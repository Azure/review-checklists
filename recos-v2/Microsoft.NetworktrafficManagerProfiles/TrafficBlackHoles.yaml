guid: c31f76a0-48cd-9f44-aa43-99ee904db9bc
name: TrafficBlackHoles
title: Ensure endpoint configured to (All World) for geographic profiles
description: |-
  For geographic routing, traffic is directed to endpoints based on specific regions. If a region fails, without a predefined failover, configuring an endpoint to "All (World)" for geographic profiles can prevent traffic black holes, ensuring service remains available.
source:
  type: aprl
  file: azure-resources/Network/trafficManagerProfiles/recommendations.yaml
  timestamp: July 24, 2024
services:
- Microsoft.Network/trafficManagerProfiles
resourceTypes:
- Microsoft.Network/trafficManagerProfiles
severity: 0
labels:
  area: Disaster Recovery
links: []
queries:
  arg: |-
    // Azure Resource Graph Query
    // Provides a list of Traffic Manager resources that are not confirgured for all-World access
    Resources
    | where type == 'microsoft.network/trafficmanagerprofiles'
    | where properties.trafficRoutingMethod =~ "Geographic"
    | extend endpoints = properties.endpoints
    | mv-expand endpoint = endpoints
    | where endpoint.properties.geoMapping !contains "WORLD"
    | extend endpointName = endpoint.name
    | project recommendationId="c31f76a0-48cd-9f44-aa43-99ee904db9bc", name, id, tags, param1=strcat("endpointName:",endpointName), param2=strcat("GeoMapping:", tostring(endpoint.properties.geoMapping))
