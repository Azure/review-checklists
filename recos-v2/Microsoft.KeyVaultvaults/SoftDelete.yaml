guid: 1cca00d2-d9ab-8e42-a788-5d40f49405cb
name: SoftDelete
title: Key vaults should have soft delete enabled
description: |-
  Key Vault's soft-delete feature enables recovery of deleted vaults and objects like keys, secrets, and certificates. When enabled, marked resources are retained for 90 days, allowing for their recovery, essentially undoing deletion.
source:
  type: aprl
  file: azure-resources/KeyVault/vaults/recommendations.yaml
  timestamp: July 24, 2024
services:
- Microsoft.KeyVault/vaults
resourceTypes:
- Microsoft.KeyVault/vaults
severity: 0
labels:
  area: Disaster Recovery
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // This Resource Graph query will return all Key Vaults that do not have soft delete enabled.
    resources
    | where type == "microsoft.keyvault/vaults"
    | where isnull(properties.enableSoftDelete) or properties.enableSoftDelete != "true"
    | project recommendationId = "1cca00d2-d9ab-8e42-a788-5d40f49405cb", name, id, tags, param1 = "EnableSoftDelete: Disabled"
