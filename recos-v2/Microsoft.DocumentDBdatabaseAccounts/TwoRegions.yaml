guid: 43663217-a1d3-844b-80ea-571a2ce37c6c
name: TwoRegions
title: Configure at least two regions for high availability
description: Enable a secondary region in Cosmos DB for higher SLA without downtime.
  Simple as pinning a location on a map. For Strong consistency, configure at least
  three regions for write availability in case of failure.
source:
  type: aprl
  file: azure-resources/DocumentDB/databaseAccounts/recommendations.yaml
  timestamp: July 24, 2024
services:
- Microsoft.DocumentDB/databaseAccounts
resourceTypes:
- Microsoft.DocumentDB/databaseAccounts
severity: 0
labels:
  area: High Availability
links: []
queries:
  arg: |-
    // Azure Resource Graph Query
    // Query to find Azure Cosmos DB accounts that have less than 2 regions or less than 3 regions with strong consistency level
    Resources
    | where type =~ 'Microsoft.DocumentDb/databaseAccounts'
    | where
        array_length(properties.locations) < 2 or
        (array_length(properties.locations) < 3 and properties.consistencyPolicy.defaultConsistencyLevel == 'Strong')
    | project recommendationId='43663217-a1d3-844b-80ea-571a2ce37c6c', name, id, tags
