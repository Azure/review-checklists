guid: 0b5a380c-4bfb-47bc-b1d7-dcfef363a61b
name: AzureFrontDoorOriginGroup
title: Disable health probes when there is only one origin in an Azure Front Door
  origin group.
source:
  type: revcl
  file: ./checklists/waf_checklist.en.json
services:
- Front Door
resourceTypes:
- microsoft.network/frontdoors
waf: Performance
severity: 2
labels: {}
links:
- https://learn.microsoft.com/azure/frontdoor/best-practices#disable-health-probes-when-theres-only-one-origin-in-an-origin-group
queries:
  arg: cdnresources | where type =~ 'microsoft.cdn/profiles/origingroups/origins'
    | extend frontDoorId = substring(id, 0, indexof(id, '/origingroups')) | extend
    originGroupId = substring(id, 0, indexof(id, '/origins')) | join kind=inner (cdnresources
    | where type =~ 'microsoft.cdn/profiles/origingroups' | extend originGroupName
    = name | extend hasHealthProbe = isnotnull(properties.healthProbeSettings)) on
    $left.originGroupId == $right.id | summarize numberOrigins = count() by originGroupId,
    subscriptionId, frontDoorId, hasHealthProbe, originGroupName | extend compliant
    = not(numberOrigins == 1 and hasHealthProbe) | project id = frontDoorId, compliant
