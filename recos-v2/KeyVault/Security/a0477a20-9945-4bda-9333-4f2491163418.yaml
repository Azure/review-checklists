guid: a0477a20-9945-4bda-9333-4f2491163418
labels:
  alzArea: Security
  alzId: G02.02
  alzSubarea: Encryption and keys
  checklist: alz
links:
- https://learn.microsoft.com/azure/key-vault/general/overview-throttling
queries:
  arg: ResourceContainers | where type=='microsoft.resources/subscriptions'| parse
    id with '/subscriptions/' SubscriptionID| project subscriptionId, SubscriptionName
    = name| join kind=leftouter (Resources| where type == 'microsoft.keyvault/vaults'|
    project id, name, subscriptionId) on subscriptionId| join kind= leftouter (Resources|
    where type == 'microsoft.keyvault/vaults'| summarize ResourceCount = count() by
    subscriptionId) on subscriptionId| extend RCount = iff(isnull(ResourceCount),
    0, ResourceCount)| project-away ResourceCount| extend compliant = (RCount <> 1)
resourceTypes: []
service: Key Vault
severity: 1
title: Use different Azure Key Vaults for different applications and regions to avoid
  transaction scale limits and restrict access to secrets.
waf: Security
