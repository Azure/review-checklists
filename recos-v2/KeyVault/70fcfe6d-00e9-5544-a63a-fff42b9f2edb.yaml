description: 'Purge protection secures against malicious deletions by enforcing a
  retention period for soft deleted key vaults, ensuring no one, not even insiders
  or Microsoft, can purge your key vaults during this period, preventing permanent
  data loss.

  '
guid: 70fcfe6d-00e9-5544-a63a-fff42b9f2edb
labels:
  area: Disaster Recovery
  source: azure-resources/KeyVault/vaults/recommendations.yaml
  sourceType: aprl
links: []
queries:
- arg: '// Azure Resource Graph Query

    // This resource graph query will return all Key Vaults that do not have Purge
    Protection enabled.

    resources

    | where type == "microsoft.keyvault/vaults"

    | where isnull(properties.enablePurgeProtection) or properties.enablePurgeProtection
    != "true"

    | project recommendationId = "70fcfe6d-00e9-5544-a63a-fff42b9f2edb", name, id,
    tags, param1 = "EnablePurgeProtection: Disabled"


    '
resourceTypes:
- Microsoft.KeyVault/vaults
service: Key Vault
severity: 1
text: Key vaults should have purge protection enabled
