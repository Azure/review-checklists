{
    "$schema": "https://raw.githubusercontent.com/Azure/review-checklists/main/checklists/checklist.schema.json",
    "items": [
        {
            "description": "You need to use a minimum of Enterprise SKU for your managed domain to support replica sets.\n",
            "aprlGuid": "bb6deb9d-24fa-4ee8-bc23-ac3ebc7fdf8e",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.AAD/domainServices",
            "recommendationMetadataState": "Active",
            "longDescription": "You need to use a minimum of Enterprise SKU for your managed domain to support replica sets.\n",
            "potentialBenefits": "The Enterprise SKU enables creation of replica sets.",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Create and use replica sets for resiliency or geolocation in Microsoft Entra Domain Services",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/domain-services/tutorial-create-replica-set"
                }
            ],
            "service": "Microsoft.AAD/domainServices",
            "text": "Use at least the Enterprise SKU",
            "severity": "High",
            "category": "High Availability",
            "guid": "bb6deb9d-24fa-4ee8-bc23-ac3ebc7fdf8e",
            "source": "azure-resources/AAD/domainServices/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Gets Entry Domain Services that are using the Standard SKU\nresources\n| where type == \"microsoft.aad/domainservices\"\n| extend sku = properties.sku\n| where sku =~ 'Standard'\n| project recommendationId='bb6deb9d-24fa-4ee8-bc23-ac3ebc7fdf8e', name=name, id=id, tags=tags, param1=strcat('SKU:', sku)\n"
        },
        {
            "description": "To improve the resiliency of a Microsoft Entra Domain Services managed domain, or deploy to additional geographic locations close to your applications, you can use replica sets.\nYou can add a replica set to any peered virtual network in any Azure region that supports Domain Services.\n",
            "aprlGuid": "a3058909-fcf8-4450-88b5-499f57449178",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.AAD/domainServices",
            "recommendationMetadataState": "Active",
            "longDescription": "To improve the resiliency of a Microsoft Entra Domain Services managed domain, or deploy to additional geographic locations close to your applications, you can use replica sets.\nYou can add a replica set to any peered virtual network in any Azure region that supports Domain Services.\n",
            "potentialBenefits": "The replica sets provide geographical resiliency.",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Create and use replica sets for resiliency or geolocation in Microsoft Entra Domain Services",
                    "url": "https://learn.microsoft.com/en-us/entra/identity/domain-services/tutorial-create-replica-set"
                }
            ],
            "service": "Microsoft.AAD/domainServices",
            "text": "Use replica sets for resiliency or geolocation in Microsoft Entra Domain Services",
            "severity": "High",
            "category": "High Availability",
            "guid": "a3058909-fcf8-4450-88b5-499f57449178",
            "source": "azure-resources/AAD/domainServices/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Gets Entry Domain Services that are using only one replicaSet\nresources\n| where type == \"microsoft.aad/domainservices\"\n| extend replicaSets = properties.replicaSets\n| where array_length(replicaSets) < 2\n| project recommendationId='a3058909-fcf8-4450-88b5-499f57449178', name=name, id=id, tags=tags, param1=strcat('replicaSetLocation:', replicaSets[0].location)\n"
        },
        {
            "description": "Ensure Azure Service Health notifications are set for Azure VMware Solution across all used regions and subscriptions. This communicates service/security issues and maintenance activities like host replacements and upgrades, reducing service request submissions.\n",
            "aprlGuid": "74fcb9f2-9a25-49a6-8c42-d32851c4afb7",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.AVS/privateClouds",
            "recommendationMetadataState": "Active",
            "longDescription": "Ensure Azure Service Health notifications are set for Azure VMware Solution across all used regions and subscriptions. This communicates service/security issues and maintenance activities like host replacements and upgrades, reducing service request submissions.\n",
            "potentialBenefits": "Prompt mitigation of issues.",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/scenarios/azure-vmware/eslz-management-and-monitoring#design-recommendations"
                }
            ],
            "service": "Microsoft.AVS/privateClouds",
            "text": "Configure Azure Service Health notifications and alerts for Azure VMware Solution",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "74fcb9f2-9a25-49a6-8c42-d32851c4afb7",
            "source": "azure-resources/AVS/privateClouds/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure VMware Solution resources that don't have one or more service health alerts covering AVS private clouds in the deployed subscription and region pairs.\n//full list of private clouds\n(resources\n| where ['type'] == \"microsoft.avs/privateclouds\"\n| extend locale = tolower(location)\n| extend subscriptionId = tolower(subscriptionId)\n| project id, name, tags, subscriptionId, locale)\n| join kind=leftouter\n//Alert ID's that include all incident types filtered by AVS Service Health alerts\n((resources\n| where type == \"microsoft.insights/activitylogalerts\"\n| extend alertproperties = todynamic(properties)\n| where alertproperties.condition.allOf[0].field == \"category\" and alertproperties.condition.allOf[0].equals == \"ServiceHealth\"\n| where alertproperties.condition.allOf[1].field == \"properties.impactedServices[*].ServiceName\" and set_has_element(alertproperties.condition.allOf[1].containsAny, \"Azure VMware Solution\")\n| extend locale = strcat_array(split(tolower(alertproperties.condition.allOf[2].containsAny),' '), '')\n| mv-expand todynamic(locale)\n| where locale != \"global\"\n| project subscriptionId, tostring(locale) )\n| union\n//Alert ID's that include only some of the incident types after filtering by service health alerts covering AVS private clouds.\n(resources\n| where type == \"microsoft.insights/activitylogalerts\"\n| extend subscriptionId = tolower(subscriptionId)\n| extend alertproperties = todynamic(properties)\n| where alertproperties.condition.allOf[0].field == \"category\" and alertproperties.condition.allOf[0].equals == \"ServiceHealth\"\n| where alertproperties.condition.allOf[2].field == \"properties.impactedServices[*].ServiceName\" and set_has_element(alertproperties.condition.allOf[2].containsAny, \"Azure VMware Solution\")\n| extend locale = strcat_array(split(tolower(alertproperties.condition.allOf[3].containsAny),' '), '')\n| mv-expand todynamic(locale)\n| mv-expand alertproperties.condition.allOf[1].anyOf\n| extend incidentType = alertproperties_condition_allOf_1_anyOf.equals\n| where locale != \"global\"\n| project id, subscriptionId, locale, incidentType\n| distinct subscriptionId, tostring(locale), tostring(incidentType)\n| summarize incidentTypes=count() by subscriptionId, locale\n| where incidentTypes == 5 //only include this subscription, region pair if it includes all the incident types.\n| project subscriptionId, locale)) on subscriptionId, locale\n| where subscriptionId1 == \"\" or locale1 == \"\" or isnull(subscriptionId1) or isnull(locale1)\n| project recommendationId = \"74fcb9f2-9a25-49a6-8c42-d32851c4afb7\", name, id, tags, param1 = \"avsServiceHealthAlertsAllIncidentTypesConfigured: False\"\n\n"
        },
        {
            "description": "Set an alert for when the node count in Azure VMware Solution Private Cloud hits or exceeds 90 hosts, enabling timely planning for a new private cloud.\n",
            "aprlGuid": "29d7a115-dfb6-4df1-9205-04824109548f",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.AVS/privateClouds",
            "recommendationMetadataState": "Active",
            "longDescription": "Set an alert for when the node count in Azure VMware Solution Private Cloud hits or exceeds 90 hosts, enabling timely planning for a new private cloud.\n",
            "potentialBenefits": "Proactive capacity planning",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure and streamline alerts",
                    "url": "https://learn.microsoft.com/en-us/azure/well-architected/azure-vmware/monitoring#configure-and-streamline-alerts"
                }
            ],
            "service": "Microsoft.AVS/privateClouds",
            "text": "Monitor when Azure VMware Solution Private Cloud is reaching the capacity limit",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "29d7a115-dfb6-4df1-9205-04824109548f",
            "source": "azure-resources/AVS/privateClouds/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Alert when the cluster size reaches 14 hosts. Set up periodic alerts for planning new clusters or datastores due to growth, especially from storage needs. Beyond 14 hosts, trigger alerts for each new host addition for proactive resource monitoring.\n",
            "aprlGuid": "f86355e3-de7c-4dad-8080-1b0b411e66c8",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.AVS/privateClouds",
            "recommendationMetadataState": "Active",
            "longDescription": "Alert when the cluster size reaches 14 hosts. Set up periodic alerts for planning new clusters or datastores due to growth, especially from storage needs. Beyond 14 hosts, trigger alerts for each new host addition for proactive resource monitoring.\n",
            "potentialBenefits": "Proactive resource management",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/en-us/azure/well-architected/azure-vmware/monitoring#configure-and-streamline-alerts"
                }
            ],
            "service": "Microsoft.AVS/privateClouds",
            "text": "Monitor when Azure VMware Solution Cluster Size is approaching the host limit",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "f86355e3-de7c-4dad-8080-1b0b411e66c8",
            "source": "azure-resources/AVS/privateClouds/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "For Azure VMware Solution, enabling Stretched Clusters offers 99.99% SLA, synchronous storage replication (RPO=0), and spreads vSAN datastore across two AZs. Must be done at initial setup, needing double quota due to extension across AZs.\n",
            "aprlGuid": "9ec5b4c8-3dd8-473a-86ee-3273290331b9",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.AVS/privateClouds",
            "recommendationMetadataState": "Active",
            "longDescription": "For Azure VMware Solution, enabling Stretched Clusters offers 99.99% SLA, synchronous storage replication (RPO=0), and spreads vSAN datastore across two AZs. Must be done at initial setup, needing double quota due to extension across AZs.\n",
            "potentialBenefits": "99.99% SLA, 0 RPO, Multi-AZ",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/en-us/azure/well-architected/azure-vmware/infrastructure#implement-high-availability"
                },
                {
                    "name": "Stretched Clusters",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-vmware/deploy-vsan-stretched-clusters"
                }
            ],
            "service": "Microsoft.AVS/privateClouds",
            "text": "Enable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore",
            "severity": "Low",
            "category": "High Availability",
            "guid": "9ec5b4c8-3dd8-473a-86ee-3273290331b9",
            "source": "azure-resources/AVS/privateClouds/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure VMware Solution resources that aren't configured as stretched clusters and in supported regions.\nresources\n| where ['type'] == \"microsoft.avs/privateclouds\"\n| extend avsproperties = todynamic(properties)\n| where avsproperties.availability.strategy != \"DualZone\"\n| where location in (\"uksouth\", \"westeurope\", \"germanywestcentral\", \"australiaeast\")\n| project recommendationId = \"9ec5b4c8-3dd8-473a-86ee-3273290331b9\", name, id, tags, param1 = \"stretchClusters: Disabled\"\n\n"
        },
        {
            "description": "Ensure VMware vSAN datastore slack space is maintained for SLA by monitoring storage utilization and setting alerts at 70% and 75% utilization to allow for capacity planning. To expand, add hosts or external storage like Azure Elastic SAN, Azure NetApp Files, if CPU and RAM requirements are met.\n",
            "aprlGuid": "4232eb32-3241-4049-9e14-9b8005817b56",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.AVS/privateClouds",
            "recommendationMetadataState": "Active",
            "longDescription": "Ensure VMware vSAN datastore slack space is maintained for SLA by monitoring storage utilization and setting alerts at 70% and 75% utilization to allow for capacity planning. To expand, add hosts or external storage like Azure Elastic SAN, Azure NetApp Files, if CPU and RAM requirements are met.\n",
            "potentialBenefits": "Optimized capacity planning for vSAN",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-vmware/configure-alerts-for-azure-vmware-solution#supported-metrics-and-activities"
                }
            ],
            "service": "Microsoft.AVS/privateClouds",
            "text": "Configure Azure Monitor Alert warning thresholds for vSAN datastore utilization",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "4232eb32-3241-4049-9e14-9b8005817b56",
            "source": "azure-resources/AVS/privateClouds/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure VMware Solution resources that don't have a vSAN capacity critical alert with a threshold of 75% or a warning capacity of 70%.\n(\nresources\n| where ['type'] == \"microsoft.avs/privateclouds\"\n| extend scopeId = tolower(tostring(id))\n| project ['scopeId'], name, id, tags\n| join kind=leftouter (\nresources\n| where type == \"microsoft.insights/metricalerts\"\n| extend alertProperties = todynamic(properties)\n| mv-expand alertProperties.scopes\n| mv-expand alertProperties.criteria.allOf\n| extend scopeId = tolower(tostring(alertProperties_scopes))\n| extend metric = alertProperties_criteria_allOf.metricName\n| extend threshold = alertProperties_criteria_allOf.threshold\n| project scopeId, tostring(metric), toint(['threshold'])\n| where metric == \"DiskUsedPercentage\"\n| where threshold == 75\n) on scopeId\n| where isnull(['threshold'])\n| project recommendationId = \"4232eb32-3241-4049-9e14-9b8005817b56\", name, id, tags, param1 = \"vsanCapacityCriticalAlert: isNull or threshold != 75\"\n)\n| union (\nresources\n| where ['type'] == \"microsoft.avs/privateclouds\"\n| extend scopeId = tolower(tostring(id))\n| project ['scopeId'], name, id, tags\n| join kind=leftouter (\nresources\n| where type == \"microsoft.insights/metricalerts\"\n| extend alertProperties = todynamic(properties)\n| mv-expand alertProperties.scopes\n| mv-expand alertProperties.criteria.allOf\n| extend scopeId = tolower(tostring(alertProperties_scopes))\n| extend metric = alertProperties_criteria_allOf.metricName\n| extend threshold = alertProperties_criteria_allOf.threshold\n| project scopeId, tostring(metric), toint(['threshold'])\n| where metric == \"DiskUsedPercentage\"\n| where threshold == 70\n) on scopeId\n| where isnull(['threshold'])\n| project recommendationId = \"4232eb32-3241-4049-9e14-9b8005817b56\", name, id, tags, param1 = \"vsanCapacityWarningAlert: isNull or threshold != 70\"\n)\n\n"
        },
        {
            "description": "Ensure Diagnostic Settings are configured for each private cloud to send syslogs to external sources for analysis and/or archiving. Azure VMware Solution Syslogs contain data for troubleshooting and performance, aiding quicker issue resolution and early detection of issues.\n",
            "aprlGuid": "fa4ab927-bced-429a-971a-53350de7f14b",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.AVS/privateClouds",
            "recommendationMetadataState": "Active",
            "longDescription": "Ensure Diagnostic Settings are configured for each private cloud to send syslogs to external sources for analysis and/or archiving. Azure VMware Solution Syslogs contain data for troubleshooting and performance, aiding quicker issue resolution and early detection of issues.\n",
            "potentialBenefits": "Faster issue resolution, early detection",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/en-us/azure/well-architected/azure-vmware/monitoring#manage-logs-and-archives"
                }
            ],
            "service": "Microsoft.AVS/privateClouds",
            "text": "Configure Syslog in Diagnostic Settings for Azure VMware Solution",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "fa4ab927-bced-429a-971a-53350de7f14b",
            "source": "azure-resources/AVS/privateClouds/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Ensure sufficient compute resources to avoid host resource exhaustion in Azure VMware Solution, which utilizes vSphere DRS and HA for dynamic workload resource management. However, sustained CPU utilization over 95% may increase CPU Ready times, impacting workloads.\n",
            "aprlGuid": "4ee5d535-c47b-470a-9557-4a3dd297d62f",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.AVS/privateClouds",
            "recommendationMetadataState": "Active",
            "longDescription": "Ensure sufficient compute resources to avoid host resource exhaustion in Azure VMware Solution, which utilizes vSphere DRS and HA for dynamic workload resource management. However, sustained CPU utilization over 95% may increase CPU Ready times, impacting workloads.\n",
            "potentialBenefits": "Avoids resource exhaustion, optimizes performance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/en-us/azure/well-architected/azure-vmware/monitoring#configure-and-streamline-alerts"
                }
            ],
            "service": "Microsoft.AVS/privateClouds",
            "text": "Monitor CPU Utilization to ensure sufficient resources for workloads",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "4ee5d535-c47b-470a-9557-4a3dd297d62f",
            "source": "azure-resources/AVS/privateClouds/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure VMware Solution resources that don't have a Cluster CPU capacity critical alert with a threshold of 95%.\nresources\n| where ['type'] == \"microsoft.avs/privateclouds\"\n| extend scopeId = tolower(tostring(id))\n| project ['scopeId'], name, id, tags\n| join kind=leftouter (\nresources\n| where type == \"microsoft.insights/metricalerts\"\n| extend alertProperties = todynamic(properties)\n| mv-expand alertProperties.scopes\n| mv-expand alertProperties.criteria.allOf\n| extend scopeId = tolower(tostring(alertProperties_scopes))\n| extend metric = alertProperties_criteria_allOf.metricName\n| extend threshold = alertProperties_criteria_allOf.threshold\n| project scopeId, tostring(metric), toint(['threshold'])\n| where metric == \"EffectiveCpuAverage\"\n| where threshold == 95\n) on scopeId\n| where isnull(['threshold'])\n| project recommendationId = \"4ee5d535-c47b-470a-9557-4a3dd297d62f\", name, id, tags, param1 = \"hostCpuCriticalAlert: isNull or threshold != 95\"\n\n"
        },
        {
            "description": "Ensure sufficient memory resources to prevent host resource exhaustion in Azure VMware Solution. It uses vSphere DRS and vSphere HA for dynamic workload management. Yet, continuous memory use over 95% leads to disk swapping, affecting workloads.\n",
            "aprlGuid": "029208c8-5186-4a76-8ee8-6e3445fef4dd",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.AVS/privateClouds",
            "recommendationMetadataState": "Active",
            "longDescription": "Ensure sufficient memory resources to prevent host resource exhaustion in Azure VMware Solution. It uses vSphere DRS and vSphere HA for dynamic workload management. Yet, continuous memory use over 95% leads to disk swapping, affecting workloads.\n",
            "potentialBenefits": "Avoids host exhaustion and swapping",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/en-us/azure/well-architected/azure-vmware/monitoring#configure-and-streamline-alerts"
                }
            ],
            "service": "Microsoft.AVS/privateClouds",
            "text": "Monitor Memory Utilization to ensure sufficient resources for workloads",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "029208c8-5186-4a76-8ee8-6e3445fef4dd",
            "source": "azure-resources/AVS/privateClouds/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure VMware Solution resources that don't have a cluster host memory critical alert with a threshold of 95%.\nresources\n| where ['type'] == \"microsoft.avs/privateclouds\"\n| extend scopeId = tolower(tostring(id))\n| project ['scopeId'], name, id, tags\n| join kind=leftouter (\nresources\n| where type == \"microsoft.insights/metricalerts\"\n| extend alertProperties = todynamic(properties)\n| mv-expand alertProperties.scopes\n| mv-expand alertProperties.criteria.allOf\n| extend scopeId = tolower(tostring(alertProperties_scopes))\n| extend metric = alertProperties_criteria_allOf.metricName\n| extend threshold = alertProperties_criteria_allOf.threshold\n| project scopeId, tostring(metric), toint(['threshold'])\n| where metric == \"UsageAverage\"\n| where threshold == 95\n) on scopeId\n| where isnull(['threshold'])\n| project recommendationId = \"029208c8-5186-4a76-8ee8-6e3445fef4dd\", name, id, tags, param1 = \"hostMemoryCriticalAlert: isNull or threshold != 95\"\n\n"
        },
        {
            "description": "Applying a resource delete lock to the Azure VMware Solution Private Cloud resource group prevents unauthorized or accidental deletion by anyone with contributor access, ensuring the protection and reliability of the Azure VMware Solution Private Cloud.\n",
            "aprlGuid": "a5ef7c05-c611-4842-9af5-11efdc99123a",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.AVS/privateClouds",
            "recommendationMetadataState": "Active",
            "longDescription": "Applying a resource delete lock to the Azure VMware Solution Private Cloud resource group prevents unauthorized or accidental deletion by anyone with contributor access, ensuring the protection and reliability of the Azure VMware Solution Private Cloud.\n",
            "potentialBenefits": "Prevents accidental deletion",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Lock your resources to protect your infrastructure",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/lock-resources"
                }
            ],
            "service": "Microsoft.AVS/privateClouds",
            "text": "Apply Resource delete lock on the resource group hosting the private cloud",
            "severity": "High",
            "category": "Governance",
            "guid": "a5ef7c05-c611-4842-9af5-11efdc99123a",
            "source": "azure-resources/AVS/privateClouds/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "When using customer-managed keys for encrypting vSAN datastores, leveraging Azure Key Vault for central management and accessing them via a managed identity linked to the private cloud is advised. The expiration of these keys can render the vSAN datastore and its associated workloads inaccessible.\n",
            "aprlGuid": "e0ac2f57-c8c0-4b8c-a7c8-19e5797828b5",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.AVS/privateClouds",
            "recommendationMetadataState": "Active",
            "longDescription": "When using customer-managed keys for encrypting vSAN datastores, leveraging Azure Key Vault for central management and accessing them via a managed identity linked to the private cloud is advised. The expiration of these keys can render the vSAN datastore and its associated workloads inaccessible.\n",
            "potentialBenefits": "Avoid outages with key auto-rotation",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure Customer Managed Keys",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-vmware/configure-customer-managed-keys?tabs=azure-portal"
                }
            ],
            "service": "Microsoft.AVS/privateClouds",
            "text": "Use key autorotation for vSAN datastore customer-managed keys",
            "severity": "High",
            "category": "Security",
            "guid": "e0ac2f57-c8c0-4b8c-a7c8-19e5797828b5",
            "source": "azure-resources/AVS/privateClouds/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Azure VMware Solution private clouds support up to three DNS servers for a single FQDN, preventing a single DNS server from becoming a point of failure. It's crucial to use multiple DNS servers for on-premises FQDN resolution from each private cloud.\n",
            "aprlGuid": "fcc2e257-23af-4c68-aac8-9cc03033c939",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.AVS/privateClouds",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure VMware Solution private clouds support up to three DNS servers for a single FQDN, preventing a single DNS server from becoming a point of failure. It's crucial to use multiple DNS servers for on-premises FQDN resolution from each private cloud.\n",
            "potentialBenefits": "Enhances reliability and avoids failure",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure DNS forwarder",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-vmware/configure-dns-azure-vmware-solution#configure-dns-forwarder"
                }
            ],
            "service": "Microsoft.AVS/privateClouds",
            "text": "Use multiple DNS servers per private FQDN zone",
            "severity": "High",
            "category": "High Availability",
            "guid": "fcc2e257-23af-4c68-aac8-9cc03033c939",
            "source": "azure-resources/AVS/privateClouds/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Upgrading the API Management instance to the Premium SKU adds support for Availability Zones, enhancing availability and resilience by distributing services across physically separate locations within Azure regions.\n",
            "aprlGuid": "baf3bfc0-32a2-4c0c-926d-c9bf0b49808e",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ApiManagement/service",
            "recommendationMetadataState": "Active",
            "longDescription": "Upgrading the API Management instance to the Premium SKU adds support for Availability Zones, enhancing availability and resilience by distributing services across physically separate locations within Azure regions.\n",
            "potentialBenefits": "Enhanced availability and resilience",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Change your API Management service tier",
                    "url": "https://learn.microsoft.com/en-us/azure/api-management/upgrade-and-scale#change-your-api-management-service-tier"
                },
                {
                    "name": "Migrate Azure API Management to availability zone support",
                    "url": "https://learn.microsoft.com/en-us/azure/reliability/migrate-api-mgt"
                }
            ],
            "service": "Microsoft.ApiManagement/service",
            "text": "Migrate API Management services to Premium SKU to support Availability Zones",
            "severity": "High",
            "category": "High Availability",
            "guid": "baf3bfc0-32a2-4c0c-926d-c9bf0b49808e",
            "source": "azure-resources/ApiManagement/service/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all API Management instances that aren't Premium\nresources\n| where type =~ 'Microsoft.ApiManagement/service'\n| extend skuName = sku.name\n| where tolower(skuName) != tolower('premium')\n| project recommendationId = \"baf3bfc0-32a2-4c0c-926d-c9bf0b49808e\", name, id, tags, param1=strcat(\"SKU: \", skuName)\n\n"
        },
        {
            "description": "Zone redundancy for APIM instances ensures the gateway and control plane (Management API, developer portal, Git configuration) are replicated across datacenters in physically separated zones, boosting resilience to zone failures.\n",
            "aprlGuid": "740f2c1c-8857-4648-80eb-47d2c56d5a50",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ApiManagement/service",
            "recommendationMetadataState": "Active",
            "longDescription": "Zone redundancy for APIM instances ensures the gateway and control plane (Management API, developer portal, Git configuration) are replicated across datacenters in physically separated zones, boosting resilience to zone failures.\n",
            "potentialBenefits": "Improved resilience to zone failures",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Ensure API Management availability and reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/api-management/high-availability#availability-zones"
                },
                {
                    "name": "Migrate Azure API Management to availability zone support",
                    "url": "https://learn.microsoft.com/en-us/azure/reliability/migrate-api-mgt"
                }
            ],
            "service": "Microsoft.ApiManagement/service",
            "text": "Enable Availability Zones on Premium API Management instances",
            "severity": "High",
            "category": "High Availability",
            "guid": "740f2c1c-8857-4648-80eb-47d2c56d5a50",
            "source": "azure-resources/ApiManagement/service/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Premium API Management instances that aren't zone redundant\nresources\n| where type =~ 'Microsoft.ApiManagement/service'\n| extend skuName = sku.name\n| where tolower(skuName) == tolower('premium')\n| where isnull(zones) or array_length(zones) < 2\n| extend zoneValue = iff((isnull(zones)), \"null\", zones)\n| project recommendationId = \"740f2c1c-8857-4648-80eb-47d2c56d5a50\", name, id, tags, param1=\"Zones: No Zone or Zonal\", param2=strcat(\"Zones value: \", zoneValue )\n\n"
        },
        {
            "description": "Upgrading to API Management stv2 is required as stv1 retires on 31 Aug 2024, offering enhanced capabilities with the new platform version.\n",
            "aprlGuid": "e35cf148-8eee-49d1-a1c9-956160f99e0b",
            "recommendationTypeId": "e5f60ef8-3fcc-4fb5-bee7-7aaeb44c1509",
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ApiManagement/service",
            "recommendationMetadataState": "Active",
            "longDescription": "Upgrading to API Management stv2 is required as stv1 retires on 31 Aug 2024, offering enhanced capabilities with the new platform version.\n",
            "potentialBenefits": "Ensures service continuity",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure API Management - stv1 platform retirement (August 2024)",
                    "url": "https://learn.microsoft.com/en-us/azure/api-management/breaking-changes/stv1-platform-retirement-august-2024"
                },
                {
                    "name": "Azure API Management compute platform",
                    "url": "https://learn.microsoft.com/en-us/azure/api-management/compute-infrastructure"
                }
            ],
            "service": "Microsoft.ApiManagement/service",
            "text": "Azure API Management platform version should be stv2",
            "severity": "High",
            "category": "High Availability",
            "guid": "e35cf148-8eee-49d1-a1c9-956160f99e0b",
            "source": "azure-resources/ApiManagement/service/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all API Management instances that aren't upgraded to platform version stv2\nresources\n| where type =~ 'Microsoft.ApiManagement/service'\n| extend plat_version = properties.platformVersion\n| extend skuName = sku.name\n| where tolower(plat_version) != tolower('stv2')\n| project recommendationId = \"e35cf148-8eee-49d1-a1c9-956160f99e0b\", name, id, tags, param1=strcat(\"Platform Version: \", plat_version) , param2=strcat(\"SKU: \", skuName)\n\n"
        },
        {
            "description": "Use API Management with auto-scale for high availability in workloads that experience variable traffic patterns. There are several limitations with auto-scale, so review the documentation to ensure it meets your requirements.\n",
            "aprlGuid": "c79680ea-de85-44fa-a596-f31fa17a952f",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.ApiManagement/service",
            "recommendationMetadataState": "Active",
            "longDescription": "Use API Management with auto-scale for high availability in workloads that experience variable traffic patterns. There are several limitations with auto-scale, so review the documentation to ensure it meets your requirements.\n",
            "potentialBenefits": "Enhanced availability and resilience",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Setting up auto-scale for Azure API Management",
                    "url": "https://learn.microsoft.com/azure/api-management/api-management-howto-autoscale"
                }
            ],
            "service": "Microsoft.ApiManagement/service",
            "text": "Enable auto-scale for production workloads on API Management services",
            "severity": "Low",
            "category": "High Availability",
            "guid": "c79680ea-de85-44fa-a596-f31fa17a952f",
            "source": "azure-resources/ApiManagement/service/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Enable container health probes to monitor the health of your container apps and ensure that unhealthy containers are restarted automatically.\n",
            "aprlGuid": "8dbcd94b-0948-4df3-b608-1946726c3abf",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.App/containerApps",
            "recommendationMetadataState": "Active",
            "longDescription": "Enable container health probes to monitor the health of your container apps and ensure that unhealthy containers are restarted automatically.\n",
            "potentialBenefits": "Enhanced availability and resilience",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Health probes for Azure Container Apps",
                    "url": "https://learn.microsoft.com/azure/container-apps/health-probes?tabs=arm-template"
                }
            ],
            "service": "Microsoft.App/containerApps",
            "text": "Enable container health probes",
            "severity": "High",
            "category": "High Availability",
            "guid": "8dbcd94b-0948-4df3-b608-1946726c3abf",
            "source": "azure-resources/App/containerApps/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "To take advantage of availability zones, you must enable zone redundancy when you create a Container Apps environment. The environment must include a virtual network with an available subnet. To ensure proper distribution of replicas, set your app's minimum replica count to three.\n",
            "aprlGuid": "f4201965-a88d-449d-b3b4-021394719eb2",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.App/managedenvironments",
            "recommendationMetadataState": "Active",
            "longDescription": "To take advantage of availability zones, you must enable zone redundancy when you create a Container Apps environment. The environment must include a virtual network with an available subnet. To ensure proper distribution of replicas, set your app's minimum replica count to three.\n",
            "potentialBenefits": "Enhances app resiliency and reliability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Reliability in Azure Container Apps",
                    "url": "https://learn.microsoft.com/en-us/azure/reliability/reliability-azure-container-apps"
                }
            ],
            "service": "Microsoft.App/managedenvironments",
            "text": "Deploy zone redundant Container app environments",
            "severity": "High",
            "category": "High Availability",
            "guid": "f4201965-a88d-449d-b3b4-021394719eb2",
            "source": "azure-resources/App/managedEnvironments/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// The query filters the qualified Container app environments that do not have Zone Redundancy enabled.\nresources\n| where type =~ \"microsoft.app/managedenvironments\"\n| where tobool(properties.zoneRedundant) == false\n| project recommendationId = \"f4201965-a88d-449d-b3b4-021394719eb2\", name, id, tags, param1 = \"AvailabilityZones: Single Zone\"\n| order by id asc\n"
        },
        {
            "description": "With Purge protection enabled, soft deleted stores can't be purged in the retention period. If disabled, the soft deleted store can be purged before the retention period expires.\n",
            "aprlGuid": "bb4c8db4-f821-475b-b1ea-16e95358665e",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.AppConfiguration/configurationStores",
            "recommendationMetadataState": "Active",
            "longDescription": "With Purge protection enabled, soft deleted stores can't be purged in the retention period. If disabled, the soft deleted store can be purged before the retention period expires.\n",
            "potentialBenefits": "Prevent accidental deletion of configuration stores.",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Purge protection",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-app-configuration/concept-soft-delete#purge-protection"
                }
            ],
            "service": "Microsoft.AppConfiguration/configurationStores",
            "text": "Enable Purge protection for Azure App Configuration",
            "severity": "Low",
            "category": "Governance",
            "guid": "bb4c8db4-f821-475b-b1ea-16e95358665e",
            "source": "azure-resources/AppConfiguration/configurationStores/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Purge protection should be enabled for App Configuration stores to prevent accidental deletion of configuration data.\nresources\n| where type =~ \"Microsoft.AppConfiguration/configurationStores\"\n| where sku.name <> \"free\"\n| where (properties.enablePurgeProtection <> true) or isnull(properties.enablePurgeProtection )\n| project recommendationId = \"bb4c8db4-f821-475b-b1ea-16e95358665e\", name, id, tags, param1 = \"Enable purge protection\"\n"
        },
        {
            "description": "SLA is not available for Free tier. Upgrade to the Standard tier to get an SLA of 99.9%\n",
            "aprlGuid": "2102a57a-a056-4d5e-afe5-9df9f92177ca",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.AppConfiguration/configurationStores",
            "recommendationMetadataState": "Active",
            "longDescription": "SLA is not available for Free tier. Upgrade to the Standard tier to get an SLA of 99.9%\n",
            "potentialBenefits": "High availability, more storage, higher request quota.",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Choose App Configuration tier",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-app-configuration/faq#which-app-configuration-tier-should-i-use"
                }
            ],
            "service": "Microsoft.AppConfiguration/configurationStores",
            "text": "Upgrade to App Configuration Standard tier",
            "severity": "High",
            "category": "High Availability",
            "guid": "2102a57a-a056-4d5e-afe5-9df9f92177ca",
            "source": "azure-resources/AppConfiguration/configurationStores/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Upgrade to App Configuration Standard tier\nresources\n| where type =~ \"Microsoft.AppConfiguration/configurationStores\"\n| where sku.name == \"free\"\n| project recommendationId = \"2102a57a-a056-4d5e-afe5-9df9f92177ca\", name, id, tags, param1 = \"Upgrade to Standard SKU\"\n"
        },
        {
            "description": "Set up disaster recovery for Automation accounts and resources like Modules, Connections, Credentials, Certificates, Variables, and Schedules to deal with region or zone failures. A replica Automation account should be ready in a secondary region for failover.\n",
            "aprlGuid": "67205887-0733-466e-b50e-b1cd7316c514",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Automation/automationAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Set up disaster recovery for Automation accounts and resources like Modules, Connections, Credentials, Certificates, Variables, and Schedules to deal with region or zone failures. A replica Automation account should be ready in a secondary region for failover.\n",
            "potentialBenefits": "Ensures continuity during outages",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Disaster recovery for Automation accounts",
                    "url": "https://learn.microsoft.com/en-us/azure/automation/automation-disaster-recovery?tabs=win-hrw%2Cps-script%2Coption-one"
                },
                {
                    "name": "Disaster recovery scenarios for cloud and hybrid jobs",
                    "url": "https://learn.microsoft.com/en-us/azure/automation/automation-disaster-recovery?tabs=win-hrw%2Cps-script%2Coption-one#scenarios-for-cloud-and-hybrid-jobs"
                }
            ],
            "service": "Microsoft.Automation/automationAccounts",
            "text": "Set up disaster recovery of Automation accounts and its dependent resources",
            "severity": "High",
            "category": "High Availability",
            "guid": "67205887-0733-466e-b50e-b1cd7316c514",
            "source": "azure-resources/Automation/automationAccounts/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "To ensure cross-region disaster recovery and business continuity, set the right quotas for all Batch accounts to allocate necessary core numbers upfront, preventing execution interruptions from reaching quota limits.\n",
            "aprlGuid": "3464854d-6f75-4922-95e4-a2a308b53ce6",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Batch/batchAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "To ensure cross-region disaster recovery and business continuity, set the right quotas for all Batch accounts to allocate necessary core numbers upfront, preventing execution interruptions from reaching quota limits.\n",
            "potentialBenefits": "Ensures business continuity",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/azure/reliability/reliability-batch#cross-region-disaster-recovery-and-business-continuity"
                }
            ],
            "service": "Microsoft.Batch/batchAccounts",
            "text": "Monitor Batch Account quota",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "3464854d-6f75-4922-95e4-a2a308b53ce6",
            "source": "azure-resources/Batch/batchAccounts/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "When using Virtual Machine Configuration for Azure Batch pools, opting to distribute your pool across Availability Zones bolsters your compute nodes against Azure datacenter failures.\n",
            "aprlGuid": "71cfab8f-d588-4742-b175-b6e07ae48dbd",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Batch/batchAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "When using Virtual Machine Configuration for Azure Batch pools, opting to distribute your pool across Availability Zones bolsters your compute nodes against Azure datacenter failures.\n",
            "potentialBenefits": "Enhanced reliability and failure protection",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/azure/batch/create-pool-availability-zones"
                }
            ],
            "service": "Microsoft.Batch/batchAccounts",
            "text": "Create an Azure Batch pool across Availability Zones",
            "severity": "High",
            "category": "High Availability",
            "guid": "71cfab8f-d588-4742-b175-b6e07ae48dbd",
            "source": "azure-resources/Batch/batchAccounts/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Azure Cache for Redis offers zone redundancy in Premium and Enterprise tiers, using VMs across multiple Availability Zones to ensure greater resilience and availability.\n",
            "aprlGuid": "5a44bd30-ae6a-4b81-9b68-dc3a8ffca4d8",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Cache/Redis",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Cache for Redis offers zone redundancy in Premium and Enterprise tiers, using VMs across multiple Availability Zones to ensure greater resilience and availability.\n",
            "potentialBenefits": "Higher resilience and availability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Enable zone redundancy for Azure Cache for Redis",
                    "url": "https://learn.microsoft.com/azure/azure-cache-for-redis/cache-how-to-zone-redundancy"
                }
            ],
            "service": "Microsoft.Cache/Redis",
            "text": "Enable zone redundancy for Azure Cache for Redis",
            "severity": "High",
            "category": "High Availability",
            "guid": "5a44bd30-ae6a-4b81-9b68-dc3a8ffca4d8",
            "source": "azure-resources/Cache/Redis/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Cache for Redis instances with one or no Zones selected\nresources\n| where type =~ \"microsoft.cache/redis\"\n| where array_length(zones) <= 1 or isnull(zones)\n| project recommendationId = \"5a44bd30-ae6a-4b81-9b68-dc3a8ffca4d8\", name, id, tags, param1 = \"AvailabilityZones: Single Zone\"\n| order by id asc\n\n"
        },
        {
            "description": "Azure Cache for Redis allows for specifying maintenance windows. A maintenance window allows you to control the days and times of a week during which the VMs hosting your cache can be updated.\n",
            "aprlGuid": "cabc1f98-c8a7-44f7-ab24-977982ef3f70",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Cache/redis",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Cache for Redis allows for specifying maintenance windows. A maintenance window allows you to control the days and times of a week during which the VMs hosting your cache can be updated.\n",
            "potentialBenefits": "Higher resilience and availability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Schedule Redis Updates",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-cache-for-redis/cache-administration#update-channel-and-schedule-updates"
                }
            ],
            "service": "Microsoft.Cache/redis",
            "text": "Schedule updates by setting a maintenance window",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "cabc1f98-c8a7-44f7-ab24-977982ef3f70",
            "source": "azure-resources/Cache/Redis/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Use private endpoints for secure connection to cache via a private link, avoiding the public internet.\n",
            "aprlGuid": "c474fc96-4e6a-4fb0-95d0-a26b3f35933c",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Cache/redis",
            "recommendationMetadataState": "Active",
            "longDescription": "Use private endpoints for secure connection to cache via a private link, avoiding the public internet.\n",
            "potentialBenefits": "Secure, private VNet ingress, efficient data transfer",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure private endpoints for Azure Redis Cache",
                    "url": "https://learn.microsoft.com/azure/azure-cache-for-redis/cache-network-isolation"
                }
            ],
            "service": "Microsoft.Cache/redis",
            "text": "Configure Private Endpoints",
            "severity": "Medium",
            "category": "Security",
            "guid": "c474fc96-4e6a-4fb0-95d0-a26b3f35933c",
            "source": "azure-resources/Cache/Redis/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Azure Redis cache services not protected by private endpoints.\nResources\n| where type =~ \"microsoft.cache/redis\"\n| where properties['publicNetworkAccess'] == \"Enabled\"\n| project recommendationId = \"c474fc96-4e6a-4fb0-95d0-a26b3f35933c\", name, id, tags\n| order by id asc\n\n"
        },
        {
            "description": "For most solutions, choose either Azure Front Door for content caching, CDN, TLS termination, and WAF, or Traffic Manager for simple global load balancing.\n",
            "aprlGuid": "9437634c-d69e-2747-b13e-631c13182150",
            "recommendationTypeId": null,
            "recommendationControl": "Business Continuity",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "For most solutions, choose either Azure Front Door for content caching, CDN, TLS termination, and WAF, or Traffic Manager for simple global load balancing.\n",
            "potentialBenefits": "Optimized network routing and security",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Load Balancing Options",
                    "url": "https://learn.microsoft.com/azure/architecture/guide/technology-choices/load-balancing-overview"
                },
                {
                    "name": "Azure Traffic Manager",
                    "url": "https://learn.microsoft.com/azure/traffic-manager/traffic-manager-overview"
                },
                {
                    "name": "Azure Front Door",
                    "url": "https://learn.microsoft.com/azure/frontdoor/front-door-overview"
                },
                {
                    "name": "Mission-critical global content delivery",
                    "url": "https://learn.microsoft.com/en-us/azure/architecture/guide/networking/global-web-applications/mission-critical-content-delivery"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Avoid combining Traffic Manager and Front Door",
            "severity": "High",
            "category": "Business Continuity",
            "guid": "9437634c-d69e-2747-b13e-631c13182150",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Avoid combining Traffic Manager and Front Door\nresources\n| where type == \"microsoft.network/trafficmanagerprofiles\"\n| mvexpand(properties.endpoints)\n| extend endpoint=tostring(properties_endpoints.properties.target)\n| project name, trafficmanager=id, matchname=endpoint, tags\n| join (\n    resources\n    | where type =~ \"microsoft.cdn/profiles/afdendpoints\"\n    | extend matchname= tostring(properties.hostName)\n    | extend splitid=split(id, \"/\")\n    | extend frontdoorid=tolower(strcat_array(array_slice(splitid, 0, 8), \"/\"))\n    | project name, id, matchname, frontdoorid, type\n    | union\n        (cdnresources\n        | where type =~ \"Microsoft.Cdn/Profiles/CustomDomains\"\n        | extend matchname= tostring(properties.hostName)\n        | extend splitid=split(id, \"/\")\n        | extend frontdoorid=tolower(strcat_array(array_slice(splitid, 0, 8), \"/\"))\n        | project name, id, matchname, frontdoorid, type)\n    )\n    on matchname\n| project\n    recommendationId = \"9437634c-d69e-2747-b13e-631c13182150\",\n    name=split(trafficmanager, \"/\")[-1],\n    id=trafficmanager,\n    tags,\n    param1=strcat(\"hostname:\", matchname),\n    param2=strcat(\"frontdoorid:\", frontdoorid)\n\n"
        },
        {
            "description": "Front Door's features perform optimally when traffic exclusively comes through Front Door. It's advised to set up your origin to deny access to traffic that bypasses Front Door.\n",
            "aprlGuid": "6c40b7ae-2bea-5748-be1a-9e9e3b834649",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Front Door's features perform optimally when traffic exclusively comes through Front Door. It's advised to set up your origin to deny access to traffic that bypasses Front Door.\n",
            "potentialBenefits": "Enhances security and performance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Secure traffic to Azure Front Door origins",
                    "url": "https://learn.microsoft.com/azure/frontdoor/origin-security?tabs=app-service-functions&pivots=front-door-standard-premium"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Restrict traffic to your origins",
            "severity": "High",
            "category": "Security",
            "guid": "6c40b7ae-2bea-5748-be1a-9e9e3b834649",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "When working with Azure Front Door through APIs, ARM templates, Bicep, or SDKs, using the latest API or SDK version is crucial. Updates bring new functions, important security patches, and bug fixes.\n",
            "aprlGuid": "52bc9a7b-23c8-bc4c-9d2a-7bc43b50104a",
            "recommendationTypeId": "e607041e-3194-42ad-9994-b6ea5ec12f5e",
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "When working with Azure Front Door through APIs, ARM templates, Bicep, or SDKs, using the latest API or SDK version is crucial. Updates bring new functions, important security patches, and bug fixes.\n",
            "potentialBenefits": "Enhanced security and features",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "REST API Reference",
                    "url": "https://learn.microsoft.com/rest/api/frontdoor/"
                },
                {
                    "name": "Client library for Java",
                    "url": "https://learn.microsoft.com/java/api/overview/azure/resourcemanager-frontdoor-readme?view=azure-java-preview"
                },
                {
                    "name": "SDK for Python",
                    "url": "https://learn.microsoft.com/python/api/overview/azure/front-door?view=azure-python"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Use the latest API version and SDK version",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "52bc9a7b-23c8-bc4c-9d2a-7bc43b50104a",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Front Door logs offer comprehensive telemetry on each request, crucial for understanding your solution's performance and responses, especially when caching is enabled, as origin servers might not receive every request.\n",
            "aprlGuid": "1ad74c3c-e3d7-0046-b83f-a2199974ef15",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Front Door logs offer comprehensive telemetry on each request, crucial for understanding your solution's performance and responses, especially when caching is enabled, as origin servers might not receive every request.\n",
            "potentialBenefits": "Enhanced insights and solution monitoring",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Monitor metrics and logs in Azure Front Door",
                    "url": "https://learn.microsoft.com/azure/frontdoor/front-door-diagnostics?pivots=front-door-standard-premium"
                },
                {
                    "name": "WAF logs",
                    "url": "https://learn.microsoft.com/azure/web-application-firewall/afds/waf-front-door-monitor?pivots=front-door-standard-premium#waf-logs"
                },
                {
                    "name": "Configure Azure Front Door logs",
                    "url": "https://learn.microsoft.com/azure/frontdoor/standard-premium/how-to-logs"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Configure logs",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "1ad74c3c-e3d7-0046-b83f-a2199974ef15",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Front Door terminates TCP and TLS connections from clients and establishes new connections from each PoP to the origin. Securing these connections with TLS, even for Azure-hosted origins, ensures data is always encrypted during transit.\n",
            "aprlGuid": "d9bd6780-0d6f-cd4c-bc66-8ddcab12f3d1",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Front Door terminates TCP and TLS connections from clients and establishes new connections from each PoP to the origin. Securing these connections with TLS, even for Azure-hosted origins, ensures data is always encrypted during transit.\n",
            "potentialBenefits": "Ensures data encryption in transit",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "End-to-end TLS with Azure Front Door",
                    "url": "https://learn.microsoft.com/azure/frontdoor/end-to-end-tls?pivots=front-door-standard-premium"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Use end-to-end TLS",
            "severity": "High",
            "category": "Security",
            "guid": "d9bd6780-0d6f-cd4c-bc66-8ddcab12f3d1",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Use end-to-end TLS\ncdnresources\n| where type == \"microsoft.cdn/profiles/afdendpoints/routes\"\n| extend forwardingProtocol=tostring(properties.forwardingProtocol),supportedProtocols=properties.supportedProtocols\n| project id,name,forwardingProtocol,supportedProtocols,tags\n| where forwardingProtocol !~ \"httpsonly\" or supportedProtocols has \"http\"\n| project recommendationId= \"d9bd6780-0d6f-cd4c-bc66-8ddcab12f3d1\", name,id,tags,param1=strcat(\"forwardingProtocol:\",forwardingProtocol),param2=strcat(\"supportedProtocols:\",supportedProtocols)\n\n"
        },
        {
            "description": "Using HTTPS is ideal for secure connections. However, for compatibility with older clients, HTTP requests may be necessary. Azure Front Door enables auto redirection of HTTP to HTTPS, enhancing security without sacrificing accessibility.\n",
            "aprlGuid": "24ab9f11-a3e4-3043-a985-22cf94c4933a",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Using HTTPS is ideal for secure connections. However, for compatibility with older clients, HTTP requests may be necessary. Azure Front Door enables auto redirection of HTTP to HTTPS, enhancing security without sacrificing accessibility.\n",
            "potentialBenefits": "Enhances security and compliance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Create HTTP to HTTPS redirect rule",
                    "url": "https://learn.microsoft.com/azure/frontdoor/front-door-how-to-redirect-https#create-http-to-https-redirect-rule"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Use HTTP to HTTPS redirection",
            "severity": "High",
            "category": "Security",
            "guid": "24ab9f11-a3e4-3043-a985-22cf94c4933a",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Use HTTP to HTTPS redirection\ncdnresources\n| where type == \"microsoft.cdn/profiles/afdendpoints/routes\"\n| extend httpsRedirect=tostring(properties.httpsRedirect)\n| project id,name,httpsRedirect,tags\n| where httpsRedirect !~ \"enabled\"\n| project recommendationId= \"24ab9f11-a3e4-3043-a985-22cf94c4933a\", name,id,tags,param1=strcat(\"httpsRedirect:\",httpsRedirect)\n\n"
        },
        {
            "description": "When Front Door manages your TLS certificates, it reduces your operational costs and helps you to avoid costly outages caused by forgetting to renew a certificate. Front Door automatically issues and rotates the managed TLS certificates.\n",
            "aprlGuid": "29d65c41-2fad-d142-95eb-9eab95f6c0a5",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "When Front Door manages your TLS certificates, it reduces your operational costs and helps you to avoid costly outages caused by forgetting to renew a certificate. Front Door automatically issues and rotates the managed TLS certificates.\n",
            "potentialBenefits": "Lowers costs, avoids outages",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure HTTPS on an Azure Front Door custom domain using the Azure portal",
                    "url": "https://learn.microsoft.com/azure/frontdoor/standard-premium/how-to-configure-https-custom-domain?tabs=powershell"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Use managed TLS certificates",
            "severity": "High",
            "category": "Security",
            "guid": "29d65c41-2fad-d142-95eb-9eab95f6c0a5",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "If you use your own TLS certificates, set the Key Vault certificate version to 'Latest' to avoid reconfiguring Azure Front Door for new certificate versions and waiting for deployment across Front Door's environments.\n",
            "aprlGuid": "4638c2c0-03de-6d42-9e09-82ee4478cbf3",
            "recommendationTypeId": "2c057605-4707-4d3e-bbb0-a7fe9b6a626b",
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "If you use your own TLS certificates, set the Key Vault certificate version to 'Latest' to avoid reconfiguring Azure Front Door for new certificate versions and waiting for deployment across Front Door's environments.\n",
            "potentialBenefits": "Saves time and automates TLS updates",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Select the certificate for Azure Front Door to deploy",
                    "url": "https://learn.microsoft.com/azure/frontdoor/standard-premium/how-to-configure-https-custom-domain?tabs=powershell#select-the-certificate-for-azure-front-door-to-deploy"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Use latest version for customer-managed certificates",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "4638c2c0-03de-6d42-9e09-82ee4478cbf3",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Front Door can rewrite Host headers for custom domain names routing to a single origin, useful for avoiding custom domain configuration at both Front Door and the origin.\n",
            "aprlGuid": "cd6a32af-747a-e649-82a7-a98f528ca842",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Front Door can rewrite Host headers for custom domain names routing to a single origin, useful for avoiding custom domain configuration at both Front Door and the origin.\n",
            "potentialBenefits": "Improves session/auth handling",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Preserve the original HTTP host name between a reverse proxy and its back-end web application",
                    "url": "https://learn.microsoft.com/azure/architecture/best-practices/host-name-preservation"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Use the same domain name on Front Door and your origin",
            "severity": "Medium",
            "category": "Governance",
            "guid": "cd6a32af-747a-e649-82a7-a98f528ca842",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "For internet-facing applications, enabling the Front Door web application firewall (WAF) and configuring it to use managed rules is recommended for protection against a wide range of attacks using Microsoft-managed rules.\n",
            "aprlGuid": "1bd2b7e8-400f-e64a-99a2-c572f7b08a62",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "For internet-facing applications, enabling the Front Door web application firewall (WAF) and configuring it to use managed rules is recommended for protection against a wide range of attacks using Microsoft-managed rules.\n",
            "potentialBenefits": "Enhances web app security",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Web Application Firewall on Azure Front Door",
                    "url": "https://learn.microsoft.com/azure/frontdoor/web-application-firewall"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Enable the WAF",
            "severity": "Medium",
            "category": "Security",
            "guid": "1bd2b7e8-400f-e64a-99a2-c572f7b08a62",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Enable the WAF\n\nresources\n| where type =~ \"microsoft.cdn/profiles\" and sku has \"AzureFrontDoor\"\n| project name, cdnprofileid=tolower(id), tostring(tags), resourceGroup, subscriptionId,skuname=tostring(sku.name)\n| join kind= fullouter (\n    cdnresources\n    | where type == \"microsoft.cdn/profiles/securitypolicies\"\n    | extend wafpolicyid=tostring(properties['parameters']['wafPolicy']['id'])\n    | extend splitid=split(id, \"/\")\n    | extend cdnprofileid=tolower(strcat_array(array_slice(splitid, 0, 8), \"/\"))\n    | project secpolname=name, cdnprofileid, wafpolicyid\n    )\n    on cdnprofileid\n| project name, cdnprofileid, secpolname, wafpolicyid,skuname\n| join kind = fullouter (\n    resources\n    | where type == \"microsoft.network/frontdoorwebapplicationfirewallpolicies\"\n    | extend\n        managedrulesenabled=iff(tostring(properties.managedRules.managedRuleSets) != \"[]\", true, false),\n        enabledState = tostring(properties.policySettings.enabledState)\n    | project afdwafname=name, managedrulesenabled, wafpolicyid=id, enabledState, tostring(tags)\n    )\n    on wafpolicyid\n| where name != \"\"\n| summarize\n    associatedsecuritypolicies=countif(secpolname != \"\"),\n    wafswithmanagedrules=countif(managedrulesenabled == 1)\n    by name, id=cdnprofileid, tags,skuname\n| where associatedsecuritypolicies == 0 or wafswithmanagedrules  == 0\n| project\n    recommendationId = \"1bd2b7e8-400f-e64a-99a2-c572f7b08a62\",\n    name,\n    id,\n    todynamic(tags),\n    param1 = strcat(\"associatedsecuritypolicies:\", associatedsecuritypolicies),\n    param2 = strcat(\"wafswithmanagedrules:\", wafswithmanagedrules),\n    param3 = strcat(\"skuname:\",skuname)\n\n"
        },
        {
            "description": "Front Door health probes help detect unavailable or unhealthy origins, directing traffic to alternate origins if needed.\n",
            "aprlGuid": "38f3d542-6de6-a44b-86c6-97e3be690281",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Front Door health probes help detect unavailable or unhealthy origins, directing traffic to alternate origins if needed.\n",
            "potentialBenefits": "Reduces unnecessary origin traffic",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Health probes",
                    "url": "https://learn.microsoft.com/azure/frontdoor/health-probes"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Disable health probes when there is only one origin in an origin group",
            "severity": "Low",
            "category": "High Availability",
            "guid": "38f3d542-6de6-a44b-86c6-97e3be690281",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Disable health probes when there is only one origin in an origin group\ncdnresources\n| where type =~ \"microsoft.cdn/profiles/origingroups\"\n| extend healthprobe=tostring(properties.healthProbeSettings)\n| project origingroupname=name, id, tags, resourceGroup, subscriptionId, healthprobe\n| join (\n    cdnresources\n    | where type =~ \"microsoft.cdn/profiles/origingroups/Origins\"\n    | extend origingroupname = tostring(properties.originGroupName)\n    )\n    on origingroupname\n| summarize origincount=count(), enabledhealthprobecount=countif(healthprobe != \"\") by origingroupname, id, tostring(tags), resourceGroup, subscriptionId\n| where origincount == 1 and enabledhealthprobecount != 0\n| project\n    recommendationId = \"38f3d542-6de6-a44b-86c6-97e3be690281\",\n    name=origingroupname,\n    id,\n    todynamic(tags),\n    param1 = strcat(\"origincount:\", origincount),\n    param2 = strcat(\"enabledhealthprobecount:\", enabledhealthprobecount)\n\n"
        },
        {
            "description": "Consider selecting a webpage or location specifically designed for health monitoring as the endpoint for Azure Front Door's health probes. This should encompass the status of critical components like application servers, databases, and caches to serve production traffic efficiently.\n",
            "aprlGuid": "5225bba3-28ec-1e43-8986-7eedfd466d65",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Consider selecting a webpage or location specifically designed for health monitoring as the endpoint for Azure Front Door's health probes. This should encompass the status of critical components like application servers, databases, and caches to serve production traffic efficiently.\n",
            "potentialBenefits": "Improves traffic routing and uptime",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Health Endpoint Monitoring pattern",
                    "url": "https://learn.microsoft.com/azure/architecture/patterns/health-endpoint-monitoring"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Select good health probe endpoints",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "5225bba3-28ec-1e43-8986-7eedfd466d65",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Health probes in Azure Front Door can use GET or HEAD HTTP methods. Using the HEAD method for health probes is a recommended practice because it reduces the traffic load on your origins, being less resource-intensive.\n",
            "aprlGuid": "5783defe-b49e-d947-84f7-d8677593f324",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Health probes in Azure Front Door can use GET or HEAD HTTP methods. Using the HEAD method for health probes is a recommended practice because it reduces the traffic load on your origins, being less resource-intensive.\n",
            "potentialBenefits": "Reduces traffic load on origins",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Supported HTTP methods for health probes",
                    "url": "https://learn.microsoft.com/azure/frontdoor/health-probes#supported-http-methods-for-health-probes"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Use HEAD health probes",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "5783defe-b49e-d947-84f7-d8677593f324",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Azure Front Door's geo-filtering through WAF enables defining custom access rules by country/region to restrict or allow web app access.\n",
            "aprlGuid": "b515690d-3bf9-3a49-8d38-188e0fd45896",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Front Door's geo-filtering through WAF enables defining custom access rules by country/region to restrict or allow web app access.\n",
            "potentialBenefits": "Enhanced regional access control",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Geo filter WAF policy - GeoMatch",
                    "url": "https://learn.microsoft.com/azure/web-application-firewall/afds/waf-front-door-geo-filtering"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Use geo-filtering in Azure Front Door",
            "severity": "Medium",
            "category": "Security",
            "guid": "b515690d-3bf9-3a49-8d38-188e0fd45896",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Azure Private Link enables secure access to Azure PaaS and services over a private endpoint in your virtual network, ensuring traffic goes over the Microsoft backbone network, not the public internet.\n",
            "aprlGuid": "1cfe7834-56ec-ff41-b11d-993734705dba",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Cdn/profiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Private Link enables secure access to Azure PaaS and services over a private endpoint in your virtual network, ensuring traffic goes over the Microsoft backbone network, not the public internet.\n",
            "potentialBenefits": "Enhanced security and private connectivity",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Private link for Azure Front Door",
                    "url": "https://learn.microsoft.com/azure/frontdoor/private-link"
                }
            ],
            "service": "Microsoft.Cdn/profiles",
            "text": "Secure your Origin with Private Link in Azure Front Door",
            "severity": "Medium",
            "category": "Security",
            "guid": "1cfe7834-56ec-ff41-b11d-993734705dba",
            "source": "azure-resources/Cdn/profiles/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Keeping a minimum of 3 replicas for production images in Azure's Compute Gallery ensures scalability and prevents throttling in multi-VM deployments by distributing VM deployments across different replicas. This reduces the risk of overloading a single replica.\n",
            "aprlGuid": "b49a39fd-f431-4b61-9062-f2157849d845",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/galleries",
            "recommendationMetadataState": "Active",
            "longDescription": "Keeping a minimum of 3 replicas for production images in Azure's Compute Gallery ensures scalability and prevents throttling in multi-VM deployments by distributing VM deployments across different replicas. This reduces the risk of overloading a single replica.\n",
            "potentialBenefits": "Enhances scalability and avoids throttling",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Compute Gallery best practices",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machines/azure-compute-gallery#best-practices"
                }
            ],
            "service": "Microsoft.Compute/galleries",
            "text": "A minimum of three replicas should be kept for production image versions",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "b49a39fd-f431-4b61-9062-f2157849d845",
            "source": "azure-resources/Compute/galleries/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Query to list all image versions,its associated image name and version replica configurations per region in a compute gallery whose version replicas is less than 3\nresources\n| where type =~ \"microsoft.compute/galleries/images/versions\"\n| extend GalleryName = tostring(split(tostring(id), \"/\")[8]), ImageName = tostring(split(tostring(id), \"/\")[10])\n| mv-expand VersionReplicas = properties.publishingProfile.targetRegions\n| project RecommendationId=\"b49a39fd-f431-4b61-9062-f2157849d845\",name,id,tags,param1=strcat(\"GalleryName: \",GalleryName),param2=strcat(\"ImageName: \",ImageName),param3=strcat(\"VersionReplicaRegionName: \",VersionReplicas.name),param4=strcat(\"VersionReplicationCount: \",VersionReplicas.regionalReplicaCount),rc=toint(VersionReplicas.regionalReplicaCount)\n| where rc < 3\n| project-away rc\n\n"
        },
        {
            "description": "Use ZRS for high availability when creating image/VM versions in Azure Compute Gallery, offering resilience against Availability Zone failures. ZRS accounts are advisable in regions with Availability Zones, with the choice of Standard_ZRS recommended over Standard_LRS for these regions.\n",
            "aprlGuid": "488dcc8b-f2e3-40ce-bf95-73deb2db095f",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/galleries",
            "recommendationMetadataState": "Active",
            "longDescription": "Use ZRS for high availability when creating image/VM versions in Azure Compute Gallery, offering resilience against Availability Zone failures. ZRS accounts are advisable in regions with Availability Zones, with the choice of Standard_ZRS recommended over Standard_LRS for these regions.\n",
            "potentialBenefits": "Enhances image version availability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Compute Gallery best practices",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machines/azure-compute-gallery#best-practices"
                },
                {
                    "name": "Zone-redundant storage",
                    "url": "https://learn.microsoft.com/en-us/azure/storage/common/storage-redundancy#zone-redundant-storage"
                }
            ],
            "service": "Microsoft.Compute/galleries",
            "text": "Zone redundant storage should be used for image versions",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "488dcc8b-f2e3-40ce-bf95-73deb2db095f",
            "source": "azure-resources/Compute/galleries/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Query to list all image versions and its associated image and gallery name whose Storage account type is not using ZRS\nresources\n| where type =~ \"microsoft.compute/galleries/images/versions\"\n| extend GalleryName = tostring(split(tostring(id), \"/\")[8]), ImageName = tostring(split(tostring(id), \"/\")[10])\n| extend StorageAccountType = tostring(properties.publishingProfile.storageAccountType)\n| where StorageAccountType !has \"ZRS\"\n| project RecommendationId=\"488dcc8b-f2e3-40ce-bf95-73deb2db095f\",name,id,tags,param1=strcat(\"GalleryName: \",GalleryName),param2=strcat(\"ImageName: \",ImageName),param3=strcat(\"StorageAccountType: \",StorageAccountType)\n\n"
        },
        {
            "description": "We recommend creating Trusted Launch Supported Images for benefits like Secure Boot, vTPM, trusted launch VMs, large boot volume. These are Gen 2 Images by default and you cannot change a VM's generation after creation, so review the considerations first.\n",
            "aprlGuid": "1c5e1e58-4e56-491c-8529-10f37af9d4ed",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/galleries",
            "recommendationMetadataState": "Active",
            "longDescription": "We recommend creating Trusted Launch Supported Images for benefits like Secure Boot, vTPM, trusted launch VMs, large boot volume. These are Gen 2 Images by default and you cannot change a VM's generation after creation, so review the considerations first.\n",
            "potentialBenefits": "Enhances VM security and features",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Compute Gallery best practices",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machines/azure-compute-gallery#best-practices"
                },
                {
                    "name": "Generation 1 vs Generation 2 in Hyper-V",
                    "url": "https://learn.microsoft.com/en-us/windows-server/virtualization/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v"
                },
                {
                    "name": "Images in Compute gallery",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machines/shared-image-galleries?tabs=azure-cli"
                }
            ],
            "service": "Microsoft.Compute/galleries",
            "text": "Consider creating TrustedLaunchSupported images where possible",
            "severity": "Low",
            "category": "High Availability",
            "guid": "1c5e1e58-4e56-491c-8529-10f37af9d4ed",
            "source": "azure-resources/Compute/galleries/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Query to list all images whose Hyper-V generation is not V2\nresources\n| where type =~ \"microsoft.compute/galleries/images\"\n| extend VMGeneration = properties.hyperVGeneration\n| where VMGeneration <> 'V2'\n| project RecommendationId=\"1c5e1e58-4e56-491c-8529-10f37af9d4ed\",name,id,tags,param1=strcat(\"VMGeneration: \",VMGeneration)\n\n"
        },
        {
            "description": "Deploying even single instance VMs into a scale set with Flexible orchestration mode future-proofs applications for scaling and availability. This mode guarantees high availability (up to 1000 VMs) by distributing VMs across fault domains in a region or within an Availability Zone.\n",
            "aprlGuid": "e7495e1c-0c75-0946-b266-b429b5c7f3bf",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachineScaleSets",
            "recommendationMetadataState": "Active",
            "longDescription": "Deploying even single instance VMs into a scale set with Flexible orchestration mode future-proofs applications for scaling and availability. This mode guarantees high availability (up to 1000 VMs) by distributing VMs across fault domains in a region or within an Availability Zone.\n",
            "potentialBenefits": "Higher scalability and availability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "When to use VMSS instead of VMs",
                    "url": "https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview#when-to-use-scale-sets-instead-of-virtual-machines"
                },
                {
                    "name": "Azure Well-Architected Framework review - Virtual Machines and Scale Sets",
                    "url": "https://learn.microsoft.com/azure/well-architected/services/compute/virtual-machines/virtual-machines-review"
                }
            ],
            "service": "Microsoft.Compute/virtualMachineScaleSets",
            "text": "Deploy VMSS with Flex orchestration mode instead of Uniform",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "e7495e1c-0c75-0946-b266-b429b5c7f3bf",
            "source": "azure-resources/Compute/virtualMachineScaleSets/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all zonal VMs that are NOT deployed with Flex orchestration mode\nresources\n| where type == \"microsoft.compute/virtualmachinescalesets\"\n| where properties.orchestrationMode != \"Flexible\"\n| project recommendationId = \"e7495e1c-0c75-0946-b266-b429b5c7f3bf\", name, id, tags, param1 = strcat(\"orchestrationMode: \", tostring(properties.orchestrationMode))\n\n"
        },
        {
            "description": "Monitoring application health in Azure Virtual Machine Scale Sets is crucial for deployment management. It supports rolling upgrades such as automatic OS-image upgrades and VM guest patching, leveraging health monitoring for upgrading.\n",
            "aprlGuid": "94794d2a-eff0-2345-9b67-6f9349d0a627",
            "recommendationTypeId": "3b587048-b04b-4f81-aaed-e43793652b0f",
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachineScaleSets",
            "recommendationMetadataState": "Active",
            "longDescription": "Monitoring application health in Azure Virtual Machine Scale Sets is crucial for deployment management. It supports rolling upgrades such as automatic OS-image upgrades and VM guest patching, leveraging health monitoring for upgrading.\n",
            "potentialBenefits": "Enhances deployment management and upgrades",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Using Application Health extension with Virtual Machine Scale Sets",
                    "url": "https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-health-extension?tabs=rest-api"
                }
            ],
            "service": "Microsoft.Compute/virtualMachineScaleSets",
            "text": "Enable Azure Virtual Machine Scale Set Application Health Monitoring",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "94794d2a-eff0-2345-9b67-6f9349d0a627",
            "source": "azure-resources/Compute/virtualMachineScaleSets/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs that do NOT have health monitoring enabled\nresources\n| where type == \"microsoft.compute/virtualmachinescalesets\"\n| join kind=leftouter  (\n    resources\n    | where type == \"microsoft.compute/virtualmachinescalesets\"\n    | mv-expand extension=properties.virtualMachineProfile.extensionProfile.extensions\n    | where extension.properties.type in ( \"ApplicationHealthWindows\", \"ApplicationHealthLinux\" )\n    | project id\n) on id\n| where id1 == \"\"\n| project recommendationId = \"94794d2a-eff0-2345-9b67-6f9349d0a627\", name, id, tags, param1 = \"extension: null\"\n\n"
        },
        {
            "description": "Enabling automatic instance repairs in Azure Virtual Machine Scale Sets enhances application availability through a continuous health check and maintenance process.\n",
            "aprlGuid": "820f4743-1f94-e946-ae0b-45efafd87962",
            "recommendationTypeId": "b4d988a9-85e6-4179-b69c-549bdd8a55bb",
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachineScaleSets",
            "recommendationMetadataState": "Active",
            "longDescription": "Enabling automatic instance repairs in Azure Virtual Machine Scale Sets enhances application availability through a continuous health check and maintenance process.\n",
            "potentialBenefits": "Boosts app availability by auto-repair",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Automatic instance repairs for Azure Virtual Machine Scale Sets",
                    "url": "https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-automatic-instance-repairs#requirements-for-using-automatic-instance-repairs"
                }
            ],
            "service": "Microsoft.Compute/virtualMachineScaleSets",
            "text": "Enable Automatic Repair Policy on Azure Virtual Machine Scale Sets",
            "severity": "High",
            "category": "High Availability",
            "guid": "820f4743-1f94-e946-ae0b-45efafd87962",
            "source": "azure-resources/Compute/virtualMachineScaleSets/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs that do NOT have automatic repair policy enabled\nresources\n| where type == \"microsoft.compute/virtualmachinescalesets\"\n| where properties.automaticRepairsPolicy.enabled == false\n| project recommendationId = \"820f4743-1f94-e946-ae0b-45efafd87962\", name, id, tags, param1 = \"automaticRepairsPolicy: Disabled\"\n\n"
        },
        {
            "description": "Use custom autoscale for VMSS based on metrics and schedules to improve performance and cost effectiveness, adjusting instances as demand changes.\n",
            "aprlGuid": "ee66ff65-9aa3-2345-93c1-25827cf79f44",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachineScaleSets",
            "recommendationMetadataState": "Active",
            "longDescription": "Use custom autoscale for VMSS based on metrics and schedules to improve performance and cost effectiveness, adjusting instances as demand changes.\n",
            "potentialBenefits": "Enhances performance and cost-efficiency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Get started with autoscale in Azure",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/autoscale/autoscale-get-started?WT.mc_id=Portal-Microsoft_Azure_Monitoring"
                },
                {
                    "name": "Overview of autoscale in Azure",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/autoscale/autoscale-overview"
                }
            ],
            "service": "Microsoft.Compute/virtualMachineScaleSets",
            "text": "Configure VMSS Autoscale to custom and configure the scaling metrics",
            "severity": "High",
            "category": "Scalability",
            "guid": "ee66ff65-9aa3-2345-93c1-25827cf79f44",
            "source": "azure-resources/Compute/virtualMachineScaleSets/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find VMSS instances associated with autoscale settings when autoscale is disabled\nresources\n| where type == \"microsoft.compute/virtualmachinescalesets\"\n| project name, id, tags\n| join kind=leftouter  (\n    resources\n    | where type == \"microsoft.insights/autoscalesettings\"\n    | where tostring(properties.targetResourceUri) contains \"Microsoft.Compute/virtualMachineScaleSets\"\n    | project id = tostring(properties.targetResourceUri), autoscalesettings = properties\n) on id\n| where isnull(autoscalesettings) or autoscalesettings.enabled == \"false\"\n| project recommendationId = \"ee66ff65-9aa3-2345-93c1-25827cf79f44\", name, id, tags, param1 = \"autoscalesettings: Disabled\"\n| order by id asc\n\n"
        },
        {
            "description": "Predictive autoscale utilizes machine learning to efficiently manage and scale Azure Virtual Machine Scale Sets by forecasting CPU load through historical usage analysis, ensuring timely scale-out to meet demand.\n",
            "aprlGuid": "3f85a51c-e286-9f44-b4dc-51d00768696c",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/virtualMachineScaleSets",
            "recommendationMetadataState": "Active",
            "longDescription": "Predictive autoscale utilizes machine learning to efficiently manage and scale Azure Virtual Machine Scale Sets by forecasting CPU load through historical usage analysis, ensuring timely scale-out to meet demand.\n",
            "potentialBenefits": "Optimizes scaling with ML predictions",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Use predictive autoscale to scale out before load demands in virtual machine scale sets",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/autoscale/autoscale-predictive"
                }
            ],
            "service": "Microsoft.Compute/virtualMachineScaleSets",
            "text": "Enable Predictive autoscale and configure at least for Forecast Only",
            "severity": "Low",
            "category": "Scalability",
            "guid": "3f85a51c-e286-9f44-b4dc-51d00768696c",
            "source": "azure-resources/Compute/virtualMachineScaleSets/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find VMSS instances associated with autoscale settings when predictiveAutoscalePolicy_scaleMode is disabled\nresources\n| where type == \"microsoft.compute/virtualmachinescalesets\"\n| project name, id, tags\n| join kind=leftouter  (\n    resources\n    | where type == \"microsoft.insights/autoscalesettings\"\n    | where tostring(properties.targetResourceUri) contains \"Microsoft.Compute/virtualMachineScaleSets\"\n    | project id = tostring(properties.targetResourceUri), autoscalesettings = properties\n) on id\n| where autoscalesettings.enabled == \"true\" and autoscalesettings.predictiveAutoscalePolicy.scaleMode == \"Disabled\"\n| project recommendationId = \"3f85a51c-e286-9f44-b4dc-51d00768696c\", name, id, tags, param1 = \"predictiveAutoscalePolicy_scaleMode: Disabled\"\n| order by id asc\n\n"
        },
        {
            "description": "Microsoft advises disabling strictly even VM instance distribution across Availability Zones in VMSS to improve scalability and flexibility, noting that uneven distribution may better serve application load demands despite the potential trade-off in resilience.\n",
            "aprlGuid": "b5a63aa0-c58e-244f-b8a6-cbba0560a6db",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachineScaleSets",
            "recommendationMetadataState": "Active",
            "longDescription": "Microsoft advises disabling strictly even VM instance distribution across Availability Zones in VMSS to improve scalability and flexibility, noting that uneven distribution may better serve application load demands despite the potential trade-off in resilience.\n",
            "potentialBenefits": "Improves scaling, reduces fail attempts",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Use scale-in policies with Azure Virtual Machine Scale Sets",
                    "url": "https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-scale-in-policy"
                }
            ],
            "service": "Microsoft.Compute/virtualMachineScaleSets",
            "text": "Disable Force strictly even balance across zones to avoid scale in and out fail attempts",
            "severity": "High",
            "category": "High Availability",
            "guid": "b5a63aa0-c58e-244f-b8a6-cbba0560a6db",
            "source": "azure-resources/Compute/virtualMachineScaleSets/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find VMSS instances where strictly zoneBalance is set to True\nresources\n| where type == \"microsoft.compute/virtualmachinescalesets\"\n| where properties.orchestrationMode == \"Uniform\" and properties.zoneBalance == true\n| project recommendationId = \"b5a63aa0-c58e-244f-b8a6-cbba0560a6db\", name, id, tags, param1 = \"strictly zoneBalance: Enabled\"\n| order by id asc\n\n"
        },
        {
            "description": "When creating VMSS, implement availability zones as a protection measure for your applications and data against the rare event of datacenter failure.\n",
            "aprlGuid": "1422c567-782c-7148-ac7c-5fc14cf45adc",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachineScaleSets",
            "recommendationMetadataState": "Active",
            "longDescription": "When creating VMSS, implement availability zones as a protection measure for your applications and data against the rare event of datacenter failure.\n",
            "potentialBenefits": "Enhances disaster resilience",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Create a Virtual Machine Scale Set that uses Availability Zones",
                    "url": "https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-use-availability-zones"
                },
                {
                    "name": "Update scale set to add availability zones",
                    "url": "https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-use-availability-zones?tabs=cli-1%2Cportal-2#update-scale-set-to-add-availability-zones"
                }
            ],
            "service": "Microsoft.Compute/virtualMachineScaleSets",
            "text": "Deploy VMSS across availability zones with VMSS Flex",
            "severity": "High",
            "category": "High Availability",
            "guid": "1422c567-782c-7148-ac7c-5fc14cf45adc",
            "source": "azure-resources/Compute/virtualMachineScaleSets/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find VMSS instances with one or no Zones selected\nresources\n| where type == \"microsoft.compute/virtualmachinescalesets\"\n| where array_length(zones) <= 1 or isnull(zones)\n| project recommendationId = \"1422c567-782c-7148-ac7c-5fc14cf45adc\", name, id, tags, param1 = \"AvailabilityZones: Single Zone\"\n| order by id asc\n\n"
        },
        {
            "description": "Enabling automatic VM guest patching eases update management by safely, automatically patching virtual machines to maintain security compliance, while limiting blast radius of VMs. Note, the KQL will not return sets using Uniform orchestration.\n",
            "aprlGuid": "e4ffd7b0-ba24-c84e-9352-ba4819f908c0",
            "recommendationTypeId": null,
            "recommendationControl": "Other Best Practices",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/virtualMachineScaleSets",
            "recommendationMetadataState": "Active",
            "longDescription": "Enabling automatic VM guest patching eases update management by safely, automatically patching virtual machines to maintain security compliance, while limiting blast radius of VMs. Note, the KQL will not return sets using Uniform orchestration.\n",
            "potentialBenefits": "Eases patch management, enhances security",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Automatic VM Guest Patching for Azure VMs",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/automatic-vm-guest-patching"
                },
                {
                    "name": "Auto OS Image Upgrades",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-automatic-upgrade"
                }
            ],
            "service": "Microsoft.Compute/virtualMachineScaleSets",
            "text": "Set Patch orchestration options to Azure-orchestrated",
            "severity": "Low",
            "category": "Other Best Practices",
            "guid": "e4ffd7b0-ba24-c84e-9352-ba4819f908c0",
            "source": "azure-resources/Compute/virtualMachineScaleSets/recommendations.yaml",
            "graph": "// Azure Resource Graph query\n// Identifies VMs and VMSS with manual patch settings, excluding automatic patch modes\nresources\n| where type == \"microsoft.compute/virtualmachinescalesets\"\n| join kind=inner (\n    resources\n    | where type == \"microsoft.compute/virtualmachines\"\n    | project id = tostring(properties.virtualMachineScaleSet.id), vmproperties = properties\n) on id\n| extend recommendationId = \"e4ffd7b0-ba24-c84e-9352-ba4819f908c0\", param1 = \"patchMode: Manual\", vmproperties.osProfile.linuxConfiguration.patchSettings.patchMode\n| where isnotnull(vmproperties.osProfile.linuxConfiguration) and vmproperties.osProfile.linuxConfiguration.patchSettings.patchMode !in (\"AutomaticByPlatform\", \"AutomaticByOS\")\n| distinct recommendationId, name, id, param1\n| union (resources\n| where type == \"microsoft.compute/virtualmachinescalesets\"\n| join kind=inner (\n    resources\n    | where type == \"microsoft.compute/virtualmachines\"\n    | project id = tostring(properties.virtualMachineScaleSet.id), vmproperties = properties\n) on id\n| extend recommendationId = \"e4ffd7b0-ba24-c84e-9352-ba4819f908c0\", param1 = \"patchMode: Manual\", vmproperties.osProfile.windowsConfiguration.patchSettings.patchMode\n| where isnotnull(vmproperties.osProfile.windowsConfiguration) and vmproperties.osProfile.windowsConfiguration.patchSettings.patchMode !in (\"AutomaticByPlatform\", \"AutomaticByOS\")\n| distinct recommendationId, name, id, param1)\n\n"
        },
        {
            "description": "Ensure current versions of images are in use to avoid disruption after image deprecation. Please review the publisher, offer, sku information of the VM to ensure you are running on a supported image. Enable Auto Guest Patching or Image Upgrades, to get notifications about image deprecation.\n",
            "aprlGuid": "83d61669-7bd6-9642-a305-175db8adcdf4",
            "recommendationTypeId": "3b739bd1-c193-4bb6-a953-1362ee3b03b2",
            "recommendationControl": "Governance",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachineScaleSets",
            "recommendationMetadataState": "Active",
            "longDescription": "Ensure current versions of images are in use to avoid disruption after image deprecation. Please review the publisher, offer, sku information of the VM to ensure you are running on a supported image. Enable Auto Guest Patching or Image Upgrades, to get notifications about image deprecation.\n",
            "potentialBenefits": "Avoid disruptions by updating VMSS images.",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Deprecated Azure Marketplace images",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machines/deprecated-images"
                }
            ],
            "service": "Microsoft.Compute/virtualMachineScaleSets",
            "text": "Upgrade VMSS Image versions scheduled to be deprecated or already retired",
            "severity": "High",
            "category": "Governance",
            "guid": "83d61669-7bd6-9642-a305-175db8adcdf4",
            "source": "azure-resources/Compute/virtualMachineScaleSets/recommendations.yaml",
            "graph": "//cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Production VM workloads should be deployed on multiple VMs and grouped in a VMSS Flex instance to intelligently distribute across the platform, minimizing the impact of platform faults and updates.\n",
            "aprlGuid": "273f6b30-68e0-4241-85ea-acf15ffb60bf",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Production VM workloads should be deployed on multiple VMs and grouped in a VMSS Flex instance to intelligently distribute across the platform, minimizing the impact of platform faults and updates.\n",
            "potentialBenefits": "Enhanced fault/update resilience",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "What has changed with Flexible orchestration mode",
                    "url": "https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-orchestration-modes#what-has-changed-with-flexible-orchestration-mode"
                },
                {
                    "name": "Attach or detach a Virtual Machine to or from a Virtual Machine Scale Set",
                    "url": "https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-attach-detach-vm?branch=main&tabs=portal-1%2Cportal-2%2Cportal-3"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Run production workloads on two or more VMs using VMSS Flex",
            "severity": "High",
            "category": "High Availability",
            "guid": "273f6b30-68e0-4241-85ea-acf15ffb60bf",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs that are not associated with a VMSS Flex instance\nresources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| where isnull(properties.virtualMachineScaleSet.id)\n| project recommendationId=\"273f6b30-68e0-4241-85ea-acf15ffb60bf\", name, id, tags\n\n"
        },
        {
            "description": "Azure Availability Zones, within each Azure region, are tolerant to local failures, protecting applications and data against unlikely Datacenter failures by being physically separate.\n",
            "aprlGuid": "2bd0be95-a825-6f47-a8c6-3db1fb5eb387",
            "recommendationTypeId": "066a047a-9ace-45f4-ac50-6325840a6b00",
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Availability Zones, within each Azure region, are tolerant to local failures, protecting applications and data against unlikely Datacenter failures by being physically separate.\n",
            "potentialBenefits": "Enhanced VM resilience to failures",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Create virtual machines in an availability zone using the Azure portal",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/create-portal-availability-zone?tabs=standard"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Deploy VMs across Availability Zones",
            "severity": "High",
            "category": "High Availability",
            "guid": "2bd0be95-a825-6f47-a8c6-3db1fb5eb387",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs that are not assigned to a Zone\nResources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| where isnull(zones)\n| project recommendationId=\"2bd0be95-a825-6f47-a8c6-3db1fb5eb387\", name, id, tags, param1=\"No Zone\"\n\n"
        },
        {
            "description": "Availability sets will soon be retired. Migrate workloads from VMs to VMSS Flex for deployment across zones or within the same zone across different fault domains (FDs) and update domains (UDs) for better reliability.\n",
            "aprlGuid": "a8d25876-7951-b646-b4e8-880c9031596b",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Availability sets will soon be retired. Migrate workloads from VMs to VMSS Flex for deployment across zones or within the same zone across different fault domains (FDs) and update domains (UDs) for better reliability.\n",
            "potentialBenefits": "Enhances reliability and future-proofs VMs",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resiliency checklist for Virtual Machines",
                    "url": "https://learn.microsoft.com/azure/architecture/checklist/resiliency-per-service#virtual-machines"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Migrate VMs using availability sets to VMSS Flex",
            "severity": "High",
            "category": "High Availability",
            "guid": "a8d25876-7951-b646-b4e8-880c9031596b",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs using Availability Sets\nresources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| where isnotnull(properties.availabilitySet)\n| project recommendationId = \"a8d25876-7951-b646-b4e8-880c9031596b\", name, id, tags, param1=strcat(\"availabilitySet: \",properties.availabilitySet.id)\n\n"
        },
        {
            "description": "Replicating Azure VMs via Site Recovery entails continuous, asynchronous disk replication to a target region. Recovery points are generated every few minutes, ensuring a Recovery Point Objective (RPO) in minutes.\n",
            "aprlGuid": "cfe22a65-b1db-fd41-9e8e-d573922709ae",
            "recommendationTypeId": "ed651749-cd37-4fd5-9897-01b416926745",
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Replicating Azure VMs via Site Recovery entails continuous, asynchronous disk replication to a target region. Recovery points are generated every few minutes, ensuring a Recovery Point Objective (RPO) in minutes.\n",
            "potentialBenefits": "Minimize downtime in disasters",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resiliency checklist for Virtual Machines",
                    "url": "https://learn.microsoft.com/azure/architecture/checklist/resiliency-per-service#virtual-machines"
                },
                {
                    "name": "Run a test failover (disaster recovery drill) to Azure",
                    "url": "https://learn.microsoft.com/azure/site-recovery/site-recovery-test-failover-to-azure"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Replicate VMs using Azure Site Recovery",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "cfe22a65-b1db-fd41-9e8e-d573922709ae",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs that do NOT have replication with ASR enabled\nresources\n| where type =~ \"Microsoft.Compute/virtualMachines\"\n| extend securityType = iif(isnull(properties.securityProfile.securityType), \"Standard\", properties.securityProfile.securityType)\n| where securityType !in~ (\"TrustedLaunch\", \"ConfidentialVM\")\n| project id, vmIdForJoin = tolower(id), name, tags\n| join kind = leftouter (\n    recoveryservicesresources\n    | where type =~ \"Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers/replicationProtectedItems\"\n        and properties.providerSpecificDetails.dataSourceInfo.datasourceType =~ \"AzureVm\"\n    | project vmResourceId = tolower(properties.providerSpecificDetails.dataSourceInfo.resourceId)\n    )\n    on $left.vmIdForJoin == $right.vmResourceId\n| where isempty(vmResourceId)\n| project recommendationId = \"cfe22a65-b1db-fd41-9e8e-d573922709ae\", name, id, tags\n"
        },
        {
            "description": "Azure is retiring unmanaged disks on September 30, 2025. Users should plan the migration to avoid disruptions and maintain service reliability.\n",
            "aprlGuid": "122d11d7-b91f-8747-a562-f56b79bcfbdc",
            "recommendationTypeId": "57ecb3cd-f2b4-4cad-8b3a-232cca527a0b",
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure is retiring unmanaged disks on September 30, 2025. Users should plan the migration to avoid disruptions and maintain service reliability.\n",
            "potentialBenefits": "Avoid retirement disruption, enhance reliability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Migrate your Azure unmanaged disks by Sep 30, 2025",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/unmanaged-disks-deprecation"
                },
                {
                    "name": "Migrate Windows VM from unmanaged disks to managed disks",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/windows/convert-unmanaged-to-managed-disks"
                },
                {
                    "name": "Migrate Linux VM from unmanaged disks to managed disks",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/linux/convert-unmanaged-to-managed-disks"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Use Managed Disks for VM disks",
            "severity": "High",
            "category": "High Availability",
            "guid": "122d11d7-b91f-8747-a562-f56b79bcfbdc",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs that are not using Managed Disks\nResources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| where isnull(properties.storageProfile.osDisk.managedDisk)\n| project recommendationId = \"122d11d7-b91f-8747-a562-f56b79bcfbdc\", name, id, tags\n\n"
        },
        {
            "description": "A data disk is a managed disk attached to a virtual machine for storing database or other essential data. These disks are SCSI drives labeled as per choice.\n",
            "aprlGuid": "4ea2878f-0d69-8d4a-b715-afc10d1e538e",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "A data disk is a managed disk attached to a virtual machine for storing database or other essential data. These disks are SCSI drives labeled as per choice.\n",
            "potentialBenefits": "Enhances performance, recovery, migration flexibility",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Introduction to Azure managed disks - Data disks",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/managed-disks-overview#data-disk"
                },
                {
                    "name": "Azure managed disk types",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/disks-types"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Host database data on a data disk",
            "severity": "Low",
            "category": "Scalability",
            "guid": "4ea2878f-0d69-8d4a-b715-afc10d1e538e",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs that only have OS Disk\nResources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| where array_length(properties.storageProfile.dataDisks) < 1\n| project recommendationId = \"4ea2878f-0d69-8d4a-b715-afc10d1e538e\", name, id, tags\n\n"
        },
        {
            "description": "Enable backups for your virtual machines with Azure Backup to secure and quickly recover your data. This service offers simple, secure, and cost-effective solutions for backing up and recovering data from the Microsoft Azure cloud.\n",
            "aprlGuid": "1981f704-97b9-b645-9c57-33f8ded9261a",
            "recommendationTypeId": "651c7925-17a3-42e5-85cd-73bd095cf27f",
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Enable backups for your virtual machines with Azure Backup to secure and quickly recover your data. This service offers simple, secure, and cost-effective solutions for backing up and recovering data from the Microsoft Azure cloud.\n",
            "potentialBenefits": "Secure data recovery and backup",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "What is the Azure Backup service?",
                    "url": "https://learn.microsoft.com/azure/backup/backup-overview"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Backup VMs with Azure Backup service",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "1981f704-97b9-b645-9c57-33f8ded9261a",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs that do NOT have Backup enabled\n// Run query to see results.\nresources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| project name, id, tags\n| join kind=leftouter (\n    recoveryservicesresources\n    | where type =~ 'Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems'\n    | where properties.dataSourceInfo.datasourceType =~ 'Microsoft.Compute/virtualMachines'\n    | project idBackupEnabled=properties.sourceResourceId\n    | extend name=strcat_array(array_slice(split(idBackupEnabled, '/'), 8, -1), '/')\n) on name\n| where isnull(idBackupEnabled)\n| project-away idBackupEnabled\n| project-away name1\n| project recommendationId = \"1981f704-97b9-b645-9c57-33f8ded9261a\", name, id, tags\n| order by id asc\n\n"
        },
        {
            "description": "Azure Virtual Machines (VM) instances have various states, like provisioning and power states. A non-running VM may indicate issues or it being unnecessary, suggesting removal could help cut costs.\n",
            "aprlGuid": "98b334c0-8578-6046-9e43-b6e8fce6318e",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Virtual Machines (VM) instances have various states, like provisioning and power states. A non-running VM may indicate issues or it being unnecessary, suggesting removal could help cut costs.\n",
            "potentialBenefits": "Reduce costs by removing unused VMs",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "States and billing status of Azure Virtual Machines",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/states-billing?context=%2Ftroubleshoot%2Fazure%2Fvirtual-machines%2Fcontext%2Fcontext#power-states-and-billing"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Review VMs in stopped state",
            "severity": "Low",
            "category": "Governance",
            "guid": "98b334c0-8578-6046-9e43-b6e8fce6318e",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs that are NOT running\nResources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| where properties.extended.instanceView.powerState.displayStatus != 'VM running'\n| project recommendationId = \"98b334c0-8578-6046-9e43-b6e8fce6318e\", name, id, tags\n\n"
        },
        {
            "description": "Accelerated networking enables SR-IOV to a VM, greatly improving its networking performance by bypassing the host from the data path, which reduces latency, jitter, and CPU utilization for demanding network workloads on supported VM types.\n",
            "aprlGuid": "dfedbeb1-1519-fc47-86a5-52f96cf07105",
            "recommendationTypeId": "3a3c1a2a-8597-4d3a-981a-0a24a0ee9de4",
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Accelerated networking enables SR-IOV to a VM, greatly improving its networking performance by bypassing the host from the data path, which reduces latency, jitter, and CPU utilization for demanding network workloads on supported VM types.\n",
            "potentialBenefits": "Reduces latency, jitter and CPU use",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Accelerated Networking (AccelNet) overview",
                    "url": "https://learn.microsoft.com/azure/virtual-network/accelerated-networking-overview"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Enable Accelerated Networking (AccelNet)",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "dfedbeb1-1519-fc47-86a5-52f96cf07105",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VM NICs that do not have Accelerated Networking enabled\nresources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| mv-expand nic = properties.networkProfile.networkInterfaces\n| project name, id, tags, lowerCaseNicId = tolower(nic.id), vmSize = tostring(properties.hardwareProfile.vmSize)\n| join kind = inner (\n    resources\n    | where type =~ 'Microsoft.Network/networkInterfaces'\n    | where properties.enableAcceleratedNetworking == false\n    | project nicName = split(id, \"/\")[8], lowerCaseNicId = tolower(id)\n    )\n    on lowerCaseNicId\n| summarize nicNames = make_set(nicName) by name, id, tostring(tags), vmSize\n| extend param1 = strcat(\"NicName: \", strcat_array(nicNames, \", \")), param2 = strcat(\"VMSize: \", vmSize)\n| project recommendationId = \"dfedbeb1-1519-fc47-86a5-52f96cf07105\", name, id, tags, param1, param2\n| order by id asc\n\n"
        },
        {
            "description": "When Accelerated Networking is enabled, the default Azure VNet interface in GuestOS is swapped for a Mellanox, and its driver comes from a 3rd party. Marketplace images have the latest Mellanox drivers, but post-deployment, updating the driver is the user's responsibility.\n",
            "aprlGuid": "73d1bb04-7d3e-0d47-bc0d-63afe773b5fe",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "When Accelerated Networking is enabled, the default Azure VNet interface in GuestOS is swapped for a Mellanox, and its driver comes from a 3rd party. Marketplace images have the latest Mellanox drivers, but post-deployment, updating the driver is the user's responsibility.\n",
            "potentialBenefits": "Enhanced VM network efficiency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Accelerated Networking (AccelNet) overview",
                    "url": "https://learn.microsoft.com/azure/virtual-network/accelerated-networking-overview"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "When AccelNet is enabled, you must manually update the GuestOS NIC driver",
            "severity": "Low",
            "category": "Governance",
            "guid": "73d1bb04-7d3e-0d47-bc0d-63afe773b5fe",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "For outbound internet connectivity of Virtual Machines, using NAT Gateway or Azure Firewall is recommended to enhance security and service resilience, thanks to their higher availability and SNAT ports.\n",
            "aprlGuid": "1f629a30-c9d0-d241-82ee-6f2eb9d42cb4",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "For outbound internet connectivity of Virtual Machines, using NAT Gateway or Azure Firewall is recommended to enhance security and service resilience, thanks to their higher availability and SNAT ports.\n",
            "potentialBenefits": "Enhanced security and service resiliency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Use Source Network Address Translation (SNAT) for outbound connections",
                    "url": "https://learn.microsoft.com/azure/load-balancer/load-balancer-outbound-connections"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "VMs should not have a Public IP directly associated",
            "severity": "Medium",
            "category": "Security",
            "guid": "1f629a30-c9d0-d241-82ee-6f2eb9d42cb4",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs with PublicIPs directly associated with them\nResources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| where isnotnull(properties.networkProfile.networkInterfaces)\n| mv-expand nic=properties.networkProfile.networkInterfaces\n| project name, id, tags, nicId = nic.id\n| extend nicId = tostring(nicId)\n| join kind=inner (\n    Resources\n    | where type =~ 'Microsoft.Network/networkInterfaces'\n    | where isnotnull(properties.ipConfigurations)\n    | mv-expand ipconfig=properties.ipConfigurations\n    | extend publicIp = tostring(ipconfig.properties.publicIPAddress.id)\n    | where publicIp != \"\"\n    | project name, nicId = tostring(id), publicIp\n) on nicId\n| project recommendationId = \"1f629a30-c9d0-d241-82ee-6f2eb9d42cb4\", name, id, tags\n| order by id asc\n\n"
        },
        {
            "description": "Unless you have a specific reason, it's advised to associate a network security group to a subnet or a network interface, but not both, to avoid unexpected communication issues and troubleshooting due to potential rule conflicts between the two associations.\n",
            "aprlGuid": "82b3cf6b-9ae2-2e44-b193-10793213f676",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Unless you have a specific reason, it's advised to associate a network security group to a subnet or a network interface, but not both, to avoid unexpected communication issues and troubleshooting due to potential rule conflicts between the two associations.\n",
            "potentialBenefits": "Reduces communication problems",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "How network security groups filter network traffic",
                    "url": "https://learn.microsoft.com/azure/virtual-network/network-security-group-how-it-works#intra-subnet-traffic"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "VM network interfaces and associated subnets both have a Network Security Group associated",
            "severity": "Low",
            "category": "Security",
            "guid": "82b3cf6b-9ae2-2e44-b193-10793213f676",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of virtual machines and associated NICs that do have an NSG associated to them and also an NSG associated to the subnet.\nResources\n| where type =~ 'Microsoft.Network/networkInterfaces'\n| where isnotnull(properties.networkSecurityGroup)\n| mv-expand ipConfigurations = properties.ipConfigurations, nsg = properties.networkSecurityGroup\n| project nicId = tostring(id), subnetId = tostring(ipConfigurations.properties.subnet.id), nsgName=split(nsg.id, '/')[8]\n| parse kind=regex subnetId with '/virtualNetworks/' virtualNetwork '/subnets/' subnet\n    | join kind=inner (\n        Resources\n        | where type =~ 'Microsoft.Network/NetworkSecurityGroups' and isnotnull(properties.subnets)\n        | project name, resourceGroup, subnet=properties.subnets\n        | mv-expand subnet\n        | project subnetId=tostring(subnet.id)\n    ) on subnetId\n    | project nicId\n| join kind=leftouter (\n    Resources\n    | where type =~ 'Microsoft.Compute/virtualMachines'\n    | where isnotnull(properties.networkProfile.networkInterfaces)\n    | mv-expand nic=properties.networkProfile.networkInterfaces\n    | project vmName = name, vmId = id, tags, nicId = nic.id, nicName=split(nic.id, '/')[8]\n    | extend nicId = tostring(nicId)\n) on nicId\n| project recommendationId = \"82b3cf6b-9ae2-2e44-b193-10793213f676\", name=vmName, id = vmId, tags, param1 = strcat(\"nic-name=\", nicName)\n\n"
        },
        {
            "description": "IP forwarding allows a virtual machine network interface to receive and send network traffic not destined for or originating from its assigned IP addresses.\n",
            "aprlGuid": "41a22a5e-5e08-9647-92d0-2ffe9ef1bdad",
            "recommendationTypeId": "c3b51c94-588b-426b-a892-24696f9e54cc",
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "IP forwarding allows a virtual machine network interface to receive and send network traffic not destined for or originating from its assigned IP addresses.\n",
            "potentialBenefits": "Enhances network appliance function",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Enable or disable IP forwarding",
                    "url": "https://learn.microsoft.com/azure/virtual-network/virtual-network-network-interface?tabs=network-interface-portal#enable-or-disable-ip-forwarding"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "IP Forwarding should only be enabled for Network Virtual Appliances",
            "severity": "Medium",
            "category": "Security",
            "guid": "41a22a5e-5e08-9647-92d0-2ffe9ef1bdad",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VM NICs that have IPForwarding enabled. This feature is usually only required for Network Virtual Appliances\nResources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| where isnotnull(properties.networkProfile.networkInterfaces)\n| mv-expand nic=properties.networkProfile.networkInterfaces\n| project name, id, tags, nicId = nic.id\n| extend nicId = tostring(nicId)\n| join kind=inner (\n    Resources\n    | where type =~ 'Microsoft.Network/networkInterfaces'\n    | where properties.enableIPForwarding == true\n    | project nicId = tostring(id)\n) on nicId\n| project recommendationId = \"41a22a5e-5e08-9647-92d0-2ffe9ef1bdad\", name, id, tags\n| order by id asc\n\n"
        },
        {
            "description": "Configure the DNS Server at the Virtual Network level to prevent any inconsistency across the environment.\n",
            "aprlGuid": "1cf8fe21-9593-1e4e-966b-779a294c0d30",
            "recommendationTypeId": null,
            "recommendationControl": "Other Best Practices",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Configure the DNS Server at the Virtual Network level to prevent any inconsistency across the environment.\n",
            "potentialBenefits": "Ensures DNS consistency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Name resolution for resources in Azure virtual networks",
                    "url": "https://learn.microsoft.com/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Customer DNS Servers should be configured in the Virtual Network level",
            "severity": "Low",
            "category": "Other Best Practices",
            "guid": "1cf8fe21-9593-1e4e-966b-779a294c0d30",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VM NICs that have DNS Server settings configured in any of the NICs\nResources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| where isnotnull(properties.networkProfile.networkInterfaces)\n| mv-expand nic=properties.networkProfile.networkInterfaces\n| project name, id, tags, nicId = nic.id\n| extend nicId = tostring(nicId)\n| join kind=inner (\n    Resources\n    | where type =~ 'Microsoft.Network/networkInterfaces'\n    | project name, id, dnsServers = properties.dnsSettings.dnsServers\n    | extend hasDns = array_length(dnsServers) >= 1\n    | where hasDns != 0\n    | project name, nicId = tostring(id)\n) on nicId\n| project recommendationId = \"1cf8fe21-9593-1e4e-966b-779a294c0d30\", name, id, tags\n| order by id asc\n\n"
        },
        {
            "description": "Azure shared disks let you attach a disk to multiple VMs at once for deploying or migrating clustered applications, suitable only when a disk is shared among VM cluster members.\n",
            "aprlGuid": "3263a64a-c256-de48-9818-afd3cbc55c2a",
            "recommendationTypeId": null,
            "recommendationControl": "Other Best Practices",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure shared disks let you attach a disk to multiple VMs at once for deploying or migrating clustered applications, suitable only when a disk is shared among VM cluster members.\n",
            "potentialBenefits": "Enhances clustered server performance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Shared Disk Introduction",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/disks-shared"
                },
                {
                    "name": "Enable Shared Disks",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/disks-shared-enable?tabs=azure-portal"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Shared disks should only be enabled in clustered servers",
            "severity": "Medium",
            "category": "Other Best Practices",
            "guid": "3263a64a-c256-de48-9818-afd3cbc55c2a",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Disks configured to be Shared. This is not an indication of an issue, but if a disk with this configuration is assigned to two or more VMs without a proper disk control mechanism (like a WSFC) it can lead to data loss\nresources\n| where type =~ 'Microsoft.Compute/disks'\n| where isnotnull(properties.maxShares) and properties.maxShares >= 2\n| project id, name, tags, lowerCaseDiskId = tolower(id), diskState = tostring(properties.diskState)\n| join kind = leftouter (\n    resources\n    | where type =~ 'Microsoft.Compute/virtualMachines'\n    | project osDiskVmName = name, lowerCaseOsDiskId = tolower(properties.storageProfile.osDisk.managedDisk.id)\n    | join kind = fullouter (\n        resources\n        | where type =~ 'Microsoft.Compute/virtualMachines'\n        | mv-expand dataDisks = properties.storageProfile.dataDisks\n        | project dataDiskVmName = name, lowerCaseDataDiskId = tolower(dataDisks.managedDisk.id)\n        )\n        on $left.lowerCaseOsDiskId == $right.lowerCaseDataDiskId\n    | project lowerCaseDiskId = coalesce(lowerCaseOsDiskId, lowerCaseDataDiskId), vmName = coalesce(osDiskVmName, dataDiskVmName)\n    )\n    on lowerCaseDiskId\n| summarize vmNames = make_set(vmName) by name, id, tostring(tags), diskState\n| extend param1 = strcat(\"DiskState: \", diskState), param2 = iif(isempty(vmNames[0]), \"VMName: n/a\", strcat(\"VMName: \", strcat_array(vmNames, \", \")))\n| project recommendationId = \"3263a64a-c256-de48-9818-afd3cbc55c2a\", name, id, tags, param1, param2\n| order by id asc\n\n"
        },
        {
            "description": "Recommended changing to \"Disable public access and enable private access\" and creating a Private Endpoint to improve security by restricting direct public access and ensuring connections are made privately, enhancing data protection and minimizing potential external threats.\n",
            "aprlGuid": "70b1d2be-e6c4-b54e-9959-b1b690f9e485",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Recommended changing to \"Disable public access and enable private access\" and creating a Private Endpoint to improve security by restricting direct public access and ensuring connections are made privately, enhancing data protection and minimizing potential external threats.\n",
            "potentialBenefits": "Enhances VM security and privacy",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Restrict import/export access for managed disks using Azure Private Link",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/disks-enable-private-links-for-import-export-portal"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Network access to the VM disk should be set to Disable public access and enable private access",
            "severity": "Low",
            "category": "Security",
            "guid": "70b1d2be-e6c4-b54e-9959-b1b690f9e485",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Disks with \"Enable public access from all networks\" enabled\nresources\n| where type =~ 'Microsoft.Compute/disks'\n| where properties.publicNetworkAccess == \"Enabled\"\n| project id, name, tags, lowerCaseDiskId = tolower(id)\n| join kind = leftouter (\n    resources\n    | where type =~ 'Microsoft.Compute/virtualMachines'\n    | project osDiskVmName = name, lowerCaseOsDiskId = tolower(properties.storageProfile.osDisk.managedDisk.id)\n    | join kind = fullouter (\n        resources\n        | where type =~ 'Microsoft.Compute/virtualMachines'\n        | mv-expand dataDisks = properties.storageProfile.dataDisks\n        | project dataDiskVmName = name, lowerCaseDataDiskId = tolower(dataDisks.managedDisk.id)\n        )\n        on $left.lowerCaseOsDiskId == $right.lowerCaseDataDiskId\n    | project lowerCaseDiskId = coalesce(lowerCaseOsDiskId, lowerCaseDataDiskId), vmName = coalesce(osDiskVmName, dataDiskVmName)\n    )\n    on lowerCaseDiskId\n| summarize vmNames = make_set(vmName) by name, id, tostring(tags)\n| extend param1 = iif(isempty(vmNames[0]), \"VMName: n/a\", strcat(\"VMName: \", strcat_array(vmNames, \", \")))\n| project recommendationId = \"70b1d2be-e6c4-b54e-9959-b1b690f9e485\", name, id, tags, param1\n| order by id asc\n\n"
        },
        {
            "description": "Keeping your virtual machine (VM) secure is crucial for the applications you run. This involves using various Azure services and features to ensure secure access to your VMs and the secure storage of your data, aiming for overall security of your VM and applications.\n",
            "aprlGuid": "c42343ae-2712-2843-a285-3437eb0b28a1",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Keeping your virtual machine (VM) secure is crucial for the applications you run. This involves using various Azure services and features to ensure secure access to your VMs and the secure storage of your data, aiming for overall security of your VM and applications.\n",
            "potentialBenefits": "Secure VMs and applications",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Policy-driven governance",
                    "url": "https://learn.microsoft.com/azure/cloud-adoption-framework/ready/landing-zone/design-principles#policy-driven-governance"
                },
                {
                    "name": "Azure Policy Regulatory Compliance controls for Azure Virtual Machines",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/security-policy"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Ensure that your VMs are compliant with Azure Policies",
            "severity": "Low",
            "category": "Governance",
            "guid": "c42343ae-2712-2843-a285-3437eb0b28a1",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs in \"Non-compliant\" state with Azure Policies\npolicyresources\n| where type =~ \"Microsoft.PolicyInsights/policyStates\" and properties.resourceType =~ \"Microsoft.Compute/virtualMachines\" and properties.complianceState =~ \"NonCompliant\"\n| project\n    policyDefinitionId = tolower(properties.policyDefinitionId),\n    policyAssignmentId = tolower(properties.policyAssignmentId),\n    targetResourceId = tolower(properties.resourceId)\n// Join the policy definition details\n| join kind = leftouter (\n    policyresources\n    | where type =~ \"Microsoft.Authorization/policyDefinitions\"\n    | project policyDefinitionId = tolower(id), policyDefinitionDisplayName = properties.displayName\n    )\n    on policyDefinitionId\n| project policyDefinitionId, policyDefinitionDisplayName, policyAssignmentId, targetResourceId\n// Join the policy assignment details\n| join kind = leftouter (\n    policyresources\n    | where type =~ \"Microsoft.Authorization/policyAssignments\"\n    | project policyAssignmentId = tolower(id), policyAssignmentDisplayName = properties.displayName\n    )\n    on policyAssignmentId\n| project policyDefinitionId, policyDefinitionDisplayName, policyAssignmentId, policyAssignmentDisplayName, targetResourceId\n// Join the target resource details\n| join kind = leftouter (\n    resources\n    | where type =~ \"Microsoft.Compute/virtualMachines\"\n    | project targetResourceId = tolower(id), targetResourceIdPreservedCase = id, targetResourceName = name, targetResourceTags = tags\n    )\n    on targetResourceId\n| project\n    recommendationId = \"c42343ae-2712-2843-a285-3437eb0b28a1\",\n    name = targetResourceName,\n    id = targetResourceIdPreservedCase,\n    tags = targetResourceTags,\n    param1 = strcat(\"DefinitionName: \", policyDefinitionDisplayName),\n    param2 = strcat(\"DefinitionID: \", policyDefinitionId),\n    param3 = strcat(\"AssignmentName: \", policyAssignmentDisplayName),\n    param4 = strcat(\"AssignmentID: \", policyAssignmentId)\n"
        },
        {
            "description": "Consider enabling Azure Disk Encryption (ADE) for encrypting Azure VM disks using DM-Crypt (Linux) or BitLocker (Windows). Additionally, consider Encryption at host and Confidential disk encryption for enhanced data security.\n",
            "aprlGuid": "f0a97179-133a-6e4f-8a49-8a44da73ffce",
            "recommendationTypeId": "a40cc620-e72c-fdf4-c554-c6ca2cd705c0",
            "recommendationControl": "Security",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Consider enabling Azure Disk Encryption (ADE) for encrypting Azure VM disks using DM-Crypt (Linux) or BitLocker (Windows). Additionally, consider Encryption at host and Confidential disk encryption for enhanced data security.\n",
            "potentialBenefits": "Enhances data security and integrity",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Overview of managed disk encryption options",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/disk-encryption-overview"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Virtual Machines should have Azure Disk Encryption or EncryptionAtHost enabled",
            "severity": "High",
            "category": "Security",
            "guid": "f0a97179-133a-6e4f-8a49-8a44da73ffce",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure VM disks without Azure Disk Encryption or encryption at host enabled\nresources\n| where type =~ \"microsoft.compute/disks\"\n| project diskId = id, diskName = name, vmId = tolower(managedBy), azureDiskEncryption = iff(properties.encryptionSettingsCollection.enabled == true, true, false)\n| join kind=leftouter (resources\n| where type =~ \"microsoft.compute/virtualmachines\"\n| project vmId = tolower(id), vmName = name, encryptionAtHost = iff(properties.securityProfile.encryptionAtHost == true, true, false)) on vmId\n| where not(encryptionAtHost) and not(azureDiskEncryption)\n| project recommendationId = 'f0a97179-133a-6e4f-8a49-8a44da73ffce', name = vmName, id =vmId, param1 = strcat('diskName:',diskName), param2 = strcat('azureDiskEncryption:',iff(azureDiskEncryption, \"Enabled\", \"Disabled\")), param3 = strcat('encryptionAtHost:',iff(encryptionAtHost, \"Enabled\", \"Disabled\"))\n"
        },
        {
            "description": "VM Insights monitors VM and scale set performance, health, running processes, and dependencies. It enhances the predictability of application performance and availability by pinpointing performance bottlenecks and network issues, and it clarifies if problems are related to other dependencies.\n",
            "aprlGuid": "b72214bb-e879-5f4b-b9cd-642db84f36f4",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "VM Insights monitors VM and scale set performance, health, running processes, and dependencies. It enhances the predictability of application performance and availability by pinpointing performance bottlenecks and network issues, and it clarifies if problems are related to other dependencies.\n",
            "potentialBenefits": "Improves VM performance and health",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Overview of VM insights",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/vm/vminsights-overview"
                },
                {
                    "name": "Did the extension install properly?",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/vm/vminsights-troubleshoot#did-the-extension-install-properly"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Enable VM Insights",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "b72214bb-e879-5f4b-b9cd-642db84f36f4",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Check for VMs without Azure Monitoring Agent extension installed, missing Data Collection Rule or Data Collection Rule without performance enabled.\nResources\n| where type == 'microsoft.compute/virtualmachines'\n| project idVm = tolower(id), name, tags\n| join kind=leftouter (\n    InsightsResources\n    | where type =~ \"Microsoft.Insights/dataCollectionRuleAssociations\" and id has \"Microsoft.Compute/virtualMachines\"\n    | project idDcr = tolower(properties.dataCollectionRuleId), idVmDcr = tolower(substring(id, 0, indexof(id, \"/providers/Microsoft.Insights/dataCollectionRuleAssociations/\"))))\non $left.idVm == $right.idVmDcr\n| join kind=leftouter (\n    Resources\n    | where type =~ \"Microsoft.Insights/dataCollectionRules\"\n    | extend\n        isPerformanceEnabled = iif(properties.dataSources.performanceCounters contains \"Microsoft-InsightsMetrics\" and properties.dataFlows contains \"Microsoft-InsightsMetrics\", true, false),\n        isMapEnabled = iif(properties.dataSources.extensions contains \"Microsoft-ServiceMap\" and properties.dataSources.extensions contains \"DependencyAgent\" and properties.dataFlows contains \"Microsoft-ServiceMap\", true, false)//,\n    | where isPerformanceEnabled or isMapEnabled\n    | project dcrName = name, isPerformanceEnabled, isMapEnabled, idDcr = tolower(id))\non $left.idDcr == $right.idDcr\n| join kind=leftouter (\n    Resources\n        | where type == 'microsoft.compute/virtualmachines/extensions' and (name contains 'AzureMonitorWindowsAgent' or name contains 'AzureMonitorLinuxAgent')\n        | extend idVmExtension = tolower(substring(id, 0, indexof(id, '/extensions'))), extensionName = name)\non $left.idVm == $right.idVmExtension\n| where isPerformanceEnabled != 1 or (extensionName != 'AzureMonitorWindowsAgent' and extensionName != 'AzureMonitorLinuxAgent')\n| project recommendationId = \"b72214bb-e879-5f4b-b9cd-642db84f36f4\", name, id = idVm, tags, param1 = strcat('MonitoringExtension:', extensionName), param2 = strcat('DataCollectionRuleId:', idDcr), param3 = strcat('isPerformanceEnabled:', isPerformanceEnabled)\n\n"
        },
        {
            "description": "Azure Monitor Metrics automatically receives platform metrics, but platform logs, which offer detailed diagnostics and auditing for resources and their Azure platform, need to be manually routed for collection.\n",
            "aprlGuid": "4a9d8973-6dba-0042-b3aa-07924877ebd5",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Monitor Metrics automatically receives platform metrics, but platform logs, which offer detailed diagnostics and auditing for resources and their Azure platform, need to be manually routed for collection.\n",
            "potentialBenefits": "Enhanced diagnostics and auditing capability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Monitor Agent overview",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-monitor/agents/agents-overview"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Configure monitoring for all Azure Virtual Machines",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "4a9d8973-6dba-0042-b3aa-07924877ebd5",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Virtual Machines without diagnostic settings enabled/with diagnostic settings enabled but not configured both performance counters and event logs/syslogs.\nresources\n| where type =~ \"microsoft.compute/virtualmachines\"\n| project name, id, tags, lowerCaseVmId = tolower(id)\n| join kind = leftouter (\n    resources\n    | where type =~ \"Microsoft.Compute/virtualMachines/extensions\" and properties.publisher =~ \"Microsoft.Azure.Diagnostics\"\n    | project\n        lowerCaseVmIdOfExtension = tolower(substring(id, 0, indexof(id, \"/extensions/\"))),\n        extensionType = properties.type,\n        provisioningState = properties.provisioningState,\n        storageAccount = properties.settings.StorageAccount,\n        // Windows\n        wadPerfCounters = properties.settings.WadCfg.DiagnosticMonitorConfiguration.PerformanceCounters.PerformanceCounterConfiguration,\n        wadEventLogs = properties.settings.WadCfg.DiagnosticMonitorConfiguration.WindowsEventLog,\n        // Linux\n        ladPerfCounters = properties.settings.ladCfg.diagnosticMonitorConfiguration.performanceCounters.performanceCounterConfiguration,\n        ladSyslog = properties.settings.ladCfg.diagnosticMonitorConfiguration.syslogEvents\n    | extend\n        // Windows\n        isWadPerfCountersConfigured = iif(array_length(wadPerfCounters) > 0, true, false),\n        isWadEventLogsConfigured = iif(isnotnull(wadEventLogs) and array_length(wadEventLogs.DataSource) > 0, true, false),\n        // Linux\n        isLadPerfCountersConfigured = iif(array_length(ladPerfCounters) > 0, true, false),\n        isLadSyslogConfigured = isnotnull(ladSyslog)\n    | project\n        lowerCaseVmIdOfExtension,\n        extensionType,\n        provisioningState,\n        storageAccount,\n        isPerfCountersConfigured = case(extensionType =~ \"IaaSDiagnostics\", isWadPerfCountersConfigured, extensionType =~ \"LinuxDiagnostic\", isLadPerfCountersConfigured, false),\n        isEventLogsConfigured = case(extensionType =~ \"IaaSDiagnostics\", isWadEventLogsConfigured, extensionType =~ \"LinuxDiagnostic\", isLadSyslogConfigured, false)\n    )\n    on $left.lowerCaseVmId == $right.lowerCaseVmIdOfExtension\n| where isempty(lowerCaseVmIdOfExtension) or provisioningState !~ \"Succeeded\" or not(isPerfCountersConfigured and isEventLogsConfigured)\n| extend\n    param1 = strcat(\"DiagnosticSetting: \", iif(isnotnull(extensionType), strcat(\"Enabled, partially configured (\", extensionType, \")\"), \"Not enabled\")),\n    param2 = strcat(\"ProvisioningState: \", iif(isnotnull(provisioningState), provisioningState, \"n/a\")),\n    param3 = strcat(\"storageAccount: \", iif(isnotnull(storageAccount), storageAccount, \"n/a\")),\n    param4 = strcat(\"PerformanceCounters: \", case(isnull(isPerfCountersConfigured), \"n/a\", isPerfCountersConfigured, \"Configured\", \"Not configured\")),\n    param5 = strcat(\"EventLogs/Syslogs: \", case(isnull(isEventLogsConfigured), \"n/a\", isEventLogsConfigured, \"Configured\", \"Not configured\"))\n| project recommendationId = \"4a9d8973-6dba-0042-b3aa-07924877ebd5\", name, id, tags, param1, param2, param3, param4, param5\n\n"
        },
        {
            "description": "The maintenance configuration settings let users schedule and manage updates, making sure the updates or interruptions on the VM are performed within a planned timeframe.\n",
            "aprlGuid": "52ab9e5c-eec0-3148-8bd7-b6dd9e1be870",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "The maintenance configuration settings let users schedule and manage updates, making sure the updates or interruptions on the VM are performed within a planned timeframe.\n",
            "potentialBenefits": "Scheduled updates for VMs",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Use maintenance configurations to control and manage the VM updates",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/maintenance-configurations"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Use maintenance configurations for the VMs",
            "severity": "High",
            "category": "High Availability",
            "guid": "52ab9e5c-eec0-3148-8bd7-b6dd9e1be870",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find VMS that do not have maintenance configuration assigned\nResources\n| extend resourceId = tolower(id)\n| project name, location, type, id, tags, resourceId, properties\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| join kind=leftouter (\nmaintenanceresources\n| where type =~ \"microsoft.maintenance/configurationassignments\"\n| project planName = name, type, maintenanceProps = properties\n| extend resourceId = tostring(maintenanceProps.resourceId)\n) on resourceId\n| where isnull(maintenanceProps)\n| project recommendationId = \"52ab9e5c-eec0-3148-8bd7-b6dd9e1be870\",name, id, tags\n| order by id asc\n\n"
        },
        {
            "description": "A-series VMs are tailored for entry-level workloads like development and testing, including use cases such as development and test servers, low traffic web servers, and small to medium databases.\n",
            "aprlGuid": "3201dba8-d1da-4826-98a4-104066545170",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "A-series VMs are tailored for entry-level workloads like development and testing, including use cases such as development and test servers, low traffic web servers, and small to medium databases.\n",
            "potentialBenefits": "Ensures full CPU usage for heavy tasks",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "B-series burstable virtual machine sizes",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machines/sizes-b-series-burstable"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Don't use A or B-Series VMs for production needing constant full CPU performance",
            "severity": "High",
            "category": "Scalability",
            "guid": "3201dba8-d1da-4826-98a4-104066545170",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs using A or B series families\nresources\n| where type == 'microsoft.compute/virtualmachines'\n| where properties.hardwareProfile.vmSize contains \"Standard_B\" or properties.hardwareProfile.vmSize contains \"Standard_A\"\n| project recommendationId = \"3201dba8-d1da-4826-98a4-104066545170\", name, id, tags, param1=strcat(\"vmSku: \" , properties.hardwareProfile.vmSize)\n\n"
        },
        {
            "description": "Compared to Standard HDD and SSD, Premium SSD, SSDv2, and Ultra SSDs offer improved performance, configurability, and higher single-instance Virtual Machine uptime SLAs. The lowest SLA of all disks on a Virtual Machine applies, so it is best to use Premium or Ultra Disks for the highest uptime SLA.\n",
            "aprlGuid": "df0ff862-814d-45a3-95e4-4fad5a244ba6",
            "recommendationTypeId": "58d6648d-32e8-4346-827c-4f288dd8ca24",
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Compared to Standard HDD and SSD, Premium SSD, SSDv2, and Ultra SSDs offer improved performance, configurability, and higher single-instance Virtual Machine uptime SLAs. The lowest SLA of all disks on a Virtual Machine applies, so it is best to use Premium or Ultra Disks for the highest uptime SLA.\n",
            "potentialBenefits": "Enhanced performance, cost efficiency, and uptime SLA",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Disk type comparison and decision tree",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machines/disks-types#disk-type-comparison"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Mission Critical Workloads should consider using Premium or Ultra Disks",
            "severity": "High",
            "category": "Scalability",
            "guid": "df0ff862-814d-45a3-95e4-4fad5a244ba6",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs that have an attached disk that is not in the Premium or Ultra sku tier.\n\nresources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| extend lname = tolower(name)\n| join kind=leftouter(resources\n    | where type =~ 'Microsoft.Compute/disks'\n    | where not(sku.tier =~ 'Premium') and not(sku.tier =~ 'Ultra')\n    | extend lname = tolower(tostring(split(managedBy, '/')[8]))\n    | project lname, name\n    | summarize disks = make_list(name) by lname) on lname\n| where isnotnull(disks)\n| project recommendationId = \"df0ff862-814d-45a3-95e4-4fad5a244ba6\", name, id, tags, param1=strcat(\"AffectedDisks: \", disks)\n\n"
        },
        {
            "description": "If the workload is Maintenance sensitive, consider Azure Boost compatible VMs. Azure Boost is designed to lessen the impact on customers when Azure maintenance activities occur on the host, and the current list of compatible VM sizes are documented in the first link below.\n",
            "aprlGuid": "9ab499d8-8844-424d-a2d4-8f53690eb8f8",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "If the workload is Maintenance sensitive, consider Azure Boost compatible VMs. Azure Boost is designed to lessen the impact on customers when Azure maintenance activities occur on the host, and the current list of compatible VM sizes are documented in the first link below.\n",
            "potentialBenefits": "Less maintenance impact",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Microsoft Azure Boost",
                    "url": "https://learn.microsoft.com/azure/azure-boost/overview"
                },
                {
                    "name": "Announcing the general availability of Azure Boost",
                    "url": "https://aka.ms/AzureBoostGABlog"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Use Azure Boost VMs for Maintenance sensitive workload",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "9ab499d8-8844-424d-a2d4-8f53690eb8f8",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "If your workload is Maintenance sensitive, enable Scheduled Events. This Azure Metadata Service lets your app prepare for virtual machine maintenance by providing information on upcoming events like reboots, reducing disruptions.\n",
            "aprlGuid": "2de8fa5e-14f4-4c4c-857f-1520f87a629f",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "If your workload is Maintenance sensitive, enable Scheduled Events. This Azure Metadata Service lets your app prepare for virtual machine maintenance by providing information on upcoming events like reboots, reducing disruptions.\n",
            "potentialBenefits": "Minimize downtime for VMs",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Monitor scheduled events for your Azure VMs",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/windows/scheduled-event-service"
                },
                {
                    "name": "Azure Metadata Service Scheduled Events for Linux VMs",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/linux/scheduled-events"
                },
                {
                    "name": "Azure Metadata Service Scheduled Events for Windows VMs",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/windows/scheduled-events"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Enable Scheduled Events for Maintenance sensitive workload VMs",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "2de8fa5e-14f4-4c4c-857f-1520f87a629f",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Azure disks offers a zone-redundant storage (ZRS) option for workloads that need to be resilient to an entire zone being down. Due to the cross-zone data replication, ZRS disks have higher write latency when compared to the locally-redundant option (LRS), so make sure to benchmark your disks.\n",
            "aprlGuid": "fa0cf4f5-0b21-47b7-89a9-ee936f193ce1",
            "recommendationTypeId": "d4102c0f-ebe3-4b22-8fe0-e488866a87af",
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure disks offers a zone-redundant storage (ZRS) option for workloads that need to be resilient to an entire zone being down. Due to the cross-zone data replication, ZRS disks have higher write latency when compared to the locally-redundant option (LRS), so make sure to benchmark your disks.\n",
            "potentialBenefits": "Enhanced Disk resilience to failures",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Redundancy options for managed disks",
                    "url": "https://aka.ms/zrsdisksdoc"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Use Azure Disks with Zone Redundant Storage for higher resiliency and availability",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "fa0cf4f5-0b21-47b7-89a9-ee936f193ce1",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find eligible Disks that are not zonal nor zone redundant\nresources\n| where type == 'microsoft.compute/disks'\n| where sku has \"Premium_LRS\" or sku has \"StandardSSD_LRS\"\n| where sku.name has_cs 'ZRS' or array_length(zones) > 0\n| project recommendationId=\"fa0cf4f5-0b21-47b7-89a9-ee936f193ce1\", name, id, tags, param1 = sku, param2 = sku.name\n"
        },
        {
            "description": "Azure Capacity Reservations ensure high availability for virtual machines by reserving compute capacity in advance within a specific region or availability zone. This guarantees that VMs will have the necessary resources during peak demand or maintenance events, enhancing reliability and uptime.\n",
            "aprlGuid": "302fda08-ee65-4fbe-a916-6dc0b33169c4",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Capacity Reservations ensure high availability for virtual machines by reserving compute capacity in advance within a specific region or availability zone. This guarantees that VMs will have the necessary resources during peak demand or maintenance events, enhancing reliability and uptime.\n",
            "potentialBenefits": "Guaranteed capacity in constrained regions/zones",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "On-demand Capacity Reservation",
                    "url": "https://aka.ms/on-demand-capacity-reservations-docs"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Reserve Compute Capacity for critical workloads",
            "severity": "High",
            "category": "High Availability",
            "guid": "302fda08-ee65-4fbe-a916-6dc0b33169c4",
            "source": "azure-resources/Compute/virtualMachines/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Virtual Machines not associated with a Capacity Reservation, and provide details for Capacity Reservation like vmSize, location, and zone.\nresources\n| where type =~ 'Microsoft.Compute/virtualMachines'\n| where isnull(properties.capacityReservation)\n| extend zoneValue = iff(isnull(zones), \"null\", zones)\n| project recommendationId = \"302fda08-ee65-4fbe-a916-6dc0b33169c4\", name, id, tags, param1 = strcat(\"VmSize: \", properties.hardwareProfile.vmSize), param2 = strcat(\"Location: \", location), param3 = strcat(\"Zone: \", zoneValue)\n"
        },
        {
            "description": "Choose a service tier of Azure Container Registry to meet your performance needs. Premium offers the most bandwidth and highest rate of read and write operations for high-volume deployments. Use Basic to start, Standard for production, and Premium for hyper-scale performance and geo-replication.\n",
            "aprlGuid": "eb005943-40a8-194b-9db2-474d430046b7",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerRegistry/registries",
            "recommendationMetadataState": "Active",
            "longDescription": "Choose a service tier of Azure Container Registry to meet your performance needs. Premium offers the most bandwidth and highest rate of read and write operations for high-volume deployments. Use Basic to start, Standard for production, and Premium for hyper-scale performance and geo-replication.\n",
            "potentialBenefits": "High-volume support and geo-replication",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Container Registry Best Practices",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/container-registry-best-practices"
                }
            ],
            "service": "Microsoft.ContainerRegistry/registries",
            "text": "Use Premium tier for critical production workloads",
            "severity": "High",
            "category": "Scalability",
            "guid": "eb005943-40a8-194b-9db2-474d430046b7",
            "source": "azure-resources/ContainerRegistry/registries/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Container Registries that are not using the Premium tier\nresources\n| where type =~ \"microsoft.containerregistry/registries\"\n| where sku.name != \"Premium\"\n| project recommendationId = \"eb005943-40a8-194b-9db2-474d430046b7\", name, id, tags, param1=strcat(\"SkuName: \", tostring(sku.name))\n| order by id asc\n\n"
        },
        {
            "description": "Azure Container Registry's optional zone redundancy enhances resiliency and high availability for registries or replication resources in a specific region by distributing resources across multiple zones.\n",
            "aprlGuid": "63491f70-22e4-3b4a-8b0c-845450e46fac",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerRegistry/registries",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Container Registry's optional zone redundancy enhances resiliency and high availability for registries or replication resources in a specific region by distributing resources across multiple zones.\n",
            "potentialBenefits": "Enhances resiliency and high availability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Registry best practices - Enable zone redundancy",
                    "url": "https://review.learn.microsoft.com/en-us/azure/container-registry/zone-redundancy?toc=%2Fazure%2Freliability%2Ftoc.json&bc=%2Fazure%2Freliability%2Fbreadcrumb%2Ftoc.json&branch=main"
                }
            ],
            "service": "Microsoft.ContainerRegistry/registries",
            "text": "Enable zone redundancy",
            "severity": "High",
            "category": "High Availability",
            "guid": "63491f70-22e4-3b4a-8b0c-845450e46fac",
            "source": "azure-resources/ContainerRegistry/registries/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Container Registries that do not have zone redundancy enabled\nresources\n| where type =~ \"microsoft.containerregistry/registries\"\n| where properties.zoneRedundancy != \"Enabled\"\n| project recommendationId = \"63491f70-22e4-3b4a-8b0c-845450e46fac\", name, id, tags, param1=strcat(\"zoneRedundancy: \", tostring(properties.zoneRedundancy))\n| order by id asc\n\n"
        },
        {
            "description": "Use Azure Container Registry's geo-replication for multi-region deployments to simplify registry management and minimize latency. It enables serving global customers from local data centers and supports distributed development teams. Regional webhooks can notify of events in replicas.\n",
            "aprlGuid": "36ea6c09-ef6e-d743-9cfb-bd0c928a430b",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerRegistry/registries",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Azure Container Registry's geo-replication for multi-region deployments to simplify registry management and minimize latency. It enables serving global customers from local data centers and supports distributed development teams. Regional webhooks can notify of events in replicas.\n",
            "potentialBenefits": "Simplifies management, reduces latency",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Registry best practices - Enable geo-replication",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/container-registry-best-practices#geo-replicate-multi-region-deployments"
                },
                {
                    "name": "Geo-Replicate Container Registry",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/container-registry-geo-replication"
                }
            ],
            "service": "Microsoft.ContainerRegistry/registries",
            "text": "Enable geo-replication",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "36ea6c09-ef6e-d743-9cfb-bd0c928a430b",
            "source": "azure-resources/ContainerRegistry/registries/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Container Registries that do not have geo-replication enabled\nresources\n| where type =~ \"microsoft.containerregistry/registries\"\n| project registryName = name, registryId = id, tags, primaryRegion = location\n| join kind=leftouter (\n    Resources\n    | where type =~ \"microsoft.containerregistry/registries/replications\"\n    | project replicationRegion=name, replicationId = id\n    | extend registryId=strcat_array(array_slice(split(replicationId, '/'), 0, -3), '/')\n    ) on registryId\n| project-away registryId1, replicationId\n| where isempty(replicationRegion)\n| project recommendationId = \"36ea6c09-ef6e-d743-9cfb-bd0c928a430b\", name=registryName, id=registryId, tags\n| order by id asc\n\n"
        },
        {
            "description": "Using repository namespaces allows a single registry to be shared across multiple groups and deployments within an organization, supporting nested namespaces for group isolation. However, repositories are managed independently, not hierarchically.\n",
            "aprlGuid": "a5a0101a-a240-8742-90ba-81dbde9a0c0c",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.ContainerRegistry/registries",
            "recommendationMetadataState": "Active",
            "longDescription": "Using repository namespaces allows a single registry to be shared across multiple groups and deployments within an organization, supporting nested namespaces for group isolation. However, repositories are managed independently, not hierarchically.\n",
            "potentialBenefits": "Enables sharing and group isolation",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Registry best practices - use repository namespaces",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/container-registry-best-practices#repository-namespaces"
                }
            ],
            "service": "Microsoft.ContainerRegistry/registries",
            "text": "Use Repository namespaces",
            "severity": "Low",
            "category": "Security",
            "guid": "a5a0101a-a240-8742-90ba-81dbde9a0c0c",
            "source": "azure-resources/ContainerRegistry/registries/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Container registries, used across multiple hosts, should be in their own resource group to prevent accidental deletion of images when container instances are deleted, preserving the image collection while experimenting with hosts.\n",
            "aprlGuid": "8e389532-5db5-7e4c-9d4d-443b3e55ae82",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.ContainerRegistry/registries",
            "recommendationMetadataState": "Active",
            "longDescription": "Container registries, used across multiple hosts, should be in their own resource group to prevent accidental deletion of images when container instances are deleted, preserving the image collection while experimenting with hosts.\n",
            "potentialBenefits": "Safeguards image collection",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Registry best practices - Use dedicated resource group",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/container-registry-best-practices#dedicated-resource-group"
                }
            ],
            "service": "Microsoft.ContainerRegistry/registries",
            "text": "Move Container Registry to a dedicated resource group",
            "severity": "Low",
            "category": "Governance",
            "guid": "8e389532-5db5-7e4c-9d4d-443b3e55ae82",
            "source": "azure-resources/ContainerRegistry/registries/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// List container registries that contain additional resources within the same resource group.\nresources\n| where type =~ \"microsoft.containerregistry/registries\"\n| project registryName=name, registryId=id, registryTags=tags, resourceGroupId=strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup), resourceGroup, subscriptionId\n| join kind=inner (\n    resources\n    | where not(type =~ \"microsoft.containerregistry/registries\")\n    | summarize recourceCount=count() by subscriptionId, resourceGroup\n    | where recourceCount != 0\n) on resourceGroup, subscriptionId\n| project recommendationId = \"8e389532-5db5-7e4c-9d4d-443b3e55ae82\", name=registryName, id=registryId, tags=registryTags, param1=strcat('resourceGroupName:',resourceGroup), param2=strcat('resourceGroupId:',resourceGroupId)\n\n"
        },
        {
            "description": "The storage constraints of Azure Container Registry's service tiers align with usage scenarios: Basic for starters, Standard for production, and Premium for high-scale performance and geo-replication.\n",
            "aprlGuid": "3ef86f16-f65b-c645-9901-7830d6dc3a1b",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.ContainerRegistry/registries",
            "recommendationMetadataState": "Active",
            "longDescription": "The storage constraints of Azure Container Registry's service tiers align with usage scenarios: Basic for starters, Standard for production, and Premium for high-scale performance and geo-replication.\n",
            "potentialBenefits": "Reduce costs, optimize storage",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Registry best practices - Manage registry size",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/container-registry-best-practices#manage-registry-size"
                },
                {
                    "name": "Retention Policy",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/container-registry-retention-policy#about-the-retention-policy"
                }
            ],
            "service": "Microsoft.ContainerRegistry/registries",
            "text": "Manage registry size",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "3ef86f16-f65b-c645-9901-7830d6dc3a1b",
            "source": "azure-resources/ContainerRegistry/registries/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Container Registries that have their retention policy disabled\nresources\n| where type =~ \"microsoft.containerregistry/registries\"\n| where properties.policies.retentionPolicy.status == \"disabled\"\n| project recommendationId = \"3ef86f16-f65b-c645-9901-7830d6dc3a1b\", name, id, tags, param1='retentionPolicy:disabled'\n| order by id asc\n\n"
        },
        {
            "description": "By default, Azure container registry requires authentication for pull/push actions. Enabling anonymous pull access exposes all content for public read actions. This applies to all repositories, potentially allowing unrestricted access if repository-scoped tokens are used.\n",
            "aprlGuid": "03f4a7d8-c5b4-7842-8e6e-14997a34842b",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.ContainerRegistry/registries",
            "recommendationMetadataState": "Active",
            "longDescription": "By default, Azure container registry requires authentication for pull/push actions. Enabling anonymous pull access exposes all content for public read actions. This applies to all repositories, potentially allowing unrestricted access if repository-scoped tokens are used.\n",
            "potentialBenefits": "Enhanced security and controlled access",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Enable anonymous pull access",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/anonymous-pull-access#about-anonymous-pull-access"
                }
            ],
            "service": "Microsoft.ContainerRegistry/registries",
            "text": "Disable anonymous pull access",
            "severity": "Medium",
            "category": "Security",
            "guid": "03f4a7d8-c5b4-7842-8e6e-14997a34842b",
            "source": "azure-resources/ContainerRegistry/registries/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Container Registries that have anonymous pull access enabled\nresources\n| where type =~ \"microsoft.containerregistry/registries\"\n| where properties.anonymousPullEnabled == \"true\"\n| project recommendationId = \"03f4a7d8-c5b4-7842-8e6e-14997a34842b\", name, id, tags\n| order by id asc\n\n"
        },
        {
            "description": "Resource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations.\n",
            "aprlGuid": "44107155-7a32-9348-89f3-d5aa7e7c5a1d",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.ContainerRegistry/registries",
            "recommendationMetadataState": "Active",
            "longDescription": "Resource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations.\n",
            "potentialBenefits": "Enhanced tracking and debugging",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Monitoring Azure Container Registry data reference - Resource Logs",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/monitor-service-reference#resource-logs"
                },
                {
                    "name": "Monitor Azure Container Registry - Enable diagnostic logs",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/monitor-service#collection-and-routing"
                }
            ],
            "service": "Microsoft.ContainerRegistry/registries",
            "text": "Configure Diagnostic Settings for all Azure Container Registries",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "44107155-7a32-9348-89f3-d5aa7e7c5a1d",
            "source": "azure-resources/ContainerRegistry/registries/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Monitoring Azure resources using Azure Monitor enhances their availability, performance, and operation. Azure Container Registry, a full-stack monitoring service, provides features for Azure and other cloud and on-premises resources.\n",
            "aprlGuid": "d594cde6-4116-d143-a64a-25f63289a2f8",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.ContainerRegistry/registries",
            "recommendationMetadataState": "Active",
            "longDescription": "Monitoring Azure resources using Azure Monitor enhances their availability, performance, and operation. Azure Container Registry, a full-stack monitoring service, provides features for Azure and other cloud and on-premises resources.\n",
            "potentialBenefits": "Enhanced monitoring and operation",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Monitoring Azure Container Registry data reference",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/monitor-service-reference#metrics"
                },
                {
                    "name": "Monitor Azure Container Registry",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/monitor-service"
                }
            ],
            "service": "Microsoft.ContainerRegistry/registries",
            "text": "Monitor Azure Container Registry with Azure Monitor",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "d594cde6-4116-d143-a64a-25f63289a2f8",
            "source": "azure-resources/ContainerRegistry/registries/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Enabling soft delete in Azure Container Registry (ACR) allows for the management of deleted artifacts with a specified retention period. Users can list, filter, and restore these artifacts until automatically purged post-retention.\n",
            "aprlGuid": "e7f0fd54-fba0-054e-9ab8-e676f2851f88",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.ContainerRegistry/registries",
            "recommendationMetadataState": "Active",
            "longDescription": "Enabling soft delete in Azure Container Registry (ACR) allows for the management of deleted artifacts with a specified retention period. Users can list, filter, and restore these artifacts until automatically purged post-retention.\n",
            "potentialBenefits": "Recovery of deleted artifacts",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Enable soft delete policy",
                    "url": "https://learn.microsoft.com/en-us/azure/container-registry/container-registry-soft-delete-policy"
                }
            ],
            "service": "Microsoft.ContainerRegistry/registries",
            "text": "Enable soft delete policy",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "e7f0fd54-fba0-054e-9ab8-e676f2851f88",
            "source": "azure-resources/ContainerRegistry/registries/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure Container Registry resources that do not have soft delete enabled\nresources\n| where type =~ \"microsoft.containerregistry/registries\"\n| where properties.policies.softDeletePolicy.status == \"disabled\"\n| project recommendationId = \"e7f0fd54-fba0-054e-9ab8-e676f2851f88\", name, id, tags\n| order by id asc\n\n"
        },
        {
            "description": "Azure Availability Zones ensure high availability by offering independent locations within regions, equipped with their own power, cooling, and networking to ensure applications and data are protected from datacenter-level failures.\n",
            "aprlGuid": "4f63619f-5001-439c-bacb-8de891287727",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Availability Zones ensure high availability by offering independent locations within regions, equipped with their own power, cooling, and networking to ensure applications and data are protected from datacenter-level failures.\n",
            "potentialBenefits": "Enhanced fault tolerance for AKS",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "AKS Availability Zones",
                    "url": "https://learn.microsoft.com/en-us/azure/aks/availability-zones"
                },
                {
                    "name": "Zone Balancing",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-use-availability-zones#zone-balancing"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Deploy AKS cluster across availability zones",
            "severity": "High",
            "category": "High Availability",
            "guid": "4f63619f-5001-439c-bacb-8de891287727",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns AKS clusters that do not have any availability zones enabled or only use a single zone\nresources\n| where type =~ \"Microsoft.ContainerService/managedClusters\"\n| project id, name, tags, location, pools = properties.agentPoolProfiles\n| mv-expand pool = pools\n| extend\n    numOfAvailabilityZones = iif(isnull(pool.availabilityZones), 0, array_length(pool.availabilityZones))\n| where numOfAvailabilityZones < 2\n| project\n    recommendationId = \"4f63619f-5001-439c-bacb-8de891287727\",\n    id,\n    name,\n    tags,\n    param1 = strcat(\"NodePoolName: \", pool.name),\n    param2 = strcat(\"Mode: \", pool.mode),\n    param3 = strcat(\"AvailabilityZones: \", iif(numOfAvailabilityZones == 0, \"None\", strcat(\"Zone \", strcat_array(pool.availabilityZones, \", \")))),\n    param4 = strcat(\"Location: \", location)\n"
        },
        {
            "description": "AKS assigns the kubernetes.azure.com/mode: system label to nodes in system node pools signaling the preference for system pods should be scheduled there. The CriticalAddonsOnly=true:NoSchedule taint can be added to your system nodes to prohibit application pods from being scheduled on them.\n",
            "aprlGuid": "5ee083cd-6ac3-4a83-8913-9549dd36cf56",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "AKS assigns the kubernetes.azure.com/mode: system label to nodes in system node pools signaling the preference for system pods should be scheduled there. The CriticalAddonsOnly=true:NoSchedule taint can be added to your system nodes to prohibit application pods from being scheduled on them.\n",
            "potentialBenefits": "Enhanced reliability via pod isolation",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "System and user node pools",
                    "url": "https://learn.microsoft.com/en-us/azure/aks/use-system-pools?tabs=azure-cli#system-and-user-node-pools"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Isolate system and application pods",
            "severity": "High",
            "category": "High Availability",
            "guid": "5ee083cd-6ac3-4a83-8913-9549dd36cf56",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns each AKS cluster with nodepools that do not have system pods labelled with CriticalAddonsOnly\nresources\n| where type == \"microsoft.containerservice/managedclusters\"\n| mv-expand agentPoolProfile = properties.agentPoolProfiles\n| where agentPoolProfile.mode =~ 'System' // system node pools\n| extend taint = tostring(parse_json(agentPoolProfile.nodeTaints))\n| extend hasCriticalAddonsTaint = agentPoolProfile.kubeletConfig has 'CriticalAddonsOnly'\n| extend hasNodeLabel = agentPoolProfile.customNodeLabels has 'CriticalAddonsOnly'\n| extend hasCriticalAddonsOnly = hasCriticalAddonsTaint or hasNodeLabel or isempty(taint)\n| extend nodePool = tostring(parse_json(agentPoolProfile.name))\n| where hasCriticalAddonsOnly\n| project\n    recommendationId=\"5ee083cd-6ac3-4a83-8913-9549dd36cf56\",\n    id,\n    name,\n    tags,\n    param1=strcat(\"nodepoolName: \", nodePool)\n"
        },
        {
            "description": "Local Kubernetes accounts in AKS, being non-auditable and legacy, are discouraged. Microsoft Entra's integration offers centralized management, multi-factor authentication, RBAC for detailed access, and a secure, scalable authentication system compatible with Azure and external identity providers.\n",
            "aprlGuid": "ca324d71-54b0-4a3e-b9e4-10e767daa9fc",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Local Kubernetes accounts in AKS, being non-auditable and legacy, are discouraged. Microsoft Entra's integration offers centralized management, multi-factor authentication, RBAC for detailed access, and a secure, scalable authentication system compatible with Azure and external identity providers.\n",
            "potentialBenefits": "Enhanced security and access control",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Entra integration",
                    "url": "https://learn.microsoft.com/en-us/azure/aks/concepts-identity#azure-ad-integration"
                },
                {
                    "name": "Use Azure role-based access control for AKS",
                    "url": "https://learn.microsoft.com/en-us/azure/aks/manage-azure-rbac?source=recommendations"
                },
                {
                    "name": "Manage AKS local accounts",
                    "url": "https://learn.microsoft.com/en-us/azure/aks/manage-local-accounts-managed-azure-ad?source=recommendations"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Disable local accounts",
            "severity": "High",
            "category": "Security",
            "guid": "ca324d71-54b0-4a3e-b9e4-10e767daa9fc",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns a list of AKS clusters not using AAD enabled\nresources\n| where type == \"microsoft.containerservice/managedclusters\"\n| extend aadProfile = tostring (parse_json(properties.aadProfile))\n| extend disablelocalAdmin = tostring(parse_json(properties.disableLocalAccounts))\n| extend RBAC = tostring(parse_json(properties.enableRBAC))\n| where RBAC == \"false\"\n| project recommendationId=\"ca324d71-54b0-4a3e-b9e4-10e767daa9fc\", name, id, tags, param1=strcat(\"aadProfile: \", aadProfile), param2=strcat(\"disablelocalAdmin: \",disablelocalAdmin), param3=strcat(\"RBAC: \", RBAC)\n\n"
        },
        {
            "description": "Azure CNI enhances cluster IP and network management, allowing dynamic IP allocation, scalable subnets, direct pod-VNET connectivity, and supports diverse network policies for pods and nodes with Azure Network Policies and Calico, optimizing network efficiency and security\n",
            "aprlGuid": "c22db132-399b-4e7c-995d-577a60881be8",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure CNI enhances cluster IP and network management, allowing dynamic IP allocation, scalable subnets, direct pod-VNET connectivity, and supports diverse network policies for pods and nodes with Azure Network Policies and Calico, optimizing network efficiency and security\n",
            "potentialBenefits": "Dynamic IP allocation, scalable subnets, direct VNET access",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure Azure CNI networking",
                    "url": "https://learn.microsoft.com/en-us/azure/aks/configure-azure-cni-dynamic-ip-allocation"
                },
                {
                    "name": "Configure Azure CNI Overlay networking",
                    "url": "https://learn.microsoft.com/en-us/azure/aks/azure-cni-overlay"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Configure Azure CNI networking for dynamic allocation of IPs",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "c22db132-399b-4e7c-995d-577a60881be8",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Check AKS Clusters using kubenet network profile\nresources\n| where type == \"microsoft.containerservice/managedclusters\"\n| extend networkProfile = tostring (parse_json(properties.networkProfile.networkPlugin))\n| where networkProfile ==\"kubenet\"\n| project recommendationId=\"c22db132-399b-4e7c-995d-577a60881be8\", name, id, tags, param1=strcat(\"networkProfile :\",networkProfile)\n\n"
        },
        {
            "description": "The cluster auto-scaler in AKS adjusts node counts based on pod resource needs and available capacity, enabling scaling as per demand to prevent outages.\n",
            "aprlGuid": "902c82ff-4910-4b61-942d-0d6ef7f39b67",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "The cluster auto-scaler in AKS adjusts node counts based on pod resource needs and available capacity, enabling scaling as per demand to prevent outages.\n",
            "potentialBenefits": "Optimizes scaling and prevents outages",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Use the Cluster Autoscaler on AKS",
                    "url": "https://learn.microsoft.com/azure/aks/cluster-autoscaler?tabs=azure-cli"
                },
                {
                    "name": "Best practices for advanced scheduler features",
                    "url": "https://learn.microsoft.com/azure/aks/operator-best-practices-advanced-scheduler"
                },
                {
                    "name": "Node pool scaling considerations and best practices",
                    "url": "https://learn.microsoft.com/azure/aks/best-practices-performance-scale-large#node-pool-scaling"
                },
                {
                    "name": "Best practices for basic scheduler features",
                    "url": "https://learn.microsoft.com/azure/aks/operator-best-practices-scheduler"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Enable the cluster auto-scaler on an existing cluster",
            "severity": "High",
            "category": "Scalability",
            "guid": "902c82ff-4910-4b61-942d-0d6ef7f39b67",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find AKS clusters with auto-scaling disabled\nResources\n| where type == \"microsoft.containerservice/managedclusters\"\n| extend autoScaling = tostring (parse_json(properties.agentPoolProfiles.[0].enableAutoScaling))\n| where autoScaling == \"false\"\n| project recommendationId=\"902c82ff-4910-4b61-942d-0d6ef7f39b67\", name, id, tags, param1=strcat(\"autoScaling :\", autoScaling)\n\n"
        },
        {
            "description": "AKS, popular for stateful apps needing backups, can now use Azure Backup to secure clusters and attached volumes through an installed Backup Extension, enabling backup and restore operations via a Backup Vault.\n",
            "aprlGuid": "269a9f1a-6675-460a-831e-b05a887a8c4b",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "AKS, popular for stateful apps needing backups, can now use Azure Backup to secure clusters and attached volumes through an installed Backup Extension, enabling backup and restore operations via a Backup Vault.\n",
            "potentialBenefits": "Ensures data safety for AKS",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "AKS Backups",
                    "url": "https://learn.microsoft.com/en-us/azure/backup/azure-kubernetes-service-cluster-backup"
                },
                {
                    "name": "Best Practices for AKS Backups",
                    "url": "https://learn.microsoft.com/en-us/azure/aks/operator-best-practices-storage"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Back up Azure Kubernetes Service",
            "severity": "Low",
            "category": "Disaster Recovery",
            "guid": "269a9f1a-6675-460a-831e-b05a887a8c4b",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find AKS clusters that do not have backup enabled\n\nresources\n| where type =~ 'Microsoft.ContainerService/managedClusters'\n| extend lname = tolower(name)\n| join kind=leftouter(recoveryservicesresources\n    | where type =~ 'microsoft.dataprotection/backupvaults/backupinstances'\n    | extend lname = tolower(tostring(split(properties.dataSourceInfo.resourceID, '/')[8]))\n    | extend protectionState = properties.currentProtectionState\n    | project lname, protectionState) on lname\n| where protectionState != 'ProtectionConfigured'\n| extend param1 = iif(isnull(protectionState), 'Protection Not Configured', strcat('Protection State: ', protectionState))\n| project recommendationId = \"269a9f1a-6675-460a-831e-b05a887a8c4b\", name, id, tags, param1\n\n"
        },
        {
            "description": "ZRS ensures data replication across three zones, protecting against zonal outages. It's available for Azure Disks, Container Storage, Files, and Blob by setting the SKU to ZRS in storage classes, enhancing multi-zone AKS clusters from v1.29.\n",
            "aprlGuid": "d3111036-355d-431b-ab49-8ddad042800b",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "ZRS ensures data replication across three zones, protecting against zonal outages. It's available for Azure Disks, Container Storage, Files, and Blob by setting the SKU to ZRS in storage classes, enhancing multi-zone AKS clusters from v1.29.\n",
            "potentialBenefits": "Increases data durability and availability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Availability zones overview",
                    "url": "https://learn.microsoft.com/azure/reliability/availability-zones-overview?tabs=azure-cli"
                },
                {
                    "name": "Zone-redundant storage",
                    "url": "https://learn.microsoft.com/azure/storage/common/storage-redundancy#zone-redundant-storage"
                },
                {
                    "name": "ZRS disks",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/disks-redundancy#zone-redundant-storage-for-managed-disks"
                },
                {
                    "name": "Convert a disk from LRS to ZRS",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/disks-migrate-lrs-zrs"
                },
                {
                    "name": "Enable multi-zone storage redundancy in Azure Container Storage",
                    "url": "https://learn.microsoft.com/azure/storage/container-storage/enable-multi-zone-redundancy"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Use zone-redundant storage for persistent volumes when running multi-zone AKS",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "d3111036-355d-431b-ab49-8ddad042800b",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "From Kubernetes 1.26, Azure Disk and Azure File in-tree drivers are deprecated in favor of CSI drivers. Existing deployments remain operational but untested; users should switch to CSI drivers for new features and SKUs.\n",
            "aprlGuid": "b002c030-72e6-4a37-8217-1cb276c43169",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "From Kubernetes 1.26, Azure Disk and Azure File in-tree drivers are deprecated in favor of CSI drivers. Existing deployments remain operational but untested; users should switch to CSI drivers for new features and SKUs.\n",
            "potentialBenefits": "Ensures future compatibility",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "CSI Storage Drivers",
                    "url": "https://learn.microsoft.com/azure/aks/csi-storage-drivers"
                },
                {
                    "name": "CSI Migrate in Tree Volumes",
                    "url": "https://learn.microsoft.com/azure/aks/csi-migrate-in-tree-volumes"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Upgrade Persistent Volumes using in-tree drivers to Azure CSI drivers",
            "severity": "High",
            "category": "Governance",
            "guid": "b002c030-72e6-4a37-8217-1cb276c43169",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "A ResourceQuota object sets limits on resource use per namespace, controlling the number and type of objects created, and the total compute resources available.\n",
            "aprlGuid": "9a1c17e5-c9a0-43db-b920-adaf54d1bcb7",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "A ResourceQuota object sets limits on resource use per namespace, controlling the number and type of objects created, and the total compute resources available.\n",
            "potentialBenefits": "Limits AKS resource usage per namespace",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resource Quotas",
                    "url": "https://kubernetes.io/docs/concepts/policy/resource-quotas/"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Implement Resource Quota to ensure that Kubernetes resources do not exceed hard resource limits",
            "severity": "Low",
            "category": "Scalability",
            "guid": "9a1c17e5-c9a0-43db-b920-adaf54d1bcb7",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "To rapidly scale AKS workloads, utilize virtual nodes for quick pod provisioning, unlike Kubernetes auto-scaler. For clusters with availability zones, ensure one nodepool per AZ due to persistent volumes not working across AZs, preventing auto-scaler pod creation failures if lacking access.\n",
            "aprlGuid": "b4639ca7-6308-429a-8b98-92f0bf9bf813",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "To rapidly scale AKS workloads, utilize virtual nodes for quick pod provisioning, unlike Kubernetes auto-scaler. For clusters with availability zones, ensure one nodepool per AZ due to persistent volumes not working across AZs, preventing auto-scaler pod creation failures if lacking access.\n",
            "potentialBenefits": "Faster scaling with virtual nodes",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Virtual Nodes",
                    "url": "https://learn.microsoft.com/azure/aks/virtual-nodes"
                },
                {
                    "name": "Azure Container Instances",
                    "url": "https://learn.microsoft.com/azure/container-instances/container-instances-overview"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Attach Virtual Nodes (ACI) to the AKS cluster",
            "severity": "Low",
            "category": "Scalability",
            "guid": "b4639ca7-6308-429a-8b98-92f0bf9bf813",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Production AKS clusters require the Standard tier for a financially backed SLA and enhanced node scalability, as the free service lacks these features.\n",
            "aprlGuid": "0611251f-e70f-4243-8ddd-cfe894bec2e7",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Production AKS clusters require the Standard tier for a financially backed SLA and enhanced node scalability, as the free service lacks these features.\n",
            "potentialBenefits": "SLA guarantee and better scalability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Pricing Tiers",
                    "url": "https://learn.microsoft.com/en-us/azure/aks/free-standard-pricing-tiers"
                },
                {
                    "name": "AKS Baseline Architecture",
                    "url": "https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/containers/aks/baseline-aks?toc=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fazure%2Faks%2Ftoc.json&bc=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fazure%2Fbread%2Ftoc.json#kubernetes-api-server-sla"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Update AKS tier to Standard",
            "severity": "High",
            "category": "High Availability",
            "guid": "0611251f-e70f-4243-8ddd-cfe894bec2e7",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns all AKS clusters not running on the Standard tier\nresources\n| where type == \"microsoft.containerservice/managedclusters\"\n| where sku.tier != \"Standard\"\n| project recommendationId=\"0611251f-e70f-4243-8ddd-cfe894bec2e7\", id, name, tags, param1=strcat(\"skuName: \", sku.name), param2=strcat(\"skuTier: \", sku.tier)\n\n"
        },
        {
            "description": "Azure Monitor enables real-time health and performance insights for AKS by collecting events, capturing container logs, and gathering CPU/Memory data from the Metrics API. It allows data visualization using Azure Monitor Container Insights, Prometheus, Grafana, or others.\n",
            "aprlGuid": "dcaf8128-94bd-4d53-9235-3a0371df6b74",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Monitor enables real-time health and performance insights for AKS by collecting events, capturing container logs, and gathering CPU/Memory data from the Metrics API. It allows data visualization using Azure Monitor Container Insights, Prometheus, Grafana, or others.\n",
            "potentialBenefits": "Real-time AKS health/performance insights",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Monitor AKS",
                    "url": "https://learn.microsoft.com/azure/aks/monitor-aks"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Enable AKS Monitoring",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "dcaf8128-94bd-4d53-9235-3a0371df6b74",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns AKS clusters where either Azure Monitor is not enabled and/or Container Insights is not enabled\nresources\n|  where type == \"microsoft.containerservice/managedclusters\"\n|  extend azureMonitor = tostring(parse_json(properties.azureMonitorProfile.metrics.enabled))\n|  extend insights = tostring(parse_json(properties.addonProfiles.omsagent.enabled))\n|  where isempty(azureMonitor) or isempty(insights)\n|  project recommendationId=\"dcaf8128-94bd-4d53-9235-3a0371df6b74\",id, name, tags, param1=strcat(\"azureMonitorProfileEnabled: \", iff(isempty(azureMonitor), \"false\", azureMonitor)), param2=strcat(\"containerInsightsEnabled: \", iff(isempty(insights), \"false\", insights))\n\n"
        },
        {
            "description": "Ephemeral OS disks on AKS offer lower read/write latency due to local attachment, eliminating the need for replication seen with managed disks. This enhances performance and speeds up cluster operations such as scaling or upgrading due to quicker re-imaging and boot times.\n",
            "aprlGuid": "a7bfcc18-b0d8-4d37-81f3-8131ed8bead5",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Ephemeral OS disks on AKS offer lower read/write latency due to local attachment, eliminating the need for replication seen with managed disks. This enhances performance and speeds up cluster operations such as scaling or upgrading due to quicker re-imaging and boot times.\n",
            "potentialBenefits": "Lower latency, faster re-imaging and booting",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Ephemeral OS disk",
                    "url": "https://learn.microsoft.com/azure/aks/concepts-storage#ephemeral-os-disk"
                },
                {
                    "name": "Configure an AKS cluster",
                    "url": "https://learn.microsoft.com/azure/aks/cluster-configuration"
                },
                {
                    "name": "Everything you want to know about ephemeral OS disks and AKS",
                    "url": "https://learn.microsoft.com/samples/azure-samples/aks-ephemeral-os-disk/aks-ephemeral-os-disk/"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Use Ephemeral OS disks on AKS clusters",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "a7bfcc18-b0d8-4d37-81f3-8131ed8bead5",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns any AKS cluster nodepools that do not have Ephemeral Disks\nresources\n| where type == \"microsoft.containerservice/managedclusters\"\n| mv-expand agentPoolProfile = properties.agentPoolProfiles\n| extend type = tostring(agentPoolProfile.osDiskType)\n| where type != 'Ephemeral'\n| project recommendationId=\"a7bfcc18-b0d8-4d37-81f3-8131ed8bead5\", name, id, param1=strcat(\"osDiskType: \", type)\n"
        },
        {
            "description": "Azure Policies in AKS clusters help enforce governance best practices concerning security, authentication, provisioning, networking, and more, ensuring a robust and secure environment for operations.\n",
            "aprlGuid": "26ebaf1f-c70d-4ebd-8641-4b60a0ce0094",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Policies in AKS clusters help enforce governance best practices concerning security, authentication, provisioning, networking, and more, ensuring a robust and secure environment for operations.\n",
            "potentialBenefits": "Enhanced AKS governance and security",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "AKS Baseline - Policy Management",
                    "url": "https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/containers/aks/baseline-aks?toc=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fazure%2Faks%2Ftoc.json&bc=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fazure%2Fbread%2Ftoc.json#policy-management"
                },
                {
                    "name": "Built-in Policy Definitions for AKS",
                    "url": "https://learn.microsoft.com/en-us/azure/aks/policy-reference"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Enable and remediate Azure Policies configured for AKS",
            "severity": "Low",
            "category": "Governance",
            "guid": "26ebaf1f-c70d-4ebd-8641-4b60a0ce0094",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns a count of non-compliant policy items per AKS cluster\nPolicyResources\n| where type =~ 'Microsoft.PolicyInsights/PolicyStates'\n| extend complianceState = tostring(properties.complianceState)\n| where complianceState == 'NonCompliant'\n| where properties.resourceType =~ 'Microsoft.ContainerService/managedClusters'\n| extend\n    id = tostring(properties.resourceId)\n| summarize count() by id\n| join kind=inner (\n    resources\n    | where type =~ 'Microsoft.ContainerService/managedClusters'\n    | project id, name\n) on id\n| project recommendationId=\"26ebaf1f-c70d-4ebd-8641-4b60a0ce0094\", id, name, param1=strcat(\"numNonCompliantAlerts: \", count_)\n"
        },
        {
            "description": "GitOps, an operating model for cloud-native apps, uses Git for storing application and infrastructure code as a source of truth for continuous delivery.\n",
            "aprlGuid": "5f3cbd68-692a-4121-988c-9770914859a9",
            "recommendationTypeId": null,
            "recommendationControl": "Other Best Practices",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "GitOps, an operating model for cloud-native apps, uses Git for storing application and infrastructure code as a source of truth for continuous delivery.\n",
            "potentialBenefits": "Ensures AKS config consistency",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "GitOps with AKS",
                    "url": "https://learn.microsoft.com/en-us/azure/architecture/guide/aks/aks-cicd-github-actions-and-gitops"
                },
                {
                    "name": "GitOps for AKS - Reference Architecture",
                    "url": "https://learn.microsoft.com/en-us/azure/architecture/example-scenario/gitops-aks/gitops-blueprint-aks"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Enable GitOps when using DevOps frameworks",
            "severity": "Low",
            "category": "Other Best Practices",
            "guid": "5f3cbd68-692a-4121-988c-9770914859a9",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns AKS clusters where GitOps is not enabled\nresources\n|  where type == \"microsoft.containerservice/managedclusters\"\n|  extend gitops = tostring (parse_json(properties.addOnProfiles.gitops.enabled))\n|  where isempty(gitops)\n|  project recommendationId=\"5f3cbd68-692a-4121-988c-9770914859a9\", id, name, tags, param1=strcat(\"gitopsEnabled: \", \"false\")\n\n"
        },
        {
            "description": "Enhance availability and reliability by using pod topology spread constraints to control pod distribution based on node or zone topology, ensuring pods are spread across your cluster.\n",
            "aprlGuid": "928fcc6f-5e9a-42d9-9bd4-260af42de2e5",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Enhance availability and reliability by using pod topology spread constraints to control pod distribution based on node or zone topology, ensuring pods are spread across your cluster.\n",
            "potentialBenefits": "Ensures high availability and efficient use",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Topology Spread Constraints",
                    "url": "https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/"
                },
                {
                    "name": "Assign Pod Node",
                    "url": "https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Use pod topology spread constraints to ensure that pods are spread across different nodes or zones",
            "severity": "High",
            "category": "High Availability",
            "guid": "928fcc6f-5e9a-42d9-9bd4-260af42de2e5",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "AKS kubelet controller uses liveness probes to validate containers and applications health, ensuring the system knows when to restart a container based on its health status.\n",
            "aprlGuid": "cd6791b1-c60e-4b37-ac98-9897b1e6f4b8",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "AKS kubelet controller uses liveness probes to validate containers and applications health, ensuring the system knows when to restart a container based on its health status.\n",
            "potentialBenefits": "Enhances container health monitoring",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure probes",
                    "url": "https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/"
                },
                {
                    "name": "Assign Pod Node",
                    "url": "https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Configures Pods Liveness, Readiness, and Startup Probes",
            "severity": "High",
            "category": "High Availability",
            "guid": "cd6791b1-c60e-4b37-ac98-9897b1e6f4b8",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Configuring multiple replicas in Pod or Deployment manifests stabilizes the number of replica Pods, ensuring that a specified number of identical Pods are always available, thereby guaranteeing their availability.\n",
            "aprlGuid": "bcfe71f1-ebed-49e5-a84a-193b81ad5d27",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Configuring multiple replicas in Pod or Deployment manifests stabilizes the number of replica Pods, ensuring that a specified number of identical Pods are always available, thereby guaranteeing their availability.\n",
            "potentialBenefits": "Ensures stable pod availability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Replica Sets",
                    "url": "https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Use deployments with multiple replicas in production applications to guarantee availability",
            "severity": "High",
            "category": "High Availability",
            "guid": "bcfe71f1-ebed-49e5-a84a-193b81ad5d27",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "The system node pool should be configured with a minimum node count of two to ensure critical system pods are resilient to node outages.\n",
            "aprlGuid": "7f7ae535-a5ba-4665-b7e0-c451dbdda01f",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "The system node pool should be configured with a minimum node count of two to ensure critical system pods are resilient to node outages.\n",
            "potentialBenefits": "Ensures pod resilience",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "System nodepools",
                    "url": "https://learn.microsoft.com/azure/aks/use-system-pools?tabs=azure-cli"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Configure system nodepool count",
            "severity": "High",
            "category": "High Availability",
            "guid": "7f7ae535-a5ba-4665-b7e0-c451dbdda01f",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns each AKS cluster with nodepools that have system nodepools with less than 2 nodes\nresources\n| where type == \"microsoft.containerservice/managedclusters\"\n| mv-expand agentPoolProfile = properties.agentPoolProfiles\n| extend taints = tostring(parse_json(agentPoolProfile.nodeTaints))\n| extend nodePool = tostring(parse_json(agentPoolProfile.name))\n| where taints has \"CriticalAddonsOnly=true:NoSchedule\" and  agentPoolProfile.minCount < 2\n| project recommendationId=\"7f7ae535-a5ba-4665-b7e0-c451dbdda01f\", id, name, param1=strcat(\"nodePoolName: \", nodePool), param2=strcat(\"nodePoolMinNodeCount: \", agentPoolProfile.minCount)\n\n"
        },
        {
            "description": "Configuring the user node pool with at least two nodes is essential for applications needing high availability, ensuring they remain operational and accessible without interruption.\n",
            "aprlGuid": "005ccbbd-aeab-46ef-80bd-9bd4479412ec",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Configuring the user node pool with at least two nodes is essential for applications needing high availability, ensuring they remain operational and accessible without interruption.\n",
            "potentialBenefits": "Ensures high app availability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Well-Architected Framework review for Azure Kubernetes Service (AKS)",
                    "url": "https://learn.microsoft.com/azure/well-architected/service-guides/azure-kubernetes-service#design-checklist"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Configure user nodepool count",
            "severity": "High",
            "category": "High Availability",
            "guid": "005ccbbd-aeab-46ef-80bd-9bd4479412ec",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns each AKS cluster with nodepools that have user nodepools with less than 2 nodes\nresources\n| where type == \"microsoft.containerservice/managedclusters\"\n| mv-expand agentPoolProfile = properties.agentPoolProfiles\n| extend taints = tostring(parse_json(agentPoolProfile.nodeTaints))\n| extend nodePool = tostring(parse_json(agentPoolProfile.name))\n| where taints !has \"CriticalAddonsOnly=true:NoSchedule\" and  agentPoolProfile.minCount < 2\n| project recommendationId=\"005ccbbd-aeab-46ef-80bd-9bd4479412ec\", id, name, param1=strcat(\"nodePoolName: \", nodePool), param2=strcat(\"nodePoolMinNodeCount: \", agentPoolProfile.minCount)\n\n"
        },
        {
            "description": "A Pod Disruption Budget is a Kubernetes resource configuring the minimum number or percentage of pods that should remain available during disruptions like maintenance or scaling, ensuring a minimum number of pods are always available in the cluster.\n",
            "aprlGuid": "a08a06a0-e41a-4b99-83bb-69ce8bca54cb",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "A Pod Disruption Budget is a Kubernetes resource configuring the minimum number or percentage of pods that should remain available during disruptions like maintenance or scaling, ensuring a minimum number of pods are always available in the cluster.\n",
            "potentialBenefits": "Ensures cluster resiliency during disruptions",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure PDBs",
                    "url": "https://kubernetes.io/docs/tasks/run-application/configure-pdb/"
                },
                {
                    "name": "Plan availability using PDBs",
                    "url": "https://learn.microsoft.com/azure/aks/operator-best-practices-scheduler#plan-for-availability-using-pod-disruption-budgets"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Configure pod disruption budgets (PDBs)",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "a08a06a0-e41a-4b99-83bb-69ce8bca54cb",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Nodepool subnets sized for max auto-scale settings enable AKS to efficiently scale out nodes, meeting increased demand while reducing resource constraints and potential service disruptions.\n",
            "aprlGuid": "e620fa98-7a40-41a0-bfc9-b4407297fb58",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Nodepool subnets sized for max auto-scale settings enable AKS to efficiently scale out nodes, meeting increased demand while reducing resource constraints and potential service disruptions.\n",
            "potentialBenefits": "Efficient scaling, reduced disruptions",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure CNI Dynamic IP Allocation",
                    "url": "https://learn.microsoft.com/azure/aks/configure-azure-cni-dynamic-ip-allocation"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Nodepool subnet size needs to accommodate maximum auto-scale settings",
            "severity": "High",
            "category": "High Availability",
            "guid": "e620fa98-7a40-41a0-bfc9-b4407297fb58",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns each AKS cluster with nodepools that have user nodepools with a subnetmask that does not match autoscale configured max-nodes\n// Subtracting the network address, broadcast address, and default 3 addresses Azure reserves within each subnet\n\nresources\n| where type == \"microsoft.containerservice/managedclusters\"\n| extend nodePools = properties['agentPoolProfiles']\n| mv-expand nodePools = properties.agentPoolProfiles\n| where nodePools.enableAutoScaling == true\n| extend nodePoolName=nodePools.name, maxNodes = nodePools.maxCount, subnetId = tostring(nodePools.vnetSubnetID)\n| project clusterId = id, clusterName=name, nodePoolName=nodePools.name, toint(maxNodes), subnetId\n| join kind = leftouter (\n    resources\n    | where type == 'microsoft.network/virtualnetworks'\n    | extend subnets = properties.subnets\n    | mv-expand subnets\n    | project id = tostring(subnets.id), addressPrefix = tostring(subnets.properties['addressPrefix'])\n    | extend subnetmask = toint(substring(addressPrefix, indexof(addressPrefix, '/')+1, string_size(addressPrefix)))\n    | extend possibleMaxNodeCount = toint(exp2(32-subnetmask) - 5)\n) on $left.subnetId == $right.id\n| project-away id, subnetmask\n| where possibleMaxNodeCount <= maxNodes\n| extend param1 = strcat(nodePoolName, \" autoscaler upper limit: \", maxNodes)\n| extend param2 = strcat(\"ip addresses on subnet: \", possibleMaxNodeCount)\n| project recommendationId=\"e620fa98-7a40-41a0-bfc9-b4407297fb58\", name=clusterName, id=clusterId, param1, param2\n\n"
        },
        {
            "description": "Node pool settings should not exceed the subscription core quota to ensure AKS can scale out nodes efficiently, meeting increased demand while reducing resource constraints and potential service disruptions.\n",
            "aprlGuid": "a01afc4c-7439-4919-b2da-3565992ea2a7",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Node pool settings should not exceed the subscription core quota to ensure AKS can scale out nodes efficiently, meeting increased demand while reducing resource constraints and potential service disruptions.\n",
            "potentialBenefits": "Reduced disruptions",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Quotas",
                    "url": "https://learn.microsoft.com/azure/quotas/quotas-overview"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Node pool auto-scale settings should not exceed subscription core quota",
            "severity": "High",
            "category": "High Availability",
            "guid": "a01afc4c-7439-4919-b2da-3565992ea2a7",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Azure Linux on AKS boosts resiliency with a native image using validated, source-built components. It's lightweight, reducing the attack surface and maintenance. A Microsoft-hardened kernel, optimized for Azure, enhances stability and security for container workloads.\n",
            "aprlGuid": "f46b0d1d-56ef-4795-b98a-f6ee00cb341a",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Linux on AKS boosts resiliency with a native image using validated, source-built components. It's lightweight, reducing the attack surface and maintenance. A Microsoft-hardened kernel, optimized for Azure, enhances stability and security for container workloads.\n",
            "potentialBenefits": "Reduced disruptions",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Linux",
                    "url": "https://learn.microsoft.com/azure/aks/use-azure-linux"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Use Azure Linux for Linux nodepools",
            "severity": "High",
            "category": "High Availability",
            "guid": "f46b0d1d-56ef-4795-b98a-f6ee00cb341a",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns each AKS cluster with nodepools that have Linux nodepools not using Azure Linux\nresources\n| where type == \"microsoft.containerservice/managedclusters\"\n| mv-expand agentPoolProfile = properties.agentPoolProfiles\n| where agentPoolProfile.osType == 'Linux' and agentPoolProfile.osSKU != 'AzureLinux'\n| project recommendationid=\"f46b0d1d-56ef-4795-b98a-f6ee00cb341a\", name, id, param1=strcat(\"nodePoolName: \", agentPoolProfile.name)\n"
        },
        {
            "description": "Deploying at least two replicas of your application ensures that your application is highly available and can tolerate node failures.\n",
            "aprlGuid": "9200aca6-0e83-4749-a5eb-e3939367bdc2",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ContainerService/managedClusters",
            "recommendationMetadataState": "Active",
            "longDescription": "Deploying at least two replicas of your application ensures that your application is highly available and can tolerate node failures.\n",
            "potentialBenefits": "Ensures high app availability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Multi-replica apps",
                    "url": "https://learn.microsoft.com/azure/aks/best-practices-app-cluster-reliability#multi-replica-applications"
                }
            ],
            "service": "Microsoft.ContainerService/managedClusters",
            "text": "Deploy at least two replicas of your application",
            "severity": "High",
            "category": "High Availability",
            "guid": "9200aca6-0e83-4749-a5eb-e3939367bdc2",
            "source": "azure-resources/ContainerService/managedClusters/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Enable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery.\n",
            "aprlGuid": "88856605-53d8-4bbd-a75b-4a7b14939d32",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DBforMySQL/flexibleServers",
            "recommendationMetadataState": "Active",
            "longDescription": "Enable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery.\n",
            "potentialBenefits": "Enhanced uptime and data protection",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "High availability concepts in Azure Database for MySQL - Flexible Server",
                    "url": "https://learn.microsoft.com/azure/mysql/flexible-server/concepts-high-availability"
                }
            ],
            "service": "Microsoft.DBforMySQL/flexibleServers",
            "text": "Enable HA with zone redundancy",
            "severity": "High",
            "category": "High Availability",
            "guid": "88856605-53d8-4bbd-a75b-4a7b14939d32",
            "source": "azure-resources/DBforMySQL/flexibleServers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Database for MySQL instances that are not zone redundant\nresources\n| where type == \"microsoft.dbformysql/flexibleservers\"\n| where properties.highAvailability.mode != \"ZoneRedundant\"\n| project recommendationId = \"88856605-53d8-4bbd-a75b-4a7b14939d32\", name, id, tags, param1 = \"ZoneRedundant: False\"\n"
        },
        {
            "description": "Use custom maintenance schedule on flexible server instances to select a preferred time for service updates to be applied.\n",
            "aprlGuid": "82a9a0f2-24ee-496f-9ad2-25f81710942d",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DBforMySQL/flexibleServers",
            "recommendationMetadataState": "Active",
            "longDescription": "Use custom maintenance schedule on flexible server instances to select a preferred time for service updates to be applied.\n",
            "potentialBenefits": "Control update timings",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Scheduled maintenance in Azure Database for MySQL - Flexible Server",
                    "url": "https://learn.microsoft.com/azure/mysql/flexible-server/concepts-maintenance"
                }
            ],
            "service": "Microsoft.DBforMySQL/flexibleServers",
            "text": "Enable custom maintenance schedule",
            "severity": "High",
            "category": "Scalability",
            "guid": "82a9a0f2-24ee-496f-9ad2-25f81710942d",
            "source": "azure-resources/DBforMySQL/flexibleServers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Database for MySQL instances that do not have a custom maintenance window\nresources\n| where type =~ \"microsoft.dbformysql/flexibleservers\"\n| where properties.maintenanceWindow.customWindow != \"Enabled\"\n| project recommendationId = \"82a9a0f2-24ee-496f-9ad2-25f81710942d\", name, id, tags, param1 = strcat(\"customWindow:\", properties['maintenanceWindow']['customWindow'])\n"
        },
        {
            "description": "Configure GRS to ensure that your database meets its availability and durability targets even in the face of failures or disasters.\n",
            "aprlGuid": "5c96afc3-7d2e-46ff-a4c7-9c32850c441b",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DBforMySQL/flexibleServers",
            "recommendationMetadataState": "Active",
            "longDescription": "Configure GRS to ensure that your database meets its availability and durability targets even in the face of failures or disasters.\n",
            "potentialBenefits": "Recover from regional failure and/or disaster",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Backup and restore in Azure Database for MySQL - Flexible Server",
                    "url": "https://learn.microsoft.com/en-us/azure/mysql/flexible-server/concepts-backup-restore"
                }
            ],
            "service": "Microsoft.DBforMySQL/flexibleServers",
            "text": "Configure geo redundant backup storage",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "5c96afc3-7d2e-46ff-a4c7-9c32850c441b",
            "source": "azure-resources/DBforMySQL/flexibleServers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Database for MySQL instances that do not have geo redundant backup storage enabled\nresources\n| where type =~ \"microsoft.dbformysql/flexibleservers\"\n| where properties.backup.geoRedundantBackup != \"Enabled\"\n| project recommendationId = \"5c96afc3-7d2e-46ff-a4c7-9c32850c441b\", name, id, tags, param1 = strcat(\"geoRedundantBackup:\", properties['backup']['geoRedundantBackup'])\n"
        },
        {
            "description": "Configure one or more read replicas to ensure that your database meets its availability and durability targets even in the face of failures or disasters.\n",
            "aprlGuid": "b49a8653-cc43-48c9-8513-a2d2e3f14dd1",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DBforMySQL/flexibleServers",
            "recommendationMetadataState": "Active",
            "longDescription": "Configure one or more read replicas to ensure that your database meets its availability and durability targets even in the face of failures or disasters.\n",
            "potentialBenefits": "Recover from regional failure and/or disaster",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Read replicas in Azure Database for MySQL - Flexible Server",
                    "url": "https://learn.microsoft.com/en-us/azure/mysql/flexible-server/concepts-read-replicas"
                }
            ],
            "service": "Microsoft.DBforMySQL/flexibleServers",
            "text": "Configure one or more read replicas",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "b49a8653-cc43-48c9-8513-a2d2e3f14dd1",
            "source": "azure-resources/DBforMySQL/flexibleServers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Database for MySQL instances that do not have a read replica configured\nresources\n| where type =~ \"microsoft.dbformysql/flexibleservers\"\n| where properties.replicationRole == \"None\"\n| project recommendationId = \"b49a8653-cc43-48c9-8513-a2d2e3f14dd1\", name, id, tags, param1 = strcat(\"replicationRole:\", properties['replicationRole'])\n"
        },
        {
            "description": "Configure storage auto-grow to prevent the server from running out of storage and becoming read-only.\n",
            "aprlGuid": "8176a79d-8645-4e52-96be-a10fc0204fe5",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DBforMySQL/flexibleServers",
            "recommendationMetadataState": "Active",
            "longDescription": "Configure storage auto-grow to prevent the server from running out of storage and becoming read-only.\n",
            "potentialBenefits": "Scale storage automatically to meet increasing demand",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Database for MySQL - Flexible Server service tiers - Storage auto grow",
                    "url": "https://learn.microsoft.com/en-us/azure/mysql/flexible-server/concepts-service-tiers-storage#storage-auto-grow"
                }
            ],
            "service": "Microsoft.DBforMySQL/flexibleServers",
            "text": "Configure storage auto-grow",
            "severity": "High",
            "category": "Scalability",
            "guid": "8176a79d-8645-4e52-96be-a10fc0204fe5",
            "source": "azure-resources/DBforMySQL/flexibleServers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Database for MySQL instances that do not have a storage auto-grow\nresources\n| where type =~ \"microsoft.dbformysql/flexibleservers\"\n| where properties.storage.autoGrow != \"Enabled\"\n| project recommendationId = \"8176a79d-8645-4e52-96be-a10fc0204fe5\", name, id, tags, param1 = strcat(\"autoGrow:\", properties['storage']['autoGrow'])\n"
        },
        {
            "description": "Enable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery.\n",
            "aprlGuid": "ca87914f-aac4-4783-ab67-82a6f936f194",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DBforPostgreSQL/flexibleServers",
            "recommendationMetadataState": "Active",
            "longDescription": "Enable HA with zone redundancy on flexible server instances to deploy a standby replica in a different zone, offering automatic failover capability for improved reliability and disaster recovery.\n",
            "potentialBenefits": "Enhanced uptime and data protection",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Overview of high availability with Azure Database for PostgreSQL",
                    "url": "https://learn.microsoft.com/azure/postgresql/flexible-server/concepts-high-availability"
                }
            ],
            "service": "Microsoft.DBforPostgreSQL/flexibleServers",
            "text": "Enable HA with zone redundancy",
            "severity": "High",
            "category": "High Availability",
            "guid": "ca87914f-aac4-4783-ab67-82a6f936f194",
            "source": "azure-resources/DBforPostgreSQL/flexibleServers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Database for PostgreSQL instances that are not zone redundant\nresources\n| where type == \"microsoft.dbforpostgresql/flexibleservers\"\n| where properties.highAvailability.mode != \"ZoneRedundant\"\n| project recommendationId = \"ca87914f-aac4-4783-ab67-82a6f936f194\", name, id, tags, param1 = \"ZoneRedundant: False\"\n"
        },
        {
            "description": "Use custom maintenance schedule on flexible server instances to select a preferred time for service updates to be applied.\n",
            "aprlGuid": "b2bad57d-7e03-4c0f-9024-597c9eb295bb",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DBforPostgreSQL/flexibleServers",
            "recommendationMetadataState": "Active",
            "longDescription": "Use custom maintenance schedule on flexible server instances to select a preferred time for service updates to be applied.\n",
            "potentialBenefits": "Control update timings",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Scheduled maintenance in Azure Database for PostgreSQL - Flexible Server",
                    "url": "https://learn.microsoft.com/azure/postgresql/flexible-server/concepts-maintenance"
                }
            ],
            "service": "Microsoft.DBforPostgreSQL/flexibleServers",
            "text": "Enable custom maintenance schedule",
            "severity": "High",
            "category": "Scalability",
            "guid": "b2bad57d-7e03-4c0f-9024-597c9eb295bb",
            "source": "azure-resources/DBforPostgreSQL/flexibleServers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Database for PostgreSQL instances that do not have a custom maintenance window\nresources\n| where type == \"microsoft.dbforpostgresql/flexibleservers\"\n| where properties.maintenanceWindow.customWindow != \"Enabled\"\n| project recommendationId = \"b2bad57d-7e03-4c0f-9024-597c9eb295bb\", name, id, tags, param1 = strcat(\"customWindow:\", properties['maintenanceWindow']['customWindow'])\n"
        },
        {
            "description": "Configure GRS to ensure that your database meets its availability and durability targets even in the face of failures or disasters.\n",
            "aprlGuid": "31f4ac4b-29cb-4588-8de2-d8fe6f13ceb3",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DBforPostgreSQL/flexibleServers",
            "recommendationMetadataState": "Active",
            "longDescription": "Configure GRS to ensure that your database meets its availability and durability targets even in the face of failures or disasters.\n",
            "potentialBenefits": "Recover from regional failure and/or disaster",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Backup and restore in Azure Database for PostgreSQL - Flexible Server",
                    "url": "https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-backup-restore"
                }
            ],
            "service": "Microsoft.DBforPostgreSQL/flexibleServers",
            "text": "Configure geo redundant backup storage",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "31f4ac4b-29cb-4588-8de2-d8fe6f13ceb3",
            "source": "azure-resources/DBforPostgreSQL/flexibleServers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Database for PostgreSQL instances that do not have geo redundant backup storage configured\nresources\n| where type == \"microsoft.dbforpostgresql/flexibleservers\"\n| where properties.backup.geoRedundantBackup != \"Enabled\"\n| project recommendationId = \"31f4ac4b-29cb-4588-8de2-d8fe6f13ceb3\", name, id, tags, param1 = strcat(\"geoRedundantBackup:\", properties['backup']['geoRedundantBackup'])\n"
        },
        {
            "description": "Configure one or more read replicas to ensure that your database meets its availability and durability targets even in the face of failures or disasters.\n",
            "aprlGuid": "2ab85a67-26be-4ed2-a0bb-101b2513ec63",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DBforPostgreSQL/flexibleServers",
            "recommendationMetadataState": "Active",
            "longDescription": "Configure one or more read replicas to ensure that your database meets its availability and durability targets even in the face of failures or disasters.\n",
            "potentialBenefits": "Recover from regional failure and/or disaster",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Read replicas in Azure Database for PostgreSQL - Flexible Server",
                    "url": "https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-read-replicas"
                }
            ],
            "service": "Microsoft.DBforPostgreSQL/flexibleServers",
            "text": "Configure one or more read replicas",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "2ab85a67-26be-4ed2-a0bb-101b2513ec63",
            "source": "azure-resources/DBforPostgreSQL/flexibleServers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Database for PostgreSQL instances that are read replicas\nresources\n| where type == \"microsoft.dbforpostgresql/flexibleservers\"\n| where properties.replicationRole == \"AsyncReplica\"\n| project recommendationId = \"2ab85a67-26be-4ed2-a0bb-101b2513ec63\", name, id, tags, param1 = strcat(\"replicationRole:\", properties['replicationRole'])\n"
        },
        {
            "description": "Configure storage auto-grow to prevent the server from running out of storage and becoming read-only.\n",
            "aprlGuid": "6293a3cc-6b4a-4c0f-9ea7-b8ae8d7dd3d5",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DBforPostgreSQL/flexibleServers",
            "recommendationMetadataState": "Active",
            "longDescription": "Configure storage auto-grow to prevent the server from running out of storage and becoming read-only.\n",
            "potentialBenefits": "Scale storage automatically to meet increasing demand",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Storage autogrow using Azure portal in Azure Database for PostgreSQL - Flexible Server",
                    "url": "https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/how-to-auto-grow-storage-portal"
                }
            ],
            "service": "Microsoft.DBforPostgreSQL/flexibleServers",
            "text": "Configure storage auto-grow",
            "severity": "High",
            "category": "Scalability",
            "guid": "6293a3cc-6b4a-4c0f-9ea7-b8ae8d7dd3d5",
            "source": "azure-resources/DBforPostgreSQL/flexibleServers/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Databricks recommends migrating workloads to the latest or LTS version of its runtime for enhanced stability and support. If on Runtime 11.3 LTS or above, move directly to the latest 12.x version. If below, first migrate to 11.3 LTS, then to the latest 12.x version as per the migration guide.\n",
            "aprlGuid": "0e835cc2-2551-a247-b1f1-3c5f25c9cb70",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Databricks recommends migrating workloads to the latest or LTS version of its runtime for enhanced stability and support. If on Runtime 11.3 LTS or above, move directly to the latest 12.x version. If below, first migrate to 11.3 LTS, then to the latest 12.x version as per the migration guide.\n",
            "potentialBenefits": "Enhanced stability and support",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Databricks runtime support lifecycles",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/release-notes/runtime/databricks-runtime-ver"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Databricks runtime version is not latest or is not LTS version",
            "severity": "Medium",
            "category": "Governance",
            "guid": "0e835cc2-2551-a247-b1f1-3c5f25c9cb70",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Databricks pools pre-provision VMs, reducing risks of provisioning errors during cluster start or scale, enhancing reliability.\n",
            "aprlGuid": "c166602e-0804-e34b-be8f-09b4d56e1fcd",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Databricks pools pre-provision VMs, reducing risks of provisioning errors during cluster start or scale, enhancing reliability.\n",
            "potentialBenefits": "Reduces provisioning errors",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Use Databricks Pools",
            "severity": "High",
            "category": "Scalability",
            "guid": "c166602e-0804-e34b-be8f-09b4d56e1fcd",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Upgrade HDDs in premium VMs to SSDs for better speed and reliability. Premium SSDs boost IO-heavy apps; Standard SSDs balance cost and performance. Ideal for critical workloads, upgrading improves connectivity with brief reboot. Consider for vital VMs\n",
            "aprlGuid": "5877a510-8444-7a4c-8412-a8dab8662f7e",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Upgrade HDDs in premium VMs to SSDs for better speed and reliability. Premium SSDs boost IO-heavy apps; Standard SSDs balance cost and performance. Ideal for critical workloads, upgrading improves connectivity with brief reboot. Consider for vital VMs\n",
            "potentialBenefits": "Faster, reliable VM performance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure managed disk types",
                    "url": "https://learn.microsoft.com/azure/virtual-machines/disks-types#premium-ssd"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Use SSD backed VMs for Worker VM Type and Driver type",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "5877a510-8444-7a4c-8412-a8dab8662f7e",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Autoscaling adjusts cluster sizes automatically based on workload demands, offering benefits for many use cases in terms of costs and performance. It includes guidance on when and how to best utilize Autoscaling. For streaming, Delta Live Tables with autoscaling is advised.\n",
            "aprlGuid": "5c72f0d6-55ec-d941-be84-36c194fa78c0",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Autoscaling adjusts cluster sizes automatically based on workload demands, offering benefits for many use cases in terms of costs and performance. It includes guidance on when and how to best utilize Autoscaling. For streaming, Delta Live Tables with autoscaling is advised.\n",
            "potentialBenefits": "Cost and performance optimization",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices#enable-autoscaling-for-batch-workloadss"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Enable autoscaling for batch workloads",
            "severity": "High",
            "category": "Scalability",
            "guid": "5c72f0d6-55ec-d941-be84-36c194fa78c0",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "The scaling parameter of a SQL warehouse defines the min and max number of clusters for distributing queries. By default, it's set to one. Increasing the cluster count can accommodate more concurrent users effectively.\n",
            "aprlGuid": "362ad2b6-b92c-414f-980a-0cf69467ccce",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "The scaling parameter of a SQL warehouse defines the min and max number of clusters for distributing queries. By default, it's set to one. Increasing the cluster count can accommodate more concurrent users effectively.\n",
            "potentialBenefits": "Improves concurrency and efficiency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices#enable-autoscaling-for-sql-warehouse"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Enable autoscaling for SQL warehouse",
            "severity": "High",
            "category": "Scalability",
            "guid": "362ad2b6-b92c-414f-980a-0cf69467ccce",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Databricks enhanced autoscaling optimizes cluster utilization by automatically allocating cluster resources based on workload volume, with minimal impact on the data processing latency of your pipelines.\n",
            "aprlGuid": "cd77db98-9b13-6e4b-bd2b-74c2cb538628",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Databricks enhanced autoscaling optimizes cluster utilization by automatically allocating cluster resources based on workload volume, with minimal impact on the data processing latency of your pipelines.\n",
            "potentialBenefits": "Optimized resource use and minimal latency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/azure/databricks/lakehouse-architecture/reliability/best-practices"
                },
                {
                    "name": "Databricks enhanced autoscaling",
                    "url": "https://learn.microsoft.com/azure/databricks/delta-live-tables/settings#use-autoscaling-to-increase-efficiency-and-reduce-resource-usage"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Use Delta Live Tables enhanced autoscaling",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "cd77db98-9b13-6e4b-bd2b-74c2cb538628",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "To conserve cluster resources, you can terminate a cluster to store its configuration for future reuse or autostart jobs. Clusters can auto-terminate after inactivity, but this only tracks Spark jobs, not local processes, which might still be running even after Spark jobs end.\n",
            "aprlGuid": "3d3e53b5-ebd1-db42-b43b-d4fad74824ec",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "To conserve cluster resources, you can terminate a cluster to store its configuration for future reuse or autostart jobs. Clusters can auto-terminate after inactivity, but this only tracks Spark jobs, not local processes, which might still be running even after Spark jobs end.\n",
            "potentialBenefits": "Saves cluster resources, avoids idle use",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability?",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Automatic Job Termination is enabled, ensure there are no user-defined local processes",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "3d3e53b5-ebd1-db42-b43b-d4fad74824ec",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "When creating a Databricks cluster, you can set a log delivery location for the Spark driver, worker nodes, and events. Logs are delivered every 5 mins and archived hourly. Upon cluster termination, all generated logs until that point are guaranteed to be delivered.\n",
            "aprlGuid": "7fb90127-5364-bb4d-86fa-30778ed713fb",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "When creating a Databricks cluster, you can set a log delivery location for the Spark driver, worker nodes, and events. Logs are delivered every 5 mins and archived hourly. Upon cluster termination, all generated logs until that point are guaranteed to be delivered.\n",
            "potentialBenefits": "Improved troubleshooting and audit",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Create a cluster",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/clusters/configure#cluster-log-delivery"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Enable Logging-Cluster log delivery",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "7fb90127-5364-bb4d-86fa-30778ed713fb",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Delta Lake is an open source storage format enhancing data lakes' reliability with ACID transactions, schema enforcement, and scalable metadata handling.\n",
            "aprlGuid": "da4ea916-4df3-8c4d-8060-17b49da45977",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Delta Lake is an open source storage format enhancing data lakes' reliability with ACID transactions, schema enforcement, and scalable metadata handling.\n",
            "potentialBenefits": "Enhances data reliability and processing",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Use Delta Lake for higher reliability",
            "severity": "High",
            "category": "High Availability",
            "guid": "da4ea916-4df3-8c4d-8060-17b49da45977",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Apache Spark in Databricks Lakehouse ensures resilient distributed data processing by automatically rescheduling failed tasks, aiding in overcoming external issues like network problems or revoked VMs.\n",
            "aprlGuid": "892ca809-e2b5-9a47-924a-71132bf6f902",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Apache Spark in Databricks Lakehouse ensures resilient distributed data processing by automatically rescheduling failed tasks, aiding in overcoming external issues like network problems or revoked VMs.\n",
            "potentialBenefits": "Boosts speed and reliability for Spark tasks",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices#use-apache-spark-or-photon-for-distributed-compute"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Use Photon Acceleration",
            "severity": "Low",
            "category": "High Availability",
            "guid": "892ca809-e2b5-9a47-924a-71132bf6f902",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Invalid or nonconforming data can crash workloads dependent on specific data formats. Best practices recommend filtering such data at ingestion to improve end-to-end resilience, ensuring no data is lost or missed.\n",
            "aprlGuid": "7e52d64d-8cc0-8548-a593-eb49ab45630d",
            "recommendationTypeId": null,
            "recommendationControl": "Business Continuity",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Invalid or nonconforming data can crash workloads dependent on specific data formats. Best practices recommend filtering such data at ingestion to improve end-to-end resilience, ensuring no data is lost or missed.\n",
            "potentialBenefits": "Enhanced data resilience and integrity",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Automatically rescue invalid or nonconforming data with Databricks Auto Loader or Delta Live Tables",
            "severity": "Low",
            "category": "Business Continuity",
            "guid": "7e52d64d-8cc0-8548-a593-eb49ab45630d",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Use Databricks and MLflow for deploying models as Spark UDFs for job scheduling, retries, autoscaling. Model serving offers scalable infrastructure, processes models using MLflow, and serves them via REST API using serverless compute managed in Databricks cloud.\n",
            "aprlGuid": "84e44da6-8cd7-b349-b02c-c8bf72cf587c",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Databricks and MLflow for deploying models as Spark UDFs for job scheduling, retries, autoscaling. Model serving offers scalable infrastructure, processes models using MLflow, and serves them via REST API using serverless compute managed in Databricks cloud.\n",
            "potentialBenefits": "Enhanced reliability and autoscaling",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Configure jobs for automatic retries and termination",
            "severity": "High",
            "category": "High Availability",
            "guid": "84e44da6-8cd7-b349-b02c-c8bf72cf587c",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Use Databricks and MLflow for deploying models as Apache Spark UDFs, benefiting from job scheduling, retries, autoscaling, etc.\n",
            "aprlGuid": "4cbb7744-ff3d-0447-badb-baf068c95696",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Databricks and MLflow for deploying models as Apache Spark UDFs, benefiting from job scheduling, retries, autoscaling, etc.\n",
            "potentialBenefits": "Enhances scalability and reliability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Use a scalable and production-grade model serving infrastructure",
            "severity": "High",
            "category": "Scalability",
            "guid": "4cbb7744-ff3d-0447-badb-baf068c95696",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Curate data by creating a layered architecture to increase data quality across layers. Start with a raw layer for ingested source data, continue with a curated layer for cleansed and refined data, and finish with a final layer catered to business needs, focusing on security and performance.\n",
            "aprlGuid": "1b0d0893-bf0e-8f4c-9dc6-f18f145c1ecf",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Curate data by creating a layered architecture to increase data quality across layers. Start with a raw layer for ingested source data, continue with a curated layer for cleansed and refined data, and finish with a final layer catered to business needs, focusing on security and performance.\n",
            "potentialBenefits": "Enhances data quality and trust",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Use a layered storage architecture",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "1b0d0893-bf0e-8f4c-9dc6-f18f145c1ecf",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Copying data leads to redundancy, lost integrity, lineage, and access issues, affecting lakehouse data quality. Temporary copies are useful for agility and innovation but can become problematic operational data silos, questioning data's master status and currency.\n",
            "aprlGuid": "e93fe702-e385-d741-ba37-1f1656482ecd",
            "recommendationTypeId": null,
            "recommendationControl": "Business Continuity",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Copying data leads to redundancy, lost integrity, lineage, and access issues, affecting lakehouse data quality. Temporary copies are useful for agility and innovation but can become problematic operational data silos, questioning data's master status and currency.\n",
            "potentialBenefits": "Enhanced data integrity and quality",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Improve data integrity by reducing data redundancy",
            "severity": "Low",
            "category": "Business Continuity",
            "guid": "e93fe702-e385-d741-ba37-1f1656482ecd",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Uncontrolled schema changes can lead to invalid data and failing jobs. Databricks validates and enforces schema through Delta Lake, which prevents bad records during ingestion, and Auto Loader, which detects new columns and supports schema evolution to maintain data integrity.\n",
            "aprlGuid": "b7e1d13f-54c9-1648-8a52-34c0abe8ce16",
            "recommendationTypeId": null,
            "recommendationControl": "Other Best Practices",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Uncontrolled schema changes can lead to invalid data and failing jobs. Databricks validates and enforces schema through Delta Lake, which prevents bad records during ingestion, and Auto Loader, which detects new columns and supports schema evolution to maintain data integrity.\n",
            "potentialBenefits": "Prevents invalid data and job failures",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Actively manage schemas",
            "severity": "Medium",
            "category": "Other Best Practices",
            "guid": "b7e1d13f-54c9-1648-8a52-34c0abe8ce16",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Delta tables verify data quality automatically with SQL constraints, triggering an error for violations. Delta Live Tables enhance this by defining expectations for data quality, utilizing Python or SQL, to manage actions for record failures, ensuring data integrity and compliance.\n",
            "aprlGuid": "a42297c4-7e4f-8b41-8d4b-114033263f0e",
            "recommendationTypeId": null,
            "recommendationControl": "Business Continuity",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Delta tables verify data quality automatically with SQL constraints, triggering an error for violations. Delta Live Tables enhance this by defining expectations for data quality, utilizing Python or SQL, to manage actions for record failures, ensuring data integrity and compliance.\n",
            "potentialBenefits": "Ensures data quality and integrity",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices#use-constraints-and-data-expectations"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Use constraints and data expectations",
            "severity": "Low",
            "category": "Business Continuity",
            "guid": "a42297c4-7e4f-8b41-8d4b-114033263f0e",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "To recover from a failure, regular backups are needed. The Databricks Labs project migrate lets admins create backups by exporting workspace assets using the Databricks CLI/API. These backups help in restoring or migrating workspaces.\n",
            "aprlGuid": "932d45d6-b46d-e341-abfb-d97bce832f1f",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "To recover from a failure, regular backups are needed. The Databricks Labs project migrate lets admins create backups by exporting workspace assets using the Databricks CLI/API. These backups help in restoring or migrating workspaces.\n",
            "potentialBenefits": "Ensures data recovery and migration",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices#create-regular-backups"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Create regular backups",
            "severity": "Low",
            "category": "Disaster Recovery",
            "guid": "932d45d6-b46d-e341-abfb-d97bce832f1f",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Structured Streaming ensures fault-tolerance and data consistency in streaming queries. With Azure Databricks workflows, you can set up your queries to automatically restart after failure, picking up precisely where they left off.\n",
            "aprlGuid": "12e9d852-5cdc-2743-bffe-ee21f2ef7781",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Structured Streaming ensures fault-tolerance and data consistency in streaming queries. With Azure Databricks workflows, you can set up your queries to automatically restart after failure, picking up precisely where they left off.\n",
            "potentialBenefits": "Fault-tolerance and auto-restart for queries",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices#recover-from-structured-streaming-query-failures"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Recover from Structured Streaming query failures",
            "severity": "High",
            "category": "High Availability",
            "guid": "12e9d852-5cdc-2743-bffe-ee21f2ef7781",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Despite thorough testing, a production job can fail or yield unexpected data. Sometimes, repairs are done by adding jobs post-issue identification and pipeline correction.\n",
            "aprlGuid": "a18d60f8-c98c-ba4e-ad6e-2fac72879df1",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Despite thorough testing, a production job can fail or yield unexpected data. Sometimes, repairs are done by adding jobs post-issue identification and pipeline correction.\n",
            "potentialBenefits": "Easy rollback and fix for ETL jobs",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices#recover-etl-jobs-based-on-delta-time-travel"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Recover ETL jobs based on Delta time travel",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "a18d60f8-c98c-ba4e-ad6e-2fac72879df1",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Databricks Workflows enable efficient error recovery in multi-task jobs by offering a matrix view for issue examination. Fixes can be applied to initiate repair runs targeting only failed and dependent tasks, preserving successful outcomes and thereby saving time and money.\n",
            "aprlGuid": "c0e22580-3819-444d-8546-a80e4ed85c83",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Databricks Workflows enable efficient error recovery in multi-task jobs by offering a matrix view for issue examination. Fixes can be applied to initiate repair runs targeting only failed and dependent tasks, preserving successful outcomes and thereby saving time and money.\n",
            "potentialBenefits": "Saves time and money with smart recovery",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/reliability/best-practices"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Use Databricks Workflows and built-in recovery",
            "severity": "Low",
            "category": "Disaster Recovery",
            "guid": "c0e22580-3819-444d-8546-a80e4ed85c83",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Implementing a disaster recovery pattern is vital for Azure Databricks, ensuring data teams' access even during rare regional outages.\n\nIt is important to note that the Azure Databricks service is not entirely zone redudant and does support zonal failover.\n",
            "aprlGuid": "4fdb7112-4531-6f48-b60e-c917a6068d9b",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Implementing a disaster recovery pattern is vital for Azure Databricks, ensuring data teams' access even during rare regional outages.\n\nIt is important to note that the Azure Databricks service is not entirely zone redudant and does support zonal failover.\n",
            "potentialBenefits": "Ensures service continuity during disasters",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Databricks Best Practices",
                    "url": "https://github.com/Azure/AzureDatabricksBestPractices/tree/master"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Configure a disaster recovery pattern",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "4fdb7112-4531-6f48-b60e-c917a6068d9b",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "The Databricks Terraform provider manages Azure Databricks workspaces and cloud infrastructure flexibly and powerfully.\n",
            "aprlGuid": "42aedaa8-6151-424d-b782-b8666c779969",
            "recommendationTypeId": null,
            "recommendationControl": "Other Best Practices",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "The Databricks Terraform provider manages Azure Databricks workspaces and cloud infrastructure flexibly and powerfully.\n",
            "potentialBenefits": "Efficient, reliable automation",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for operational excellence",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/operational-excellence/best-practices#2-automate-deployments-and-workloads"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Automate deployments and workloads",
            "severity": "High",
            "category": "Other Best Practices",
            "guid": "42aedaa8-6151-424d-b782-b8666c779969",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "The Databricks Terraform provider is a flexible, powerful tool for managing Azure Databricks workspaces and cloud infrastructure.\n",
            "aprlGuid": "20193ff9-dbcd-a74e-b197-71d7d9d3c1e6",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "The Databricks Terraform provider is a flexible, powerful tool for managing Azure Databricks workspaces and cloud infrastructure.\n",
            "potentialBenefits": "Enhanced reliability and automation",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Best practices for operational excellence",
                    "url": "https://learn.microsoft.com/en-us/azure/databricks/lakehouse-architecture/operational-excellence/best-practices#system-monitoring"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Set up monitoring, alerting, and logging",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "20193ff9-dbcd-a74e-b197-71d7d9d3c1e6",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Customers often naturally divide workspaces by teams or departments. However, it's crucial to also consider Azure Subscription and ADB Workspace limits when partitioning.\n",
            "aprlGuid": "397cdebb-9d6e-ab4f-83a1-8c481de0a3a7",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Customers often naturally divide workspaces by teams or departments. However, it's crucial to also consider Azure Subscription and ADB Workspace limits when partitioning.\n",
            "potentialBenefits": "Enhanced limits management, team separation",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Databricks Best Practices",
                    "url": "https://github.com/Azure/AzureDatabricksBestPractices/blob/master/toc.md#deploy-workspaces-in-multiple-subscriptions-to-honor-azure-capacity-limits"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Deploy workspaces in separate Subscriptions",
            "severity": "High",
            "category": "Scalability",
            "guid": "397cdebb-9d6e-ab4f-83a1-8c481de0a3a7",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Deploying only one Databricks Workspace per VNet aligns with ADB's isolation model.\n",
            "aprlGuid": "5e722c4f-415a-9b4c-bd4c-96b74dce29ad",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Deploying only one Databricks Workspace per VNet aligns with ADB's isolation model.\n",
            "potentialBenefits": "Enhanced security and resource isolation",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Databricks Best Practices",
                    "url": "https://github.com/Azure/AzureDatabricksBestPractices/blob/master/toc.md#consider-isolating-each-workspace-in-its-own-vnet"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Isolate each workspace in its own Vnet",
            "severity": "High",
            "category": "Scalability",
            "guid": "5e722c4f-415a-9b4c-bd4c-96b74dce29ad",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Driven by security and data availability concerns, each Azure Databricks Workspace comes with a default DBFS designed for system-level artifacts like libraries and Init scripts, not for production data.\n",
            "aprlGuid": "14310ba6-77ad-3641-a2db-57a2218b9bc7",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Driven by security and data availability concerns, each Azure Databricks Workspace comes with a default DBFS designed for system-level artifacts like libraries and Init scripts, not for production data.\n",
            "potentialBenefits": "Enhanced security, data protection",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Databricks Best Practices",
                    "url": "https://github.com/Azure/AzureDatabricksBestPractices/blob/master/toc.md#do-not-store-any-production-data-in-default-dbfs-foldersr"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Do not Store any Production Data in Default DBFS Folders",
            "severity": "High",
            "category": "High Availability",
            "guid": "14310ba6-77ad-3641-a2db-57a2218b9bc7",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Azure Spot VMs are not suitable for critical production workloads needing high availability and reliability. They are meant for fault-tolerant tasks and can be evicted with 30-seconds notice if Azure needs the capacity, with no SLA guarantees.\n",
            "aprlGuid": "b5af7e26-3939-1b48-8fba-f8d4a475c67a",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Spot VMs are not suitable for critical production workloads needing high availability and reliability. They are meant for fault-tolerant tasks and can be evicted with 30-seconds notice if Azure needs the capacity, with no SLA guarantees.\n",
            "potentialBenefits": "Ensures high reliability for production",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Use Azure Spot Virtual Machines",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machines/spot-vms"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Do not use Azure Spot VMs for critical Production workloads",
            "severity": "High",
            "category": "High Availability",
            "guid": "b5af7e26-3939-1b48-8fba-f8d4a475c67a",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Move workspaces to in-region control plane for increased regional isolation. Identify current control plane region using the workspace URL and nslookup. When region from CNAME differs from workspace region and an in-region control is available, consider migration using tools provided below.\n",
            "aprlGuid": "8aa63c34-dd9d-49bd-9582-21ec310dfbdd",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Move workspaces to in-region control plane for increased regional isolation. Identify current control plane region using the workspace URL and nslookup. When region from CNAME differs from workspace region and an in-region control is available, consider migration using tools provided below.\n",
            "potentialBenefits": "Improves resilience and data sovereignty",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Databricks control plane addresses",
                    "url": "https://learn.microsoft.com/azure/databricks/resources/supported-regions#--azure-databricks-control-plane-addresses"
                },
                {
                    "name": "Migrate - maintained by Databricks Inc.",
                    "url": "https://github.com/databrickslabs/migrate"
                },
                {
                    "name": "Databricks Terraform Exporter - maintained by Databricks Inc. (Experimental)",
                    "url": "https://registry.terraform.io/providers/databricks/databricks/latest/docs/guides/experimental-exporter"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Evaluate regional isolation for workspaces",
            "severity": "High",
            "category": "High Availability",
            "guid": "8aa63c34-dd9d-49bd-9582-21ec310dfbdd",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Azure Databricks planning should include VM SKU swap strategies for capacity issues. VMs are regional, and allocation failures may occur, shown by a \"CLOUD PROVIDER\" error.\n",
            "aprlGuid": "028593be-956e-4736-bccf-074cb10b92f4",
            "recommendationTypeId": null,
            "recommendationControl": "Personalized",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Databricks/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Databricks planning should include VM SKU swap strategies for capacity issues. VMs are regional, and allocation failures may occur, shown by a \"CLOUD PROVIDER\" error.\n",
            "potentialBenefits": "Ensures service availability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Compute configuration best practices",
                    "url": "https://learn.microsoft.com/azure/databricks/compute/cluster-config-best-practices"
                },
                {
                    "name": "GPU-enabled compute",
                    "url": "https://learn.microsoft.com/azure/databricks/compute/gpu"
                }
            ],
            "service": "Microsoft.Databricks/workspaces",
            "text": "Define alternate VM SKUs",
            "severity": "Medium",
            "category": "Personalized",
            "guid": "028593be-956e-4736-bccf-074cb10b92f4",
            "source": "azure-resources/Databricks/workspaces/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Create a Validation Pool for early issue detection with planned AVD updates. Adjust limits based on needs. Scale by adding multiple host pools for more users. Regularly test updates on host pools. Validate changes before applying to main environment to avoid downtime.\n",
            "aprlGuid": "013ac34e-7c4b-425f-9e0c-216f0cc06181",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.DesktopVirtualization/hostPools",
            "recommendationMetadataState": "Active",
            "longDescription": "Create a Validation Pool for early issue detection with planned AVD updates. Adjust limits based on needs. Scale by adding multiple host pools for more users. Regularly test updates on host pools. Validate changes before applying to main environment to avoid downtime.\n",
            "potentialBenefits": "Enhanced environment stability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/azure/virtual-desktop/configure-validation-environment?tabs=azure-portal"
                }
            ],
            "service": "Microsoft.DesktopVirtualization/hostPools",
            "text": "Create a validation host pool for testing of planned updates",
            "severity": "Medium",
            "category": "Governance",
            "guid": "013ac34e-7c4b-425f-9e0c-216f0cc06181",
            "source": "azure-resources/DesktopVirtualization/hostPools/recommendations.yaml",
            "graph": "// under-development\n"
        },
        {
            "description": "Create maintenance schedules for AVD agent updates to avoid disruptions. Use Scheduled Agent Updates to set maintenance windows for updating Azure Virtual Desktop agent, side-by-side stack, and Geneva Monitoring agent.\n",
            "aprlGuid": "979ff8be-5f3a-4d8e-9aa3-407ecdd6d6f7",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.DesktopVirtualization/hostPools",
            "recommendationMetadataState": "Active",
            "longDescription": "Create maintenance schedules for AVD agent updates to avoid disruptions. Use Scheduled Agent Updates to set maintenance windows for updating Azure Virtual Desktop agent, side-by-side stack, and Geneva Monitoring agent.\n",
            "potentialBenefits": "Enhanced environment stability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/azure/virtual-desktop/scheduled-agent-updates"
                }
            ],
            "service": "Microsoft.DesktopVirtualization/hostPools",
            "text": "Configure host pool scheduled agent updates",
            "severity": "Medium",
            "category": "Governance",
            "guid": "979ff8be-5f3a-4d8e-9aa3-407ecdd6d6f7",
            "source": "azure-resources/DesktopVirtualization/hostPools/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This resource graph query will return all AVD host pools that does not have scheduled agent updates configured\nresources\n| where type =~ \"Microsoft.DesktopVirtualization/hostpools\"\n| where isnull(properties.agentUpdate)\n| project recommendationId = \"979ff8be-5f3a-4d8e-9aa3-407ecdd6d6f7\", name, id, tags, param1 = 'No scheduled agent updates'\n"
        },
        {
            "description": "For optimized AVD configuration, place Hybrid VMs in unique OUs. Segregate Prod and DR units for environment-specific settings. This ensures targeted configurations for session hosts, including Fslogix, timeouts, and session controls.\n",
            "aprlGuid": "939cb85c-102a-4e0a-ab82-5c92116d3778",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.DesktopVirtualization/hostPools",
            "recommendationMetadataState": "Active",
            "longDescription": "For optimized AVD configuration, place Hybrid VMs in unique OUs. Segregate Prod and DR units for environment-specific settings. This ensures targeted configurations for session hosts, including Fslogix, timeouts, and session controls.\n",
            "potentialBenefits": "Improved AVD hostpool config & segmentation",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/deploy/virtual-dc/adds-on-azure-vm#configure-the-vms-and-install-active-directory-domain-services"
                }
            ],
            "service": "Microsoft.DesktopVirtualization/hostPools",
            "text": "Ensure a unique OU is used when deploying host pools with domain joined session hosts",
            "severity": "Medium",
            "category": "Governance",
            "guid": "939cb85c-102a-4e0a-ab82-5c92116d3778",
            "source": "azure-resources/DesktopVirtualization/hostPools/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Implement Azure Site Recovery (ASR) or Azure Backup for personal host pools to enable seamless failover and failback. This replicates VMs supporting personal desktops to a secondary Azure region, ensuring recovery from a known state in case of a disaster or outage.\n",
            "aprlGuid": "38721758-2cc2-4d6b-b7b7-8b47dadbf7df",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Compute/virtualMachines",
            "recommendationMetadataState": "Active",
            "longDescription": "Implement Azure Site Recovery (ASR) or Azure Backup for personal host pools to enable seamless failover and failback. This replicates VMs supporting personal desktops to a secondary Azure region, ensuring recovery from a known state in case of a disaster or outage.\n",
            "potentialBenefits": "Ensures VM recovery & failover",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/en-us/azure/site-recovery/site-recovery-overview"
                }
            ],
            "service": "Microsoft.Compute/virtualMachines",
            "text": "Use Azure Site Recovery or backups to protect VMs supporting personal desktops",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "38721758-2cc2-4d6b-b7b7-8b47dadbf7df",
            "source": "azure-resources/DesktopVirtualization/hostPools/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Each region has its own scaling plans assigned to host pools within that region. However, these plans can become inaccessible if there's a regional failure. To mitigate this risk, it's advisable to create a secondary scaling plan in another region.\n",
            "aprlGuid": "499769ae-67c9-492e-9ca5-cfd4cece5209",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.DesktopVirtualization/scalingPlans",
            "recommendationMetadataState": "Active",
            "longDescription": "Each region has its own scaling plans assigned to host pools within that region. However, these plans can become inaccessible if there's a regional failure. To mitigate this risk, it's advisable to create a secondary scaling plan in another region.\n",
            "potentialBenefits": "Enhanced scaling",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/azure/virtual-desktop/autoscale-scaling-plan?tabs=portal"
                }
            ],
            "service": "Microsoft.DesktopVirtualization/scalingPlans",
            "text": "Scaling plans should be created per region and not scaled across regions",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "499769ae-67c9-492e-9ca5-cfd4cece5209",
            "source": "azure-resources/DesktopVirtualization/scalingPlans/recommendations.yaml",
            "graph": "// under-development\n"
        },
        {
            "description": "Device Identities should be copied to the failover region IoT-Hub for all IoT devices to ensure connectivity in case of a failover. Manual Failover to another region is quicker (RTO), suitable for mission critical workloads.\n",
            "aprlGuid": "783c6c18-760b-4867-9ced-3010a0bc5aa3",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Devices/IotHubs",
            "recommendationMetadataState": "Active",
            "longDescription": "Device Identities should be copied to the failover region IoT-Hub for all IoT devices to ensure connectivity in case of a failover. Manual Failover to another region is quicker (RTO), suitable for mission critical workloads.\n",
            "potentialBenefits": "Faster failover; Ensures device connectivity",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Import and export IoT Hub device identities in bulk",
                    "url": "https://learn.microsoft.com/en-us/azure/iot-hub/iot-hub-bulk-identity-mgmt"
                },
                {
                    "name": "IoT Hub high availability and disaster recovery",
                    "url": "https://learn.microsoft.com/en-us/azure/iot-hub/iot-hub-ha-dr#manual-failover"
                }
            ],
            "service": "Microsoft.Devices/IotHubs",
            "text": "Device Identities are exported to a secondary region",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "783c6c18-760b-4867-9ced-3010a0bc5aa3",
            "source": "azure-resources/Devices/iotHubs/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "In a production scenario, the IoT Hub tier should not be Free because the Free tier does not provide the necessary Service Level Agreement.\n",
            "aprlGuid": "eeba3a49-fef0-481f-a471-7ff01139b474",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Devices/IotHubs",
            "recommendationMetadataState": "Active",
            "longDescription": "In a production scenario, the IoT Hub tier should not be Free because the Free tier does not provide the necessary Service Level Agreement.\n",
            "potentialBenefits": "Ensures SLA for production",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Choose the right IoT Hub tier and size for your solution",
                    "url": "https://learn.microsoft.com/en-us/azure/iot-hub/iot-hub-scaling"
                }
            ],
            "service": "Microsoft.Devices/IotHubs",
            "text": "Do not use free tier",
            "severity": "High",
            "category": "High Availability",
            "guid": "eeba3a49-fef0-481f-a471-7ff01139b474",
            "source": "azure-resources/Devices/iotHubs/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// list all IoT Hubs that are using the Free tier\nresources\n| where type =~ \"microsoft.devices/iothubs\" and\n    tostring(sku.tier) =~ 'Free'\n| project recommendationId=\"eeba3a49-fef0-481f-a471-7ff01139b474\", name, id, tags, param1=strcat(\"tier:\", tostring(sku.tier))\n\n"
        },
        {
            "description": "In regions supporting Availability Zones for IoT Hub, using these zones boosts availability. They're automatically activated for new IoT Hubs in supported areas.\n",
            "aprlGuid": "214cbc46-747e-4354-af6e-6bf0054196a5",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Devices/IotHubs",
            "recommendationMetadataState": "Active",
            "longDescription": "In regions supporting Availability Zones for IoT Hub, using these zones boosts availability. They're automatically activated for new IoT Hubs in supported areas.\n",
            "potentialBenefits": "Boosts IoT Hub availability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure IoT Hub high availability and disaster recovery",
                    "url": "https://learn.microsoft.com/en-us/azure/iot-hub/iot-hub-ha-dr#availability-zones"
                }
            ],
            "service": "Microsoft.Devices/IotHubs",
            "text": "Use Availability Zones",
            "severity": "High",
            "category": "High Availability",
            "guid": "214cbc46-747e-4354-af6e-6bf0054196a5",
            "source": "azure-resources/Devices/iotHubs/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Device Provisioning Service (DPS) enables easy redistribution of IoT devices for scaling and availability, allowing devices to be reassigned and not bound to specific IoT Hub instances. Devices in IoT Hubs using DPS should be verified for DPS utilization.\n",
            "aprlGuid": "b1e1378d-4572-4414-bebd-b8872a6d4d1c",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Devices/IotHubs",
            "recommendationMetadataState": "Active",
            "longDescription": "Device Provisioning Service (DPS) enables easy redistribution of IoT devices for scaling and availability, allowing devices to be reassigned and not bound to specific IoT Hub instances. Devices in IoT Hubs using DPS should be verified for DPS utilization.\n",
            "potentialBenefits": "Enhances scalability and availability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "IoT Hub Device Provisioning Service (DPS) terminology",
                    "url": "https://learn.microsoft.com/en-us/azure/iot-dps/concepts-service"
                },
                {
                    "name": "Best practices for large-scale IoT device deployments",
                    "url": "https://learn.microsoft.com/en-us/azure/iot-dps/concepts-deploy-at-scale"
                },
                {
                    "name": "IoT Hub Device Provisioning Service high availability and disaster recovery",
                    "url": "https://learn.microsoft.com/en-us/azure/iot-dps/iot-dps-ha-dr"
                }
            ],
            "service": "Microsoft.Devices/IotHubs",
            "text": "Use Device Provisioning Service",
            "severity": "High",
            "category": "Scalability",
            "guid": "b1e1378d-4572-4414-bebd-b8872a6d4d1c",
            "source": "azure-resources/Devices/iotHubs/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// list all IoT Hubs that do not have a linked IoT Hub Device Provisioning Service (DPS)\nresources\n| where type =~ \"microsoft.devices/iothubs\"\n| project id, iotHubName=tostring(properties.hostName), tags, resourceGroup\n| join kind=fullouter (\n    resources\n    | where type == \"microsoft.devices/provisioningservices\"\n    | mv-expand iotHubs=properties.iotHubs\n    | project iotHubName = tostring(iotHubs.name), dpsName = name, name=iotHubs.name\n) on iotHubName\n| where dpsName == ''\n| project recommendationId=\"b1e1378d-4572-4414-bebd-b8872a6d4d1c\", name=iotHubName, id, tags, param1='DPS:none'\n\n"
        },
        {
            "description": "In case of a regional failure, an IoT Hub can failover to a second region, automatically or manually, to ensure your application continues working.\n",
            "aprlGuid": "02568a5d-335e-4e51-9f7c-fe2ada977300",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Devices/IotHubs",
            "recommendationMetadataState": "Active",
            "longDescription": "In case of a regional failure, an IoT Hub can failover to a second region, automatically or manually, to ensure your application continues working.\n",
            "potentialBenefits": "Ensures business continuity",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "IoT Hub high availability and disaster recovery",
                    "url": "https://learn.microsoft.com/en-us/azure/iot-hub/iot-hub-ha-dr"
                }
            ],
            "service": "Microsoft.Devices/IotHubs",
            "text": "Define Failover Guidelines",
            "severity": "High",
            "category": "High Availability",
            "guid": "02568a5d-335e-4e51-9f7c-fe2ada977300",
            "source": "azure-resources/Devices/iotHubs/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Using message routing for custom endpoints in IoT Hub, messages might not reach these destinations if specific conditions are unmet. A default route ensures all messages are received, but disabling this safety net risks leaving some messages undelivered.\n",
            "aprlGuid": "e7dbd21f-b27a-4b8c-a901-cedb1e6d8e1e",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Devices/IotHubs",
            "recommendationMetadataState": "Active",
            "longDescription": "Using message routing for custom endpoints in IoT Hub, messages might not reach these destinations if specific conditions are unmet. A default route ensures all messages are received, but disabling this safety net risks leaving some messages undelivered.\n",
            "potentialBenefits": "Prevents undelivered messages",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Use message routing - Fallback route",
                    "url": "https://learn.microsoft.com/en-us/azure/iot-hub/iot-hub-devguide-messages-d2c#fallback-route"
                }
            ],
            "service": "Microsoft.Devices/IotHubs",
            "text": "Disabled Fallback Route",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "e7dbd21f-b27a-4b8c-a901-cedb1e6d8e1e",
            "source": "azure-resources/Devices/iotHubs/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// list all IoT Hubs that have the fallback route disabled\nresources\n| where type == \"microsoft.devices/iothubs\"\n| extend fallbackEnabled=properties.routing.fallbackRoute.isEnabled\n| where fallbackEnabled == false\n| project recommendationId=\"e7dbd21f-b27a-4b8c-a901-cedb1e6d8e1e\", name, id, tags, param1='FallbackRouteEnabled:false'\n\n"
        },
        {
            "description": "Enable a secondary region in Cosmos DB for higher SLA without downtime. Simple as pinning a location on a map. For Strong consistency, configure at least three regions for write availability in case of failure.\n",
            "aprlGuid": "43663217-a1d3-844b-80ea-571a2ce37c6c",
            "recommendationTypeId": "b57f7a29-dcc8-43de-86fa-18d3f9d3764d",
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DocumentDB/databaseAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Enable a secondary region in Cosmos DB for higher SLA without downtime. Simple as pinning a location on a map. For Strong consistency, configure at least three regions for write availability in case of failure.\n",
            "potentialBenefits": "Enhances SLA and resilience",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Distribute data globally with Azure Cosmos DB | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/cosmos-db/distribute-data-globally"
                },
                {
                    "name": "Tips for building highly available applications | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/cosmos-db/high-availability#tips-for-building-highly-available-applications"
                }
            ],
            "service": "Microsoft.DocumentDB/databaseAccounts",
            "text": "Configure at least two regions for high availability",
            "severity": "High",
            "category": "High Availability",
            "guid": "43663217-a1d3-844b-80ea-571a2ce37c6c",
            "source": "azure-resources/DocumentDB/databaseAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Query to find Azure Cosmos DB accounts that have less than 2 regions or less than 3 regions with strong consistency level\nResources\n| where type =~ 'Microsoft.DocumentDb/databaseAccounts'\n| where\n    array_length(properties.locations) < 2 or\n    (array_length(properties.locations) < 3 and properties.consistencyPolicy.defaultConsistencyLevel == 'Strong')\n| project recommendationId='43663217-a1d3-844b-80ea-571a2ce37c6c', name, id, tags\n\n"
        },
        {
            "description": "Cosmos DB boasts high uptime and resiliency. Even so, issues may arise. With Service-Managed failover, if a region is down, Cosmos DB automatically switches to the next available region, requiring no user action.\n",
            "aprlGuid": "9cabded7-a1fc-6e4a-944b-d7dd98ea31a2",
            "recommendationTypeId": "5de9f2e6-087e-40da-863a-34b7943beed4",
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DocumentDB/databaseAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Cosmos DB boasts high uptime and resiliency. Even so, issues may arise. With Service-Managed failover, if a region is down, Cosmos DB automatically switches to the next available region, requiring no user action.\n",
            "potentialBenefits": "Auto failover for high uptime",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Manage an Azure Cosmos DB account by using the Azure portal | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/cosmos-db/how-to-manage-database-account#automatic-failover"
                }
            ],
            "service": "Microsoft.DocumentDB/databaseAccounts",
            "text": "Enable service-managed failover for multi-region accounts with single write region",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "9cabded7-a1fc-6e4a-944b-d7dd98ea31a2",
            "source": "azure-resources/DocumentDB/databaseAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Query to list all Azure Cosmos DB accounts that do not have multiple write locations or automatic failover enabled\nResources\n| where type =~ 'Microsoft.DocumentDb/databaseAccounts'\n| where\n    array_length(properties.locations) > 1 and\n    tobool(properties.enableAutomaticFailover) == false and\n    tobool(properties.enableMultipleWriteLocations) == false\n| project recommendationId='9cabded7-a1fc-6e4a-944b-d7dd98ea31a2', name, id, tags\n"
        },
        {
            "description": "Multi-region write capability allows for designing applications that are highly available across multiple regions, though it demands careful attention to consistency requirements and conflict resolution. Improper setup may decrease availability and cause data corruption due to unhandled conflicts.\n",
            "aprlGuid": "9ce78192-74a0-104c-b5bb-9a443f941649",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DocumentDB/databaseAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Multi-region write capability allows for designing applications that are highly available across multiple regions, though it demands careful attention to consistency requirements and conflict resolution. Improper setup may decrease availability and cause data corruption due to unhandled conflicts.\n",
            "potentialBenefits": "Enhances high availability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Distribute data globally with Azure Cosmos DB | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/cosmos-db/distribute-data-globally"
                },
                {
                    "name": "Conflict resolution types and resolution policies in Azure Cosmos DB | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/cosmos-db/conflict-resolution-policies"
                }
            ],
            "service": "Microsoft.DocumentDB/databaseAccounts",
            "text": "Evaluate multi-region write capability",
            "severity": "High",
            "category": "High Availability",
            "guid": "9ce78192-74a0-104c-b5bb-9a443f941649",
            "source": "azure-resources/DocumentDB/databaseAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Query to find Azure Cosmos DB accounts that have multiple read locations but do not have multiple write locations enabled\nResources\n| where type =~ 'Microsoft.DocumentDb/databaseAccounts'\n| where\n    array_length(properties.locations) > 1 and\n    properties.enableMultipleWriteLocations == false\n| project recommendationId='9ce78192-74a0-104c-b5bb-9a443f941649', name, id, tags\n\n"
        },
        {
            "description": "Cosmos DB's backup is always on, offering protection against data mishaps. Continuous mode allows for self-serve restoration to a pre-mishap point, unlike periodic mode which requires contacting Microsoft support, leading to longer restore times.\n",
            "aprlGuid": "e544520b-8505-7841-9e77-1f1974ee86ec",
            "recommendationTypeId": "52fef986-5897-4359-8b92-0f22749f0d73",
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DocumentDB/databaseAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Cosmos DB's backup is always on, offering protection against data mishaps. Continuous mode allows for self-serve restoration to a pre-mishap point, unlike periodic mode which requires contacting Microsoft support, leading to longer restore times.\n",
            "potentialBenefits": "Faster self-serve data restore",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Continuous backup with point in time restore feature in Azure Cosmos DB | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/cosmos-db/continuous-backup-restore-introduction"
                }
            ],
            "service": "Microsoft.DocumentDB/databaseAccounts",
            "text": "Configure continuous backup mode",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "e544520b-8505-7841-9e77-1f1974ee86ec",
            "source": "azure-resources/DocumentDB/databaseAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Query all Azure Cosmos DB accounts that do not have continuous backup mode configured\nResources\n| where type =~ 'Microsoft.DocumentDb/databaseAccounts'\n| where\n    properties.backupPolicy.type == 'Periodic' and\n    properties.enableMultipleWriteLocations == false and\n    properties.enableAnalyticalStorage == false\n| project recommendationId='e544520b-8505-7841-9e77-1f1974ee86ec', name, id, tags\n"
        },
        {
            "description": "Cosmos DB has a 4 MB response limit, leading to paginated results for large or partition-spanning queries. Each page shows availability and provides a continuation token for the next. A while loop in code is necessary to traverse all pages until completion.\n",
            "aprlGuid": "c006604a-0d29-684c-99f0-9729cb40dac5",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.DocumentDB/databaseAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Cosmos DB has a 4 MB response limit, leading to paginated results for large or partition-spanning queries. Each page shows availability and provides a continuation token for the next. A while loop in code is necessary to traverse all pages until completion.\n",
            "potentialBenefits": "Maximizes data retrieval efficiency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Pagination in Azure Cosmos DB | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/cosmos-db/nosql/query/pagination#handling-multiple-pages-of-results"
                }
            ],
            "service": "Microsoft.DocumentDB/databaseAccounts",
            "text": "Ensure query results are fully drained",
            "severity": "High",
            "category": "Scalability",
            "guid": "c006604a-0d29-684c-99f0-9729cb40dac5",
            "source": "azure-resources/DocumentDB/databaseAccounts/recommendations.yaml",
            "graph": "// under-development\n"
        },
        {
            "description": "Using a single instance of the SDK client for each account and application is crucial as connections are tied to the client. Compute environments have a limit on open connections, affecting connectivity when exceeded.\n",
            "aprlGuid": "7eb32cf9-9a42-1540-acf8-597cbba8a418",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.DocumentDB/databaseAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Using a single instance of the SDK client for each account and application is crucial as connections are tied to the client. Compute environments have a limit on open connections, affecting connectivity when exceeded.\n",
            "potentialBenefits": "Optimizes connections and efficiency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Designing resilient applications with Azure Cosmos DB SDKs | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/cosmos-db/nosql/conceptual-resilient-sdk-applications"
                }
            ],
            "service": "Microsoft.DocumentDB/databaseAccounts",
            "text": "Maintain singleton pattern in your client",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "7eb32cf9-9a42-1540-acf8-597cbba8a418",
            "source": "azure-resources/DocumentDB/databaseAccounts/recommendations.yaml",
            "graph": "// under-development\n"
        },
        {
            "description": "Cosmos DB SDKs automatically manage many transient errors through retries. Despite this, it's crucial for applications to implement additional retry policies targeting specific cases that the SDKs can't generically address, ensuring more robust error handling.\n",
            "aprlGuid": "fa6ac22f-0584-bb4b-80e4-80f4755d1a97",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.DocumentDB/databaseAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Cosmos DB SDKs automatically manage many transient errors through retries. Despite this, it's crucial for applications to implement additional retry policies targeting specific cases that the SDKs can't generically address, ensuring more robust error handling.\n",
            "potentialBenefits": "Enhances error handling resilience",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Designing resilient applications with Azure Cosmos DB SDKs | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/cosmos-db/nosql/conceptual-resilient-sdk-applications"
                }
            ],
            "service": "Microsoft.DocumentDB/databaseAccounts",
            "text": "Implement retry logic in your client",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "fa6ac22f-0584-bb4b-80e4-80f4755d1a97",
            "source": "azure-resources/DocumentDB/databaseAccounts/recommendations.yaml",
            "graph": "// under-development\n"
        },
        {
            "description": "Monitoring the availability and responsiveness of Azure Cosmos DB resources and having alerts set up for your workload is a good practice. This ensures you stay proactive in handling unforeseen events.\n",
            "aprlGuid": "deaea200-013c-414b-ac9f-bfa7a7fb13f0",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.DocumentDB/databaseAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Monitoring the availability and responsiveness of Azure Cosmos DB resources and having alerts set up for your workload is a good practice. This ensures you stay proactive in handling unforeseen events.\n",
            "potentialBenefits": "Proactive issue management",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Create alerts for Azure Cosmos DB using Azure Monitor | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/cosmos-db/create-alerts"
                }
            ],
            "service": "Microsoft.DocumentDB/databaseAccounts",
            "text": "Monitor Cosmos DB health and set up alerts",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "deaea200-013c-414b-ac9f-bfa7a7fb13f0",
            "source": "azure-resources/DocumentDB/databaseAccounts/recommendations.yaml",
            "graph": "// under-development\n"
        },
        {
            "description": "Enabling diagnostic settings on Azure Event Grid resources like custom topics, system topics, and domains lets you capture and view diagnostic information to troubleshoot failures effectively.\n",
            "aprlGuid": "54c3191b-b535-1946-bba9-b754f44060f6",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.EventGrid/topics",
            "recommendationMetadataState": "Active",
            "longDescription": "Enabling diagnostic settings on Azure Event Grid resources like custom topics, system topics, and domains lets you capture and view diagnostic information to troubleshoot failures effectively.\n",
            "potentialBenefits": "Enhanced troubleshooting for Event Grid",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Event Grid - Enable diagnostic logs for Event Grid resources",
                    "url": "https://learn.microsoft.com/en-us/azure/event-grid/enable-diagnostic-logs-topic"
                }
            ],
            "service": "Microsoft.EventGrid/topics",
            "text": "Configure Diagnostic Settings for all Azure Event Grid resources",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "54c3191b-b535-1946-bba9-b754f44060f6",
            "source": "azure-resources/EventGrid/topics/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Event Grid may not deliver an event within a specific time or after several attempts, leading to dead-lettering where undelivered events are sent to a storage account.\n",
            "aprlGuid": "92162eb5-4323-3145-8a6c-525ce2f0700e",
            "recommendationTypeId": null,
            "recommendationControl": "Personalized",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.EventGrid/topics",
            "recommendationMetadataState": "Active",
            "longDescription": "Event Grid may not deliver an event within a specific time or after several attempts, leading to dead-lettering where undelivered events are sent to a storage account.\n",
            "potentialBenefits": "Saves undelivered events",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Event Grid delivery and retry",
                    "url": "https://learn.microsoft.com/en-us/azure/event-grid/delivery-and-retry#dead-letter-events"
                }
            ],
            "service": "Microsoft.EventGrid/topics",
            "text": "Configure Dead-letter to save events that cannot be delivered",
            "severity": "Low",
            "category": "Personalized",
            "guid": "92162eb5-4323-3145-8a6c-525ce2f0700e",
            "source": "azure-resources/EventGrid/topics/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Use private endpoints for secure event ingress to custom topics/domains via a private link, avoiding the public internet. It employs an IP from the VNet space for your topic/domain.\n",
            "aprlGuid": "b2069f64-4741-3d4a-a71d-50c8b03f5ab7",
            "recommendationTypeId": "bdac9c7b-b9b8-f572-0450-f161c430861c",
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.EventGrid/topics",
            "recommendationMetadataState": "Active",
            "longDescription": "Use private endpoints for secure event ingress to custom topics/domains via a private link, avoiding the public internet. It employs an IP from the VNet space for your topic/domain.\n",
            "potentialBenefits": "Secure, private VNet ingress",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure private endpoints for Azure Event Grid topics or domains",
                    "url": "https://learn.microsoft.com/en-us/azure/event-grid/configure-private-endpoints"
                }
            ],
            "service": "Microsoft.EventGrid/topics",
            "text": "Azure Event Grid topics should use Private Link Private Endpoints",
            "severity": "Medium",
            "category": "Security",
            "guid": "b2069f64-4741-3d4a-a71d-50c8b03f5ab7",
            "source": "azure-resources/EventGrid/topics/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all eventgrid services not protected by private endpoints.\nResources\n| where type contains \"eventgrid\"\n| where properties['publicNetworkAccess'] == \"Enabled\"\n| project recommendationId = \"b2069f64-4741-3d4a-a71d-50c8b03f5ab7\", name, id, tags\n| order by id asc\n\n"
        },
        {
            "description": "When using the Azure portal, zone redundancy is automatically enabled. However, some Infrastructure as Code (IaC) tools may default this to false. To ensure replication of metadata and events across data centers in an availability zone, always verify that zone redundancy is enabled.\n",
            "aprlGuid": "84636c6c-b317-4722-b603-7b1ffc16384b",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.EventHub/namespaces",
            "recommendationMetadataState": "Active",
            "longDescription": "When using the Azure portal, zone redundancy is automatically enabled. However, some Infrastructure as Code (IaC) tools may default this to false. To ensure replication of metadata and events across data centers in an availability zone, always verify that zone redundancy is enabled.\n",
            "potentialBenefits": "Enhanced fault tolerance for Event Hub",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Event Hubs - Geo-disaster recovery",
                    "url": "https://learn.microsoft.com/azure/event-hubs/event-hubs-geo-dr?tabs=portal#availability-zones"
                }
            ],
            "service": "Microsoft.EventHub/namespaces",
            "text": "Ensure zone redundancy is enabled in supported regions",
            "severity": "High",
            "category": "High Availability",
            "guid": "84636c6c-b317-4722-b603-7b1ffc16384b",
            "source": "azure-resources/EventHub/namespaces/recommendations.yaml"
        },
        {
            "description": "Enable auto-inflate on Event Hub Standard tier namespaces to automatically scale up TUs, meeting usage needs and preventing data ingress or egress throttle scenarios by adjusting to allowed rates.\n",
            "aprlGuid": "fbfef3df-04a5-41b2-a8fd-b8541eb04956",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.EventHub/namespaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Enable auto-inflate on Event Hub Standard tier namespaces to automatically scale up TUs, meeting usage needs and preventing data ingress or egress throttle scenarios by adjusting to allowed rates.\n",
            "potentialBenefits": "Prevents throttling by autoscaling TUs",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Event Hubs - Automatically scale throughput units",
                    "url": "https://learn.microsoft.com/azure/event-hubs/event-hubs-auto-inflate"
                }
            ],
            "service": "Microsoft.EventHub/namespaces",
            "text": "Enable auto-inflate on Event Hub Standard tier",
            "severity": "High",
            "category": "Scalability",
            "guid": "fbfef3df-04a5-41b2-a8fd-b8541eb04956",
            "source": "azure-resources/EventHub/namespaces/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Event Hub namespace instances that are Standard tier and do not have Auto Inflate enabled\nresources\n| where type == \"microsoft.eventhub/namespaces\"\n| where sku.tier == \"Standard\"\n| where properties.isAutoInflateEnabled == \"false\"\n| project recommendationId = \"fbfef3df-04a5-41b2-a8fd-b8541eb04956\", name, id, tags, param1 = \"AutoInflateEnabled: False\"\n\n"
        },
        {
            "description": "Configure Resource Health Alerts for all applicable resources to stay informed about the current and historical health status of your Azure resources. They notify you when these resources have a change in their health status.\n",
            "aprlGuid": "be448849-0d7d-49ba-9c94-9573ee533d5d",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Insights/activityLogAlerts",
            "recommendationMetadataState": "Active",
            "longDescription": "Configure Resource Health Alerts for all applicable resources to stay informed about the current and historical health status of your Azure resources. They notify you when these resources have a change in their health status.\n",
            "potentialBenefits": "Stay informed on resource status",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resource Health",
                    "url": "https://learn.microsoft.com/en-us/azure/service-health/resource-health-overview"
                },
                {
                    "name": "Configure Resource Health alerts in the Azure portal",
                    "url": "https://learn.microsoft.com/en-us/azure/service-health/resource-health-alert-monitor-guide#create-a-resource-health-alert-rule-in-the-azure-portal"
                },
                {
                    "name": "Alerts Health",
                    "url": "https://learn.microsoft.com/en-us/azure/service-health/alerts-activity-log-service-notifications-portal"
                }
            ],
            "service": "Microsoft.Insights/activityLogAlerts",
            "text": "Configure Resource Health Alerts",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "be448849-0d7d-49ba-9c94-9573ee533d5d",
            "source": "azure-resources/Insights/activityLogAlerts/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Service health gives a personalized health view of Azure services and regions used, offering the best place for notifications on outages, planned maintenance, and health advisories by knowing the services used.\n",
            "aprlGuid": "9729c89d-8118-41b4-a39b-e12468fa872b",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Insights/activityLogAlerts",
            "recommendationMetadataState": "Active",
            "longDescription": "Service health gives a personalized health view of Azure services and regions used, offering the best place for notifications on outages, planned maintenance, and health advisories by knowing the services used.\n",
            "potentialBenefits": "Proactive outage and maintenance alerts",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "What is Azure Service Health?",
                    "url": "https://learn.microsoft.com/azure/service-health/overview"
                },
                {
                    "name": "Configure alerts for service health events",
                    "url": "https://learn.microsoft.com/azure/service-health/alerts-activity-log-service-notifications-portal"
                }
            ],
            "service": "Microsoft.Insights/activityLogAlerts",
            "text": "Configure Service Health Alerts",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "9729c89d-8118-41b4-a39b-e12468fa872b",
            "source": "azure-resources/Insights/activityLogAlerts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This resource graph query will return all subscriptions without Service Health alerts configured.\n\nresourcecontainers\n| where type == 'microsoft.resources/subscriptions'\n| project subscriptionAlerts=tostring(id),name,tags\n| join kind=leftouter (\n  resources\n  | where type == 'microsoft.insights/activitylogalerts' and properties.condition contains \"ServiceHealth\"\n  | extend subscriptions = properties.scopes\n  | project subscriptions\n  | mv-expand subscriptions\n  | project subscriptionAlerts = tostring(subscriptions)\n) on subscriptionAlerts\n| where isempty(subscriptionAlerts1)\n| project-away subscriptionAlerts1\n| project recommendationId = \"9729c89d-8118-41b4-a39b-e12468fa872b\",id=subscriptionAlerts,name,tags\n\n"
        },
        {
            "description": "Classic Application Insights retires in February 2024. To minimize disruption to existing application monitoring scenarios, transition to workspace-based Application Insights before 29 February 2024.\n",
            "aprlGuid": "dac421ec-2832-4c37-839e-b6dc5a38f2fa",
            "recommendationTypeId": null,
            "recommendationControl": "Service Upgrade and Retirement",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Insights/components",
            "recommendationMetadataState": "Active",
            "longDescription": "Classic Application Insights retires in February 2024. To minimize disruption to existing application monitoring scenarios, transition to workspace-based Application Insights before 29 February 2024.\n",
            "potentialBenefits": "Avoid service disruption post-Feb 2024",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Migrate an Application Insights classic resource to a workspace-based resource",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-monitor/app/convert-classic-resource"
                }
            ],
            "service": "Microsoft.Insights/components",
            "text": "Convert Classic Deployments",
            "severity": "Medium",
            "category": "Service Upgrade and Retirement",
            "guid": "dac421ec-2832-4c37-839e-b6dc5a38f2fa",
            "source": "azure-resources/Insights/components/recommendations.yaml",
            "graph": "// Azure Resource Graph query\n// Filters Application Insights resources with \u2018Classic\u2019 deployment type\nresources\n| where type =~ \"microsoft.insights/components\"\n| extend IngestionMode = properties.IngestionMode\n| where IngestionMode =~ 'ApplicationInsights'\n| project recommendationId= \"dac421ec-2832-4c37-839e-b6dc5a38f2fa\", name, id, tags, param1=\"ApplicationInsightsDeploymentType: Classic\"\n\n"
        },
        {
            "description": "Key Vault's soft-delete feature enables recovery of deleted vaults and objects like keys, secrets, and certificates. When enabled, marked resources are retained for 90 days, allowing for their recovery, essentially undoing deletion.\n",
            "aprlGuid": "1cca00d2-d9ab-8e42-a788-5d40f49405cb",
            "recommendationTypeId": "78211c00-15a9-336e-17c4-0b48613dadf4",
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.KeyVault/vaults",
            "recommendationMetadataState": "Active",
            "longDescription": "Key Vault's soft-delete feature enables recovery of deleted vaults and objects like keys, secrets, and certificates. When enabled, marked resources are retained for 90 days, allowing for their recovery, essentially undoing deletion.\n",
            "potentialBenefits": "Enables recovery of deleted items",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Key Vault soft-delete overview",
                    "url": "https://learn.microsoft.com/azure/key-vault/general/soft-delete-overview"
                }
            ],
            "service": "Microsoft.KeyVault/vaults",
            "text": "Key vaults should have soft delete enabled",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "1cca00d2-d9ab-8e42-a788-5d40f49405cb",
            "source": "azure-resources/KeyVault/vaults/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This Resource Graph query will return all Key Vaults that do not have soft delete enabled.\nresources\n| where type == \"microsoft.keyvault/vaults\"\n| where isnull(properties.enableSoftDelete) or properties.enableSoftDelete != \"true\"\n| project recommendationId = \"1cca00d2-d9ab-8e42-a788-5d40f49405cb\", name, id, tags, param1 = \"EnableSoftDelete: Disabled\"\n\n"
        },
        {
            "description": "Purge protection secures against malicious deletions by enforcing a retention period for soft deleted key vaults, ensuring no one, not even insiders or Microsoft, can purge your key vaults during this period, preventing permanent data loss.\n",
            "aprlGuid": "70fcfe6d-00e9-5544-a63a-fff42b9f2edb",
            "recommendationTypeId": "4ed62ae4-5072-f9e7-8d94-51c76c48159a",
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.KeyVault/vaults",
            "recommendationMetadataState": "Active",
            "longDescription": "Purge protection secures against malicious deletions by enforcing a retention period for soft deleted key vaults, ensuring no one, not even insiders or Microsoft, can purge your key vaults during this period, preventing permanent data loss.\n",
            "potentialBenefits": "Protects from insider attacks, avoids data loss",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Key Vault purge-protection overview",
                    "url": "https://learn.microsoft.com/azure/key-vault/general/soft-delete-overview#purge-protection"
                }
            ],
            "service": "Microsoft.KeyVault/vaults",
            "text": "Key vaults should have purge protection enabled",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "70fcfe6d-00e9-5544-a63a-fff42b9f2edb",
            "source": "azure-resources/KeyVault/vaults/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This resource graph query will return all Key Vaults that do not have Purge Protection enabled.\nresources\n| where type == \"microsoft.keyvault/vaults\"\n| where isnull(properties.enablePurgeProtection) or properties.enablePurgeProtection != \"true\"\n| project recommendationId = \"70fcfe6d-00e9-5544-a63a-fff42b9f2edb\", name, id, tags, param1 = \"EnablePurgeProtection: Disabled\"\n\n"
        },
        {
            "description": "Azure Private Link Service lets you securely and privately connect to Azure Key Vault via a Private Endpoint in your VNet, using a private IP and eliminating public Internet exposure.\n",
            "aprlGuid": "00c3d2b0-ea6e-4c4b-89be-b78a35caeb51",
            "recommendationTypeId": "2e96bc2f-1972-e471-9e70-ae58d41e9d2a",
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.KeyVault/vaults",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Private Link Service lets you securely and privately connect to Azure Key Vault via a Private Endpoint in your VNet, using a private IP and eliminating public Internet exposure.\n",
            "potentialBenefits": "Secure Key Vault with Private Link",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Key Vault Private Link Service overview",
                    "url": "https://learn.microsoft.com/azure/key-vault/general/security-features#network-security"
                }
            ],
            "service": "Microsoft.KeyVault/vaults",
            "text": "Private endpoint should be configured for Key Vault",
            "severity": "Medium",
            "category": "Security",
            "guid": "00c3d2b0-ea6e-4c4b-89be-b78a35caeb51",
            "source": "azure-resources/KeyVault/vaults/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This resource graph query will return all Key Vaults that does not have a Private Endpoint Connection or where a private endpoint exists but public access is enabled\n\nresources\n| where type == \"microsoft.keyvault/vaults\"\n| where isnull(properties.privateEndpointConnections) or properties.privateEndpointConnections[0].properties.provisioningState != (\"Succeeded\") or (isnull(properties.networkAcls) and properties.publicNetworkAccess == 'Enabled')\n| extend param1 = strcat('Private Endpoint: ', iif(isnotnull(properties.privateEndpointConnections),split(properties.privateEndpointConnections[0].properties.privateEndpoint.id,'/')[8],'No Private Endpoint'))\n| extend param2 = strcat('Access: ', iif(properties.publicNetworkAccess == 'Disabled', 'Public Access Disabled', iif(isnotnull(properties.networkAcls), 'NetworkACLs in place','Public Access Enabled')))\n| project recommendationId = \"00c3d2b0-ea6e-4c4b-89be-b78a35caeb51\", name, id, tags, param1, param2\n\n"
        },
        {
            "description": "Key vaults are security boundaries for secret storage. Grouping secrets together increases risk during a security event, as attacks could access multiple secrets.\n",
            "aprlGuid": "e7091145-3642-bd41-bb58-66502e64d2cd",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.KeyVault/vaults",
            "recommendationMetadataState": "Active",
            "longDescription": "Key vaults are security boundaries for secret storage. Grouping secrets together increases risk during a security event, as attacks could access multiple secrets.\n",
            "potentialBenefits": "Enhanced security, Reduced risk",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Key Vault best practices overview",
                    "url": "https://learn.microsoft.com/azure/key-vault/general/best-practices#why-we-recommend-separate-key-vaults"
                }
            ],
            "service": "Microsoft.KeyVault/vaults",
            "text": "Use separate key vaults per application per environment",
            "severity": "High",
            "category": "Governance",
            "guid": "e7091145-3642-bd41-bb58-66502e64d2cd",
            "source": "azure-resources/KeyVault/vaults/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Enable logs, set up alerts, and adhere to retention requirements for improved monitoring and security of Key Vault access, detailing the frequency and identity of users.\n",
            "aprlGuid": "1dc0821d-4f14-7644-bab4-ba208ff5f7fa",
            "recommendationTypeId": "88bbc99c-e5af-ddd7-6105-6150b2bfa519",
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.KeyVault/vaults",
            "recommendationMetadataState": "Active",
            "longDescription": "Enable logs, set up alerts, and adhere to retention requirements for improved monitoring and security of Key Vault access, detailing the frequency and identity of users.\n",
            "potentialBenefits": "Enhanced monitoring and security compliance",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Key Vault logging overview",
                    "url": "https://learn.microsoft.com/azure/key-vault/general/logging?tabs=Vault"
                }
            ],
            "service": "Microsoft.KeyVault/vaults",
            "text": "Diagnostic logs in Key Vault should be enabled",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "1dc0821d-4f14-7644-bab4-ba208ff5f7fa",
            "source": "azure-resources/KeyVault/vaults/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Service levels, part of capacity pool attributes, determine the maximum throughput per volume quota in Azure NetApp Files. It combines read and write speed, offering three levels: Standard (16 MiB/s per 1TiB), Premium (64 MiB/s per 1TiB), and Ultra (128 MiB/s per 1TiB) throughput.\n",
            "aprlGuid": "af426a99-62a6-6b4c-9662-42d220b413b8",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Service levels, part of capacity pool attributes, determine the maximum throughput per volume quota in Azure NetApp Files. It combines read and write speed, offering three levels: Standard (16 MiB/s per 1TiB), Premium (64 MiB/s per 1TiB), and Ultra (128 MiB/s per 1TiB) throughput.\n",
            "potentialBenefits": "Optimized performance and cost efficiency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Service levels for Azure NetApp Files | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Use the correct service level and volume quota size for the expected performance level",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "af426a99-62a6-6b4c-9662-42d220b413b8",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Standard network feature in Azure NetApp Files enhances IP limits and VNet capabilities, including network security groups, user-defined routes on subnets, and diverse connectivity options.\n",
            "aprlGuid": "ab984130-c57b-6c4a-8d04-6723b4e1bdb6",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Standard network feature in Azure NetApp Files enhances IP limits and VNet capabilities, including network security groups, user-defined routes on subnets, and diverse connectivity options.\n",
            "potentialBenefits": "Enhanced connectivity and security",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Guidelines for Azure NetApp Files network planning | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/azure-netapp-files-network-topologies"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Use standard network features for production in Azure NetApp Files",
            "severity": "High",
            "category": "Scalability",
            "guid": "ab984130-c57b-6c4a-8d04-6723b4e1bdb6",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This Resource Graph query will return all Azure NetApp Files volumes without standard network features.\nresources\n| where type =~ \"microsoft.netapp/netappaccounts/capacitypools/volumes\"\n| where properties.networkFeatures != \"Standard\"\n| project recommendationId = \"ab984130-c57b-6c4a-8d04-6723b4e1bdb6\", name, id, tags\n\n"
        },
        {
            "description": "Availability zones are distinct locations within an Azure region to withstand local failures. Deploy your workload in multiple availability zones and use application-based replication or Azure NetApp Files cross-zone replication to achieve high availability. Note that failover is a manual process.\n",
            "aprlGuid": "47d100a5-7f85-5742-967a-67eb5081240a",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Availability zones are distinct locations within an Azure region to withstand local failures. Deploy your workload in multiple availability zones and use application-based replication or Azure NetApp Files cross-zone replication to achieve high availability. Note that failover is a manual process.\n",
            "potentialBenefits": "High Availability across availability zones",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Use availability zones for high availability in Azure NetApp Files | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/use-availability-zones"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Use availability zones for high availability in Azure NetApp Files",
            "severity": "High",
            "category": "High Availability",
            "guid": "47d100a5-7f85-5742-967a-67eb5081240a",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This Resource Graph query will return all Azure NetApp Files volumes without an availability zone defined.\nResources\n| where type =~ \"Microsoft.NetApp/netAppAccounts/capacityPools/volumes\"\n| where array_length(zones) == 0 or isnull(zones)\n| project recommendationId = \"47d100a5-7f85-5742-967a-67eb5081240a\", name, id, tags\n\n"
        },
        {
            "description": "Azure NetApp Files' availability zone (AZ) volume placement feature lets you deploy volumes in the same AZ with Azure compute and other services to have within AZ latency and share the same AZ failure domain.\n",
            "aprlGuid": "8bb690e8-64d5-4838-8703-9ee3dbac688f",
            "recommendationTypeId": null,
            "recommendationControl": "Other Best Practices",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure NetApp Files' availability zone (AZ) volume placement feature lets you deploy volumes in the same AZ with Azure compute and other services to have within AZ latency and share the same AZ failure domain.\n",
            "potentialBenefits": "Within AZ latency and tolerate failure of other AZ",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Manage availability zone volume placement for Azure NetApp Files | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/manage-availability-zone-volume-placement"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Deploy ANF volumes in the same availability zone with Azure compute and other services",
            "severity": "High",
            "category": "Other Best Practices",
            "guid": "8bb690e8-64d5-4838-8703-9ee3dbac688f",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Azure NetApp Files snapshot technology ensures stability, scalability, and swift data recoverability without affecting performance. It supports automatic snapshot creation via policies for Azure NetApp Files data.\n",
            "aprlGuid": "72827434-c773-4345-9493-34848ddf5803",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure NetApp Files snapshot technology ensures stability, scalability, and swift data recoverability without affecting performance. It supports automatic snapshot creation via policies for Azure NetApp Files data.\n",
            "potentialBenefits": "Stable, scalable, swift recovery, no perf impact",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "How Azure NetApp Files snapshots work | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/snapshots-introduction"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Use snapshots for data protection in Azure NetApp Files",
            "severity": "High",
            "category": "High Availability",
            "guid": "72827434-c773-4345-9493-34848ddf5803",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This Resource Graph query will return all Azure NetApp Files volumes without a snapshot policy defined.\nresources\n|\u00a0where\u00a0type\u00a0==\u00a0\"microsoft.netapp/netappaccounts/capacitypools/volumes\"\n| where properties.dataProtection.snapshot.snapshotPolicyId == \"\"\n| project recommendationId = \"72827434-c773-4345-9493-34848ddf5803\", name, id, tags\n\n"
        },
        {
            "description": "Azure NetApp Files offers a fully managed backup solution enhancing long-term recovery, archiving, and compliance.\n",
            "aprlGuid": "b2fb3e60-97ec-e34d-af29-b16a0d61c2ac",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure NetApp Files offers a fully managed backup solution enhancing long-term recovery, archiving, and compliance.\n",
            "potentialBenefits": "Enhances data recovery and compliance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Understand Azure NetApp Files backup | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/backup-introduction"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Enable backup for data protection in Azure NetApp Files",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "b2fb3e60-97ec-e34d-af29-b16a0d61c2ac",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This Resource Graph query will return all Azure NetApp Files volumes without a backup policy defined.\nresources\n| where type == \"microsoft.netapp/netappaccounts/capacitypools/volumes\"\n| where properties.dataProtection.backup.backupPolicyId == \"\"\n| project recommendationId = \"b2fb3e60-97ec-e34d-af29-b16a0d61c2ac\", name, id, tags\n"
        },
        {
            "description": "Azure NetApp Files replication offers data protection by allowing asynchronous cross-region volume replication for application failover in case of regional outages. Volumes can be replicated across regions, not concurrently with cross-zone replication. Note that failover is a manual process.\n",
            "aprlGuid": "e30317d2-c502-4dfe-a2d3-0a737cc79545",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure NetApp Files replication offers data protection by allowing asynchronous cross-region volume replication for application failover in case of regional outages. Volumes can be replicated across regions, not concurrently with cross-zone replication. Note that failover is a manual process.\n",
            "potentialBenefits": "Enhanced data protection and disaster recovery",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Cross-region replication of Azure NetApp Files volumes",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-netapp-files/cross-region-replication-introduction"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Enable Cross-region replication of Azure NetApp Files volumes",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "e30317d2-c502-4dfe-a2d3-0a737cc79545",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This Resource Graph query will return all Azure NetApp Files volumes without cross-region replication.\nresources\n|\u00a0where\u00a0type\u00a0==\u00a0\"microsoft.netapp/netappaccounts/capacitypools/volumes\"\n|\u00a0extend\u00a0remoteVolumeRegion\u00a0=\u00a0properties.dataProtection.replication.remoteVolumeRegion\n|\u00a0extend\u00a0volumeType\u00a0=\u00a0properties.volumeType\n|\u00a0extend\u00a0replicationType\u00a0=\u00a0iff((remoteVolumeRegion\u00a0==\u00a0location),\u00a0\"CZR\",\u00a0iff((remoteVolumeRegion\u00a0==\u00a0\"\"),\"n/a\",\"CRR\"))\n| where replicationType != \"CRR\" and volumeType != \"DataProtection\"\n| project recommendationId = \"e30317d2-c502-4dfe-a2d3-0a737cc79545\", name, id, tags\n\n"
        },
        {
            "description": "The cross-zone replication (CZR) feature enables asynchronous data replication between Azure NetApp Files volumes across different availability zones, ensuring data protection and critical application failover in case of zone-wide disasters. Note that failover is a manual process.\n",
            "aprlGuid": "e3d742e1-dacd-9b48-b6b1-510ec9f87c96",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "The cross-zone replication (CZR) feature enables asynchronous data replication between Azure NetApp Files volumes across different availability zones, ensuring data protection and critical application failover in case of zone-wide disasters. Note that failover is a manual process.\n",
            "potentialBenefits": "Enhances disaster recovery across availability zones",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Cross-zone replication of Azure NetApp Files volumes | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/cross-zone-replication-introduction"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Enable Cross-zone replication of Azure NetApp Files volumes",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "e3d742e1-dacd-9b48-b6b1-510ec9f87c96",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This Resource Graph query will return all Azure NetApp Files volumes without cross-zone replication.\nresources\n|\u00a0where\u00a0type\u00a0==\u00a0\"microsoft.netapp/netappaccounts/capacitypools/volumes\"\n|\u00a0extend\u00a0remoteVolumeRegion\u00a0=\u00a0properties.dataProtection.replication.remoteVolumeRegion\n|\u00a0extend\u00a0volumeType\u00a0=\u00a0properties.volumeType\n|\u00a0extend\u00a0replicationType\u00a0=\u00a0iff((remoteVolumeRegion\u00a0==\u00a0location),\u00a0\"CZR\",\u00a0iff((remoteVolumeRegion\u00a0==\u00a0\"\"),\"n/a\",\"CRR\"))\n| where replicationType != \"CZR\" and volumeType != \"DataProtection\"\n| project recommendationId = \"e3d742e1-dacd-9b48-b6b1-510ec9f87c96\", name, id, tags\n\n"
        },
        {
            "description": "Azure NetApp Files offers metrics like allocated storage, actual usage, volume IOPS, and latency, enabling a better understanding of usage patterns and volume performance for NetApp accounts.\n",
            "aprlGuid": "2f579fc9-e599-0d44-8b97-254f50ae04d8",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure NetApp Files offers metrics like allocated storage, actual usage, volume IOPS, and latency, enabling a better understanding of usage patterns and volume performance for NetApp accounts.\n",
            "potentialBenefits": "Optimize usage and performance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Ways to monitor Azure NetApp Files | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/monitor-azure-netapp-files"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Monitor Azure NetApp Files metrics to better understand usage pattern and performance",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "2f579fc9-e599-0d44-8b97-254f50ae04d8",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Azure NetApp Files supports Azure policy integration using either built-in policy definitions or by creating custom ones to maintain organizational standards and compliance.\n",
            "aprlGuid": "687ae58f-517f-ca43-90fe-922497e61283",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure NetApp Files supports Azure policy integration using either built-in policy definitions or by creating custom ones to maintain organizational standards and compliance.\n",
            "potentialBenefits": "Enforce standards and assess compliance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Policy definitions for Azure NetApp Files | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/azure-policy-definitions"
                },
                {
                    "name": "Creating custom policy definitions | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/governance/policy/tutorials/create-custom-policy-definition"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Enforce standards and assess compliance in Azure NetApp Files with Azure policy",
            "severity": "Medium",
            "category": "Governance",
            "guid": "687ae58f-517f-ca43-90fe-922497e61283",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Access to the delegated subnet should be limited to specific Azure Virtual Networks. SMB-enabled volumes' share permissions should move away from 'Everyone/Full control'. NFS-enabled volumes' access needs to be controlled via export policies and/or NFSv4.1 ACLs.\n",
            "aprlGuid": "cfa2244b-5436-47de-8287-b217875d3b0a",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Access to the delegated subnet should be limited to specific Azure Virtual Networks. SMB-enabled volumes' share permissions should move away from 'Everyone/Full control'. NFS-enabled volumes' access needs to be controlled via export policies and/or NFSv4.1 ACLs.\n",
            "potentialBenefits": "Enhanced security, Reduced data breach risk",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure network features for an Azure NetApp Files volume",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/configure-network-features"
                },
                {
                    "name": "Manage SMB share ACLs in Azure NetApp Files",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/manage-smb-share-access-control-lists"
                },
                {
                    "name": "Configure export policy for NFS or dual-protocol volumes",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/azure-netapp-files-configure-export-policy"
                },
                {
                    "name": "Configure access control lists on NFSv4.1 volumes for Azure NetApp Files",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/configure-access-control-lists"
                },
                {
                    "name": "Configure Unix permissions and change ownership mode for NFS and dual-protocol volumes",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/configure-unix-permissions-change-ownership-mode"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Restrict default access to Azure NetApp Files volumes",
            "severity": "Medium",
            "category": "Security",
            "guid": "cfa2244b-5436-47de-8287-b217875d3b0a",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Certain SMB applications need SMB Transparent Failover for maintenance without interrupting server connectivity. Azure NetApp Files provides this through SMB Continuous Availability for applications like Citrix App Layering, FSLogix user/profile containers, Microsoft SQL Server, MSIX app attach.\n",
            "aprlGuid": "d1e7ccc3-e6c1-40e9-a36e-fd134711c808",
            "recommendationTypeId": "e4bebd74-387a-4a74-b757-475d2d1b4e3e",
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Certain SMB applications need SMB Transparent Failover for maintenance without interrupting server connectivity. Azure NetApp Files provides this through SMB Continuous Availability for applications like Citrix App Layering, FSLogix user/profile containers, Microsoft SQL Server, MSIX app attach.\n",
            "potentialBenefits": "Zero downtime for SMB apps",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Do I need to take special precautions for SMB-based applications? | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/faq-application-resilience#do-i-need-to-take-special-precautions-for-smb-based-applications"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Make use of SMB continuous availability for supported applications",
            "severity": "High",
            "category": "High Availability",
            "guid": "d1e7ccc3-e6c1-40e9-a36e-fd134711c808",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Azure NetApp Files might undergo occasional planned maintenance such as platform updates or service and software upgrades. It's important to be aware of the application's resiliency settings to cope with these storage service maintenance events.\n",
            "aprlGuid": "60f36f9b-fac9-4160-bbf5-57af04da4f53",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.NetApp/netAppAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure NetApp Files might undergo occasional planned maintenance such as platform updates or service and software upgrades. It's important to be aware of the application's resiliency settings to cope with these storage service maintenance events.\n",
            "potentialBenefits": "Minimizes downtime during maintenance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "What do you recommend for handling potential application disruptions due to storage service maintenance events? | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/azure-netapp-files/faq-application-resilience#what-do-you-recommend-for-handling-potential-application-disruptions-due-to-storage-service-maintenance-events"
                }
            ],
            "service": "Microsoft.NetApp/netAppAccounts",
            "text": "Ensure application resilience for service maintenance events",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "60f36f9b-fac9-4160-bbf5-57af04da4f53",
            "source": "azure-resources/NetApp/netAppAccounts/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Azure Application Gateways v2 are always deployed in a highly available fashion with multiple instances by default. Enabling autoscale ensures the service is not reliant on manual intervention for scaling.\n",
            "aprlGuid": "823b0cff-05c0-2e4e-a1e7-9965e1cfa16f",
            "recommendationTypeId": "c9c9750b-9ddb-436f-b19a-9c725539a0b5",
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/applicationGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Application Gateways v2 are always deployed in a highly available fashion with multiple instances by default. Enabling autoscale ensures the service is not reliant on manual intervention for scaling.\n",
            "potentialBenefits": "Enhances uptime and enables autoscaling",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Application Gateway Autoscaling Zone-Redundant",
                    "url": "https://learn.microsoft.com/azure/application-gateway/application-gateway-autoscaling-zone-redundant#autoscaling-and-high-availability"
                }
            ],
            "service": "Microsoft.Network/applicationGateways",
            "text": "Ensure Autoscale feature has been enabled",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "823b0cff-05c0-2e4e-a1e7-9965e1cfa16f",
            "source": "azure-resources/Network/applicationGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This query will return all Application Gateways that do not have autoscale enabled or have a min capacity of 1\nresources\n| where type =~ \"microsoft.network/applicationGateways\"\n| where isnull(properties.autoscaleConfiguration) or properties.autoscaleConfiguration.minCapacity <= 1\n| project recommendationId = \"823b0cff-05c0-2e4e-a1e7-9965e1cfa16f\", name, id, tags, param1 = \"autoScaleConfiguration: isNull or MinCapacity <= 1\"\n| order by id asc\n\n\n"
        },
        {
            "description": "Secure all incoming connections using HTTPS for production services with end-to-end SSL/TLS or SSL/TLS termination at the Application Gateway to protect against attacks and ensure data remains private and encrypted between the web server and browsers.\n",
            "aprlGuid": "233a7008-71e9-e745-923e-1a1c7a0b92f3",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/applicationGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Secure all incoming connections using HTTPS for production services with end-to-end SSL/TLS or SSL/TLS termination at the Application Gateway to protect against attacks and ensure data remains private and encrypted between the web server and browsers.\n",
            "potentialBenefits": "Enhanced security and privacy",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Application Gateway Security",
                    "url": "https://learn.microsoft.com/azure/well-architected/services/networking/azure-application-gateway#security"
                },
                {
                    "name": "Application Gateway SSL Overview",
                    "url": "https://learn.microsoft.com/azure/application-gateway/ssl-overview"
                },
                {
                    "name": "Application Gateway SSL Policy Overview",
                    "url": "https://learn.microsoft.com/azure/application-gateway/application-gateway-ssl-policy-overview"
                },
                {
                    "name": "Application Gateway KeyVault Certs",
                    "url": "https://learn.microsoft.com/azure/application-gateway/key-vault-certs"
                },
                {
                    "name": "Application Gateway SSL Cert Management",
                    "url": "https://learn.microsoft.com/azure/application-gateway/ssl-certificate-management"
                }
            ],
            "service": "Microsoft.Network/applicationGateways",
            "text": "Secure all incoming connections with SSL",
            "severity": "High",
            "category": "Security",
            "guid": "233a7008-71e9-e745-923e-1a1c7a0b92f3",
            "source": "azure-resources/Network/applicationGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// You can use the following Azure Resource Graph query to check if an HTTP rule is using an SSL certificate or is using Azure Key Vault to store the certificates\nresources\n| where type =~ \"microsoft.network/applicationGateways\"\n| mv-expand frontendPorts = properties.frontendPorts\n| mv-expand httpListeners = properties.httpListeners\n| where isnull(parse_json(httpListeners.properties.sslCertificate))\n| project recommendationId=\"233a7008-71e9-e745-923e-1a1c7a0b92f3\", name, id, tags, param1=strcat(\"frontendPort: \", frontendPorts.properties.port), param2=\"tls: false\"\n\n"
        },
        {
            "description": "Use Application Gateway with Web Application Firewall (WAF) in an application virtual network to safeguard inbound HTTP/S internet traffic. WAF offers centralized defense against potential exploits through OWASP core rule sets-based rules.\n",
            "aprlGuid": "8d9223c4-730d-ca47-af88-a9a024c37270",
            "recommendationTypeId": "efe75f01-6fff-5d9d-08e6-092b98d3fb3f",
            "recommendationControl": "Security",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Network/applicationGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Application Gateway with Web Application Firewall (WAF) in an application virtual network to safeguard inbound HTTP/S internet traffic. WAF offers centralized defense against potential exploits through OWASP core rule sets-based rules.\n",
            "potentialBenefits": "Enhanced security for HTTP/S traffic",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Well-Architected Framework Application Gateway Overview",
                    "url": "https://learn.microsoft.com/azure/well-architected/services/networking/azure-application-gateway"
                },
                {
                    "name": "Application Gateway - Web Application Firewall",
                    "url": "https://learn.microsoft.com/azure/application-gateway/features#web-application-firewall"
                }
            ],
            "service": "Microsoft.Network/applicationGateways",
            "text": "Enable Web Application Firewall policies",
            "severity": "Low",
            "category": "Security",
            "guid": "8d9223c4-730d-ca47-af88-a9a024c37270",
            "source": "azure-resources/Network/applicationGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This query will return all Application Gateways that do not have WAF enabled\nResources\n| where type =~ \"microsoft.network/applicationGateways\"\n| where properties.firewallpolicy != \"\"\n| project recommendationId = \"8d9223c4-730d-ca47-af88-a9a024c37270\", name, id, tags, param1 = \"webApplicationFirewallConfiguration: isNull\"\n| order by id asc\n\n\n"
        },
        {
            "description": "Use Application Gateway v2 for built-in features like autoscaling, static VIPs, Azure KeyVault integration for better traffic management and performance, unless v1 is necessary.\n",
            "aprlGuid": "7893f0b3-8622-1d47-beed-4b50a19f7895",
            "recommendationTypeId": "0e19257e-dcef-4d00-8de1-5fe1ae0fd948",
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/applicationGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Application Gateway v2 for built-in features like autoscaling, static VIPs, Azure KeyVault integration for better traffic management and performance, unless v1 is necessary.\n",
            "potentialBenefits": "Better performance, autoscaling, more features",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Application Gateway Overview V2",
                    "url": "https://learn.microsoft.com/azure/application-gateway/overview-v2"
                },
                {
                    "name": "Application Gateway Feature Comparison Between V1 and V2",
                    "url": "https://learn.microsoft.com/azure/application-gateway/overview-v2#feature-comparison-between-v1-sku-and-v2-sku"
                },
                {
                    "name": "Application Gateway V1 Retirement",
                    "url": "https://azure.microsoft.com/updates/application-gateway-v1-will-be-retired-on-28-april-2026-transition-to-application-gateway-v2/"
                }
            ],
            "service": "Microsoft.Network/applicationGateways",
            "text": "Migrate to Application Gateway v2",
            "severity": "High",
            "category": "Scalability",
            "guid": "7893f0b3-8622-1d47-beed-4b50a19f7895",
            "source": "azure-resources/Network/applicationGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Get all Application Gateways, which are using the deprecated V1 SKU\nresources\n| where type =~ 'microsoft.network/applicationgateways'\n| extend tier = properties.sku.tier\n| where tier == 'Standard' or tier == 'WAF'\n| project recommendationId = \"7893f0b3-8622-1d47-beed-4b50a19f7895\", name, id, tags\n\n"
        },
        {
            "description": "Enable logging in storage accounts, Log Analytics, and monitoring services for auditing and insights. If using NSGs, enable NSG flow logs to be stored, providing in-depth traffic analysis into Azure Cloud.\n",
            "aprlGuid": "5d035919-898d-a047-8d5d-454e199692e5",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/applicationGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Enable logging in storage accounts, Log Analytics, and monitoring services for auditing and insights. If using NSGs, enable NSG flow logs to be stored, providing in-depth traffic analysis into Azure Cloud.\n",
            "potentialBenefits": "Enhanced traffic insight and audit",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Application Gateway Metrics",
                    "url": "https://learn.microsoft.com/azure/application-gateway/application-gateway-metrics"
                },
                {
                    "name": "Application Gateway Diagnostics",
                    "url": "https://learn.microsoft.com/azure/application-gateway/application-gateway-diagnostics"
                }
            ],
            "service": "Microsoft.Network/applicationGateways",
            "text": "Monitor and Log the configurations and traffic",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "5d035919-898d-a047-8d5d-454e199692e5",
            "source": "azure-resources/Network/applicationGateways/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Using custom health probes enhances understanding of backend availability and facilitates monitoring of backend services for any impact.\n",
            "aprlGuid": "847a8d88-21c4-bc48-a94e-562206edd767",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/applicationGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Using custom health probes enhances understanding of backend availability and facilitates monitoring of backend services for any impact.\n",
            "potentialBenefits": "Ensures backend uptime monitoring.",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Application Gateway Probe Overview",
                    "url": "https://learn.microsoft.com/azure/application-gateway/application-gateway-probe-overview"
                },
                {
                    "name": "Well-Architected Framework Application Gateway Overview",
                    "url": "https://learn.microsoft.com/azure/well-architected/services/networking/azure-application-gateway"
                }
            ],
            "service": "Microsoft.Network/applicationGateways",
            "text": "Use Health Probes to detect backend availability",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "847a8d88-21c4-bc48-a94e-562206edd767",
            "source": "azure-resources/Network/applicationGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Application Gateways are not using health probes to monitor the availability of the backend systems\nresources\n| where type =~ \"microsoft.network/applicationGateways\"\n| where array_length(properties.probes) == 0\n| project recommendationId=\"847a8d88-21c4-bc48-a94e-562206edd767\", name, id, tags, param1=\"customHealthProbeUsed: false\"\n\n"
        },
        {
            "description": "Deploying Application Gateway in a zone-aware configuration ensures continued customer access to services even if a specific zone goes down, as services in other zones remain available.\n",
            "aprlGuid": "c9c00f2a-3888-714b-a72b-b4c9e8fcffb2",
            "recommendationTypeId": "5c488377-be3e-4365-92e8-09d1e8d9038c",
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/applicationGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Deploying Application Gateway in a zone-aware configuration ensures continued customer access to services even if a specific zone goes down, as services in other zones remain available.\n",
            "potentialBenefits": "Enhanced uptime and customer access",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Well-Architected Framework Application Gateway Reliability",
                    "url": "https://learn.microsoft.com/azure/well-architected/services/networking/azure-application-gateway#reliability"
                },
                {
                    "name": "Application Gateway V2 Overview",
                    "url": "https://learn.microsoft.com/azure/application-gateway/overview-v2"
                }
            ],
            "service": "Microsoft.Network/applicationGateways",
            "text": "Deploy Application Gateway in a zone-redundant configuration",
            "severity": "High",
            "category": "High Availability",
            "guid": "c9c00f2a-3888-714b-a72b-b4c9e8fcffb2",
            "source": "azure-resources/Network/applicationGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// list Application Gateways that are not configured to use at least 2 Availability Zones\nresources\n| where type =~ \"microsoft.network/applicationGateways\"\n| where isnull(zones) or array_length(zones) < 2\n| extend zoneValue = iff((isnull(zones)), \"null\", zones)\n| project recommendationId = \"c9c00f2a-3888-714b-a72b-b4c9e8fcffb2\", name, id, tags, param1=\"Zones: No Zone or Zonal\", param2=strcat(\"Zones value: \", zoneValue )\n\n"
        },
        {
            "description": "Using connection draining for backend maintenance ensures graceful removal of backend pool members during updates or health issues. It's enabled via Backend Setting and applies to all members during rule creation.\n",
            "aprlGuid": "10f02bc6-e2e7-004d-a2c2-f9bf9f16b915",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/applicationGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Using connection draining for backend maintenance ensures graceful removal of backend pool members during updates or health issues. It's enabled via Backend Setting and applies to all members during rule creation.\n",
            "potentialBenefits": "Smooth updates, no dropped users",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Application Gateway Connection Draining",
                    "url": "https://learn.microsoft.com/azure/application-gateway/features#connection-draining"
                },
                {
                    "name": "Application Gateway Connection Draining HTTP Settings",
                    "url": "https://learn.microsoft.com/azure/application-gateway/configuration-http-settings#connection-draining"
                }
            ],
            "service": "Microsoft.Network/applicationGateways",
            "text": "Plan for backend maintenance by using connection draining",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "10f02bc6-e2e7-004d-a2c2-f9bf9f16b915",
            "source": "azure-resources/Network/applicationGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This query will check if connection draining is enabled\nresources\n| where type =~ \"microsoft.network/applicationGateways\"\n| mv-expand backendHttpSettings = properties.backendHttpSettingsCollection\n| extend connectionDrainingEnabled = backendHttpSettings.properties.connectionDraining.enabled\n| where connectionDrainingEnabled != true\n| extend backendPoolName = backendHttpSettings.name\n| project recommendationId = \"10f02bc6-e2e7-004d-a2c2-f9bf9f16b915\", name, id, tags, param1 = \"connectionDraining: Disabled\", param2 = strcat(\"backendSettingsName: \", backendPoolName)\n\n"
        },
        {
            "description": "Application Gateway v2 (Standard_v2 or WAF_v2 SKU) can support up to 125 instances. A /24 subnet isn't mandatory for deployment but is advised to provide enough space for autoscaling and maintenance upgrades.\n",
            "aprlGuid": "8364fd0a-7c0e-e240-9d95-4bf965aec243",
            "recommendationTypeId": "ef4da732-f541-4109-bc0e-465c68b6c7eb",
            "recommendationControl": "Other Best Practices",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/applicationGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Application Gateway v2 (Standard_v2 or WAF_v2 SKU) can support up to 125 instances. A /24 subnet isn't mandatory for deployment but is advised to provide enough space for autoscaling and maintenance upgrades.\n",
            "potentialBenefits": "Allows autoscaling and maintenance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Application Gateway infrastructure configuration | Microsoft Learn",
                    "url": "https://learn.microsoft.com/en-us/azure/application-gateway/configuration-infrastructure#size-of-the-subnet"
                }
            ],
            "service": "Microsoft.Network/applicationGateways",
            "text": "Ensure Application Gateway Subnet is using a /24 subnet mask",
            "severity": "High",
            "category": "Other Best Practices",
            "guid": "8364fd0a-7c0e-e240-9d95-4bf965aec243",
            "source": "azure-resources/Network/applicationGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This query will validate the subnet id for an appGW ends with a /24\n\nresources\n| where type =~ 'Microsoft.Network/applicationGateways'\n| extend subnetid = tostring(properties.gatewayIPConfigurations[0].properties.subnet.id)\n| join kind=leftouter(resources\n    | where type == \"microsoft.network/virtualnetworks\"\n    | mv-expand properties.subnets\n    | extend subnetid = tostring(properties_subnets.id)\n    | extend addressprefix = tostring(properties_subnets.properties.addressPrefix)\n    | project subnetid, addressprefix) on subnetid\n| where addressprefix !endswith '/24'\n| project recommendationId = \"8364fd0a-7c0e-e240-9d95-4bf965aec243\", name, id, tags, param1 = strcat('AppGW subnet prefix: ', addressprefix)\n\n"
        },
        {
            "description": "Azure Firewall offers different SLAs depending on its deployment; in a single availability zone or across multiple, potentially improving reliability and performance.\n",
            "aprlGuid": "c72b7fee-1fa0-5b4b-98e5-54bcae95bb74",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/azureFirewalls",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Firewall offers different SLAs depending on its deployment; in a single availability zone or across multiple, potentially improving reliability and performance.\n",
            "potentialBenefits": "Enhanced SLA and reliability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Well Architected Framework - Azure Firewall",
                    "url": "https://learn.microsoft.com/azure/architecture/framework/services/networking/azure-firewall"
                },
                {
                    "name": "Deploy Azure Firewall across multiple availability zones",
                    "url": "https://learn.microsoft.com/azure/firewall/deploy-availability-zone-powershell"
                }
            ],
            "service": "Microsoft.Network/azureFirewalls",
            "text": "Deploy Azure Firewall across multiple availability zones",
            "severity": "High",
            "category": "High Availability",
            "guid": "c72b7fee-1fa0-5b4b-98e5-54bcae95bb74",
            "source": "azure-resources/Network/azureFirewalls/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// List all Azure Firewalls that are not configured with multiple availability zones or deployed without a zone\nresources\n| where type == 'microsoft.network/azurefirewalls'\n| where array_length(zones) <= 1 or isnull(zones)\n| where isempty(properties.virtualHub.id) or isnull(properties.virtualHub.id)\n| project recommendationId = \"c72b7fee-1fa0-5b4b-98e5-54bcae95bb74\", name, id, tags, param1=\"multipleZones:false\"\n\n"
        },
        {
            "description": "Monitor Azure Firewall for overall health, processed throughput, and outbound SNAT port usage. Get alerted before limits impact services. Consider NAT gateway integration with zonal deployments; note limitations with zone redundant firewalls and secure virtual hub networks.\n",
            "aprlGuid": "3c8fa7c6-6b78-a24a-a63f-348a7c71acb9",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/azureFirewalls",
            "recommendationMetadataState": "Active",
            "longDescription": "Monitor Azure Firewall for overall health, processed throughput, and outbound SNAT port usage. Get alerted before limits impact services. Consider NAT gateway integration with zonal deployments; note limitations with zone redundant firewalls and secure virtual hub networks.\n",
            "potentialBenefits": "Improve health and performance monitoring",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Firewall metrics supported in Azure Monitor",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/essentials/metrics-supported#microsoftnetworkazurefirewalls"
                },
                {
                    "name": "Azure Firewall performance",
                    "url": "https://learn.microsoft.com/azure/firewall/firewall-performance"
                }
            ],
            "service": "Microsoft.Network/azureFirewalls",
            "text": "Monitor Azure Firewall metrics",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "3c8fa7c6-6b78-a24a-a63f-348a7c71acb9",
            "source": "azure-resources/Network/azureFirewalls/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// List all Azure Firewalls resources in-scope, along with any metrics associated to Azure Monitor alert rules, that are not fully configured.\nresources\n| where type == \"microsoft.network/azurefirewalls\"\n| project firewallId = tolower(id), name, tags\n| join kind = leftouter (\n    resources\n    | where type == \"microsoft.insights/metricalerts\"\n    | mv-expand properties.scopes\n    | mv-expand properties.criteria.allOf\n    | where properties_scopes contains \"azureFirewalls\"\n    | project metricId = tolower(properties_scopes), monitoredMetric = properties_criteria_allOf.metricName, tags\n    | summarize monitoredMetrics = make_list(monitoredMetric) by tostring(metricId)\n    | project\n        metricId,\n        monitoredMetrics,\n        allAlertsConfigured = monitoredMetrics contains(\"FirewallHealth\") and monitoredMetrics contains (\"Throughput\") and monitoredMetrics contains (\"SNATPortUtilization\")\n) on $left.firewallId == $right.metricId\n| extend alertsNotFullyConfigured = isnull(allAlertsConfigured) or not(allAlertsConfigured)\n| where alertsNotFullyConfigured\n| project recommendationId = \"c8fa7c6-6b78-a24a-a63f-348a7c71acb9\", name, id = firewallId, tags, param1 = strcat(\"MetricsAlerts:\", monitoredMetrics)\n\n"
        },
        {
            "description": "Associate a DDoS protection plan with the virtual network hosting Azure Firewall to provide enhanced mitigation against DDoS attacks. Azure Firewall Manager integrates the creation of firewall infrastructure and DDoS protection plans.\n",
            "aprlGuid": "1b2dbf4a-8a0b-5e4b-8f4e-3f758188910d",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/azureFirewalls",
            "recommendationMetadataState": "Active",
            "longDescription": "Associate a DDoS protection plan with the virtual network hosting Azure Firewall to provide enhanced mitigation against DDoS attacks. Azure Firewall Manager integrates the creation of firewall infrastructure and DDoS protection plans.\n",
            "potentialBenefits": "Enhanced DDoS attack defense",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure DDoS Protection overview",
                    "url": "https://learn.microsoft.com/azure/ddos-protection/ddos-protection-overview"
                }
            ],
            "service": "Microsoft.Network/azureFirewalls",
            "text": "Configure DDoS Protection on the Azure Firewall VNet",
            "severity": "High",
            "category": "Security",
            "guid": "1b2dbf4a-8a0b-5e4b-8f4e-3f758188910d",
            "source": "azure-resources/Network/azureFirewalls/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// List all in-scope Azure Firewall resources, where the VNet is not associated to a DDoS Protection Plan\nresources\n| where type =~ \"Microsoft.Network/azureFirewalls\"\n| where isempty(properties.virtualHub.id) or isnull(properties.virtualHub.id)\n| mv-expand ipConfig = properties.ipConfigurations\n| project\n    name,\n    firewallId = id,\n    tags,\n    vNetName = split(ipConfig.properties.subnet.id, \"/\", 8)[0],\n    vNetId = tolower(substring(ipConfig.properties.subnet.id, 0, indexof(ipConfig.properties.subnet.id, \"/subnet\")))\n| join kind=fullouter (\n    resources\n    | where type =~ \"Microsoft.Network/ddosProtectionPlans\"\n    | mv-expand vNet = properties.virtualNetworks\n    | project ddosProtectionPlanId = id, vNetId = tolower(vNet.id)\n    )\n    on vNetId\n| where isempty(ddosProtectionPlanId)\n| project recommendationId = \"1b2dbf4a-8a0b-5e4b-8f4e-3f758188910d\", name, id = firewallId, tags, param1 = strcat(\"vNet: \", vNetName), param2 = \"ddosProtection: Disabled\"\n"
        },
        {
            "description": "Azure Firewall policy supports rule hierarchies for compliance enforcement, using a central base policy with higher priority over child policies, and employs Azure custom roles to safeguard base policy and manage access within subscriptions or groups.\n",
            "aprlGuid": "3a63560a-1ed3-6140-acd1-d1d23f9a2e12",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/azureFirewalls",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Firewall policy supports rule hierarchies for compliance enforcement, using a central base policy with higher priority over child policies, and employs Azure custom roles to safeguard base policy and manage access within subscriptions or groups.\n",
            "potentialBenefits": "Enhanced compliance and rule hierarchy",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Firewall Policy hierarchy",
                    "url": "https://learn.microsoft.com/azure/firewall-manager/rule-hierarchy"
                }
            ],
            "service": "Microsoft.Network/azureFirewalls",
            "text": "Leverage Azure Firewall policy inheritance model",
            "severity": "Medium",
            "category": "Governance",
            "guid": "3a63560a-1ed3-6140-acd1-d1d23f9a2e12",
            "source": "azure-resources/Network/azureFirewalls/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Configure a minimum of two to four public IP addresses per Azure Firewall to avoid SNAT exhaustion. Azure Firewall offers SNAT for all outbound traffic to public IPs, providing 2,496 SNAT ports for each additional PIP.\n",
            "aprlGuid": "d2e4a38e-2307-4299-a217-4c0cebc9a7f6",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/azureFirewalls",
            "recommendationMetadataState": "Active",
            "longDescription": "Configure a minimum of two to four public IP addresses per Azure Firewall to avoid SNAT exhaustion. Azure Firewall offers SNAT for all outbound traffic to public IPs, providing 2,496 SNAT ports for each additional PIP.\n",
            "potentialBenefits": "Avoids SNAT exhaustion.",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Well-Architected Framework review - Azure Firewall",
                    "url": "https://learn.microsoft.com/en-us/azure/well-architected/service-guides/azure-firewall#recommendations"
                }
            ],
            "service": "Microsoft.Network/azureFirewalls",
            "text": "Configure 2-4 PIPs for SNAT Port utilization",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "d2e4a38e-2307-4299-a217-4c0cebc9a7f6",
            "source": "azure-resources/Network/azureFirewalls/recommendations.yaml",
            "graph": "// under development\n\n"
        },
        {
            "description": "Creating a metric to monitor latency probes over 20ms for periods longer than 30ms helps identify when firewall instance CPUs are stressed, potentially indicating issues.\n",
            "aprlGuid": "8faace2d-a36e-425c-aa58-2ad99e3e0b7a",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/azureFirewalls",
            "recommendationMetadataState": "Active",
            "longDescription": "Creating a metric to monitor latency probes over 20ms for periods longer than 30ms helps identify when firewall instance CPUs are stressed, potentially indicating issues.\n",
            "potentialBenefits": "Improved CPU stress detection",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Well-Architected Framework review - Azure Firewall",
                    "url": "https://learn.microsoft.com/azure/well-architected/service-guides/azure-firewall#recommendations"
                },
                {
                    "name": "Azure Firewall metrics overview",
                    "url": "https://learn.microsoft.com/azure/firewall/metrics"
                }
            ],
            "service": "Microsoft.Network/azureFirewalls",
            "text": "Monitor \"AZFW Latency Probe\" metric",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "8faace2d-a36e-425c-aa58-2ad99e3e0b7a",
            "source": "azure-resources/Network/azureFirewalls/recommendations.yaml",
            "graph": "// under development\n\n"
        },
        {
            "description": "ExpressRoute gateways facilitate network traffic and route exchanges. FastPath enhances on-premises to virtual network data path performance by directing traffic straight to virtual machines, bypassing the gateway for improved resiliency through reduced gateway utilization.\n",
            "aprlGuid": "f6a14b32-a727-4ace-b5fa-7b1c6bdff402",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/connections",
            "recommendationMetadataState": "Active",
            "longDescription": "ExpressRoute gateways facilitate network traffic and route exchanges. FastPath enhances on-premises to virtual network data path performance by directing traffic straight to virtual machines, bypassing the gateway for improved resiliency through reduced gateway utilization.\n",
            "potentialBenefits": "Enhances speed and resiliency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "About ExpressRoute FastPath",
                    "url": "https://learn.microsoft.com/en-us/azure/expressroute/about-fastpath"
                }
            ],
            "service": "Microsoft.Network/connections",
            "text": "For better data path performance enable FastPath on ExpressRoute Direct and Gateway",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "f6a14b32-a727-4ace-b5fa-7b1c6bdff402",
            "source": "azure-resources/Network/connections/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Configure an Azure Resource lock for Gateway Connection resources to prevent accidental deletion and maintain connectivity between on-premises networks and Azure workloads.\n",
            "aprlGuid": "a5f3a4bd-4cf1-4196-a3cb-f5a0876198b2",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/connections",
            "recommendationMetadataState": "Active",
            "longDescription": "Configure an Azure Resource lock for Gateway Connection resources to prevent accidental deletion and maintain connectivity between on-premises networks and Azure workloads.\n",
            "potentialBenefits": "Prevents accidental deletion of connections",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Protect your Azure resources with a lock - Azure Resource Manager | Microsoft Learn",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/lock-resources?tabs=json"
                }
            ],
            "service": "Microsoft.Network/connections",
            "text": "Configure an Azure Resource Lock on connections to prevent accidental deletion",
            "severity": "High",
            "category": "High Availability",
            "guid": "a5f3a4bd-4cf1-4196-a3cb-f5a0876198b2",
            "source": "azure-resources/Network/connections/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Azure DDoS Plan metrics differentiate packets and bytes by tags: Dropped (packets scrubbed by DDoS), Forwarded (packets to VIP not filtered), and No tag (total packets, sum of dropped and forwarded).\n",
            "aprlGuid": "ae054bf2-aefa-cf4a-8282-741194cef8da",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/ddosProtectionPlans",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure DDoS Plan metrics differentiate packets and bytes by tags: Dropped (packets scrubbed by DDoS), Forwarded (packets to VIP not filtered), and No tag (total packets, sum of dropped and forwarded).\n",
            "potentialBenefits": "Enhanced security and traffic insight",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Monitoring Azure DDoS Protection",
                    "url": "https://learn.microsoft.com/en-us/azure/ddos-protection/monitor-ddos-protection-reference"
                }
            ],
            "service": "Microsoft.Network/ddosProtectionPlans",
            "text": "Monitor Azure DDoS Protection Plan metrics",
            "severity": "Medium",
            "category": "Security",
            "guid": "ae054bf2-aefa-cf4a-8282-741194cef8da",
            "source": "azure-resources/Network/ddosProtectionPlans/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Connecting each ExpressRoute Gateway to a minimum of two circuits in different peering locations enhances redundancy and reliability by ensuring alternate pathways for data in case one circuit fails.\n",
            "aprlGuid": "4d703025-dafc-f840-a183-5dc440456134",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/expressRouteCircuits",
            "recommendationMetadataState": "Active",
            "longDescription": "Connecting each ExpressRoute Gateway to a minimum of two circuits in different peering locations enhances redundancy and reliability by ensuring alternate pathways for data in case one circuit fails.\n",
            "potentialBenefits": "Enhanced reliability and redundancy",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Designing for disaster recovery with ExpressRoute private peering",
                    "url": "https://learn.microsoft.com/azure/expressroute/designing-for-disaster-recovery-with-expressroute-privatepeering"
                }
            ],
            "service": "Microsoft.Network/expressRouteCircuits",
            "text": "Connect on-prem networks to Azure critical workloads via multiple ExpressRoutes",
            "severity": "High",
            "category": "High Availability",
            "guid": "4d703025-dafc-f840-a183-5dc440456134",
            "source": "azure-resources/Network/expressRouteCircuits/recommendations.yaml",
            "graph": "// under-development\n"
        },
        {
            "description": "Microsoft or the ExpressRoute provider always ensures physical redundancy in their services. It's essential to maintain this level of physical redundancy (two devices, two links) from the ExpressRoute peering location to your network for optimal performance and reliability.\n",
            "aprlGuid": "0e19cc41-8274-1342-b0db-0e4146eacef8",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/expressRouteCircuits",
            "recommendationMetadataState": "Active",
            "longDescription": "Microsoft or the ExpressRoute provider always ensures physical redundancy in their services. It's essential to maintain this level of physical redundancy (two devices, two links) from the ExpressRoute peering location to your network for optimal performance and reliability.\n",
            "potentialBenefits": "Enhanced reliability and fault tolerance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Designing for high availability with ExpressRoute",
                    "url": "https://learn.microsoft.com/en-us/azure/expressroute/designing-for-high-availability-with-expressroute"
                },
                {
                    "name": "Azure Well-Architected Framework review - Azure ExpressRoute - Design Checklist",
                    "url": "https://learn.microsoft.com/azure/well-architected/services/networking/azure-expressroute#recommendations"
                }
            ],
            "service": "Microsoft.Network/expressRouteCircuits",
            "text": "Ensure ExpressRoute's physical links connect to distinct network edge devices",
            "severity": "High",
            "category": "High Availability",
            "guid": "0e19cc41-8274-1342-b0db-0e4146eacef8",
            "source": "azure-resources/Network/expressRouteCircuits/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Operating both connections of an ExpressRoute circuit in active-active mode enhances high availability as the Microsoft network will load balance the traffic across the connections on a per-flow basis.\n",
            "aprlGuid": "f06a2bbe-5839-d447-9f39-fc3d20562d88",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/expressRouteCircuits",
            "recommendationMetadataState": "Active",
            "longDescription": "Operating both connections of an ExpressRoute circuit in active-active mode enhances high availability as the Microsoft network will load balance the traffic across the connections on a per-flow basis.\n",
            "potentialBenefits": "Improved high availability and load balancing",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Designing for high availability with ExpressRoute - Active-active connections",
                    "url": "https://learn.microsoft.com/azure/expressroute/designing-for-high-availability-with-expressroute#active-active-connections"
                }
            ],
            "service": "Microsoft.Network/expressRouteCircuits",
            "text": "Ensure both connections of an ExpressRoute circuit are configured in active-active mode",
            "severity": "High",
            "category": "High Availability",
            "guid": "f06a2bbe-5839-d447-9f39-fc3d20562d88",
            "source": "azure-resources/Network/expressRouteCircuits/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Enabling BFD over ExpressRoute speeds up link failure detection between MSEE devices and routers configured for ExpressRoute (CE/PE), applicable over both customer and Partner Edge routing devices with managed Layer 3 service.\n",
            "aprlGuid": "2a5bf650-586d-db4c-a292-d922be7d3e0e",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/expressRouteCircuits",
            "recommendationMetadataState": "Active",
            "longDescription": "Enabling BFD over ExpressRoute speeds up link failure detection between MSEE devices and routers configured for ExpressRoute (CE/PE), applicable over both customer and Partner Edge routing devices with managed Layer 3 service.\n",
            "potentialBenefits": "Faster link failure detection",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure BFD over ExpressRoute",
                    "url": "https://learn.microsoft.com/azure/expressroute/expressroute-bfd"
                }
            ],
            "service": "Microsoft.Network/expressRouteCircuits",
            "text": "Activate Bidirectional Forwarding Detection on edge devices for faster failover",
            "severity": "High",
            "category": "High Availability",
            "guid": "2a5bf650-586d-db4c-a292-d922be7d3e0e",
            "source": "azure-resources/Network/expressRouteCircuits/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Use Network Insights for monitoring ExpressRoute circuit availability, QoS, and throughput. Set alerts based on Azure Monitor Baseline Alerts for availability, QoS metrics, and throughput metrics exceeding specific thresholds.\n",
            "aprlGuid": "9771a435-d031-814e-9827-9b5fdafc0f87",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/expressRouteCircuits",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Network Insights for monitoring ExpressRoute circuit availability, QoS, and throughput. Set alerts based on Azure Monitor Baseline Alerts for availability, QoS metrics, and throughput metrics exceeding specific thresholds.\n",
            "potentialBenefits": "Enhanced network performance and health",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Monitor Baseline Alerts - expressRouteCircuits",
                    "url": "https://azure.github.io/azure-monitor-baseline-alerts/services/Network/expressRouteCircuits/"
                }
            ],
            "service": "Microsoft.Network/expressRouteCircuits",
            "text": "Configure monitoring and alerting for ExpressRoute circuits",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "9771a435-d031-814e-9827-9b5fdafc0f87",
            "source": "azure-resources/Network/expressRouteCircuits/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "ExpressRoute leverages service health for notifications on both planned and unplanned maintenance, ensuring users are informed about any changes to their ExpressRoute circuits.\n",
            "aprlGuid": "26cb547f-aabc-dc40-be02-d0a9b6b04b1a",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/expressRouteCircuits",
            "recommendationMetadataState": "Active",
            "longDescription": "ExpressRoute leverages service health for notifications on both planned and unplanned maintenance, ensuring users are informed about any changes to their ExpressRoute circuits.\n",
            "potentialBenefits": "Stay informed on circuit updates",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "How to view and configure alerts for Azure ExpressRoute circuit maintenance",
                    "url": "https://learn.microsoft.com/azure/expressroute/maintenance-alerts"
                }
            ],
            "service": "Microsoft.Network/expressRouteCircuits",
            "text": "Configure service health to receive ExpressRoute circuit maintenance notification",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "26cb547f-aabc-dc40-be02-d0a9b6b04b1a",
            "source": "azure-resources/Network/expressRouteCircuits/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "If you haven't added a second ExpressRoute circuit, use a site-to-site VPN as a temporary solution until the second circuit is available. This ensures network reliability and continuity of service.\n",
            "aprlGuid": "f902cf86-2b53-2942-abc2-781f4fb62be6",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/expressRouteCircuits",
            "recommendationMetadataState": "Active",
            "longDescription": "If you haven't added a second ExpressRoute circuit, use a site-to-site VPN as a temporary solution until the second circuit is available. This ensures network reliability and continuity of service.\n",
            "potentialBenefits": "Ensures continuity and reliability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Using S2S VPN as a backup for ExpressRoute private peering",
                    "url": "https://learn.microsoft.com/azure/expressroute/use-s2s-vpn-as-backup-for-expressroute-privatepeering"
                }
            ],
            "service": "Microsoft.Network/expressRouteCircuits",
            "text": "Use a site-to-site VPN as an interim backup solution for a single ExpressRoute circuit",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "f902cf86-2b53-2942-abc2-781f4fb62be6",
            "source": "azure-resources/Network/expressRouteCircuits/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Rate limiting controls traffic volume between on-premises networks and Azure via ExpressRoute Direct, applying to private or Microsoft peering. It distributes port bandwidth, ensures stability, and prevents congestion, with steps outlined for enabling on circuits.\n",
            "aprlGuid": "d40c769d-2f08-4980-8d8f-a386946276e6",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/expressRouteCircuits",
            "recommendationMetadataState": "Active",
            "longDescription": "Rate limiting controls traffic volume between on-premises networks and Azure via ExpressRoute Direct, applying to private or Microsoft peering. It distributes port bandwidth, ensures stability, and prevents congestion, with steps outlined for enabling on circuits.\n",
            "potentialBenefits": "Optimizes network, prevents congestion",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Rate limiting for ExpressRoute Direct circuits (Preview)",
                    "url": "https://learn.microsoft.com/en-us/azure/expressroute/rate-limit"
                }
            ],
            "service": "Microsoft.Network/expressRouteCircuits",
            "text": "Implement rate-limiting across ExpressRoute Direct Circuits to optimize network flow",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "d40c769d-2f08-4980-8d8f-a386946276e6",
            "source": "azure-resources/Network/expressRouteCircuits/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This query will return all the ExpressRoute circuits (Direct Based) that have Direct Port Rate Limiting disabled\nresources\n| where type =~ \"microsoft.network/expressroutecircuits\"\n| where properties.expressRoutePort != \"\" or isnotnull(properties.expressRoutePort)\n| where properties.enableDirectPortRateLimit == false\n| project recommendationId = \"d40c769d-2f08-4980-8d8f-a386946276e6\", name, id, tags, param1=strcat(\"enableDirectPortRateLimit: \",properties.enableDirectPortRateLimit)\n"
        },
        {
            "description": "In Azure ExpressRoute Direct, the \"Admin State\" indicates the administrative status of layer 1 links, showing if a link is enabled or disabled, effectively turning the physical port on or off.\n",
            "aprlGuid": "60077378-7cb1-4b35-89bb-393884d9921d",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/ExpressRoutePorts",
            "recommendationMetadataState": "Active",
            "longDescription": "In Azure ExpressRoute Direct, the \"Admin State\" indicates the administrative status of layer 1 links, showing if a link is enabled or disabled, effectively turning the physical port on or off.\n",
            "potentialBenefits": "Ensures optimal connectivity.",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "How to configure ExpressRoute Direct Change Admin State of links",
                    "url": "https://learn.microsoft.com/en-us/azure/expressroute/expressroute-howto-erdirect#state"
                }
            ],
            "service": "Microsoft.Network/ExpressRoutePorts",
            "text": "The Admin State of both Links of an ExpressRoute Direct should be in Enabled state",
            "severity": "High",
            "category": "High Availability",
            "guid": "60077378-7cb1-4b35-89bb-393884d9921d",
            "source": "azure-resources/Network/expressRoutePorts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Express Route Directs that do not have Admin State of both Links Enabled\nresources\n| where type == \"microsoft.network/expressrouteports\"\n| where properties['links'][0]['properties']['adminState'] == \"Disabled\" or properties['links'][1]['properties']['adminState'] == \"Disabled\"\n| project recommendationId = \"60077378-7cb1-4b35-89bb-393884d9921d\", name, id, tags, param1 = strcat(\"Link1AdminState: \", properties['links'][0]['properties']['adminState']), param2 = strcat(\"Link2AdminState: \", properties['links'][1]['properties']['adminState'])\n\n"
        },
        {
            "description": "Provisioning ExpressRoute circuits on a 10-Gbps or 100-Gbps ExpressRoute Direct resource up to 20-Gbps or 200-Gbps is possible but not recommended for resiliency. If an ExpressRoute Direct port fails, and circuits are using full capacity, the remaining port won't handle the extra load.\n",
            "aprlGuid": "0bee356b-7348-4799-8cab-0c71ffe13018",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/ExpressRoutePorts",
            "recommendationMetadataState": "Active",
            "longDescription": "Provisioning ExpressRoute circuits on a 10-Gbps or 100-Gbps ExpressRoute Direct resource up to 20-Gbps or 200-Gbps is possible but not recommended for resiliency. If an ExpressRoute Direct port fails, and circuits are using full capacity, the remaining port won't handle the extra load.\n",
            "potentialBenefits": "Improves resilience during port failures",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "About ExpressRoute Direct Circuit Sizes",
                    "url": "https://learn.microsoft.com/en-us/azure/expressroute/expressroute-erdirect-about?source=recommendations#circuit-sizes"
                }
            ],
            "service": "Microsoft.Network/ExpressRoutePorts",
            "text": "Ensure you do not over-subscribe an ExpressRoute Direct",
            "severity": "High",
            "category": "Scalability",
            "guid": "0bee356b-7348-4799-8cab-0c71ffe13018",
            "source": "azure-resources/Network/expressRoutePorts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Express Route Directs that are over subscribed\nresources\n| where type == \"microsoft.network/expressrouteports\"\n| where toint(properties['provisionedBandwidthInGbps']) > toint(properties['bandwidthInGbps'])\n| project recommendationId = \"0bee356b-7348-4799-8cab-0c71ffe13018\", name, id, tags, param1 = strcat(\"provisionedBandwidthInGbps: \", properties['provisionedBandwidthInGbps']), param2 = strcat(\"bandwidthInGbps: \", properties['bandwidthInGbps'])\n\n"
        },
        {
            "description": "Use Network Insights for monitoring ExpressRoute Port light levels, bits per second in/out, and line protocol. Set alerts based on Azure Monitor Baseline Alerts for light levels, bits per second in/out, and line protocol exceeding specific thresholds.\n",
            "aprlGuid": "55815823-d588-4cb7-a5b8-ae581837356e",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/expressRoutePorts",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Network Insights for monitoring ExpressRoute Port light levels, bits per second in/out, and line protocol. Set alerts based on Azure Monitor Baseline Alerts for light levels, bits per second in/out, and line protocol exceeding specific thresholds.\n",
            "potentialBenefits": "Enhanced network performance and health",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Monitor Baseline Alerts - expressRoutePorts",
                    "url": "https://azure.github.io/azure-monitor-baseline-alerts/services/Network/expressRoutePorts/"
                }
            ],
            "service": "Microsoft.Network/expressRoutePorts",
            "text": "Configure monitoring and alerting for ExpressRoute Ports",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "55815823-d588-4cb7-a5b8-ae581837356e",
            "source": "azure-resources/Network/expressRoutePorts/recommendations.yaml",
            "graph": "// under-development\n"
        },
        {
            "description": "WAF may mistakenly block legitimate requests (false positives). These can be identified by examining the last 24 hours of blocked requests in Log Analytics.\n",
            "aprlGuid": "d0cfe47f-686b-5043-bf83-5a3868acb80a",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/frontdoorWebApplicationFirewallPolicies",
            "recommendationMetadataState": "Active",
            "longDescription": "WAF may mistakenly block legitimate requests (false positives). These can be identified by examining the last 24 hours of blocked requests in Log Analytics.\n",
            "potentialBenefits": "Reduces false positives, improves access",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Web Application Firewall monitoring and logging - Access Log",
                    "url": "https://learn.microsoft.com/azure/web-application-firewall/afds/waf-front-door-monitor?pivots=front-door-standard-premium#access-logs"
                },
                {
                    "name": "Understanding WAF logs",
                    "url": "https://learn.microsoft.com/azure/web-application-firewall/afds/waf-front-door-tuning?pivots=front-door-standard-premium#understanding-waf-logs"
                },
                {
                    "name": "Web Application Firewall exclusion lists",
                    "url": "https://learn.microsoft.com/azure/web-application-firewall/ag/application-gateway-waf-configuration?tabs=portal"
                },
                {
                    "name": "Fixing a false positive",
                    "url": "https://learn.microsoft.com/azure/web-application-firewall/ag/web-application-firewall-troubleshoot#fixing-false-positives"
                }
            ],
            "service": "Microsoft.Network/frontdoorWebApplicationFirewallPolicies",
            "text": "Inspect Azure Front Door WAF logs for wrongfully blocked legitimate requests",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "d0cfe47f-686b-5043-bf83-5a3868acb80a",
            "source": "azure-resources/Network/frontDoorWebApplicationFirewallPolicies/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "WAF may block legitimate requests as false positives. Identifying blocked requests within the last 24 hours through Log Analytics can help manage and mitigate these incorrect blockages efficiently.\n",
            "aprlGuid": "537b4d94-edd1-4041-b13d-8217dfa485f0",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/frontdoorWebApplicationFirewallPolicies",
            "recommendationMetadataState": "Active",
            "longDescription": "WAF may block legitimate requests as false positives. Identifying blocked requests within the last 24 hours through Log Analytics can help manage and mitigate these incorrect blockages efficiently.\n",
            "potentialBenefits": "Improve false positive identification",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Web Application Firewall Monitoring and Logging",
                    "url": "https://learn.microsoft.com/azure/web-application-firewall/ag/application-gateway-waf-metrics#logs-and-diagnostics"
                },
                {
                    "name": "Diagnostic logs",
                    "url": "https://learn.microsoft.com/azure/web-application-firewall/ag/web-application-firewall-logs#diagnostic-logs"
                }
            ],
            "service": "Microsoft.Network/frontdoorWebApplicationFirewallPolicies",
            "text": "Check Azure Application Gateway WAF logs for mistakenly blocked valid requests",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "537b4d94-edd1-4041-b13d-8217dfa485f0",
            "source": "azure-resources/Network/frontDoorWebApplicationFirewallPolicies/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Monitoring the health of your Web Application Firewall and the applications it protects is crucial. This can be achieved through integration with Microsoft Defender for Cloud, Azure Monitor, and Azure Monitor logs, ensuring optimal performance and security.\n",
            "aprlGuid": "5357ae22-0f52-1a49-9fd4-1f00ace6add0",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/frontdoorWebApplicationFirewallPolicies",
            "recommendationMetadataState": "Active",
            "longDescription": "Monitoring the health of your Web Application Firewall and the applications it protects is crucial. This can be achieved through integration with Microsoft Defender for Cloud, Azure Monitor, and Azure Monitor logs, ensuring optimal performance and security.\n",
            "potentialBenefits": "Enhanced security and health insight",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "WAF monitoring",
                    "url": "https://learn.microsoft.com/azure/web-application-firewall/ag/ag-overview#waf-monitoring"
                },
                {
                    "name": "Azure Monitor Workbook for WAF",
                    "url": "https://github.com/Azure/Azure-Network-Security/tree/master/Azure%20WAF/Workbook%20-%20WAF%20Monitor%20Workbook"
                }
            ],
            "service": "Microsoft.Network/frontdoorWebApplicationFirewallPolicies",
            "text": "Monitor Web Application Firewall",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "5357ae22-0f52-1a49-9fd4-1f00ace6add0",
            "source": "azure-resources/Network/frontDoorWebApplicationFirewallPolicies/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Selecting Standard SKU Load Balancer enhances reliability through availability zones and zone resiliency, ensuring deployments withstand zone and region failures. Unlike Basic, it supports global load balancing and offers an SLA.\n",
            "aprlGuid": "38c3bca1-97a1-eb42-8cd3-838b243f35ba",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/loadBalancers",
            "recommendationMetadataState": "Active",
            "longDescription": "Selecting Standard SKU Load Balancer enhances reliability through availability zones and zone resiliency, ensuring deployments withstand zone and region failures. Unlike Basic, it supports global load balancing and offers an SLA.\n",
            "potentialBenefits": "Enhanced reliability and SLA support",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Reliability and Azure Load Balancer",
                    "url": "https://learn.microsoft.com/azure/architecture/framework/services/networking/azure-load-balancer/reliability"
                },
                {
                    "name": "Resiliency checklist for specific Azure services- Azure Load Balancer",
                    "url": "https://learn.microsoft.com/azure/architecture/checklist/resiliency-per-service#azure-load-balancer"
                }
            ],
            "service": "Microsoft.Network/loadBalancers",
            "text": "Use Standard Load Balancer SKU",
            "severity": "High",
            "category": "High Availability",
            "guid": "38c3bca1-97a1-eb42-8cd3-838b243f35ba",
            "source": "azure-resources/Network/loadBalancers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all LoadBalancers using Basic SKU\nresources\n| where type =~ 'Microsoft.Network/loadBalancers'\n| where sku.name == 'Basic'\n| project recommendationId = \"38c3bca1-97a1-eb42-8cd3-838b243f35ba\", name, id, tags, Param1=strcat(\"sku-tier: basic\")\n\n"
        },
        {
            "description": "Deploying Azure Load Balancers with at least two instances in the backend prevents a single point of failure and supports scalability. Pairing with Virtual Machine Scale Sets is advised for optimal scale building.\n",
            "aprlGuid": "6d82d042-6d61-ad49-86f0-6a5455398081",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/loadBalancers",
            "recommendationMetadataState": "Active",
            "longDescription": "Deploying Azure Load Balancers with at least two instances in the backend prevents a single point of failure and supports scalability. Pairing with Virtual Machine Scale Sets is advised for optimal scale building.\n",
            "potentialBenefits": "Enhances reliability and scalability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resiliency checklist for specific Azure services- Azure Load Balancer",
                    "url": "https://learn.microsoft.com/azure/architecture/checklist/resiliency-per-service#azure-load-balancer"
                }
            ],
            "service": "Microsoft.Network/loadBalancers",
            "text": "Ensure the Backend Pool contains at least two instances",
            "severity": "High",
            "category": "High Availability",
            "guid": "6d82d042-6d61-ad49-86f0-6a5455398081",
            "source": "azure-resources/Network/loadBalancers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all LoadBalancers which only have 1 backend pool defined or only 1 VM in the backend pool\nresources\n| where type =~ 'Microsoft.Network/loadBalancers'\n| extend bep = properties.backendAddressPools\n| extend BackEndPools = array_length(bep)\n| where BackEndPools == 0\n| project recommendationId = \"6d82d042-6d61-ad49-86f0-6a5455398081\", name, id, Param1=\"backendPools\", Param2=toint(0), tags\n| union (resources\n  | where type =~ 'Microsoft.Network/loadBalancers'\n  | where sku.name == \"Standard\"\n  | extend bep = properties.backendAddressPools\n  | extend BackEndPools = toint(array_length(bep))\n  | mv-expand bip = properties.backendAddressPools\n  | extend BackendAddresses = array_length(bip.properties.loadBalancerBackendAddresses)\n  | where toint(BackendAddresses) <= 1\n  | project recommendationId = \"6d82d042-6d61-ad49-86f0-6a5455398081\", name, id, tags, Param1=\"backendAddresses\", Param2=toint(BackendAddresses))\n| union (\n  resources\n  | where type =~ 'Microsoft.Network/loadBalancers'\n  | where sku.name == \"Basic\"\n  | mv-expand properties.backendAddressPools\n  | extend backendPoolId = properties_backendAddressPools.id\n  | project id, name, tags, tostring(backendPoolId), recommendationId = \"6d82d042-6d61-ad49-86f0-6a5455398081\", Param1=\"BackEndPools\"\n  | join kind = leftouter (\n  resources\n  | where type =~ \"Microsoft.Network/networkInterfaces\"\n  | mv-expand properties.ipConfigurations\n  | mv-expand properties_ipConfigurations.properties.loadBalancerBackendAddressPools\n  | extend backendPoolId = tostring(properties_ipConfigurations_properties_loadBalancerBackendAddressPools.id)\n  | summarize poolMembers = count() by backendPoolId\n  | project tostring(backendPoolId), poolMembers ) on backendPoolId\n  | where toint(poolMembers) <= 1\n  | extend BackendAddresses = poolMembers\n  | project id, name, tags, recommendationId, Param1=\"backendAddresses\", Param2=toint(BackendAddresses))\n"
        },
        {
            "description": "Outbound rules for Standard Public Load Balancer involve manual port allocation for backend pools, limiting scalability and risk of SNAT port exhaustion. NAT Gateway is recommended for its dynamic scaling and secure internet connectivity.\n",
            "aprlGuid": "8d319a05-677b-944f-b9b4-ca0fb42e883c",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/loadBalancers",
            "recommendationMetadataState": "Active",
            "longDescription": "Outbound rules for Standard Public Load Balancer involve manual port allocation for backend pools, limiting scalability and risk of SNAT port exhaustion. NAT Gateway is recommended for its dynamic scaling and secure internet connectivity.\n",
            "potentialBenefits": "Enhanced scalability and reliability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resiliency checklist for specific Azure services- Azure Load Balancer",
                    "url": "https://learn.microsoft.com/azure/architecture/checklist/resiliency-per-service#azure-load-balancer"
                }
            ],
            "service": "Microsoft.Network/loadBalancers",
            "text": "Use NAT Gateway instead of Outbound Rules for Production Workloads",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "8d319a05-677b-944f-b9b4-ca0fb42e883c",
            "source": "azure-resources/Network/loadBalancers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all LoadBalancers with Outbound rules configured\nresources\n| where type =~ 'Microsoft.Network/loadBalancers'\n| extend outboundRules = array_length(properties.outboundRules)\n| where outboundRules > 0\n| project recommendationId = \"8d319a05-677b-944f-b9b4-ca0fb42e883c\", name, id, tags, Param1 = \"outboundRules: >=1\"\n\n"
        },
        {
            "description": "In regions with Availability Zones, assigning a zone-redundant frontend IP to a Standard Load Balancer ensures continuous traffic distribution even if one availability zone fails, provided other healthy zones and backend instances are available to receive the traffic.\n",
            "aprlGuid": "621dbc78-3745-4d32-8eac-9e65b27b7512",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/loadBalancers",
            "recommendationMetadataState": "Active",
            "longDescription": "In regions with Availability Zones, assigning a zone-redundant frontend IP to a Standard Load Balancer ensures continuous traffic distribution even if one availability zone fails, provided other healthy zones and backend instances are available to receive the traffic.\n",
            "potentialBenefits": "Enhances uptime and resilience",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Load Balancer and Availability Zones",
                    "url": "https://learn.microsoft.com/en-us/azure/load-balancer/load-balancer-standard-availability-zones#zone-redundant"
                }
            ],
            "service": "Microsoft.Network/loadBalancers",
            "text": "Ensure Standard Load Balancer is zone-redundant",
            "severity": "High",
            "category": "High Availability",
            "guid": "621dbc78-3745-4d32-8eac-9e65b27b7512",
            "source": "azure-resources/Network/loadBalancers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all LoadBalancers with with regional or zonal public IP Addresses\nresources\n| where type == \"microsoft.network/loadbalancers\"\n| where tolower(sku.name) != 'basic'\n| mv-expand feIPconfigs = properties.frontendIPConfigurations\n| extend\n    feConfigName = (feIPconfigs.name),\n    PrivateSubnetId = toupper(feIPconfigs.properties.subnet.id),\n    PrivateIPZones = feIPconfigs.zones,\n    PIPid = toupper(feIPconfigs.properties.publicIPAddress.id),\n    JoinID = toupper(id)\n| where isnotempty(PrivateSubnetId)\n| where isnull(PrivateIPZones) or array_length(PrivateIPZones) < 2\n| project name, feConfigName, id\n| union (resources\n    | where type == \"microsoft.network/loadbalancers\"\n    | where tolower(sku.name) != 'basic'\n    | mv-expand feIPconfigs = properties.frontendIPConfigurations\n    | extend\n        feConfigName = (feIPconfigs.name),\n        PIPid = toupper(feIPconfigs.properties.publicIPAddress.id),\n        JoinID = toupper(id)\n    | where isnotempty(PIPid)\n    | join kind=innerunique (\n        resources\n        | where type == \"microsoft.network/publicipaddresses\"\n        | where isnull(zones) or array_length(zones) < 2\n        | extend\n            LBid = toupper(substring(properties.ipConfiguration.id, 0, indexof(properties.ipConfiguration.id, '/frontendIPConfigurations'))),\n            InnerID = toupper(id)\n    ) on $left.PIPid == $right.InnerID)\n| project recommendationId = \"621dbc78-3745-4d32-8eac-9e65b27b7512\", name, id, tags, param1=\"Zones: No Zone or Zonal\", param2=strcat(\"Frontend IP Configuration:\", \" \", feConfigName)\n\n"
        },
        {
            "description": "Health probes are used by Azure Load Balancers to determine the status of backend endpoints. Using custom health probes that are aligned with vendor recommendations enhances understanding of backend availability and facilitates monitoring of backend services for any impact.\n",
            "aprlGuid": "e5f5fcea-f925-4578-8599-9a391e888a60",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/loadBalancers",
            "recommendationMetadataState": "Active",
            "longDescription": "Health probes are used by Azure Load Balancers to determine the status of backend endpoints. Using custom health probes that are aligned with vendor recommendations enhances understanding of backend availability and facilitates monitoring of backend services for any impact.\n",
            "potentialBenefits": "Ensures backend uptime monitoring.",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Load Balancer Health Probe Overview",
                    "url": "https://learn.microsoft.com/en-us/azure/load-balancer/load-balancer-custom-probe-overview"
                }
            ],
            "service": "Microsoft.Network/loadBalancers",
            "text": "Use Health Probes to detect backend instances availability",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "e5f5fcea-f925-4578-8599-9a391e888a60",
            "source": "azure-resources/Network/loadBalancers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// List the load balancers which don't have health probe configured\nresources\n| where type =~ \"microsoft.network/loadbalancers\"\n| where array_length(properties.probes) == 0\n| project recommendationId=\"e5f5fcea-f925-4578-8599-9a391e888a60\", name, id, tags, param1=\"customHealthProbeUsed: false\"\n"
        },
        {
            "description": "NAT Gateway provides 64,512 SNAT ports per public IP address and supports up to 16 public IP addresses. Monitor \"Total SNAT connection count\" metric to determine if you're nearing the connection limit of NAT gateway. You can scale the NAT gateway by adding more public IP addresses.\n",
            "aprlGuid": "4281631c-3d19-4994-8d96-084c2a51a534",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/natGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "NAT Gateway provides 64,512 SNAT ports per public IP address and supports up to 16 public IP addresses. Monitor \"Total SNAT connection count\" metric to determine if you're nearing the connection limit of NAT gateway. You can scale the NAT gateway by adding more public IP addresses.\n",
            "potentialBenefits": "Enhances reliability and scalability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Scale a NAT gateway to meet the demand of a dynamic workload",
                    "url": "https://learn.microsoft.com/en-us/azure/nat-gateway/nat-gateway-design#scale-a-nat-gateway-to-meet-the-demand-of-a-dynamic-workload"
                },
                {
                    "name": "Total SNAT Connection Count",
                    "url": "https://learn.microsoft.com/en-us/azure/nat-gateway/nat-metrics#total-snat-connection-count"
                }
            ],
            "service": "Microsoft.Network/natGateways",
            "text": "Scale a NAT gateway to meet the demand of a dynamic workload",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "4281631c-3d19-4994-8d96-084c2a51a534",
            "source": "azure-resources/Network/natGateways/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Use Network Insights for monitoring and alerting on your NAT gateway.Use Total SNAT connection count metric to determine if you're nearing the connection limit of NAT gateway. Set alerts based on Azure Monitor Baseline Alerts (AMBA) thresholds for NAT Gateway\n",
            "aprlGuid": "babf75d6-6407-4d90-b01e-5a1768e621f5",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/natGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Network Insights for monitoring and alerting on your NAT gateway.Use Total SNAT connection count metric to determine if you're nearing the connection limit of NAT gateway. Set alerts based on Azure Monitor Baseline Alerts (AMBA) thresholds for NAT Gateway\n",
            "potentialBenefits": "Enhanced network performance and health",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "What is Azure NAT Gateway metrics and alerts?",
                    "url": "https://learn.microsoft.com/en-us/azure/nat-gateway/nat-metrics"
                },
                {
                    "name": "AMBA - NAT Gateway",
                    "url": "https://azure.github.io/azure-monitor-baseline-alerts/services/Network/natGateways/"
                }
            ],
            "service": "Microsoft.Network/natGateways",
            "text": "Configure monitoring and alerting for NAT gateway",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "babf75d6-6407-4d90-b01e-5a1768e621f5",
            "source": "azure-resources/Network/natGateways/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "A zonal promise for zone isolation scenarios exists when a virtual machine instance using a NAT gateway resource is in the same zone as the NAT gateway resource and its public IP addresses. The pattern you want to use for zone isolation is creating a \"zonal stack\" per availability zone.\n",
            "aprlGuid": "419df1ea-336b-460a-b6b2-fefe2588fcef",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/natGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "A zonal promise for zone isolation scenarios exists when a virtual machine instance using a NAT gateway resource is in the same zone as the NAT gateway resource and its public IP addresses. The pattern you want to use for zone isolation is creating a \"zonal stack\" per availability zone.\n",
            "potentialBenefits": "Enhances reliability and scalability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Zonal NAT gateway resource for each zone in a region to create zone-resiliency",
                    "url": "https://learn.microsoft.com/en-us/azure/nat-gateway/nat-availability-zones#zonal-nat-gateway-resource-for-each-zone-in-a-region-to-create-zone-resiliency"
                }
            ],
            "service": "Microsoft.Network/natGateways",
            "text": "Consider zonal NAT gateway deployment for zone isolation scenarios",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "419df1ea-336b-460a-b6b2-fefe2588fcef",
            "source": "azure-resources/Network/natGateways/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Resource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations.\n",
            "aprlGuid": "d2976d3e-294b-4b49-a1f0-c42566a3758f",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/networkSecurityGroups",
            "recommendationMetadataState": "Active",
            "longDescription": "Resource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations.\n",
            "potentialBenefits": "Enhanced monitoring and security insights",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Diagnostic settings in Azure Monitor",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/essentials/diagnostic-settings"
                }
            ],
            "service": "Microsoft.Network/networkSecurityGroups",
            "text": "Configure Diagnostic Settings for all network security groups",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "d2976d3e-294b-4b49-a1f0-c42566a3758f",
            "source": "azure-resources/Network/networkSecurityGroups/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Create Alerts with Azure Monitor for operations like creating or updating Network Security Group rules to catch unauthorized/undesired changes to resources and spot attempts to bypass firewalls or access resources from the outside.\n",
            "aprlGuid": "8bb4a57b-55e4-d24e-9c19-2679d8bc779f",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Network/networkSecurityGroups",
            "recommendationMetadataState": "Active",
            "longDescription": "Create Alerts with Azure Monitor for operations like creating or updating Network Security Group rules to catch unauthorized/undesired changes to resources and spot attempts to bypass firewalls or access resources from the outside.\n",
            "potentialBenefits": "Enhanced security and change monitoring",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Monitor activity log",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/essentials/activity-log?tabs=powershell"
                }
            ],
            "service": "Microsoft.Network/networkSecurityGroups",
            "text": "Monitor changes in Network Security Groups with Azure Monitor",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "8bb4a57b-55e4-d24e-9c19-2679d8bc779f",
            "source": "azure-resources/Network/networkSecurityGroups/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Network Security Groups without alerts for modification configured.\nresources\n| where type =~ \"Microsoft.Network/networkSecurityGroups\"\n| project name, id, tags, lowerCaseNsgId = tolower(id)\n| join kind = leftouter (\n    resources\n    | where type =~ \"Microsoft.Insights/activityLogAlerts\" and properties.enabled == true\n    | mv-expand scope = properties.scopes\n    | where scope has \"Microsoft.Network/networkSecurityGroups\"\n    | project alertName = name, conditionJson = dynamic_to_json(properties.condition.allOf), scope\n    | where conditionJson has '\"Administrative\"' and (\n        // Create or Update Network Security Group\n        (conditionJson has '\"Microsoft.Network/networkSecurityGroups/write\"') or\n        // All administrative operations\n        (conditionJson !has '\"Microsoft.Network/networkSecurityGroups/write\"' and conditionJson !has '\"Microsoft.Network/networkSecurityGroups/delete\"' and conditionJson !has '\"Microsoft.Network/networkSecurityGroups/join/action\"')\n        )\n    | project lowerCaseNsgIdOfScope = tolower(scope)\n    )\n    on $left.lowerCaseNsgId == $right.lowerCaseNsgIdOfScope\n| where isempty(lowerCaseNsgIdOfScope)\n| project recommendationId = \"8bb4a57b-55e4-d24e-9c19-2679d8bc779f\", name, id, tags, param1 = \"ModificationAlert: Not configured/Disabled\"\n\n"
        },
        {
            "description": "As an administrator, you can lock an Azure subscription, resource group, or resource to protect them from accidental deletions and modifications. The lock overrides user permissions. Locks can prevent either deletions or modifications and are known as Delete and Read-only in the portal.\n",
            "aprlGuid": "52ac35e8-9c3e-f84d-8ce8-2fab955333d3",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Network/networkSecurityGroups",
            "recommendationMetadataState": "Active",
            "longDescription": "As an administrator, you can lock an Azure subscription, resource group, or resource to protect them from accidental deletions and modifications. The lock overrides user permissions. Locks can prevent either deletions or modifications and are known as Delete and Read-only in the portal.\n",
            "potentialBenefits": "Prevents accidental edits/deletions",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Lock your resources to protect your infrastructure",
                    "url": "https://learn.microsoft.com/azure/azure-resource-manager/management/lock-resources?toc=%2Fazure%2Fvirtual-network%2Ftoc.json&tabs=json"
                }
            ],
            "service": "Microsoft.Network/networkSecurityGroups",
            "text": "Configure locks for Network Security Groups to avoid accidental changes and/or deletion",
            "severity": "Low",
            "category": "Governance",
            "guid": "52ac35e8-9c3e-f84d-8ce8-2fab955333d3",
            "source": "azure-resources/Network/networkSecurityGroups/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Monitoring, managing, and understanding your network is crucial for protection and optimization. Knowing the current state, who and from where connections are made, open internet ports, expected and irregular behavior, and traffic spikes is essential.\n",
            "aprlGuid": "da1a3c06-d1d5-a940-9a99-fcc05966fe7c",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/networkSecurityGroups",
            "recommendationMetadataState": "Active",
            "longDescription": "Monitoring, managing, and understanding your network is crucial for protection and optimization. Knowing the current state, who and from where connections are made, open internet ports, expected and irregular behavior, and traffic spikes is essential.\n",
            "potentialBenefits": "Enhances security and optimizes network",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Flow logging for network security groups",
                    "url": "https://learn.microsoft.com/azure/network-watcher/network-watcher-nsg-flow-logging-overview"
                }
            ],
            "service": "Microsoft.Network/networkSecurityGroups",
            "text": "Configure NSG Flow Logs",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "da1a3c06-d1d5-a940-9a99-fcc05966fe7c",
            "source": "azure-resources/Network/networkSecurityGroups/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Network Security Groups without NSG Flow logs configured or disabled.\nresources\n| where type =~ \"Microsoft.Network/networkSecurityGroups\"\n| project name, id, tags, lowerCaseNsgId = tolower(id)\n| join kind = leftouter (\n    resources\n    | where type == \"microsoft.network/networkwatchers/flowlogs\" and properties.enabled == true\n    | project flowLogName = name, lowerCaseTargetNsgId = tolower(properties.targetResourceId)\n    )\n    on $left.lowerCaseNsgId == $right.lowerCaseTargetNsgId\n| where isempty(lowerCaseTargetNsgId)\n| project recommendationId = \"da1a3c06-d1d5-a940-9a99-fcc05966fe7c\", name, id, tags, param1 = \"NSGFlowLog: Not configured/Disabled\"\n\n"
        },
        {
            "description": "Azure network security groups filter network traffic between resources in a virtual network, using security rules to allow or deny inbound or outbound traffic based on source, destination, port, and protocol.\n",
            "aprlGuid": "8291c1fa-650c-b44b-b008-4deb7465919d",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/networkSecurityGroups",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure network security groups filter network traffic between resources in a virtual network, using security rules to allow or deny inbound or outbound traffic based on source, destination, port, and protocol.\n",
            "potentialBenefits": "Enhanced traffic control and security",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Security rules",
                    "url": "https://learn.microsoft.com/azure/virtual-network/network-security-groups-overview#security-rules"
                }
            ],
            "service": "Microsoft.Network/networkSecurityGroups",
            "text": "The NSG only has Default Security Rules, make sure to configure the necessary rules",
            "severity": "Medium",
            "category": "Security",
            "guid": "8291c1fa-650c-b44b-b008-4deb7465919d",
            "source": "azure-resources/Network/networkSecurityGroups/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This query will return all NSGs that have NO security rules\nresources\n| where type =~ \"microsoft.network/networksecuritygroups\"\n| extend sr = string_size(properties.securityRules)\n| where sr <=2 or isnull(properties.securityRules)\n| project recommendationId = \"8291c1fa-650c-b44b-b008-4deb7465919d\", name, id\n\n"
        },
        {
            "description": "Azure Network Watcher offers tools for monitoring, diagnosing, viewing metrics, and managing logs for IaaS resources. It helps maintain the health of VMs, VNets, application gateways, load balancers, but not for PaaS or Web analytics.\n",
            "aprlGuid": "4e133bd0-8762-bc40-a95b-b29142427d73",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Network/networkWatchers",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Network Watcher offers tools for monitoring, diagnosing, viewing metrics, and managing logs for IaaS resources. It helps maintain the health of VMs, VNets, application gateways, load balancers, but not for PaaS or Web analytics.\n",
            "potentialBenefits": "Enhanced monitoring and diagnostics for Azure IaaS",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "What is Azure Network Watcher?",
                    "url": "https://learn.microsoft.com/azure/network-watcher/network-watcher-overview"
                }
            ],
            "service": "Microsoft.Network/networkWatchers",
            "text": "Deploy Network Watcher in all regions where you have networking services",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "4e133bd0-8762-bc40-a95b-b29142427d73",
            "source": "azure-resources/Network/networkWatchers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This query will return all locations that do not have a Network Watcher deployed\nresources\n| where location != \"global\"\n| union (Resources\n    | where type =~ \"microsoft.network/networkwatchers\")\n| summarize NetworkWatcherCount = countif(type =~ 'Microsoft.Network/networkWatchers') by location\n| where NetworkWatcherCount == 0\n| project recommendationId = \"4e133bd0-8762-bc40-a95b-b29142427d73\", name=location, id=\"n/a\", param1 = strcat(\"LocationMisingNetworkWatcher:\", location)\n\n"
        },
        {
            "description": "Network security group flow logging is a feature of Azure Network Watcher that logs IP traffic info through a network security group. If in Failed state, monitoring data from the associated resource is not collected.\n",
            "aprlGuid": "22a769ed-0ecb-8b49-bafe-8f52e6373d9c",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Network/networkWatchers",
            "recommendationMetadataState": "Active",
            "longDescription": "Network security group flow logging is a feature of Azure Network Watcher that logs IP traffic info through a network security group. If in Failed state, monitoring data from the associated resource is not collected.\n",
            "potentialBenefits": "Ensures IP traffic logging",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Manage NSG flow logs using the Azure portal",
                    "url": "https://learn.microsoft.com/azure/network-watcher/nsg-flow-logging"
                }
            ],
            "service": "Microsoft.Network/networkWatchers",
            "text": "Fix Flow Log configurations in Failed state or Disabled Status",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "22a769ed-0ecb-8b49-bafe-8f52e6373d9c",
            "source": "azure-resources/Network/networkWatchers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This query will return all Network Watcher Flow Logs that are not enabled or in a succeeded state\nresources\n| where type =~ \"microsoft.network/networkwatchers/flowlogs\" and isnotnull(properties)\n| extend targetResourceId = tostring(properties.targetResourceId)\n| extend status = iff(properties.enabled =~ 'true', \"Enabled\", \"Disabled\")\n| extend provisioningState = tostring(properties.provisioningState)\n| extend flowLogType = iff(properties.targetResourceId contains \"Microsoft.Network/virtualNetworks\", 'Virtual network', 'Network security group')\n| where provisioningState != \"Succeeded\" or status != \"Enabled\"\n| project recommendationId = \"22a769ed-0ecb-8b49-bafe-8f52e6373d9c\", name, id, tags, param1 = strcat(\"provisioningState:\", provisioningState), param2=strcat(\"Status:\", status), param3=strcat(\"targetResourceId:\",targetResourceId), param4=strcat(\"flowLogType:\",flowLogType)\n\n"
        },
        {
            "description": "Private DNS zones and records are critical and their deletion can cause service outages. To protect against unauthorized or accidental changes, the Private DNS Zone Contributor role, a built-in role for managing these resources, should be assigned to specific users or groups.\n",
            "aprlGuid": "2820f6d6-a23c-7a40-aec5-506f3bd1aeb6",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/privateDnsZones",
            "recommendationMetadataState": "Active",
            "longDescription": "Private DNS zones and records are critical and their deletion can cause service outages. To protect against unauthorized or accidental changes, the Private DNS Zone Contributor role, a built-in role for managing these resources, should be assigned to specific users or groups.\n",
            "potentialBenefits": "Prevents DNS outages",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Protecting private DNS Zones and Records - Azure DNS",
                    "url": "https://learn.microsoft.com/en-us/azure/dns/dns-protect-private-zones-recordsets"
                }
            ],
            "service": "Microsoft.Network/privateDnsZones",
            "text": "Protect private DNS zones and records",
            "severity": "Medium",
            "category": "Security",
            "guid": "2820f6d6-a23c-7a40-aec5-506f3bd1aeb6",
            "source": "azure-resources/Network/privateDnsZones/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "The records in a private DNS zone are only resolvable from linked virtual networks. You can link a private DNS zone to multiple networks and enable autoregistration to manage DNS records for virtual machines automatically.\n",
            "aprlGuid": "ab896e8c-49b9-2c44-adec-98339aff7821",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/privateDnsZones",
            "recommendationMetadataState": "Active",
            "longDescription": "The records in a private DNS zone are only resolvable from linked virtual networks. You can link a private DNS zone to multiple networks and enable autoregistration to manage DNS records for virtual machines automatically.\n",
            "potentialBenefits": "Enhanced DNS reliability and alerting",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Supported metrics for Microsoft.Network/privateDnsZones",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-monitor/reference/supported-metrics/microsoft-network-privatednszones-metrics"
                }
            ],
            "service": "Microsoft.Network/privateDnsZones",
            "text": "Monitor Private DNS Zones health and set up alerts",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "ab896e8c-49b9-2c44-adec-98339aff7821",
            "source": "azure-resources/Network/privateDnsZones/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Azure Private DNS offers a reliable, secure way to handle domain names within virtual networks, using custom domains instead of default Azure names. Records in these zones aren't internet-accessible, only resolvable within linked virtual networks.\n",
            "aprlGuid": "1e02335c-1f90-fd4e-a5a5-d359c7b22d70",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/privateDnsZones",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure Private DNS offers a reliable, secure way to handle domain names within virtual networks, using custom domains instead of default Azure names. Records in these zones aren't internet-accessible, only resolvable within linked virtual networks.\n",
            "potentialBenefits": "Ensures seamless failover for DNS",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Scenarios for Azure Private DNS zones",
                    "url": "https://learn.microsoft.com/en-us/azure/dns/private-dns-scenarios"
                }
            ],
            "service": "Microsoft.Network/privateDnsZones",
            "text": "Align Production and DR zones with identical workload and resource failover entries",
            "severity": "Medium",
            "category": "Governance",
            "guid": "1e02335c-1f90-fd4e-a5a5-d359c7b22d70",
            "source": "azure-resources/Network/privateDnsZones/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "A private endpoint has two custom properties, static IP address and the network interface name, which must be set at creation. If not in Succeeded state, there may be issues with the endpoint or associated resource.\n",
            "aprlGuid": "b89c9acc-0aba-fb44-9ff2-3dbfcf97dce7",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/privateEndpoints",
            "recommendationMetadataState": "Active",
            "longDescription": "A private endpoint has two custom properties, static IP address and the network interface name, which must be set at creation. If not in Succeeded state, there may be issues with the endpoint or associated resource.\n",
            "potentialBenefits": "Ensure connection availability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Private endpoint connections",
                    "url": "https://learn.microsoft.com/azure/private-link/manage-private-endpoint?tabs=manage-private-link-powershell#private-endpoint-connections"
                }
            ],
            "service": "Microsoft.Network/privateEndpoints",
            "text": "Resolve issues with Private Endpoints in non Succeeded connection state",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "b89c9acc-0aba-fb44-9ff2-3dbfcf97dce7",
            "source": "azure-resources/Network/privateEndpoints/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This query will return all Private Endpoints that are not in a Succeeded state\nresources\n| where type =~ \"microsoft.network/privateendpoints\"\n| where (properties.provisioningState =~ \"Succeeded\" and (properties.privateLinkServiceConnections[0].properties.provisioningState =~ \"Succeeded\" or properties.manualPrivateLinkServiceConnections[0].properties.provisioningState =~ \"Succeeded\")) == false\n| project recommendationId = \"b89c9acc-0aba-fb44-9ff2-3dbfcf97dce7\", name, id, tags, param1 = strcat(\"provisioningState: \", tostring(properties.provisioningState)), param2 = strcat(\"provisioningState: \", tostring(properties.privateLinkServiceConnections[0].properties.provisioningState)), param3 = strcat(\"manualProvisioningState: \", tostring(properties.manualPrivateLinkServiceConnections[0].properties.provisioningState))\n"
        },
        {
            "description": "Public IP addresses in Azure can be of standard SKU, available as non-zonal, zonal, or zone-redundant. Zone-redundant IPs are accessible across all zones, resisting any single zone failure, thereby providing higher resilience.\n",
            "aprlGuid": "c63b81fb-7afc-894c-a840-91bb8a8dcfaf",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/publicIPAddresses",
            "recommendationMetadataState": "Active",
            "longDescription": "Public IP addresses in Azure can be of standard SKU, available as non-zonal, zonal, or zone-redundant. Zone-redundant IPs are accessible across all zones, resisting any single zone failure, thereby providing higher resilience.\n",
            "potentialBenefits": "Enhanced resilience with zone redundancy",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Public IP addresses - Availability Zones",
                    "url": "https://learn.microsoft.com/azure/virtual-network/ip-services/public-ip-addresses#availability-zone"
                },
                {
                    "name": "Upgrading a basic public IP address to Standard SKU",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-network/ip-services/public-ip-basic-upgrade-guidance#steps-to-complete-the-upgrade"
                }
            ],
            "service": "Microsoft.Network/publicIPAddresses",
            "text": "Use Standard SKU and Zone-Redundant IPs when applicable",
            "severity": "High",
            "category": "High Availability",
            "guid": "c63b81fb-7afc-894c-a840-91bb8a8dcfaf",
            "source": "azure-resources/Network/publicIPAddresses/recommendations.yaml",
            "graph": "// Azure Resource Graph query\n// List public IP addresses that are not Zone-Redundant\nResources\n| where type =~ \"Microsoft.Network/publicIPAddresses\" and sku.tier =~ \"Regional\"\n| where isempty(zones) or array_length(zones) <= 1\n| extend az = case(isempty(zones), \"Non-zonal\", array_length(zones) <= 1, strcat(\"Zonal (\", strcat_array(zones, \",\"), \")\"), zones)\n| project recommendationId = \"c63b81fb-7afc-894c-a840-91bb8a8dcfaf\", name, id, tags, param1 = strcat(\"sku: \", sku.name), param2 = strcat(\"availabilityZone: \", az)\n\n"
        },
        {
            "description": "Prevent connectivity failures due to SNAT port exhaustion by employing NAT gateway for outbound traffic from virtual networks, ensuring dynamic scaling and secure internet connections.\n",
            "aprlGuid": "1adba190-5c4c-e646-8527-dd1b2a6d8b15",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/publicIPAddresses",
            "recommendationMetadataState": "Active",
            "longDescription": "Prevent connectivity failures due to SNAT port exhaustion by employing NAT gateway for outbound traffic from virtual networks, ensuring dynamic scaling and secure internet connections.\n",
            "potentialBenefits": "Avoids SNAT port exhaustion risks",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Use NAT GW for outbound connectivity",
                    "url": "https://learn.microsoft.com/azure/advisor/advisor-reference-reliability-recommendations#use-nat-gateway-for-outbound-connectivity"
                },
                {
                    "name": "TCP and SNAT Ports",
                    "url": "https://learn.microsoft.com/azure/architecture/framework/services/compute/azure-app-service/reliability#tcp-and-snat-ports"
                }
            ],
            "service": "Microsoft.Network/publicIPAddresses",
            "text": "Use NAT gateway for outbound connectivity to avoid SNAT Exhaustion",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "1adba190-5c4c-e646-8527-dd1b2a6d8b15",
            "source": "azure-resources/Network/publicIPAddresses/recommendations.yaml",
            "graph": "// Azure Resource Graph query\n// Lists VMs with PIPs\nresources\n| where type =~ 'Microsoft.Network/publicIPAddresses'\n| where tostring(properties.ipConfiguration.id) contains \"microsoft.network/networkinterfaces\"\n| project recommendationId=\"1adba190-5c4c-e646-8527-dd1b2a6d8b15\", name, id, tags, param1=strcat(\"Migrate from instance IP to NAT Gateway\")\n\n"
        },
        {
            "description": "Basic SKU public IP addresses will be retired on September 30, 2025. Users are advised to upgrade to Standard SKU public IP addresses before this date to avoid service disruptions.\n",
            "aprlGuid": "5cea1501-6fe4-4ec4-ac8f-f72320eb18d3",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/publicIPAddresses",
            "recommendationMetadataState": "Active",
            "longDescription": "Basic SKU public IP addresses will be retired on September 30, 2025. Users are advised to upgrade to Standard SKU public IP addresses before this date to avoid service disruptions.\n",
            "potentialBenefits": "Avoids service disruption",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Upgrading a basic public IP address to Standard SKU - Guidance",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-network/ip-services/public-ip-basic-upgrade-guidance"
                },
                {
                    "name": "Upgrade to Standard SKU public IP addresses in Azure by 30 September 2025 as Basic SKU will be retired",
                    "url": "https://azure.microsoft.com/en-us/updates/upgrade-to-standard-sku-public-ip-addresses-in-azure-by-30-september-2025-basic-sku-will-be-retired/"
                }
            ],
            "service": "Microsoft.Network/publicIPAddresses",
            "text": "Upgrade Basic SKU public IP addresses to Standard SKU",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "5cea1501-6fe4-4ec4-ac8f-f72320eb18d3",
            "source": "azure-resources/Network/publicIPAddresses/recommendations.yaml",
            "graph": "// Azure Resource Graph query\n// List Basic SKU public IP addresses\nResources\n| where type =~ \"Microsoft.Network/publicIPAddresses\"\n| where sku.name =~ \"Basic\"\n| project recommendationId = \"5cea1501-6fe4-4ec4-ac8f-f72320eb18d3\", name, id, tags, param1 = strcat(\"sku: \", sku.name)\n\n"
        },
        {
            "description": "DDoS attacks can be targeted at any endpoint that is publicly reachable through the internet.\n",
            "aprlGuid": "c4254c66-b8a5-47aa-82f6-e7d7fb418f47",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/publicIPAddresses",
            "recommendationMetadataState": "Active",
            "longDescription": "DDoS attacks can be targeted at any endpoint that is publicly reachable through the internet.\n",
            "potentialBenefits": "Avoids service disruption",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure DDoS Protection",
                    "url": "https://learn.microsoft.com/en-us/azure/ddos-protection/ddos-protection-overview"
                }
            ],
            "service": "Microsoft.Network/publicIPAddresses",
            "text": "Public IP addresses should have DDoS protection enabled",
            "severity": "Medium",
            "category": "Security",
            "guid": "c4254c66-b8a5-47aa-82f6-e7d7fb418f47",
            "source": "azure-resources/Network/publicIPAddresses/recommendations.yaml",
            "graph": "// Azure Resource Graph query\n// Public IP addresses should have DDoS protection enabled\nresources\n| where type =~ 'Microsoft.Network/publicIPAddresses'\n| where properties.ddosSettings.protectionMode !in~ (\"Enabled\", \"VirtualNetworkInherited\")\n| project recommendationId=\"c4254c66-b8a5-47aa-82f6-e7d7fb418f47\", name, id, tags, param1=strcat(\"Apply either DDoS Network protection or DDoS IP Protrection to the public IP address.\")\n"
        },
        {
            "description": "Create Alerts with Azure Monitor for operations like Create or Update Route Table to spot unauthorized/undesired changes in production resources. This setup aids in identifying improper routing changes, including efforts to evade firewalls or access resources from outside.\n",
            "aprlGuid": "23b2dfc7-7e5d-9443-9f62-980ca621b561",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/routeTables",
            "recommendationMetadataState": "Active",
            "longDescription": "Create Alerts with Azure Monitor for operations like Create or Update Route Table to spot unauthorized/undesired changes in production resources. This setup aids in identifying improper routing changes, including efforts to evade firewalls or access resources from outside.\n",
            "potentialBenefits": "Enhanced security and change detection",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure activity log - Azure Monitor | Microsoft Learn",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log?tabs=powershell"
                }
            ],
            "service": "Microsoft.Network/routeTables",
            "text": "Monitor changes in Route Tables with Azure Monitor",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "23b2dfc7-7e5d-9443-9f62-980ca621b561",
            "source": "azure-resources/Network/routeTables/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Route Tables without alerts for modification configured.\nresources\n| where type =~ \"Microsoft.Network/routeTables\"\n| project name, id, tags, lowerCaseRouteTableId = tolower(id)\n| join kind = leftouter (\n    resources\n    | where type =~ \"Microsoft.Insights/activityLogAlerts\" and properties.enabled == true\n    | mv-expand scope = properties.scopes\n    | where scope has \"Microsoft.Network/routeTables\"\n    | project alertName = name, conditionJson = dynamic_to_json(properties.condition.allOf), scope\n    | where conditionJson has '\"Administrative\"' and (\n        // Create or Update Route Table\n        (conditionJson has '\"Microsoft.Network/routeTables/write\"') or\n        // All Administrative operations\n        (conditionJson !has '\"Microsoft.Network/routeTables/write\"' and conditionJson !has '\"Microsoft.Network/routeTables/delete\"' and conditionJson !has '\"Microsoft.Network/routeTables/join/action\"')\n        )\n    | project lowerCaseRouteTableIdOfScope = tolower(scope)\n    )\n    on $left.lowerCaseRouteTableId == $right.lowerCaseRouteTableIdOfScope\n| where isempty(lowerCaseRouteTableIdOfScope)\n| project recommendationId = \"23b2dfc7-7e5d-9443-9f62-980ca621b561\", name, id, tags, param1 = \"ModificationAlert: Not configured/Disabled\"\n\n"
        },
        {
            "description": "As an administrator, you can protect Azure subscriptions, resource groups, or resources from accidental deletions and modifications by setting locks.\n",
            "aprlGuid": "89d1166a-1a20-0f46-acc8-3194387bf127",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Network/routeTables",
            "recommendationMetadataState": "Active",
            "longDescription": "As an administrator, you can protect Azure subscriptions, resource groups, or resources from accidental deletions and modifications by setting locks.\n",
            "potentialBenefits": "Prevents accidental edits/deletions",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Protect your Azure resources with a lock - Azure Resource Manager | Microsoft Learn",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/lock-resources?toc=%2Fazure%2Fvirtual-network%2Ftoc.json&tabs=json"
                }
            ],
            "service": "Microsoft.Network/routeTables",
            "text": "Configure locks for Route Tables to avoid accidental changes or deletion",
            "severity": "Low",
            "category": "Governance",
            "guid": "89d1166a-1a20-0f46-acc8-3194387bf127",
            "source": "azure-resources/Network/routeTables/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Monitor status should be online to ensure failover for application workload. If Traffic Manager's health shows Degraded, one or more endpoints may also be Degraded.\n",
            "aprlGuid": "f05a3e6d-49db-2740-88e2-2b13706c1f67",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/trafficManagerProfiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Monitor status should be online to ensure failover for application workload. If Traffic Manager's health shows Degraded, one or more endpoints may also be Degraded.\n",
            "potentialBenefits": "Ensures failover functionality",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Traffic Manager endpoint monitoring",
                    "url": "https://learn.microsoft.com/azure/traffic-manager/traffic-manager-monitoring"
                },
                {
                    "name": "Enable or disable health checks",
                    "url": "https://learn.microsoft.com/azure/traffic-manager/traffic-manager-monitoring#enable-or-disable-health-checks-preview"
                },
                {
                    "name": "Troubleshooting degraded state on Azure Traffic Manager",
                    "url": "https://learn.microsoft.com/azure/traffic-manager/traffic-manager-troubleshooting-degraded"
                }
            ],
            "service": "Microsoft.Network/trafficManagerProfiles",
            "text": "Traffic Manager Monitor Status Should be Online",
            "severity": "High",
            "category": "High Availability",
            "guid": "f05a3e6d-49db-2740-88e2-2b13706c1f67",
            "source": "azure-resources/Network/trafficManagerProfiles/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find traffic manager profiles that have an endpoint monitor status of not 'Online'\nresources\n| where type == \"microsoft.network/trafficmanagerprofiles\"\n| mv-expand properties.endpoints\n| where properties_endpoints.properties.endpointMonitorStatus != \"Online\"\n| project recommendationId = \"f05a3e6d-49db-2740-88e2-2b13706c1f67\", name, id, tags, param1 = strcat('Profile name: ',properties_endpoints.name), param2 = strcat('endpointMonitorStatus: ', properties_endpoints.properties.endpointMonitorStatus)\n\n"
        },
        {
            "description": "When configuring the Azure traffic manager, provision at least two endpoints to ensure workloads can fail-over to another instance, enhancing reliability and availability.\n",
            "aprlGuid": "5b422a7f-8caa-3d48-becb-511599e5bba9",
            "recommendationTypeId": "6cd70072-c45c-4716-bf7b-b35c18e46e72",
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/trafficManagerProfiles",
            "recommendationMetadataState": "Active",
            "longDescription": "When configuring the Azure traffic manager, provision at least two endpoints to ensure workloads can fail-over to another instance, enhancing reliability and availability.\n",
            "potentialBenefits": "Enhances failover capabilities",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Traffic Manager Endpoint Types",
                    "url": "https://learn.microsoft.com/azure/traffic-manager/traffic-manager-endpoint-types"
                }
            ],
            "service": "Microsoft.Network/trafficManagerProfiles",
            "text": "Traffic manager profiles should have more than one endpoint",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "5b422a7f-8caa-3d48-becb-511599e5bba9",
            "source": "azure-resources/Network/trafficManagerProfiles/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find traffic manager profiles that have less than 2 endpoints\nresources\n| where type == \"microsoft.network/trafficmanagerprofiles\"\n| where array_length(properties.endpoints) < 2\n| project recommendationId = \"5b422a7f-8caa-3d48-becb-511599e5bba9\", name, id, tags, param1 = strcat('EndpointCount: ', array_length(properties.endpoints))\n\n"
        },
        {
            "description": "Profiles should have multiple endpoints to ensure availability in case an endpoint fails. It's also advised to distribute these endpoints across different regions for enhanced reliability.\n",
            "aprlGuid": "1ad9d7b7-9692-1441-a8f4-93792efbe97a",
            "recommendationTypeId": "0db76759-6d22-4262-93f0-2f989ba2b58e",
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/trafficManagerProfiles",
            "recommendationMetadataState": "Active",
            "longDescription": "Profiles should have multiple endpoints to ensure availability in case an endpoint fails. It's also advised to distribute these endpoints across different regions for enhanced reliability.\n",
            "potentialBenefits": "Enhances availability across regions",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Reliability recommendations",
                    "url": "https://learn.microsoft.com/azure/advisor/advisor-reference-reliability-recommendations#add-at-least-one-more-endpoint-to-the-profile-preferably-in-another-azure-region"
                }
            ],
            "service": "Microsoft.Network/trafficManagerProfiles",
            "text": "Configure at least one endpoint within a another region",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "1ad9d7b7-9692-1441-a8f4-93792efbe97a",
            "source": "azure-resources/Network/trafficManagerProfiles/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "For geographic routing, traffic is directed to endpoints based on specific regions. If a region fails, without a predefined failover, configuring an endpoint to \"All (World)\" for geographic profiles can prevent traffic black holes, ensuring service remains available.\n",
            "aprlGuid": "c31f76a0-48cd-9f44-aa43-99ee904db9bc",
            "recommendationTypeId": "0bbe0a49-3c63-49d3-ab4a-aa24198f03f7",
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/trafficManagerProfiles",
            "recommendationMetadataState": "Active",
            "longDescription": "For geographic routing, traffic is directed to endpoints based on specific regions. If a region fails, without a predefined failover, configuring an endpoint to \"All (World)\" for geographic profiles can prevent traffic black holes, ensuring service remains available.\n",
            "potentialBenefits": "Avoids traffic black holing, ensures availability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Add an endpoint configured to \"All (World)\"",
                    "url": "https://learn.microsoft.com/azure/advisor/advisor-reference-reliability-recommendations#add-an-endpoint-configured-to-all-world"
                },
                {
                    "name": "Traffic Manager profile - GeographicProfile (Add an endpoint configured to \"\"All (World)\"\").",
                    "url": "https://aka.ms/Rf7vc5"
                }
            ],
            "service": "Microsoft.Network/trafficManagerProfiles",
            "text": "Ensure endpoint configured to (All World) for geographic profiles",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "c31f76a0-48cd-9f44-aa43-99ee904db9bc",
            "source": "azure-resources/Network/trafficManagerProfiles/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Traffic Manager resources that are not confirgured for all-World access\nResources\n| where type == 'microsoft.network/trafficmanagerprofiles'\n| where properties.trafficRoutingMethod =~ \"Geographic\"\n| extend endpoints = properties.endpoints\n| mv-expand endpoint = endpoints\n| where endpoint.properties.geoMapping !contains \"WORLD\"\n| extend endpointName = endpoint.name\n| project recommendationId=\"c31f76a0-48cd-9f44-aa43-99ee904db9bc\", name, id, tags, param1=strcat(\"endpointName:\",endpointName), param2=strcat(\"GeoMapping:\", tostring(endpoint.properties.geoMapping))\n"
        },
        {
            "description": "To increase reliability, it's advised that each ExpressRoute gateway connects to at least two circuits, with each circuit originating from a different peering location than the other, ensuring diverse connectivity paths for enhanced resilience.\n",
            "aprlGuid": "d37db635-157f-584d-9bce-4f6fc8c65ce5",
            "recommendationTypeId": "8d61a7d4-5405-4f43-81e3-8c6239b844a6",
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "To increase reliability, it's advised that each ExpressRoute gateway connects to at least two circuits, with each circuit originating from a different peering location than the other, ensuring diverse connectivity paths for enhanced resilience.\n",
            "potentialBenefits": "Enhanced resiliency for Azure service",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Designing for disaster recovery with ExpressRoute private peering",
                    "url": "https://learn.microsoft.com/azure/expressroute/designing-for-disaster-recovery-with-expressroute-privatepeering"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Connect ExpressRoute gateway with circuits from diverse peering locations for resilience",
            "severity": "High",
            "category": "High Availability",
            "guid": "d37db635-157f-584d-9bce-4f6fc8c65ce5",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of ExpressRoute Gateways that are not connected to two or more ExpressRoute Circuits. Baremetal circuits are excluded from consideration\n//This query assumes that the running entity has visibilty to the gateway, connection, and circuit scopes.\n//Start with a full list of gateways\n(resources\n| where type == \"microsoft.network/virtualnetworkgateways\"\n| where properties.gatewayType == \"ExpressRoute\"\n| extend exrGatewayId = tolower(tostring(id))\n| join kind=inner(\nresources\n| where type == \"microsoft.network/virtualnetworkgateways\"\n| where properties.gatewayType == \"ExpressRoute\"\n| extend exrGatewayId = tolower(tostring(id))\n| join kind=leftouter(\n//connections joined with circuit peer info\nresources\n| where type == \"microsoft.network/connections\"\n| extend connectionType = properties.connectionType\n| extend exrGatewayId = tolower(tostring(properties.virtualNetworkGateway1.id))\n| extend peerId = tolower(tostring(properties.peer.id))\n| extend connectionId = tolower(tostring(id))\n| where connectionType == \"ExpressRoute\"\n| join kind=leftouter(\n  resources\n  | where type == \"microsoft.network/expressroutecircuits\"\n    //should this be location instead of peeringLocation\n  | extend circuitId = tolower(tostring(id))\n  | extend peeringLocation = tostring(properties.serviceProviderProperties.peeringLocation)\n  | extend peerId = tolower(id)\n) on peerId ) on exrGatewayId\n//remove bare metal services connections/circuits\n| where not(isnotnull(connectionId) and isnull(sku1))\n//group by gateway ID's and peering locations\n| summarize by exrGatewayId, peeringLocation\n//summarize to connections with fewer than two unique connections\n| summarize connCount = count() by exrGatewayId\n| where connCount < 2) on exrGatewayId\n| project recommendationId = \"d37db635-157f-584d-9bce-4f6fc8c65ce5\", name, id, tags, param1 = \"twoOrMoreCircuitsConnectedFromDifferentPeeringLocations: false\")\n| union\n(\nresources\n| where type == \"microsoft.network/virtualnetworkgateways\"\n| where properties.gatewayType == \"ExpressRoute\"\n| extend exrGatewayId = tolower(tostring(id))\n| join kind=leftouter(\n//connections joined with circuit peer info\nresources\n| where type == \"microsoft.network/connections\"\n| extend connectionType = properties.connectionType\n| extend exrGatewayId = tolower(tostring(properties.virtualNetworkGateway1.id))\n| extend peerId = tolower(tostring(properties.peer.id))\n| extend connectionId = tolower(tostring(id))\n| where connectionType == \"ExpressRoute\") on exrGatewayId\n| where isnull(connectionType)\n| project recommendationId = \"d37db635-157f-584d-9bce-4f6fc8c65ce5\", name, id, tags, param1 = \"twoOrMoreCircuitsConnectedFromDifferentPeeringLocations: false\", param2 = \"noConnectionsOnGateway: true\"\n)\n\n"
        },
        {
            "description": "Azure ExpressRoute gateway offers variable SLAs based on deployment in single or multiple availability zones. To deploy virtual network gateways across zones automatically, use zone-redundant gateways for accessing critical, scalable services with increased resilience.\n",
            "aprlGuid": "bbe668b7-eb5c-c746-8b82-70afdedf0cae",
            "recommendationTypeId": "c9af1ef6-55bc-48af-bfe4-2c80490159f8",
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure ExpressRoute gateway offers variable SLAs based on deployment in single or multiple availability zones. To deploy virtual network gateways across zones automatically, use zone-redundant gateways for accessing critical, scalable services with increased resilience.\n",
            "potentialBenefits": "Enhanced SLA and resilience",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "About ExpressRoute virtual network gateways - Zone-redundant gateway SKUs",
                    "url": "https://learn.microsoft.com/azure/expressroute/expressroute-about-virtual-network-gateways#zrgw"
                },
                {
                    "name": "About zone-redundant virtual network gateway in Azure availability zones",
                    "url": "https://learn.microsoft.com/azure/vpn-gateway/about-zone-redundant-vnet-gateways"
                },
                {
                    "name": "Create a zone-redundant virtual network gateway in Azure Availability Zones",
                    "url": "https://learn.microsoft.com/azure/vpn-gateway/create-zone-redundant-vnet-gateway"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Use Zone-redundant ExpressRoute gateway SKUs",
            "severity": "High",
            "category": "High Availability",
            "guid": "bbe668b7-eb5c-c746-8b82-70afdedf0cae",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// For all VNGs of type ExpressRoute, show any that do not have AZ in the SKU tier\nresources\n| where type =~ \"Microsoft.Network/virtualNetworkGateways\"\n| where properties.gatewayType == \"ExpressRoute\"\n| where properties.sku.tier !contains 'AZ'\n| project recommendationId = \"bbe668b7-eb5c-c746-8b82-70afdedf0cae\", name, id, tags, param1= strcat(\"sku-tier: \" , properties.sku.tier), param2=location\n| order by id asc\n\n"
        },
        {
            "description": "Configuring an Azure Resource lock for ExpressRoute gateway prevents accidental deletion by enabling administrators to lock an Azure subscription, resource group, or resource, thereby protecting them from unintended user deletions and modifications, with the lock overriding all user permissions.\n",
            "aprlGuid": "c0f23a92-d322-4d4d-97e9-a238b5e3bbb8",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Configuring an Azure Resource lock for ExpressRoute gateway prevents accidental deletion by enabling administrators to lock an Azure subscription, resource group, or resource, thereby protecting them from unintended user deletions and modifications, with the lock overriding all user permissions.\n",
            "potentialBenefits": "Prevents accidental deletions",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Protect your Azure resources with a lock - Azure Resource Manager | Microsoft Learn",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/lock-resources?tabs=json"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Configure an Azure Resource lock for ExpressRoute gateway to prevent accidental deletion",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "c0f23a92-d322-4d4d-97e9-a238b5e3bbb8",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Use Network Insights for monitoring ExpressRoute Gateway's health, including availability, performance, and scalability.\n",
            "aprlGuid": "1c34faa8-8b99-974c-adbf-71922eae943c",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Network Insights for monitoring ExpressRoute Gateway's health, including availability, performance, and scalability.\n",
            "potentialBenefits": "Enhanced monitoring and alerting",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "ExpressRoute monitoring, metrics, and alerts | ExpressRoute gateways",
                    "url": "https://learn.microsoft.com/azure/expressroute/expressroute-monitoring-metrics-alerts#expressroute-gateways"
                },
                {
                    "name": "Azure ExpressRoute Insights using Network Insights",
                    "url": "https://learn.microsoft.com/en-us/azure/expressroute/expressroute-network-insights"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Monitor gateway health for ExpressRoute gateways",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "1c34faa8-8b99-974c-adbf-71922eae943c",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// under-development\n\n\n"
        },
        {
            "description": "While multiple VNets can connect via the same ExpressRoute gateway, Microsoft recommends using alternatives like VNet peering, Azure Firewall, NVA, Azure Route Server, site-to-site VPN, virtual WAN, or SD-WAN for VNet-to-VNet communication to optimize network performance and management.\n",
            "aprlGuid": "194c14ac-0d7a-5a48-ae32-75fa450ee564",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "While multiple VNets can connect via the same ExpressRoute gateway, Microsoft recommends using alternatives like VNet peering, Azure Firewall, NVA, Azure Route Server, site-to-site VPN, virtual WAN, or SD-WAN for VNet-to-VNet communication to optimize network performance and management.\n",
            "potentialBenefits": "Enhanced VNet integration efficiency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "About ExpressRoute virtual network gateways - VNet-to-VNet connectivity",
                    "url": "https://learn.microsoft.com/azure/expressroute/expressroute-about-virtual-network-gateways#vnet-to-vnet-connectivity"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Avoid using ExpressRoute circuits for VNet to VNet communication",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "194c14ac-0d7a-5a48-ae32-75fa450ee564",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "ExpressRoute gateways are updated for improved functionality, reliability, performance, and security. Customer-controlled maintenance configuration and scheduling minimize update impact and align with your maintenance windows.\n",
            "aprlGuid": "3e115044-a3aa-433e-be01-ce17d67e50da",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "ExpressRoute gateways are updated for improved functionality, reliability, performance, and security. Customer-controlled maintenance configuration and scheduling minimize update impact and align with your maintenance windows.\n",
            "potentialBenefits": "Minimizes update impact",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure customer-controlled maintenance for your virtual network gateway - ExpressRoute | Microsoft Learn",
                    "url": "https://learn.microsoft.com/en-us/azure/expressroute/customer-controlled-gateway-maintenance#azure-portal-steps"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Configure customer-controlled ExpressRoute gateway maintenance",
            "severity": "High",
            "category": "High Availability",
            "guid": "3e115044-a3aa-433e-be01-ce17d67e50da",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Virtual Network Gateways without Maintenance Configurations\n\nresources\n| where type =~ \"Microsoft.Network/virtualNetworkGateways\"\n| extend resourceId = tolower(id)\n| join kind=leftouter  (\n    maintenanceresources\n    | where type =~ \"Microsoft.Maintenance/configurationAssignments\"\n    | project JsonData = parse_json(properties)\n    | extend maintenanceConfigurationId = tolower(tostring(JsonData.maintenanceConfigurationId))\n    | join kind=inner (\n        resources\n        | where type =~ \"Microsoft.Maintenance/maintenanceConfigurations\"\n        | project maintenanceConfigurationId=tolower(id)\n    ) on maintenanceConfigurationId\n    | project maintenanceConfigurationId, resourceId=tolower(tostring(JsonData.resourceId))\n) on resourceId\n| where isempty(maintenanceConfigurationId)\n| project recommendationId = \"3e115044-a3aa-433e-be01-ce17d67e50da\", name, id, tags, param1= strcat(\"sku-tier: \" , properties.sku.tier), param2=location\n\n"
        },
        {
            "description": "Azure VPN gateway offers variable SLAs based on deployment in one or two availability zones. Deploying zone-redundant virtual network gateways across availability zones ensures zone-resiliency, improving access to mission-critical, scalable services on Azure.\n",
            "aprlGuid": "5b1933a6-90e4-f642-a01f-e58594e5aab2",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure VPN gateway offers variable SLAs based on deployment in one or two availability zones. Deploying zone-redundant virtual network gateways across availability zones ensures zone-resiliency, improving access to mission-critical, scalable services on Azure.\n",
            "potentialBenefits": "Enhanced reliability and scalability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Zone redundant Virtual network gateway in availability zone",
                    "url": "https://learn.microsoft.com/azure/vpn-gateway/about-zone-redundant-vnet-gateways"
                },
                {
                    "name": "Gateway SKU",
                    "url": "https://learn.microsoft.com/azure/vpn-gateway/about-zone-redundant-vnet-gateways#gwskus"
                },
                {
                    "name": "SLA summary for Azure services",
                    "url": "https://www.microsoft.com/licensing/docs/view/Service-Level-Agreements-SLA-for-Online-Services?lang=1"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Choose a Zone-redundant VPN gateway",
            "severity": "High",
            "category": "High Availability",
            "guid": "5b1933a6-90e4-f642-a01f-e58594e5aab2",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// For all VNGs of type Vpn, show any that do not have AZ in the SKU tier\nresources\n| where type =~ \"Microsoft.Network/virtualNetworkGateways\"\n| where properties.gatewayType == \"Vpn\"\n| where properties.sku.tier !contains 'AZ'\n| project recommendationId = \"5b1933a6-90e4-f642-a01f-e58594e5aab2\", name, id, tags, param1= strcat(\"sku-tier: \" , properties.sku.tier), param2=location\n| order by id asc\n\n"
        },
        {
            "description": "The active-active mode is available for all SKUs except Basic, allowing for two Gateway IP configurations and two public IP addresses, enhancing redundancy and traffic handling.\n",
            "aprlGuid": "281a2713-c0e0-3c48-b596-19f590c46671",
            "recommendationTypeId": "c249dc0e-9a17-423e-838a-d72719e8c5dd",
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "The active-active mode is available for all SKUs except Basic, allowing for two Gateway IP configurations and two public IP addresses, enhancing redundancy and traffic handling.\n",
            "potentialBenefits": "Enhanced reliability and network capacity",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Active-active VPN gateway",
                    "url": "https://learn.microsoft.com/azure/vpn-gateway/active-active-portal#gateway"
                },
                {
                    "name": "Gateway SKU",
                    "url": "https://learn.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpn-gateway-settings#gwsku"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Enable Active-Active VPN Gateways for redundancy",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "281a2713-c0e0-3c48-b596-19f590c46671",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Identifies non-active-active VPN type virtual network gateways\nresources\n| where type =~ 'Microsoft.Network/virtualNetworkGateways'\n| where properties.gatewayType =~ \"vpn\"\n| extend gatewayType = properties.gatewayType, vpnType = properties.vpnType, connections = properties.connections, activeactive=properties.activeActive\n| where activeactive == false\n| project recommendationId = \"281a2713-c0e0-3c48-b596-19f590c46671\", name, id, tags\n\n\n"
        },
        {
            "description": "Deploying active-active VPN concentrators and Azure VPN Gateways maximizes resilience and availability using a fully-meshed topology with four IPSec tunnels.\n",
            "aprlGuid": "af11fc4c-c06c-4f4c-b98d-6eee6d5c4c70",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Deploying active-active VPN concentrators and Azure VPN Gateways maximizes resilience and availability using a fully-meshed topology with four IPSec tunnels.\n",
            "potentialBenefits": "Maximizes resilience and availability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Dual-redundancy active-active VPN gateways for both Azure and on-premises networks",
                    "url": "https://learn.microsoft.com/azure/vpn-gateway/vpn-gateway-highlyavailable#dual-redundancy-active-active-vpn-gateways-for-both-azure-and-on-premises-networks"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Deploy active-active VPN concentrators on your premises for maximum resiliency with VPN gateways",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "af11fc4c-c06c-4f4c-b98d-6eee6d5c4c70",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// under-development\n\n\n"
        },
        {
            "description": "Set up monitoring and alerts for Virtual Network Gateway health to utilize a variety of metrics for ensuring operational efficiency and prompt response to any disruptions.\n",
            "aprlGuid": "9eab120e-f6d3-ee49-ba0d-766562ce7df1",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "Set up monitoring and alerts for Virtual Network Gateway health to utilize a variety of metrics for ensuring operational efficiency and prompt response to any disruptions.\n",
            "potentialBenefits": "Improved uptime and issue awareness",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "VPN gateway data reference",
                    "url": "https://learn.microsoft.com/azure/vpn-gateway/monitor-vpn-gateway-reference"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Monitor VPN gateway connections and health",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "9eab120e-f6d3-ee49-ba0d-766562ce7df1",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "VPN gateway leverages service health to inform users about both planned and unplanned maintenance, ensuring they are notified about modifications to their VPN connectivity.\n",
            "aprlGuid": "9186dae0-7ddc-8f4b-bea5-55538cea4893",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "VPN gateway leverages service health to inform users about both planned and unplanned maintenance, ensuring they are notified about modifications to their VPN connectivity.\n",
            "potentialBenefits": "Improves VPN maintenance alerts",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Getting started with Azure Metrics Explorer",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/essentials/metrics-getting-started"
                },
                {
                    "name": "Monitor VPN gateway",
                    "url": "https://learn.microsoft.com/azure/vpn-gateway/monitor-vpn-gateway-reference#metrics"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Enable VPN gateway service health",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "9186dae0-7ddc-8f4b-bea5-55538cea4893",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// under-development\n\n\n"
        },
        {
            "description": "For zone-redundant VPN gateways, always use zone-redundant Standard SKU public IPs to avoid deploying all instances in one zone. This ensures the gateway's reliability, applying to both active-passive (single IP) and active-active (dual IP) setups.\n",
            "aprlGuid": "4bae5a28-5cf4-40d9-bcf1-623d28f6d917",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/virtualNetworkGateways",
            "recommendationMetadataState": "Active",
            "longDescription": "For zone-redundant VPN gateways, always use zone-redundant Standard SKU public IPs to avoid deploying all instances in one zone. This ensures the gateway's reliability, applying to both active-passive (single IP) and active-active (dual IP) setups.\n",
            "potentialBenefits": "Enhanced reliability and disaster recovery",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "About zone-redundant virtual network gateway in Azure availability zones",
                    "url": "https://learn.microsoft.com/azure/vpn-gateway/about-zone-redundant-vnet-gateways"
                }
            ],
            "service": "Microsoft.Network/virtualNetworkGateways",
            "text": "Deploy zone-redundant VPN gateways with zone-redundant Public IP(s)",
            "severity": "High",
            "category": "High Availability",
            "guid": "4bae5a28-5cf4-40d9-bcf1-623d28f6d917",
            "source": "azure-resources/Network/virtualNetworkGateways/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of zone-redundant Azure VPN gateways associated with non-zone-redundant Public IPs\nresources\n| where type =~ \"Microsoft.Network/virtualNetworkGateways\"\n| where properties.gatewayType == \"Vpn\"\n| where properties.sku.tier contains 'AZ'\n| mv-expand ipconfig = properties.ipConfigurations\n| extend pipId = tostring(ipconfig.properties.publicIPAddress.id)\n| join kind=inner (\n    resources\n    | where type == \"microsoft.network/publicipaddresses\"\n    | where isnull(zones) or array_length(zones) < 3   )\n    on $left.pipId == $right.id\n| project recommendationId = \"4bae5a28-5cf4-40d9-bcf1-623d28f6d917\", name, id, tags, param1 = strcat(\"PublicIpAddressName: \", name1), param2 = strcat (\"PublicIpAddressId: \",id1), param3 = strcat (\"PublicIpAddressTags: \",tags1)\n\n"
        },
        {
            "description": "Network security groups and application security groups allow filtering of inbound and outbound traffic by IP, port, and protocol, adding a security layer at the Subnet level.\n",
            "aprlGuid": "f0bf9ae6-25a5-974d-87d5-025abec73539",
            "recommendationTypeId": "eade5b56-eefd-444f-95c8-23f29e5d93cb",
            "recommendationControl": "Security",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Network/virtualNetworks",
            "recommendationMetadataState": "Active",
            "longDescription": "Network security groups and application security groups allow filtering of inbound and outbound traffic by IP, port, and protocol, adding a security layer at the Subnet level.\n",
            "potentialBenefits": "Enhanced subnet security and traffic control",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Virtual Network - Concepts and best practices | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/virtual-network/concepts-and-best-practices"
                },
                {
                    "name": "GatewaySUbnet",
                    "url": "https://learn.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpn-gateway-settings#gwsub"
                },
                {
                    "name": "Can I associate a network security group (NSG) to the RouteServerSubnet?",
                    "url": "https://learn.microsoft.com/en-us/azure/route-server/route-server-faq#can-i-associate-a-network-security-group-nsg-to-the-routeserversubnet"
                },
                {
                    "name": "Are Network Security Groups (NSGs) supported on the AzureFirewallSubnet?",
                    "url": "https://learn.microsoft.com/en-us/azure/firewall/firewall-faq#are-network-security-groups--nsgs--supported-on-the-azurefirewallsubnet"
                }
            ],
            "service": "Microsoft.Network/virtualNetworks",
            "text": "All Subnets should have a Network Security Group associated",
            "severity": "Low",
            "category": "Security",
            "guid": "f0bf9ae6-25a5-974d-87d5-025abec73539",
            "source": "azure-resources/Network/virtualNetworks/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Subnets without NSG associated\nresources\n| where type =~ 'Microsoft.Network/virtualnetworks'\n| mv-expand subnets = properties.subnets\n| extend sn = string_size(subnets.properties.networkSecurityGroup)\n| where sn == 0 and subnets.name !in (\"GatewaySubnet\", \"AzureFirewallSubnet\", \"AzureFirewallManagementSubnet\", \"RouteServerSubnet\")\n| project recommendationId = \"f0bf9ae6-25a5-974d-87d5-025abec73539\", name, id, tags, param1 = strcat(\"SubnetName: \", subnets.name), param2 = \"NSG: False\"\n\n"
        },
        {
            "description": "Azure DDoS Protection offers enhanced mitigation features against DDoS attacks and is auto-tuned to protect specific resources in a virtual network, combined with application design best practices.\n",
            "aprlGuid": "69ea1185-19b7-de40-9da1-9e8493547a5c",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Network/virtualNetworks",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure DDoS Protection offers enhanced mitigation features against DDoS attacks and is auto-tuned to protect specific resources in a virtual network, combined with application design best practices.\n",
            "potentialBenefits": "Enhanced DDoS attack mitigation",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Reliability and Azure Virtual Network - Microsoft Azure Well-Architected Framework | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/architecture/framework/services/networking/azure-virtual-network/reliability"
                }
            ],
            "service": "Microsoft.Network/virtualNetworks",
            "text": "Shield public endpoints in Azure VNets with Azure DDoS Standard Protection Plans",
            "severity": "High",
            "category": "Security",
            "guid": "69ea1185-19b7-de40-9da1-9e8493547a5c",
            "source": "azure-resources/Network/virtualNetworks/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find virtual networks without DDoS Protection\nresources\n| where type =~ 'Microsoft.Network/virtualNetworks'\n| where isnull(properties.enableDdosProtection) or properties.enableDdosProtection contains \"false\"\n| project recommendationId = \"69ea1185-19b7-de40-9da1-9e8493547a5c\", name, id, tags, param1 = strcat(\"EnableDdosProtection: \", properties.enableDdosProtection)\n\n"
        },
        {
            "description": "Use VNet service endpoints only if Private Link isn't available and no data movement concerns. This feature restricts Azure service access to specified VNet and subnet, enhancing network security and isolating service traffic.\n",
            "aprlGuid": "24ae3773-cc2c-3649-88de-c9788e25b463",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Network/virtualNetworks",
            "recommendationMetadataState": "Active",
            "longDescription": "Use VNet service endpoints only if Private Link isn't available and no data movement concerns. This feature restricts Azure service access to specified VNet and subnet, enhancing network security and isolating service traffic.\n",
            "potentialBenefits": "Enhanced security and data isolation",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Virtual Network FAQ | Microsoft Learn",
                    "url": "https://learn.microsoft.com/azure/virtual-network/virtual-networks-faq"
                },
                {
                    "name": "Reliability and Network connectivity - Microsoft Azure Well-Architected Framework | Microsoft LearnNetworking Reliability",
                    "url": "https://learn.microsoft.com/azure/architecture/framework/services/networking/network-connectivity/reliability"
                },
                {
                    "name": "Azure Private Link availability",
                    "url": "https://learn.microsoft.com/en-us/azure/private-link/availability"
                }
            ],
            "service": "Microsoft.Network/virtualNetworks",
            "text": "When available, use Private Endpoints instead of Service Endpoints for PaaS Services",
            "severity": "Medium",
            "category": "Security",
            "guid": "24ae3773-cc2c-3649-88de-c9788e25b463",
            "source": "azure-resources/Network/virtualNetworks/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find Subnets with Service Endpoint enabled for services that offer Private Link\nresources\n| where type =~ 'Microsoft.Network/virtualnetworks'\n| mv-expand subnets = properties.subnets\n| extend se = array_length(subnets.properties.serviceEndpoints)\n| where se >= 1\n| project name, id, tags, subnets, serviceEndpoints=todynamic(subnets.properties.serviceEndpoints)\n| mv-expand serviceEndpoints\n| project name, id, tags, subnetName=subnets.name, serviceName=tostring(serviceEndpoints.service)\n| where serviceName in (parse_json('[\"Microsoft.CognitiveServices\",\"Microsoft.AzureCosmosDB\",\"Microsoft.DBforMariaDB\",\"Microsoft.DBforMySQL\",\"Microsoft.DBforPostgreSQL\",\"Microsoft.EventHub\",\"Microsoft.KeyVault\",\"Microsoft.ServiceBus\",\"Microsoft.Sql\", \"Microsoft.Storage\",\"Microsoft.StorageSync\",\"Microsoft.Synapse\",\"Microsoft.Web\"]'))\n| project recommendationId = \"24ae3773-cc2c-3649-88de-c9788e25b463\", name, id, tags, param1 = strcat(\"subnet=\", subnetName), param2=strcat(\"serviceName=\",serviceName), param3=\"ServiceEndpoints=true\"\n\n"
        },
        {
            "description": "ExpressRoute Traffic Collector samples network flows over ExpressRoute Direct circuits, sending flow logs to a Log Analytics workspace for analysis or export to visualization tools/SIEM.\n",
            "aprlGuid": "1ceea4b5-1d8b-4be0-9bbe-9594557be51a",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.NetworkFunction/azureTrafficCollectors",
            "recommendationMetadataState": "Active",
            "longDescription": "ExpressRoute Traffic Collector samples network flows over ExpressRoute Direct circuits, sending flow logs to a Log Analytics workspace for analysis or export to visualization tools/SIEM.\n",
            "potentialBenefits": "Enhanced network flow analysis and DR readiness",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure ExpressRoute Traffic Collector",
                    "url": "https://learn.microsoft.com/en-us/azure/expressroute/traffic-collector"
                }
            ],
            "service": "Microsoft.NetworkFunction/azureTrafficCollectors",
            "text": "Ensure ExpressRoute Traffic Collector is enabled and configured for ExpressRoute Direct circuits",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "1ceea4b5-1d8b-4be0-9bbe-9594557be51a",
            "source": "azure-resources/NetworkFunction/azureTrafficCollectors/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Data export in a Log Analytics workspace to an Azure Storage account enhances data protection against regional failures by using geo-redundant (GRS) or geo-zone-redundant storage (GZRS), mainly for compliance and integration with other Azure services and tools.\n",
            "aprlGuid": "b36fd2ac-dd83-664a-ab48-ff7b8d3b189d",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.OperationalInsights/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Data export in a Log Analytics workspace to an Azure Storage account enhances data protection against regional failures by using geo-redundant (GRS) or geo-zone-redundant storage (GZRS), mainly for compliance and integration with other Azure services and tools.\n",
            "potentialBenefits": "Enhances compliance and regional fault tolerance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Log Analytics workspace data export in Azure Monitor",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/logs/logs-data-export"
                },
                {
                    "name": "Azure Monitor configuration recommendations",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/best-practices-logs#configuration-recommendations"
                }
            ],
            "service": "Microsoft.OperationalInsights/workspaces",
            "text": "Enable Log Analytics data export to GRS or GZRS",
            "severity": "Medium",
            "category": "Governance",
            "guid": "b36fd2ac-dd83-664a-ab48-ff7b8d3b189d",
            "source": "azure-resources/OperationalInsights/workspaces/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "A health status alert will proactively notify you if a workspace becomes unavailable because of a datacenter or regional failure.\n",
            "aprlGuid": "4b77191c-cc3c-8c4e-844b-0f56d0927890",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.OperationalInsights/workspaces",
            "recommendationMetadataState": "Active",
            "longDescription": "A health status alert will proactively notify you if a workspace becomes unavailable because of a datacenter or regional failure.\n",
            "potentialBenefits": "Early alert for workspace failure",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Monitor Log Analytics workspace health",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/logs/log-analytics-workspace-health"
                },
                {
                    "name": "Azure Monitor configuration recommendations",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/best-practices-logs#configuration-recommendations"
                }
            ],
            "service": "Microsoft.OperationalInsights/workspaces",
            "text": "Create a health status alert rule for your Log Analytics workspace",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "4b77191c-cc3c-8c4e-844b-0f56d0927890",
            "source": "azure-resources/OperationalInsights/workspaces/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Ensure VM failover settings' static IP addresses are available in the failover subnet to maintain consistent IP assignment during failover, with the target VM receiving the same static IP if it's available or the next available IP otherwise. IP adjustments can be made in VM Network settings.\n",
            "aprlGuid": "e93bb813-b356-48f3-9bdf-a06a0a6ba039",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.RecoveryServices/vaults",
            "recommendationMetadataState": "Active",
            "longDescription": "Ensure VM failover settings' static IP addresses are available in the failover subnet to maintain consistent IP assignment during failover, with the target VM receiving the same static IP if it's available or the next available IP otherwise. IP adjustments can be made in VM Network settings.\n",
            "potentialBenefits": "Smooth failover IP management",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Setup network mapping for site recovery",
                    "url": "https://learn.microsoft.com/en-us/azure/site-recovery/azure-to-azure-network-mapping#set-up-ip-addressing-for-target-vms"
                }
            ],
            "service": "Microsoft.RecoveryServices/vaults",
            "text": "Ensure static IP addresses in Site Recovery VM failover settings are available in failover subnet",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "e93bb813-b356-48f3-9bdf-a06a0a6ba039",
            "source": "azure-resources/RecoveryServices/vaults/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Perform a test failover to validate your BCDR strategy and ensure that your applications are functioning correctly in the target region without impacting your production environment. Test your Disaster Recovery plan periodically without any data loss or downtime, using test failovers.\n",
            "aprlGuid": "17e877f7-3a89-4205-8a24-0670de54ddcd",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.RecoveryServices/vaults",
            "recommendationMetadataState": "Active",
            "longDescription": "Perform a test failover to validate your BCDR strategy and ensure that your applications are functioning correctly in the target region without impacting your production environment. Test your Disaster Recovery plan periodically without any data loss or downtime, using test failovers.\n",
            "potentialBenefits": "Ensures BCDR plan accuracy and VM performance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Run a test failover",
                    "url": "https://learn.microsoft.com/en-us/azure/site-recovery/azure-to-azure-tutorial-dr-drill#run-a-test-failover"
                }
            ],
            "service": "Microsoft.RecoveryServices/vaults",
            "text": "Validate VM functionality with a Site Recovery test failover to check performance at target",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "17e877f7-3a89-4205-8a24-0670de54ddcd",
            "source": "azure-resources/RecoveryServices/vaults/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all VMs where replication has been enabled but Test Failover was never performed\nrecoveryservicesresources\n| where type == \"microsoft.recoveryservices/vaults/replicationfabrics/replicationprotectioncontainers/replicationprotecteditems\"\n| where properties.providerSpecificDetails.dataSourceInfo.datasourceType == 'AzureVm' and isnull(properties.lastSuccessfulTestFailoverTime)\n| project recommendationId=\"17e877f7-3a89-4205-8a24-0670de54ddcd\" , name = properties.providerSpecificDetails.recoveryAzureVMName, id=properties.providerSpecificDetails.dataSourceInfo.resourceId\n\n"
        },
        {
            "description": "Classic alerts for Recovery Services vaults in Azure Backup will be retired on 31 March 2026.\n",
            "aprlGuid": "2912472d-0198-4bdc-aa90-37f145790edc",
            "recommendationTypeId": "06578866-1877-41e6-9d22-3ea5122e8048",
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.RecoveryServices/vaults",
            "recommendationMetadataState": "Active",
            "longDescription": "Classic alerts for Recovery Services vaults in Azure Backup will be retired on 31 March 2026.\n",
            "potentialBenefits": "Enhanced, scalable, and consistent alerting.",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Move to Azure monitor Alerts",
                    "url": "https://learn.microsoft.com/azure/backup/move-to-azure-monitor-alerts"
                },
                {
                    "name": "Classic alerts retirement announcement",
                    "url": "https://azure.microsoft.com/updates/transition-to-builtin-azure-monitor-alerts-for-recovery-services-vaults-in-azure-backup-by-31-march-2026/"
                }
            ],
            "service": "Microsoft.RecoveryServices/vaults",
            "text": "Migrate from classic alerts to built-in Azure Monitor alerts for Azure Recovery Services Vaults",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "2912472d-0198-4bdc-aa90-37f145790edc",
            "source": "azure-resources/RecoveryServices/vaults/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This Resource Graph query will return all Recovery services vault with Classic alerts enabled.\nresources\n| where type in~ ('microsoft.recoveryservices/vaults')\n| extend monitoringSettings = parse_json(properties).monitoringSettings\n| extend isUsingClassicAlerts = case(isnull(monitoringSettings),'Enabled',monitoringSettings.classicAlertSettings.alertsForCriticalOperations)\n| extend isUsingJobsAlerts = case(isnull(monitoringSettings), 'Enabled', monitoringSettings.azureMonitorAlertSettings.alertsForAllJobFailures)\n| where isUsingClassicAlerts == 'Enabled'\n| project recommendationId = \"2912472d-0198-4bdc-aa90-37f145790edc\", name, id, tags, param1=strcat(\"isUsingClassicAlerts: \", isUsingClassicAlerts), param2=strcat(\"isUsingJobsAlerts: \", isUsingJobsAlerts)\n\n"
        },
        {
            "description": "Cross Region Restore enables the restoration of Azure VMs in a secondary, Azure paired region, facilitating drills for audit or compliance and allowing recovery of VMs or disks in the event of a primary region disaster. It is an opt-in feature available exclusively for GRS vaults.\n",
            "aprlGuid": "1549b91f-2ea0-4d4f-ba2a-4596becbe3de",
            "recommendationTypeId": "9b1308f1-4c25-4347-a061-7cc5cd6a44ab",
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.RecoveryServices/vaults",
            "recommendationMetadataState": "Active",
            "longDescription": "Cross Region Restore enables the restoration of Azure VMs in a secondary, Azure paired region, facilitating drills for audit or compliance and allowing recovery of VMs or disks in the event of a primary region disaster. It is an opt-in feature available exclusively for GRS vaults.\n",
            "potentialBenefits": "Enhances disaster recovery capabilities",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Set Cross Region Restore",
                    "url": "https://learn.microsoft.com/azure/backup/backup-create-recovery-services-vault#set-cross-region-restore"
                },
                {
                    "name": "Azure Backup Best Practices",
                    "url": "https://learn.microsoft.com/azure/backup/guidance-best-practices"
                },
                {
                    "name": "Minimum Role Requirements for Cross Region Restore",
                    "url": "https://learn.microsoft.com/azure/backup/backup-rbac-rs-vault#minimum-role-requirements-for-azure-vm-backup"
                },
                {
                    "name": "Recovery Services Vault",
                    "url": "https://learn.microsoft.com/azure/backup/backup-azure-arm-vms-prepare"
                }
            ],
            "service": "Microsoft.RecoveryServices/vaults",
            "text": "Enable Cross Region Restore for your GRS Recovery Services Vault",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "1549b91f-2ea0-4d4f-ba2a-4596becbe3de",
            "source": "azure-resources/RecoveryServices/vaults/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Displays all recovery services vaults that do not have cross region restore enabled\nresources\n| where type =~ \"Microsoft.RecoveryServices/vaults\" and\n    properties.redundancySettings.standardTierStorageRedundancy =~ \"GeoRedundant\" and\n    properties.redundancySettings.crossRegionRestore !~ \"Enabled\"\n| extend\n    param1 = strcat(\"CrossRegionRestore: \", properties.redundancySettings.crossRegionRestore),\n    param2 = strcat(\"StorageReplicationType: \", properties.redundancySettings.standardTierStorageRedundancy)\n| project recommendationId = \"1549b91f-2ea0-4d4f-ba2a-4596becbe3de\", name, id, tags, param1, param2\n"
        },
        {
            "description": "With soft delete, if backup data is deleted, the backup data is retained for 14 additional days, allowing the recovery of that backup item with no data loss with no cost to you. Soft delete is enabled by default. Disabling this feature isn't recommended.\n",
            "aprlGuid": "9e39919b-78af-4a0b-b70f-c548dae97c25",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.RecoveryServices/vaults",
            "recommendationMetadataState": "Active",
            "longDescription": "With soft delete, if backup data is deleted, the backup data is retained for 14 additional days, allowing the recovery of that backup item with no data loss with no cost to you. Soft delete is enabled by default. Disabling this feature isn't recommended.\n",
            "potentialBenefits": "Enhances disaster recovery capabilities",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Soft Delete for Azure Backup",
                    "url": "https://learn.microsoft.com/azure/backup/backup-azure-security-feature-cloud?tabs=azure-portal"
                }
            ],
            "service": "Microsoft.RecoveryServices/vaults",
            "text": "Enable Soft Delete for Recovery Services Vaults in Azure Backup",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "9e39919b-78af-4a0b-b70f-c548dae97c25",
            "source": "azure-resources/RecoveryServices/vaults/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Azure Recovery Services vaults that do not have soft delete  enabled\nresources\n| where type == \"microsoft.recoveryservices/vaults\"\n| mv-expand issoftDelete=properties.securitySettings.softDeleteSettings.softDeleteState\n| where issoftDelete == 'Disabled'\n| project recommendationId = \"9e39919b-78af-4a0b-b70f-c548dae97c25\", name, id, tags, param1=strcat(\"Soft Delete: \",issoftDelete)\n"
        },
        {
            "description": "Ensure resource locations align with their resource group to manage resources during regional outages. ARM stores resource data, which if in an unavailable region, could halt updates, rendering resources read-only.\n",
            "aprlGuid": "98bd7098-49d6-491b-86f1-b143d6b1a0ff",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Resources/resourceGroups",
            "recommendationMetadataState": "Active",
            "longDescription": "Ensure resource locations align with their resource group to manage resources during regional outages. ARM stores resource data, which if in an unavailable region, could halt updates, rendering resources read-only.\n",
            "potentialBenefits": "Improves outage management",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Resource Manager Overview",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/overview#resource-group-location-alignment"
                }
            ],
            "service": "Microsoft.Resources/resourceGroups",
            "text": "Ensure Resource Group and its Resources are located in the same Region",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "98bd7098-49d6-491b-86f1-b143d6b1a0ff",
            "source": "azure-resources/Resources/resourceGroups/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure Resource Groups that have resources deployed in a region different than the Resource Group region\nresources\n| project id, name, tags, resourceGroup, location\n| where location != \"global\"                                                                                                          // exclude global resources\n| where resourceGroup != \"networkwatcherrg\"                                                                                           // exclude networkwatcherrg\n| where split(id, \"/\", 3)[0] =~ \"resourceGroups\"                                                                                      // resource is in a resource group\n| extend resourceGroupId = strcat_array(array_slice(split(id, \"/\"),0,4), \"/\")                                                         // create resource group resource id\n| join (resourcecontainers | project containerid=id, containerlocation=location ) on $left.resourceGroupId == $right.['containerid']  // join to resourcecontainers table\n| where  location != containerlocation\n| project recommendationId=\"98bd7098-49d6-491b-86f1-b143d6b1a0ff\", name, id, tags\n| order by id asc\n\n"
        },
        {
            "description": "Use Service Bus with zone redundancy for high availability. The Premium SKU supports availability zones, ensuring isolation within the same region. It manages 3 copies of the messaging store, kept in sync.\n",
            "aprlGuid": "20057905-262c-49fe-a9be-49f423afb359",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ServiceBus/namespaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Service Bus with zone redundancy for high availability. The Premium SKU supports availability zones, ensuring isolation within the same region. It manages 3 copies of the messaging store, kept in sync.\n",
            "potentialBenefits": "Enhances fault tolerance and uptime",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Service Bus and reliability",
                    "url": "https://learn.microsoft.com/en-us/azure/well-architected/services/messaging/service-bus/reliability"
                },
                {
                    "name": "Azure Service Bus Geo-disaster recovery",
                    "url": "https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-geo-dr#availability-zones"
                },
                {
                    "name": "Insulate Azure Service Bus applications against outages and disasters",
                    "url": "https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-outages-disasters"
                }
            ],
            "service": "Microsoft.ServiceBus/namespaces",
            "text": "Enable Availability Zones for Service Bus namespaces",
            "severity": "High",
            "category": "High Availability",
            "guid": "20057905-262c-49fe-a9be-49f423afb359",
            "source": "azure-resources/ServiceBus/namespaces/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Returns Service Bus namespaces that do not have any availability zones enabled\nresources\n| where type =~ 'Microsoft.ServiceBus/namespaces'\n| where properties.zoneRedundant == 'false'\n| project recommendationId = \"20057905-262c-49fe-a9be-49f423afb359\", name, id, tags, param1=strcat(\"zoneRedundant: \", properties.zoneRedundant), param2=strcat(\"SKU: \", sku.name), param3=iff(tolower(sku.name) == 'premium', 'Move Service Bus namespace to a region that supports Availability Zones', 'Migrate to Premium SKU in a region that supports Availability Zones')\n\n"
        },
        {
            "description": "Use Service Bus with auto-scale for high availability. The Premium SKU supports auto-scale, ensuring that the resources are automatically scaled based on the load.\n",
            "aprlGuid": "d810e3a8-600f-4be1-895b-1a93e61d37fd",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.ServiceBus/namespaces",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Service Bus with auto-scale for high availability. The Premium SKU supports auto-scale, ensuring that the resources are automatically scaled based on the load.\n",
            "potentialBenefits": "Ensures high availability and performance",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Service Bus auto-scaling",
                    "url": "https://learn.microsoft.com/azure/service-bus-messaging/automate-update-messaging-units"
                }
            ],
            "service": "Microsoft.ServiceBus/namespaces",
            "text": "Enable auto-scale for production workloads on Service Bus namespaces",
            "severity": "High",
            "category": "High Availability",
            "guid": "d810e3a8-600f-4be1-895b-1a93e61d37fd",
            "source": "azure-resources/ServiceBus/namespaces/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Use SignalR with zone redundancy for production to improve uptime. This feature, available in the Premium tier, is activated upon creating or upgrading to Premium. Standard can upgrade to Premium without downtime.\n",
            "aprlGuid": "6a8b3db9-5773-413a-a127-4f7032f34bbd",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.SignalRService/SignalR",
            "recommendationMetadataState": "Active",
            "longDescription": "Use SignalR with zone redundancy for production to improve uptime. This feature, available in the Premium tier, is activated upon creating or upgrading to Premium. Standard can upgrade to Premium without downtime.\n",
            "potentialBenefits": "Enhances reliability and uptime",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Availability zones support in Azure SignalR Service",
                    "url": "https://learn.microsoft.com/azure/azure-signalr/availability-zones"
                }
            ],
            "service": "Microsoft.SignalRService/SignalR",
            "text": "Enable zone redundancy for SignalR",
            "severity": "High",
            "category": "High Availability",
            "guid": "6a8b3db9-5773-413a-a127-4f7032f34bbd",
            "source": "azure-resources/SignalRService/signalR/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find SignalR instances that are not configured with the Premium tier\nresources\n| where type == \"microsoft.signalrservice/signalr\"\n| where sku.tier != \"Premium\"\n| project recommendationId = \"6a8b3db9-5773-413a-a127-4f7032f34bbd\", name, id, tags, param1 = \"AvailabilityZones: Single Zone\"\n| order by id asc\n\n"
        },
        {
            "description": "Active Geo Replication ensures business continuity by utilizing readable secondary database replicas. In case of primary database failure, manually failover to secondary database. Secondaries, up to four, can be in same/different regions, used for read-only access.\n",
            "aprlGuid": "74c2491d-048b-0041-a140-935960220e20",
            "recommendationTypeId": "2ea11bcb-dfd0-48dc-96f0-beba578b989a",
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Sql/servers",
            "recommendationMetadataState": "Active",
            "longDescription": "Active Geo Replication ensures business continuity by utilizing readable secondary database replicas. In case of primary database failure, manually failover to secondary database. Secondaries, up to four, can be in same/different regions, used for read-only access.\n",
            "potentialBenefits": "Enhanced disaster recovery and read scalability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Active Geo Replication",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-sql/database/active-geo-replication-overview"
                }
            ],
            "service": "Microsoft.Sql/servers",
            "text": "Use Active Geo Replication to Create a Readable Secondary in Another Region",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "74c2491d-048b-0041-a140-935960220e20",
            "source": "azure-resources/Sql/servers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of SQL databases that are not part of Geo Replication.\nresources\n| where type == \"microsoft.sql/servers/databases\"\n| summarize secondaryTypeCount = countif(isnotempty(properties.secondaryType)) by name\n| where secondaryTypeCount == 0\n| join kind=inner (\n    Resources\n    | where type == \"microsoft.sql/servers/databases\"\n) on name\n| extend param1 = \"Not part of Geo Replication\"\n| project recommendationId = \"74c2491d-048b-0041-a140-935960220e20\", name, id, tags, param1\n"
        },
        {
            "description": "Failover Groups facilitate disaster recovery by configuring databases on one logical server to replicate to another region's logical server. This streamlines geo-replicated database management, offering a single endpoint for connection routing to replicated databases if the primary server fails.\n",
            "aprlGuid": "943c168a-2ec2-a94c-8015-85732a1b4859",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Sql/servers",
            "recommendationMetadataState": "Active",
            "longDescription": "Failover Groups facilitate disaster recovery by configuring databases on one logical server to replicate to another region's logical server. This streamlines geo-replicated database management, offering a single endpoint for connection routing to replicated databases if the primary server fails.\n",
            "potentialBenefits": "Improves load balancing and disaster recovery",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "AutoFailover Groups",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-sql/database/auto-failover-group-overview?tabs=azure-powershell"
                },
                {
                    "name": "DR Design",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-sql/database/designing-cloud-solutions-for-disaster-recovery"
                }
            ],
            "service": "Microsoft.Sql/servers",
            "text": "Auto Failover Groups can encompass one or multiple databases, usually used by the same app.",
            "severity": "High",
            "category": "Disaster Recovery",
            "guid": "943c168a-2ec2-a94c-8015-85732a1b4859",
            "source": "azure-resources/Sql/servers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of SQL databases that are not configured to use a failover-group.\nresources\n| where type =~'microsoft.sql/servers/databases'\n| where isnull(properties['failoverGroupId'])\n| project recommendationId = \"943c168a-2ec2-a94c-8015-85732a1b4859\", name, id, tags, param1= strcat(\"databaseId=\", properties['databaseId'])\n"
        },
        {
            "description": "By default, Azure SQL Database premium tier provisions multiple copies within the same region. For geo redundancy, databases can be set as Zone Redundant, distributing copies across Azure Availability Zones to maintain availability during regional outages.\n",
            "aprlGuid": "c0085c32-84c0-c247-bfa9-e70977cbf108",
            "recommendationTypeId": "807e58d0-e385-41ad-987b-4a4b3e3fb563",
            "recommendationControl": "High Availability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Sql/servers",
            "recommendationMetadataState": "Active",
            "longDescription": "By default, Azure SQL Database premium tier provisions multiple copies within the same region. For geo redundancy, databases can be set as Zone Redundant, distributing copies across Azure Availability Zones to maintain availability during regional outages.\n",
            "potentialBenefits": "Enhanced reliability, no extra cost",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Zone Redundant Databases",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-sql/database/high-availability-sla"
                }
            ],
            "service": "Microsoft.Sql/servers",
            "text": "Enable zone redundancy for Azure SQL Database to achieve high availability and resiliency",
            "severity": "Medium",
            "category": "High Availability",
            "guid": "c0085c32-84c0-c247-bfa9-e70977cbf108",
            "source": "azure-resources/Sql/servers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Finds non-zone redundant SQL databases and lists them\nResources\n| where type =~ 'microsoft.sql/servers/databases'\n| where tolower(tostring(properties.zoneRedundant))=~'false'\n|project recommendationId = \"c0085c32-84c0-c247-bfa9-e70977cbf108\", name, id, tags\n\n\n"
        },
        {
            "description": "During transient failures, the application should handle connection retries effectively with Azure SQL Database. No Database layer configuration is needed; instead, the application must be set up for graceful retrying.\n",
            "aprlGuid": "cbb17a29-64fb-c943-95d0-8df814a37c40",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Sql/servers",
            "recommendationMetadataState": "Active",
            "longDescription": "During transient failures, the application should handle connection retries effectively with Azure SQL Database. No Database layer configuration is needed; instead, the application must be set up for graceful retrying.\n",
            "potentialBenefits": "Enhanced connectivity stability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "How to Implement Retry Logic",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-sql/database/troubleshoot-common-connectivity-issues"
                }
            ],
            "service": "Microsoft.Sql/servers",
            "text": "Implement Retry Logic",
            "severity": "High",
            "category": "High Availability",
            "guid": "cbb17a29-64fb-c943-95d0-8df814a37c40",
            "source": "azure-resources/Sql/servers/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Monitoring and alerting are an important part of database operations. When working with Azure SQL Database, make use of Azure Monitor and SQL Insights to ensure that you capture relevant database metrics.\n",
            "aprlGuid": "7e7daec9-6a81-3546-a4cc-9aef72fec1f7",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Sql/servers",
            "recommendationMetadataState": "Active",
            "longDescription": "Monitoring and alerting are an important part of database operations. When working with Azure SQL Database, make use of Azure Monitor and SQL Insights to ensure that you capture relevant database metrics.\n",
            "potentialBenefits": "Quick incident detection and response",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Monitor",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-monitor/insights/azure-sql#analyze-data-and-create-alerts"
                },
                {
                    "name": "Azure SQL Database Monitoring",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-sql/database/monitoring-sql-database-azure-monitor"
                },
                {
                    "name": "Monitoring SQL Database Reference",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-sql/database/monitoring-sql-database-azure-monitor-reference"
                }
            ],
            "service": "Microsoft.Sql/servers",
            "text": "Monitor your Azure SQL Database in Near Real-Time to Detect Reliability Incidents",
            "severity": "High",
            "category": "Monitoring and Alerting",
            "guid": "7e7daec9-6a81-3546-a4cc-9aef72fec1f7",
            "source": "azure-resources/Sql/servers/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of SQL databases that are not configured for monitoring.\nresources\n| where type == \"microsoft.insights/metricalerts\"\n| mv-expand properties.scopes\n| mv-expand properties.criteria.allOf\n| project databaseid = properties_scopes, monitoredMetric = properties_criteria_allOf.metricName\n| where databaseid contains 'databases'\n| summarize monitoredMetrics=make_list(monitoredMetric) by databaseid=tolower(tostring(databaseid))\n| join kind=fullouter   (\n  resources\n  | where type =~ 'microsoft.sql/servers/databases'\n  | project databaseid = tolower(id), name, tags\n) on databaseid\n| where isnull(monitoredMetrics)\n| project recommendationId = \"7e7daec9-6a81-3546-a4cc-9aef72fec1f7\", name, id=databaseid1, tags, param1=strcat(\"MonitoringMetrics=false\" )\n\n"
        },
        {
            "description": "It is highly recommended to use Azure Key Vault (AKV) to store encryption keys related to Always Encrypted configurations, however it is not required. If you are not using AKV, then ensure that your keys are properly backed up and stored in a secure manner.\n",
            "aprlGuid": "d6ef87aa-574e-584e-a955-3e6bb8b5425b",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Sql/servers",
            "recommendationMetadataState": "Active",
            "longDescription": "It is highly recommended to use Azure Key Vault (AKV) to store encryption keys related to Always Encrypted configurations, however it is not required. If you are not using AKV, then ensure that your keys are properly backed up and stored in a secure manner.\n",
            "potentialBenefits": "Enhanced security and data recovery",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Key Vault",
                    "url": "https://learn.microsoft.com/en-us/azure/key-vault/general/overview"
                },
                {
                    "name": "Getting Started with Always Encrypted",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-sql/database/always-encrypted-landing?view=azuresql"
                }
            ],
            "service": "Microsoft.Sql/servers",
            "text": "Back Up Your Keys",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "d6ef87aa-574e-584e-a955-3e6bb8b5425b",
            "source": "azure-resources/Sql/servers/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Redundancy ensures storage accounts meet availability and durability targets amidst failures, weighing lower costs against higher availability. Locally redundant storage offers the least durability at the lowest cost.\n",
            "aprlGuid": "e6c7e1cc-2f47-264d-aa50-1da421314472",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Storage/storageAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Redundancy ensures storage accounts meet availability and durability targets amidst failures, weighing lower costs against higher availability. Locally redundant storage offers the least durability at the lowest cost.\n",
            "potentialBenefits": "High availability and durability for storage",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Storage redundancy",
                    "url": "https://learn.microsoft.com/azure/storage/common/storage-redundancy"
                },
                {
                    "name": "Change the redundancy configuration for a storage account",
                    "url": "https://learn.microsoft.com/azure/storage/common/redundancy-migration"
                }
            ],
            "service": "Microsoft.Storage/storageAccounts",
            "text": "Ensure that storage accounts are zone or region redundant",
            "severity": "High",
            "category": "High Availability",
            "guid": "e6c7e1cc-2f47-264d-aa50-1da421314472",
            "source": "azure-resources/Storage/storageAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This query will return all storage accounts that are not using Zone or Region replication\nResources\n| where type =~ \"Microsoft.Storage/storageAccounts\"\n| where sku.name in~ (\"Standard_LRS\", \"Premium_LRS\")\n| project recommendationId = \"e6c7e1cc-2f47-264d-aa50-1da421314472\", name, id, tags, param1 = strcat(\"sku: \", sku.name)\n\n"
        },
        {
            "description": "Classic storage accounts will be fully retired on August 31, 2024. If you have classic storage accounts, start planning your migration now.\n",
            "aprlGuid": "63ad027e-611c-294b-acc5-8e3234db9a40",
            "recommendationTypeId": "47bb383c-8e25-95f0-c2aa-437add1d87d3",
            "recommendationControl": "Service Upgrade and Retirement",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Storage/storageAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Classic storage accounts will be fully retired on August 31, 2024. If you have classic storage accounts, start planning your migration now.\n",
            "potentialBenefits": "Avoids service retirement issues",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure classic storage accounts retirement announcement",
                    "url": "https://azure.microsoft.com/updates/classic-azure-storage-accounts-will-be-retired-on-31-august-2024/"
                },
                {
                    "name": "Migrate your classic storage accounts to Azure Resource Manager",
                    "url": "https://learn.microsoft.com/azure/storage/common/classic-account-migration-overview"
                }
            ],
            "service": "Microsoft.Storage/storageAccounts",
            "text": "Classic Storage Accounts must be migrated to new Azure Resource Manager resources",
            "severity": "High",
            "category": "Service Upgrade and Retirement",
            "guid": "63ad027e-611c-294b-acc5-8e3234db9a40",
            "source": "azure-resources/Storage/storageAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Azure classic Storage Account\nresources\n| where type =~ 'microsoft.classicstorage/storageaccounts'\n| project recommendationId = '63ad027e-611c-294b-acc5-8e3234db9a40', name, id, tags, param1=type\n\n"
        },
        {
            "description": "Use premium performance block blob storage instead of standard performance storage for workloads that require fast storage response times and/or high transaction rates.\n",
            "aprlGuid": "5587ef77-7a05-a74d-9c6e-449547a12f27",
            "recommendationTypeId": "c6b94711-f1f5-4e7e-9c89-c17ed4190969",
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Storage/storageAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Use premium performance block blob storage instead of standard performance storage for workloads that require fast storage response times and/or high transaction rates.\n",
            "potentialBenefits": "Optimized cost and performance",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Types of storage accounts",
                    "url": "https://learn.microsoft.com/azure/storage/common/storage-account-overview#types-of-storage-accounts"
                },
                {
                    "name": "Scalability and performance targets for standard storage accounts",
                    "url": "https://learn.microsoft.com/azure/storage/common/scalability-targets-standard-account"
                },
                {
                    "name": "Performance and scalability checklist for Blob storage",
                    "url": "https://learn.microsoft.com/azure/storage/blobs/storage-performance-checklist"
                },
                {
                    "name": "Scalability and performance targets for Blob storage",
                    "url": "https://learn.microsoft.com/azure/storage/blobs/scalability-targets"
                },
                {
                    "name": "Premium block blob storage accounts",
                    "url": "https://learn.microsoft.com/azure/storage/blobs/storage-blob-block-blob-premium"
                }
            ],
            "service": "Microsoft.Storage/storageAccounts",
            "text": "Use premium performance block blob storage for high performance workloads",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "5587ef77-7a05-a74d-9c6e-449547a12f27",
            "source": "azure-resources/Storage/storageAccounts/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "The soft delete option enables data recovery if mistakenly deleted, while the Lock feature prevents the accidental deletion of the storage account itself, ensuring additional security and data integrity measures.\n",
            "aprlGuid": "03263c57-c869-3841-9e0a-3dbb9ef3e28d",
            "recommendationTypeId": "42dbf883-9e4b-4f84-9da4-232b87c4b5e9",
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Storage/storageAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "The soft delete option enables data recovery if mistakenly deleted, while the Lock feature prevents the accidental deletion of the storage account itself, ensuring additional security and data integrity measures.\n",
            "potentialBenefits": "Prevents accidental data/account loss",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Soft delete detail docs",
                    "url": "https://learn.microsoft.com//azure/storage/blobs/soft-delete-blob-enable?tabs=azure-portal "
                }
            ],
            "service": "Microsoft.Storage/storageAccounts",
            "text": "Enable Soft Delete to protect your data",
            "severity": "Medium",
            "category": "Disaster Recovery",
            "guid": "03263c57-c869-3841-9e0a-3dbb9ef3e28d",
            "source": "azure-resources/Storage/storageAccounts/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Consider enabling versioning for Azure Storage Accounts to recover from accidental modifications or deletions and manage blob operation latency. Microsoft advises maintaining fewer than 1000 versions per blob to optimize performance. Lifecycle management can help delete old versions automatically.\n",
            "aprlGuid": "8ebda7c0-e0e1-ed45-af59-2d7ea9a1c05d",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Storage/storageAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Consider enabling versioning for Azure Storage Accounts to recover from accidental modifications or deletions and manage blob operation latency. Microsoft advises maintaining fewer than 1000 versions per blob to optimize performance. Lifecycle management can help delete old versions automatically.\n",
            "potentialBenefits": "Recover data, manage latency",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Blob versioning",
                    "url": "https://learn.microsoft.com/azure/storage/blobs/versioning-overview "
                }
            ],
            "service": "Microsoft.Storage/storageAccounts",
            "text": "Enable versioning for accidental modification and keep the number of versions below 1000",
            "severity": "Low",
            "category": "Disaster Recovery",
            "guid": "8ebda7c0-e0e1-ed45-af59-2d7ea9a1c05d",
            "source": "azure-resources/Storage/storageAccounts/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Consider enabling point-in-time restore for standard general purpose v2 accounts with flat namespace to protect against accidental deletion or corruption by restoring block blob data to an earlier state.\n",
            "aprlGuid": "1b965cb9-7629-214e-b682-6bf6e450a100",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Storage/storageAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Consider enabling point-in-time restore for standard general purpose v2 accounts with flat namespace to protect against accidental deletion or corruption by restoring block blob data to an earlier state.\n",
            "potentialBenefits": "Protects data from loss/corruption",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Point-in-time restore for block blobs",
                    "url": "https://learn.microsoft.com/azure/storage/blobs/point-in-time-restore-overview"
                },
                {
                    "name": "Perform a point-in-time restore on block blob data",
                    "url": "https://learn.microsoft.com/azure/storage/blobs/point-in-time-restore-manage?tabs=portal"
                }
            ],
            "service": "Microsoft.Storage/storageAccounts",
            "text": "Enable point-in-time restore for GPv2 accounts to safeguard against data loss",
            "severity": "Low",
            "category": "Disaster Recovery",
            "guid": "1b965cb9-7629-214e-b682-6bf6e450a100",
            "source": "azure-resources/Storage/storageAccounts/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "For critical applications and business processes relying on Azure, monitoring and alerts are crucial. Resource logs are only stored after creating a diagnostic setting to route logs to specified locations, requiring selection of log categories to collect.\n",
            "aprlGuid": "96cb8331-6b06-8242-8ce8-4e2f665dc679",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Storage/storageAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "For critical applications and business processes relying on Azure, monitoring and alerts are crucial. Resource logs are only stored after creating a diagnostic setting to route logs to specified locations, requiring selection of log categories to collect.\n",
            "potentialBenefits": "Enhanced alerting and log analysis",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Monitor Azure Blob Storage",
                    "url": "https://learn.microsoft.com/azure/storage/blobs/monitor-blob-storage"
                },
                {
                    "name": "Best practices for monitoring Azure Blob Storage",
                    "url": "https://learn.microsoft.com/azure/storage/blobs/blob-storage-monitoring-scenarios"
                }
            ],
            "service": "Microsoft.Storage/storageAccounts",
            "text": "Monitor all blob storage accounts",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "96cb8331-6b06-8242-8ce8-4e2f665dc679",
            "source": "azure-resources/Storage/storageAccounts/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "General-purpose v2 accounts are recommended for most storage scenarios offering the latest features or the lowest per-gigabyte pricing. Legacy accounts like Standard general-purpose v1 and Blob Storage aren't advised by Microsoft but may fit specific scenarios.\n",
            "aprlGuid": "2ad78dec-5a4d-4a30-8fd1-8584335ad781",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Storage/storageAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "General-purpose v2 accounts are recommended for most storage scenarios offering the latest features or the lowest per-gigabyte pricing. Legacy accounts like Standard general-purpose v1 and Blob Storage aren't advised by Microsoft but may fit specific scenarios.\n",
            "potentialBenefits": "Latest features, lowest cost",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Legacy storage account types",
                    "url": "https://learn.microsoft.com/azure/storage/common/storage-account-overview#legacy-storage-account-types"
                },
                {
                    "name": "Upgrade to a general-purpose v2 storage account",
                    "url": "https://learn.microsoft.com/azure/storage/common/storage-account-upgrade"
                }
            ],
            "service": "Microsoft.Storage/storageAccounts",
            "text": "Consider upgrading legacy storage accounts to v2 storage accounts",
            "severity": "Low",
            "category": "Scalability",
            "guid": "2ad78dec-5a4d-4a30-8fd1-8584335ad781",
            "source": "azure-resources/Storage/storageAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Find all Azure Storage Accounts, that upgradeable to General purpose v2.\nResources\n| where type =~ \"Microsoft.Storage/storageAccounts\" and kind in~ (\"Storage\", \"BlobStorage\")\n| extend\n    param1 = strcat(\"AccountKind: \", case(kind =~ \"Storage\", \"Storage (general purpose v1)\", kind =~ \"BlobStorage\", \"BlobStorage\", kind)),\n    param2 = strcat(\"Performance: \", sku.tier),\n    param3 = strcat(\"Replication: \", sku.name)\n| project recommendationId = \"2ad78dec-5a4d-4a30-8fd1-8584335ad781\", name, id, tags, param1, param2, param3\n\n"
        },
        {
            "description": "Leverage Azure Private Link Service for secure access to Azure Storage and services via Private Endpoint in your VNet. Eliminate the need for public IPs, ensuring data privacy. Enjoy granular access control for enhanced security.\n",
            "aprlGuid": "dc55be60-6f8c-461e-a9d5-a3c7686ed94e",
            "recommendationTypeId": null,
            "recommendationControl": "Security",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Storage/storageAccounts",
            "recommendationMetadataState": "Active",
            "longDescription": "Leverage Azure Private Link Service for secure access to Azure Storage and services via Private Endpoint in your VNet. Eliminate the need for public IPs, ensuring data privacy. Enjoy granular access control for enhanced security.\n",
            "potentialBenefits": "Secure, private access to storage with no public IPs",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Learn More",
                    "url": "https://learn.microsoft.com/en-us/azure/architecture/example-scenario/wvd/windows-virtual-desktop#azure-virtual-desktop-limitations"
                },
                {
                    "name": "Private Link",
                    "url": "https://learn.microsoft.com/en-us/azure/well-architected/azure-virtual-desktop/networking#private-endpoints-private-link"
                }
            ],
            "service": "Microsoft.Storage/storageAccounts",
            "text": "Enable Azure Private Link service for storage accounts",
            "severity": "Medium",
            "category": "Security",
            "guid": "dc55be60-6f8c-461e-a9d5-a3c7686ed94e",
            "source": "azure-resources/Storage/storageAccounts/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// This resource graph query will return all storage accounts that does not have a Private Endpoint Connection or where a private endpoint exists but public access is enabled\nresources\n| where type =~ \"Microsoft.Storage/StorageAccounts\"\n| where isnull(properties.privateEndpointConnections) or properties.privateEndpointConnections[0].properties.provisioningState != (\"Succeeded\") or (isnull(properties.networkAcls) and properties.publicNetworkAccess == 'Enabled')\n| extend param1 = strcat('Private Endpoint: ', iif(isnotnull(properties.privateEndpointConnections),split(properties.privateEndpointConnections[0].properties.privateEndpoint.id,'/')[8],'No Private Endpoint'))\n| extend param2 = strcat('Access: ', iif(properties.publicNetworkAccess == 'Disabled', 'Public Access Disabled', iif(isnotnull(properties.networkAcls), 'NetworkACLs in place','Public Access Enabled')))\n| project recommendationId = \"dc55be60-6f8c-461e-a9d5-a3c7686ed94e\", name, id, tags, param1, param2\n"
        },
        {
            "description": "A Citrix Managed Azure subscription supports VMs with VDA for app/desktop delivery, excluding other machines like Cloud Connectors. When close to the limit, signaled by a dashboard notification, and with sufficient licenses, request another subscription. Can't exceed the given limits for catalogs.\n",
            "aprlGuid": "c041d596-6c97-4c5f-b4b3-9cd37628f2e2",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Subscription/Subscriptions",
            "recommendationMetadataState": "Active",
            "longDescription": "A Citrix Managed Azure subscription supports VMs with VDA for app/desktop delivery, excluding other machines like Cloud Connectors. When close to the limit, signaled by a dashboard notification, and with sufficient licenses, request another subscription. Can't exceed the given limits for catalogs.\n",
            "potentialBenefits": "Avoids hitting limit, ensures reliability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Citrix Limits",
                    "url": "https://docs.citrix.com/en-us/citrix-daas-azure/limits"
                }
            ],
            "service": "Microsoft.Subscription/Subscriptions",
            "text": "Do not create more than 2000 Citrix VDA servers per subscription",
            "severity": "High",
            "category": "Governance",
            "guid": "c041d596-6c97-4c5f-b4b3-9cd37628f2e2",
            "source": "azure-resources/Subscription/subscriptions/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Count VM instances with a tag that contains \"Citrix VDA\" and create output if that count is >2000 for each subscription.\n// The Citrix published limit is 2500. This query runs an 80% check.\n\nresources\n| where type == 'microsoft.compute/virtualmachines'\n| where tags contains 'Citrix VDA'\n| summarize VMs=count() by subscriptionId\n| where VMs > 2000\n| join (resourcecontainers| where type =='microsoft.resources/subscriptions' | project subname=name, subscriptionId) on subscriptionId\n| project recommendationId='c041d596-6c97-4c5f-b4b3-9cd37628f2e2', name= subname, id = subscriptionId, param1='Too many instances.', param2= VMs\n\n"
        },
        {
            "description": "The root management group in Azure is designed for organizational hierarchy, allowing for all management groups and subscriptions to fold into it.\n",
            "aprlGuid": "5ada5ffa-7149-4e49-9fbf-e67be7c2594c",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Subscription/Subscriptions",
            "recommendationMetadataState": "Active",
            "longDescription": "The root management group in Azure is designed for organizational hierarchy, allowing for all management groups and subscriptions to fold into it.\n",
            "potentialBenefits": "Enhanced security, compliance, and management",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Management group recommendations",
                    "url": "https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/landing-zone/design-area/resource-org-management-groups#management-group-recommendations"
                },
                {
                    "name": "Root management group for each directory",
                    "url": "https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory"
                }
            ],
            "service": "Microsoft.Subscription/Subscriptions",
            "text": "Subscriptions should not be placed under the Tenant Root Management Group",
            "severity": "Medium",
            "category": "Governance",
            "guid": "5ada5ffa-7149-4e49-9fbf-e67be7c2594c",
            "source": "azure-resources/Subscription/subscriptions/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure Subscriptions that are placed under the Tenant Root Management Group\nresourcecontainers\n| where type == 'microsoft.resources/subscriptions'\n| extend mgParentSize = array_length(properties.managementGroupAncestorsChain)\n| where mgParentSize == 1\n| project recommendationId=\"5ada5ffa-7149-4e49-9fbf-e67be7c2594c\", name, id, tags\n\n"
        },
        {
            "description": "When building Image Templates, use sources for gen 2 VMs. Gen 2 offers more memory, supports >2TB disks, uses UEFI for faster boot/installation, has Intel SGX, and virtualized persistent memory (vPMEM), unlike gen 1's BIOS-based architecture.\n",
            "aprlGuid": "19b6df57-f6b5-3e4f-843a-273daa087cb0",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.VirtualMachineImages/imageTemplates",
            "recommendationMetadataState": "Active",
            "longDescription": "When building Image Templates, use sources for gen 2 VMs. Gen 2 offers more memory, supports >2TB disks, uses UEFI for faster boot/installation, has Intel SGX, and virtualized persistent memory (vPMEM), unlike gen 1's BIOS-based architecture.\n",
            "potentialBenefits": "More memory, supports >2TB disks, faster boot",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Generation 1 vs generation 2 virtual machines",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machines/generation-2#features-and-capabilities"
                }
            ],
            "service": "Microsoft.VirtualMachineImages/imageTemplates",
            "text": "Use Generation 2 virtual machine source image",
            "severity": "Low",
            "category": "High Availability",
            "guid": "19b6df57-f6b5-3e4f-843a-273daa087cb0",
            "source": "azure-resources/VirtualMachineImages/imageTemplates/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "The Azure Image Builder service, used for deploying Image Templates, lacks availability zones support. By replicating Image Templates to a secondary, preferably paired, region, quick recovery from a region failure is enabled, ensuring continuous virtual machine deployment from these templates.\n",
            "aprlGuid": "21fb841b-ba70-1f4e-a460-1f72fb41aa51",
            "recommendationTypeId": null,
            "recommendationControl": "Disaster Recovery",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.VirtualMachineImages/imageTemplates",
            "recommendationMetadataState": "Active",
            "longDescription": "The Azure Image Builder service, used for deploying Image Templates, lacks availability zones support. By replicating Image Templates to a secondary, preferably paired, region, quick recovery from a region failure is enabled, ensuring continuous virtual machine deployment from these templates.\n",
            "potentialBenefits": "Enhances disaster recovery capability",
            "pgVerified": true,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Image Template resiliency",
                    "url": "https://learn.microsoft.com/en-us/azure/reliability/reliability-image-builder?toc=%2Fazure%2Fvirtual-machines%2Ftoc.json&bc=%2Fazure%2Fvirtual-machines%2Fbreadcrumb%2Ftoc.json#capacity-and-proactive-disaster-recovery-resiliency"
                },
                {
                    "name": "Azure Image Builder Supported Regions",
                    "url": "https://learn.microsoft.com/en-us/azure/virtual-machines/image-builder-overview?tabs=azure-powershell#regions"
                }
            ],
            "service": "Microsoft.VirtualMachineImages/imageTemplates",
            "text": "Replicate your Image Templates to a secondary region",
            "severity": "Low",
            "category": "Disaster Recovery",
            "guid": "21fb841b-ba70-1f4e-a460-1f72fb41aa51",
            "source": "azure-resources/VirtualMachineImages/imageTemplates/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// List all Image Templates that are not replicated to another region\nresources\n| where type =~ \"microsoft.virtualmachineimages/imagetemplates\"\n| mv-expand distribution=properties.distribute\n| where array_length(parse_json(distribution).replicationRegions) == 1\n| project recommendationId = \"21fb841b-ba70-1f4e-a460-1f72fb41aa51\", name, id, param1=strcat(\"replicationRegions:\",parse_json(distribution).replicationRegions)\n\n"
        },
        {
            "description": "Azure's feature of deploying App Service plans across availability zones enhances resiliency and reliability by ensuring operation during datacenter failures, providing redundancy without needing different regions, thus minimizing downtime and maintaining uninterrupted services.\n",
            "aprlGuid": "88cb90c2-3b99-814b-9820-821a63f600dd",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Web/serverFarms",
            "recommendationMetadataState": "Active",
            "longDescription": "Azure's feature of deploying App Service plans across availability zones enhances resiliency and reliability by ensuring operation during datacenter failures, providing redundancy without needing different regions, thus minimizing downtime and maintaining uninterrupted services.\n",
            "potentialBenefits": "Enhances app resiliency and reliability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Migrate App Service to availability zone support",
                    "url": "https://learn.microsoft.com/en-us/azure/reliability/migrate-app-service"
                },
                {
                    "name": "High availability enterprise deployment using App Service Environment",
                    "url": "https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/enterprise-integration/ase-high-availability-deployment"
                }
            ],
            "service": "Microsoft.Web/serverFarms",
            "text": "Migrate App Service to availability Zone Support",
            "severity": "High",
            "category": "High Availability",
            "guid": "88cb90c2-3b99-814b-9820-821a63f600dd",
            "source": "azure-resources/Web/serverFarms/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// The query filters the qualified App Service Plans that do not have Zone Redundancy enabled.\n// Its important to check regions that support availability zones for Azure App Services running on multi-tenant and App Service Environments https://learn.microsoft.com/en-us/azure/reliability/reliability-app-service?tabs=graph%2Ccli#:~:text=The%20following%20regions%20support%20Azure%20App%20Services%20running%20on%20multi%2Dtenant%20environments%3A\n\nresources\n| where type =~ 'microsoft.web/serverfarms'\n| extend zoneRedundant = tobool(properties.zoneRedundant)\n| extend sku_tier = tostring(sku.tier)\n| where (tolower(sku_tier) contains \"isolated\" or tolower(sku_tier) contains \"premium\") and zoneRedundant == false\n| project recommendationId=\"88cb90c2-3b99-814b-9820-821a63f600dd\", name, id, tags, param1=sku_tier, param2=\"Not Zone Redundant\"\n\n"
        },
        {
            "description": "Choose Standard/Premium Azure App Service Plan for robust apps with advanced scaling, high availability, better performance, and multiple slots, ensuring resilience and continuous operation.\n",
            "aprlGuid": "b2113023-a553-2e41-9789-597e2fb54c31",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Web/serverFarms",
            "recommendationMetadataState": "Active",
            "longDescription": "Choose Standard/Premium Azure App Service Plan for robust apps with advanced scaling, high availability, better performance, and multiple slots, ensuring resilience and continuous operation.\n",
            "potentialBenefits": "Enhanced scaling and reliability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resiliency checklist for specific Azure services",
                    "url": "https://learn.microsoft.com/en-us/azure/architecture/checklist/resiliency-per-service#app-service"
                }
            ],
            "service": "Microsoft.Web/serverFarms",
            "text": "Use Standard or Premium tier",
            "severity": "High",
            "category": "High Availability",
            "guid": "b2113023-a553-2e41-9789-597e2fb54c31",
            "source": "azure-resources/Web/serverFarms/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure App Service Plans that are not in the \"Standard\", \"Premium\", or \"IsolatedV2\" SKU tiers.\n\nresources\n| where type =~ 'microsoft.web/serverfarms'\n| extend sku_tier = tostring(sku.tier)\n| where tolower(sku_tier) !contains \"standard\" and\n        tolower(sku_tier) !contains \"premium\" and\n        tolower(sku_tier) !contains \"isolatedv2\"\n| project recommendationId=\"b2113023-a553-2e41-9789-597e2fb54c31\", name, id, tags, param1= strcat(\"SKU=\",sku_tier)\n\n"
        },
        {
            "description": "Avoid frequent scaling up/down of Azure App Service instances to prevent service disruptions. Choose the right tier and size for the workload and scale out for traffic changes, as scaling adjustments can trigger application restarts.\n",
            "aprlGuid": "07243659-4643-d44c-a1c6-07ac21635072",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Web/serverFarms",
            "recommendationMetadataState": "Active",
            "longDescription": "Avoid frequent scaling up/down of Azure App Service instances to prevent service disruptions. Choose the right tier and size for the workload and scale out for traffic changes, as scaling adjustments can trigger application restarts.\n",
            "potentialBenefits": "Minimizes restarts, enhances stability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resiliency checklist for specific Azure services",
                    "url": "https://learn.microsoft.com/en-us/azure/architecture/checklist/resiliency-per-service#app-service"
                }
            ],
            "service": "Microsoft.Web/serverFarms",
            "text": "Avoid scaling up or down",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "07243659-4643-d44c-a1c6-07ac21635072",
            "source": "azure-resources/Web/serverFarms/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure App Service Plans and the number of changes that was made to the pricing tier, if the count is higher that 3 it means you need to avoid scaling up and down that often\n\nresourcechanges\n| extend changeTime = todatetime(properties.changeAttributes.timestamp), targetResourceId = tostring(properties.targetResourceId),\nchangeType = tostring(properties.changeType), correlationId = properties.changeAttributes.correlationId,\nchangedProperties = properties.changes, changeCount = properties.changeAttributes.changesCount\n| where changeTime > ago(14d)\n| join kind=inner (resources | project resources_Name = name, resources_Type = type, resources_Subscription= subscriptionId, resources_ResourceGroup= resourceGroup, id) on $left.targetResourceId == $right.id\n| where resources_Type contains \"microsoft.web/serverfarms\"\n| where changedProperties['sku.name'].propertyChangeType == 'Update' or changedProperties['sku.tier'].propertyChangeType == 'Update'\n| summarize count() by targetResourceId, resources_Name  ,tostring(changedProperties['sku.name'].previousValue), tostring(changedProperties['sku.tier'].newValue)\n| project recommendationId=\"07243659-4643-d44c-a1c6-07ac21635072\", name=resources_Name, id=targetResourceId, tags=\"\", param1=['changedProperties_sku.name_previousValue'], param2=['changedProperties_sku.tier_newValue'], param3=count_\n\n"
        },
        {
            "description": "It is strongly recommended to create separate App Service plans for production and test environments to avoid using slots within your production deployment for testing purposes.\n",
            "aprlGuid": "dbe3fd66-fb2a-9d46-b162-1791e21da236",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "High",
            "recommendationResourceType": "Microsoft.Web/serverFarms",
            "recommendationMetadataState": "Active",
            "longDescription": "It is strongly recommended to create separate App Service plans for production and test environments to avoid using slots within your production deployment for testing purposes.\n",
            "potentialBenefits": "Protects prod performance; avoids test impact",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resiliency checklist for specific Azure services",
                    "url": "https://learn.microsoft.com/en-us/azure/architecture/checklist/resiliency-per-service#app-service"
                }
            ],
            "service": "Microsoft.Web/serverFarms",
            "text": "Create separate App Service plans for production and test",
            "severity": "High",
            "category": "Governance",
            "guid": "dbe3fd66-fb2a-9d46-b162-1791e21da236",
            "source": "azure-resources/Web/serverFarms/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Enabling Autoscale/Automatic Scaling for your Azure App Service ensures sufficient resources for incoming requests. Autoscaling is rule-based, whereas Automatic Scaling, a newer feature, automatically adjusts resources based on HTTP traffic.\n",
            "aprlGuid": "6320abf6-f917-1843-b2ae-4779c35985ae",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Web/serverFarms",
            "recommendationMetadataState": "Active",
            "longDescription": "Enabling Autoscale/Automatic Scaling for your Azure App Service ensures sufficient resources for incoming requests. Autoscaling is rule-based, whereas Automatic Scaling, a newer feature, automatically adjusts resources based on HTTP traffic.\n",
            "potentialBenefits": "Optimizes resources for traffic",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Automatic scaling in Azure App Service",
                    "url": "https://learn.microsoft.com/en-us/azure/app-service/manage-automatic-scaling?tabs=azure-portal"
                },
                {
                    "name": "Auto Scale Web Apps",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-monitor/autoscale/autoscale-get-started"
                }
            ],
            "service": "Microsoft.Web/serverFarms",
            "text": "Enable Autoscale/Automatic scaling to ensure adequate resources are available to service requests",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "6320abf6-f917-1843-b2ae-4779c35985ae",
            "source": "azure-resources/Web/serverFarms/recommendations.yaml",
            "graph": "// under-development\n\n"
        },
        {
            "description": "Enabling diagnostics logging for your Azure App Service is crucial for monitoring and diagnostics, including both application logging and web server logging.\n",
            "aprlGuid": "493f6079-3bb6-4a56-96ba-ab3248474cb1",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "Enabling diagnostics logging for your Azure App Service is crucial for monitoring and diagnostics, including both application logging and web server logging.\n",
            "potentialBenefits": "Monitoring and Alerting",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Enable diagnostics logging for apps in Azure App Service",
                    "url": "https://learn.microsoft.com/azure/app-service/troubleshoot-diagnostic-logs"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Enable diagnostics logging",
            "severity": "Low",
            "category": "Monitoring and Alerting",
            "guid": "493f6079-3bb6-4a56-96ba-ab3248474cb1",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n\n"
        },
        {
            "description": "Use Application Insights to monitor app performance and load behavior, offering real-time insights, issue diagnosis, and root-cause analysis. It supports ASP.NET, ASP.NET Core, Java, and Node.js on Azure App Service, now with built-in monitoring.\n",
            "aprlGuid": "a7e8bb3d-8ceb-442d-b26f-007cd63f9ffc",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Application Insights to monitor app performance and load behavior, offering real-time insights, issue diagnosis, and root-cause analysis. It supports ASP.NET, ASP.NET Core, Java, and Node.js on Azure App Service, now with built-in monitoring.\n",
            "potentialBenefits": "Real-time insights and issue diagnosis",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Application Insights",
                    "url": "https://learn.microsoft.com/azure/application-insights/app-insights-overview"
                },
                {
                    "name": "Application monitoring for Azure App Service",
                    "url": "https://learn.microsoft.com/azure/azure-monitor/app/azure-web-apps"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Monitor Performance",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "a7e8bb3d-8ceb-442d-b26f-007cd63f9ffc",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n\n"
        },
        {
            "description": "If your solution includes both a web front end and a web API, decomposing them into separate App Service apps facilitates solution decomposition by workload, allowing for independent scaling. Initially, you can deploy both in the same plan and separate them for independent scaling when necessary.\n",
            "aprlGuid": "78a5c033-ff51-4332-8a71-83464c34494b",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "If your solution includes both a web front end and a web API, decomposing them into separate App Service apps facilitates solution decomposition by workload, allowing for independent scaling. Initially, you can deploy both in the same plan and separate them for independent scaling when necessary.\n",
            "potentialBenefits": "Independent scaling, easier management",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resiliency checklist for specific Azure services",
                    "url": "https://learn.microsoft.com/azure/architecture/checklist/resiliency-per-service#app-service"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Separate web apps from web APIs",
            "severity": "Low",
            "category": "Scalability",
            "guid": "78a5c033-ff51-4332-8a71-83464c34494b",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Creating a separate storage account for logs and not using the same one for application data prevents logging activities from reducing application performance by ensuring that the resources dedicated to handling application data are not burdened by logging processes.\n",
            "aprlGuid": "3f9ddb59-0bb3-4acb-9c9b-99aa1776f0ab",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "Creating a separate storage account for logs and not using the same one for application data prevents logging activities from reducing application performance by ensuring that the resources dedicated to handling application data are not burdened by logging processes.\n",
            "potentialBenefits": "Improves app performance",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resiliency checklist",
                    "url": "https://learn.microsoft.com/azure/architecture/checklist/resiliency-per-service#app-service"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Create a separate storage account for logs",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "3f9ddb59-0bb3-4acb-9c9b-99aa1776f0ab",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n\n"
        },
        {
            "description": "Create a deployment slot for staging to deploy updates, verify them, and ensure all instances are warmed up before production swap, reducing bad update chances. An LKG slot allows easy rollback to a previous good deployment if issues arise later, enhancing reliability.\n",
            "aprlGuid": "a1d91661-32d4-430b-b3b6-5adeb0975df7",
            "recommendationTypeId": "1d3b5a51-62d4-4b77-96f6-40ed0a3aa21f",
            "recommendationControl": "Governance",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "Create a deployment slot for staging to deploy updates, verify them, and ensure all instances are warmed up before production swap, reducing bad update chances. An LKG slot allows easy rollback to a previous good deployment if issues arise later, enhancing reliability.\n",
            "potentialBenefits": "Safer updates and easy rollback",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Set up staging environments in Azure App Service",
                    "url": "https://learn.microsoft.com/azure/app-service-web/web-sites-staged-publishing"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Deploy to a staging slot",
            "severity": "Low",
            "category": "Governance",
            "guid": "a1d91661-32d4-430b-b3b6-5adeb0975df7",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Display App Service with the count of deployment slots for Apps under eligible App service plans and it shows if deployment slot is enabled or not\n\nresources\n| where type =~ 'microsoft.web/sites' or type =~ 'microsoft.web/sites/slots'\n| extend isSlot = iff(type =~ 'microsoft.web/sites/slots', 1, 0)\n| extend AspName = iff(isSlot == 1, split(name, '/')[0], name)\n| extend Sku = tostring(properties.sku)\n| where tolower(Sku) contains \"standard\" or tolower(Sku) contains \"premium\" or tolower(Sku) contains \"isolatedv2\"\n| project id, name, AspName, isSlot, Sku\n| summarize Slots = countif(isSlot == 1) by id, name, AspName, Sku\n| extend DeploymentSlotEnabled = iff(Slots > 1, true, false)\n| where DeploymentSlotEnabled = false\n| project recommendationId=\"a1d91661-32d4-430b-b3b6-5adeb0975df7\", name, id, tags=\"\", param1=Sku, param2=Slots, param3=\"DeploymentSlotEnabled=false\"\n\n"
        },
        {
            "description": "Use app settings for configuration and define them in Resource Manager templates or via PowerShell to facilitate part of an automated deployment/update process for improved reliability.\n",
            "aprlGuid": "0b80b67c-afbe-4988-ad58-a85a146b681e",
            "recommendationTypeId": null,
            "recommendationControl": "Other Best Practices",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "Use app settings for configuration and define them in Resource Manager templates or via PowerShell to facilitate part of an automated deployment/update process for improved reliability.\n",
            "potentialBenefits": "Enhanced reliability via automation",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Configure web apps in Azure App Service",
                    "url": "https://learn.microsoft.com/azure/app-service-web/web-sites-configure"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Store configuration as app settings",
            "severity": "Medium",
            "category": "Other Best Practices",
            "guid": "0b80b67c-afbe-4988-ad58-a85a146b681e",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure App Service resources that don't have App Settings configured\n\nappserviceresources\n| where type == \"microsoft.web/sites/config\"\n| extend AppSettings = iif(isempty(properties.AppSettings), true, false)\n| where AppSettings == false\n| project  recommendationId=\"0b80b67c-afbe-4988-ad58-a85a146b681e\", id, name, tags=\"\", param1=\"AppSettings is not configured\"\n\n"
        },
        {
            "description": "Use Health Check for production workloads. Health check increases your application's availability by rerouting requests away from unhealthy instances, and replacing instances if they remain unhealthy. The Health check path should check critical components of your application.\n",
            "aprlGuid": "fd049c28-ae6d-48f0-a641-cc3ba1a3fe1d",
            "recommendationTypeId": null,
            "recommendationControl": "Other Best Practices",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "Use Health Check for production workloads. Health check increases your application's availability by rerouting requests away from unhealthy instances, and replacing instances if they remain unhealthy. The Health check path should check critical components of your application.\n",
            "potentialBenefits": "Enhanced reliability via automation",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Monitor the health of App Service instances",
                    "url": "https://learn.microsoft.com/en-us/azure/app-service/monitor-instances-health-check?tabs=dotnet#enable-health-check"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Enable Health check for App Services",
            "severity": "Medium",
            "category": "Other Best Practices",
            "guid": "fd049c28-ae6d-48f0-a641-cc3ba1a3fe1d",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Check if Health Check is enabled for App Service\n\nresources\n| where type =~ 'microsoft.web/sites'\n| where properties.kind has 'app'\n| join kind = inner\n    (\n    appserviceresources\n    | where isnull(properties.HealthCheckPath) == true\n    | project  name\n    ) on name\n| project recommendationId = \"fd049c28-ae6d-48f0-a641-cc3ba1a3fe1d\", name, id, tags, param1 = \"Healthcheckpath = not set\"\n"
        },
        {
            "description": "Use network access restrictions to define a priority-ordered allow/deny list that controls network access to your app. Web application firewalls, such as the one available in Application Gateway, are recommended for protection of public-facing web applications.\n",
            "aprlGuid": "aab6b4a4-9981-43a4-8728-35c7ecbb746d",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "Use network access restrictions to define a priority-ordered allow/deny list that controls network access to your app. Web application firewalls, such as the one available in Application Gateway, are recommended for protection of public-facing web applications.\n",
            "potentialBenefits": "Enhanced security",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Set up Azure App Service access restrictions",
                    "url": "https://learn.microsoft.com/en-us/azure/app-service/app-service-ip-restrictions?tabs=azurecli"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Configure network access restrictions",
            "severity": "Medium",
            "category": "Governance",
            "guid": "aab6b4a4-9981-43a4-8728-35c7ecbb746d",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Check if Network access restrictions defined for App service\n\nresources\n| where type =~ 'microsoft.web/sites'\n| where properties.kind has 'app'\n| join kind = inner\n    (\n    appserviceresources\n    | mv-expand IpSecurityRestrictions = properties.IpSecurityRestrictions\n    | where isnotnull(IpSecurityRestrictions) == true\n    | project name\n    ) on name\n| project recommendationId = \"aab6b4a4-9981-43a4-8728-35c7ecbb746d\", name, id, tags, param1 = \"No network restrictions set\"\n"
        },
        {
            "description": "App Service should be configured with a minimum of two instances for production workloads. If apps have a longer warmup time a minimum of three instances should be used.\n",
            "aprlGuid": "9e6682ac-31bc-4635-9959-ab74b52454e6",
            "recommendationTypeId": null,
            "recommendationControl": "Scalability",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "App Service should be configured with a minimum of two instances for production workloads. If apps have a longer warmup time a minimum of three instances should be used.\n",
            "potentialBenefits": "Improves app performace",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Ultimate guide to running healthy apps in the cloud",
                    "url": "https://azure.github.io/AppService/2020/05/15/Robust-Apps-for-the-cloud.html"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Set minimum instance count to 2 for app service",
            "severity": "Medium",
            "category": "Scalability",
            "guid": "9e6682ac-31bc-4635-9959-ab74b52454e6",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of App services that do not have minimum instance count of 2\n\nresources\n| where type =~ 'microsoft.web/sites'\n| where properties.kind has 'app'\n| join kind = inner\n    (\n    appserviceresources\n    | where properties.PreWarmedInstanceCount < 2\n    | project name\n    ) on name\n| project recommendationId = \"9e6682ac-31bc-4635-9959-ab74b52454e6\", name, id, tags, param1 = \"PreWarmedInstanceCount is less than 2\"\n"
        },
        {
            "description": "Auto Heal allows you to mitigate your apps when it runs into unexpected situations like HTTP server errors, resource exhaustion, etc. You can configure different triggers based on your need and choose to recycle the app to recover it from a bad state.\n",
            "aprlGuid": "c6c4b962-5af4-447a-9d74-7b9c53a5dff5",
            "recommendationTypeId": null,
            "recommendationControl": "High Availability",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "Auto Heal allows you to mitigate your apps when it runs into unexpected situations like HTTP server errors, resource exhaustion, etc. You can configure different triggers based on your need and choose to recycle the app to recover it from a bad state.\n",
            "potentialBenefits": "Improved app availability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": "arg",
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Announcing the New Auto Healing Experience in App Service Diagnostics - Azure App Service",
                    "url": "https://azure.github.io/AppService/2018/09/10/Announcing-the-New-Auto-Healing-Experience-in-App-Service-Diagnostics.html"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Enable auto heal for Functions App",
            "severity": "Low",
            "category": "High Availability",
            "guid": "c6c4b962-5af4-447a-9d74-7b9c53a5dff5",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// Azure Resource Graph Query\n// Provides a list of Azure Function App resources that do not have auto heal enabled\n\nResources\n| where type =~ 'microsoft.web/sites'\n| where properties.kind contains 'functionapp'\n| join kind=inner\n    (appserviceresources\n    | where type == \"microsoft.web/sites/config\"\n    | where properties.AutoHealEnabled == 'false'\n    | project id, name, tenantId, location, resourceGroup, properties.AutoHealEnabled\n    ) on name\n| project recommendationID = \"c6c4b962-5af4-447a-9d74-7b9c53a5dff5\", name, id, type, kind, param1=\"AutoHealEnabled =false\"\n"
        },
        {
            "description": "Add a warmup trigger to pre-load custom dependencies during the pre-warming process so that your functions are ready to start processing requests immediately.\n",
            "aprlGuid": "52f368ee-1d77-4b34-92db-64be269642d0",
            "recommendationTypeId": null,
            "recommendationControl": "Monitoring and Alerting",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "Add a warmup trigger to pre-load custom dependencies during the pre-warming process so that your functions are ready to start processing requests immediately.\n",
            "potentialBenefits": "Improved app availability",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Azure Functions Warmup Trigger",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-functions/functions-bindings-warmup?tabs=in-process%2Cnodejs-v4&pivots=programming-language-csharp#trigger"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "No warmup trigger added to Function App",
            "severity": "Medium",
            "category": "Monitoring and Alerting",
            "guid": "52f368ee-1d77-4b34-92db-64be269642d0",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "A host ID must be between 1 and 32 characters, contain only lowercase letters, numbers, and dashes, not start or end with a dash, and not contain consecutive dashes. The host ID value should be unique for all apps/slots you're running.\n",
            "aprlGuid": "0b06a688-0dd6-4d73-9f72-6666ff853ca9",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Low",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "A host ID must be between 1 and 32 characters, contain only lowercase letters, numbers, and dashes, not start or end with a dash, and not contain consecutive dashes. The host ID value should be unique for all apps/slots you're running.\n",
            "potentialBenefits": "Easier management",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Resource naming restrictions - Azure Resource Manager",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/resource-name-rules"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Ensure unique hostid set for Function App",
            "severity": "Low",
            "category": "Governance",
            "guid": "0b06a688-0dd6-4d73-9f72-6666ff853ca9",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "Beginning on December 13, 2022, function apps running on versions 2.x and 3.x of the Azure Functions runtime have reached the end of life (EOL) of extended support. We highly recommend you migrating your function apps to version 4.x of the Functions runtime.\n",
            "aprlGuid": "c9a278b7-024b-454b-bd54-41587c512b74",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "Beginning on December 13, 2022, function apps running on versions 2.x and 3.x of the Azure Functions runtime have reached the end of life (EOL) of extended support. We highly recommend you migrating your function apps to version 4.x of the Functions runtime.\n",
            "potentialBenefits": "Better governance",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "Migrate version 3.x to 4.x",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-functions/migrate-version-3-version-4?tabs=net6-in-proc%2Cazure-cli%2Cwindows&pivots=programming-language-csharp"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Ensure Function App runs a supported version",
            "severity": "Medium",
            "category": "Governance",
            "guid": "c9a278b7-024b-454b-bd54-41587c512b74",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        },
        {
            "description": "The FUNCTIONS_WORKER_RUNTIME setting in the Function App configuration should be set to the appropriate value based on the language you are using. This setting is used to determine the language worker that will be used to execute your functions.\n",
            "aprlGuid": "7c608f46-46b2-4cc0-bbd6-1d457c16671c",
            "recommendationTypeId": null,
            "recommendationControl": "Governance",
            "recommendationImpact": "Medium",
            "recommendationResourceType": "Microsoft.Web/sites",
            "recommendationMetadataState": "Active",
            "longDescription": "The FUNCTIONS_WORKER_RUNTIME setting in the Function App configuration should be set to the appropriate value based on the language you are using. This setting is used to determine the language worker that will be used to execute your functions.\n",
            "potentialBenefits": "Better governance",
            "pgVerified": false,
            "publishedToLearn": false,
            "publishedToAdvisor": false,
            "automationAvailable": false,
            "tags": null,
            "learnMoreLink": [
                {
                    "name": "FUNCTIONS_WORKER_RUNTIME",
                    "url": "https://learn.microsoft.com/en-us/azure/azure-functions/functions-app-settings#functions_worker_runtime"
                }
            ],
            "service": "Microsoft.Web/sites",
            "text": "Ensure FUNCTIONS_WORKER_RUNTIME is set properly",
            "severity": "Medium",
            "category": "Governance",
            "guid": "7c608f46-46b2-4cc0-bbd6-1d457c16671c",
            "source": "azure-resources/Web/sites/recommendations.yaml",
            "graph": "// cannot-be-validated-with-arg\n"
        }
    ],
    "categories": [
        {
            "name": "Disaster Recovery"
        },
        {
            "name": "Scalability"
        },
        {
            "name": "Monitoring and Alerting"
        },
        {
            "name": "High Availability"
        },
        {
            "name": "Other Best Practices"
        },
        {
            "name": "Business Continuity"
        },
        {
            "name": "Personalized"
        },
        {
            "name": "Governance"
        },
        {
            "name": "Service Upgrade and Retirement"
        },
        {
            "name": "Security"
        }
    ],
    "severities": [
        {
            "name": "Low"
        },
        {
            "name": "High"
        },
        {
            "name": "Medium"
        }
    ],
    "waf": [
        {
            "name": "Reliability"
        },
        {
            "name": "Security"
        },
        {
            "name": "Cost"
        },
        {
            "name": "Operations"
        },
        {
            "name": "Performance"
        }
    ],
    "yesno": [
        {
            "name": "Yes"
        },
        {
            "name": "No"
        }
    ],
    "status": [
        {
            "name": "Not verified",
            "description": "This check has not been looked at yet"
        },
        {
            "name": "Open",
            "description": "There is an action item associated to this check"
        },
        {
            "name": "Fulfilled",
            "description": "This check has been verified, and there are no further action items associated to it"
        },
        {
            "name": "N/A",
            "description": "Not applicable for current design"
        },
        {
            "name": "Not required",
            "description": "Not required"
        }
    ],
    "metadata": {
        "name": "APRL Checklist",
        "waf": "none",
        "state": "preview",
        "timestamp": "July 14, 2024"
    }
}