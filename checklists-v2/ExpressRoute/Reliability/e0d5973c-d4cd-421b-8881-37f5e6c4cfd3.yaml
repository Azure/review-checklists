guid: e0d5973c-d4cd-421b-8881-37f5e6c4cfd3
labels:
  area: Network Topology and Connectivity
  checklist: alz
  subarea: Hybrid
links:
- https://learn.microsoft.com/azure/expressroute/designing-for-disaster-recovery-with-expressroute-privatepeering#challenges-of-using-multiple-expressroute-circuits
queries:
- arg: resources | where type=='microsoft.network/connections' | where properties.connectionType
    == 'ExpressRoute' | project cxId=id, gwId=tostring(properties.virtualNetworkGateway1.id),
    circuitId=tostring(properties.peer.id) | join (resources | where type=='microsoft.network/expressroutecircuits'
    | project circuitId=tostring(id), circuitLocation=tostring(properties.serviceProviderProperties.peeringLocation))
    on circuitId | distinct gwId, circuitLocation | summarize countErLocations=count()
    by id=gwId | extend compliant = (countErLocations >= 2)
resourceTypes: []
service: ExpressRoute
severity: 1
text: Use ExpressRoute circuits from different peering locations for redundancy.
waf: Reliability
