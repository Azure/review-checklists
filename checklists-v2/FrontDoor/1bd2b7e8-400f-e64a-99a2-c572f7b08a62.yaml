description: 'For internet-facing applications, enabling the Front Door web application
  firewall (WAF) and configuring it to use managed rules is recommended for protection
  against a wide range of attacks using Microsoft-managed rules.

  '
guid: 1bd2b7e8-400f-e64a-99a2-c572f7b08a62
labels:
  area: Security
  source: azure-resources/Cdn/profiles/recommendations.yaml
  sourceType: aprl
links: []
queries:
- arg: "// Azure Resource Graph Query\n// Enable the WAF\n\nresources\n| where type\
    \ =~ \"microsoft.cdn/profiles\" and sku has \"AzureFrontDoor\"\n| project name,\
    \ cdnprofileid=tolower(id), tostring(tags), resourceGroup, subscriptionId,skuname=tostring(sku.name)\n\
    | join kind= fullouter (\n    cdnresources\n    | where type == \"microsoft.cdn/profiles/securitypolicies\"\
    \n    | extend wafpolicyid=tostring(properties['parameters']['wafPolicy']['id'])\n\
    \    | extend splitid=split(id, \"/\")\n    | extend cdnprofileid=tolower(strcat_array(array_slice(splitid,\
    \ 0, 8), \"/\"))\n    | project secpolname=name, cdnprofileid, wafpolicyid\n \
    \   )\n    on cdnprofileid\n| project name, cdnprofileid, secpolname, wafpolicyid,skuname\n\
    | join kind = fullouter (\n    resources\n    | where type == \"microsoft.network/frontdoorwebapplicationfirewallpolicies\"\
    \n    | extend\n        managedrulesenabled=iff(tostring(properties.managedRules.managedRuleSets)\
    \ != \"[]\", true, false),\n        enabledState = tostring(properties.policySettings.enabledState)\n\
    \    | project afdwafname=name, managedrulesenabled, wafpolicyid=id, enabledState,\
    \ tostring(tags)\n    )\n    on wafpolicyid\n| where name != \"\"\n| summarize\n\
    \    associatedsecuritypolicies=countif(secpolname != \"\"),\n    wafswithmanagedrules=countif(managedrulesenabled\
    \ == 1)\n    by name, id=cdnprofileid, tags,skuname\n| where associatedsecuritypolicies\
    \ == 0 or wafswithmanagedrules  == 0\n| project\n    recommendationId = \"1bd2b7e8-400f-e64a-99a2-c572f7b08a62\"\
    ,\n    name,\n    id,\n    todynamic(tags),\n    param1 = strcat(\"associatedsecuritypolicies:\"\
    , associatedsecuritypolicies),\n    param2 = strcat(\"wafswithmanagedrules:\"\
    , wafswithmanagedrules),\n    param3 = strcat(\"skuname:\",skuname)\n\n"
resourceTypes:
- Microsoft.Cdn/profiles
service: Front Door
severity: 1
text: Enable the WAF
