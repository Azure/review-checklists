{
    "$schema": "https://json-schema.org/2020-12/schema#",
    "$id": "https://github.com/Azure/review-checklists/v2/recommendation.schema.json",
    "title": "Recommendation",
    "type": "object",
    "properties": {
        "name": {
            "type": "string",
            "description": "Unique identifier for the recommendation, human readable.",
            "pattern": "^[0-9A-Za-z]+$",
            "minLength": 5,
            "maxLength": 30,
            "$comment": "Names added for human readability, even if not strictly necessary when having GUIDs."
        },
        "title": {
            "type": "string",
            "description": "Recommendation text.",
            "minLength": 5,
            "maxLength": 100
        },
        "description": {
            "type": "string",
            "description": "More verbose recommendation description.",
            "maxLength": 300
        },
        "severity": {
            "type": "integer",
            "description": "Severity of the recommendation.",
            "enum": [0, 1, 2],
            "$comment": "0: High, 1: Medium, 2: Low"
        },
        "waf": {
            "type": "string",
            "description": "WAF pillar.",
            "minLength": 5,
            "maxLength": 30,
            "enum": ["Security", "Performance", "Reliability", "Cost", "Operations"]
        },
        "source": {
            "type": "object",
            "description": "Source of the recommendation.",
            "properties": {
                "type": {
                    "type": "string",
                    "description": "Type of the source.",
                    "enum": ["revcl", "aprl", "wafsg"]
                },
                "url": {
                    "type": "string",
                    "description": "ID of the source."
                }
            }
        },
        "reviewedDate": {
            "type": "string",
            "description": "WAF pillar.",
            "format": "date"
        },
        "resourceTypes": {
            "type": "array",
            "description": "List of resource types that this recommendation applies to.",
            "items": {
                "type": "string",
                "minLength": 5,
                "maxLength": 30
            }
        },
        "query": {
            "type": "object",
            "description": "Query to find the resources that this recommendation applies to.",
            "properties": {
                "args": {
                    "type": "string",
                    "description": "Azure Resource Graph query"
                }
            }
        },
        "links": {
            "type": "array",
            "description": "List of links to documentation or other resources.",
            "items": {
                "type": "object",
                "properties": {
                    "type": {
                        "type": "string",
                        "description": "Link text."
                    },
                    "target": {
                        "type": "string",
                        "description": "Link URL."
                    }
                }
            }
        },
        "labels": {
            "type": "object",
            "description": "Optional labels for the recommendation."
        },
        "constraints": {
            "type": "array",
            "description": "List of constraints that this recommendation applies to.",
            "items": {
                "type": "object",
                "properties": {
                    "field": {
                        "type": "string",
                        "description": "Variable to compare."
                    },
                    "operator": {
                        "type": "string",
                        "description": "Comparison operator.",
                        "enum": ["equals", "greater", "less", "contains", "startsWith", "endsWith"]
                    },
                    "value": {
                        "type": "string",
                        "description": "Value to compare against"
                    },
                    "effect": {
                        "type": "string",
                        "description": "Effect of the constraint.",
                        "enum": ["show", "hide"],
                        "$comment": "Show or hide the recommendation."
                    }
                }
            }
        },
        "duplicates": {
            "type": "array",
            "description": "List of GUIDs of recommendations that are duplicates of this one.",
            "items": {
                "type": "string",
                "minLength": 36,
                "maxLength": 36
            }
        }
    },
    "required": ["guid", "name", "title", "severity"],
    "allOf": [
        { 
            "if": {
                "properties": {
                    "source": {
                        "properties": {
                            "type": {
                                "enum": [ "revcl" ]
                            }
                        }
                    }
                }
            },
            "then": {
                "required": ["reviewedDate"]
            }
        }
    ]
}
