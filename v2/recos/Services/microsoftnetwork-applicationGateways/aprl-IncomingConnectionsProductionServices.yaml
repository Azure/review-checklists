name: aprl-IncomingConnectionsProductionServices
title: Secure all incoming connections with SSL
description: |-
  Secure all incoming connections using HTTPS for production services with end-to-end SSL/TLS or SSL/TLS termination at the Application Gateway to protect against attacks and ensure data remains private and encrypted between the web server and browsers.
source:
  type: aprl
  file: azure-resources/Network/applicationGateways/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.Network/applicationGateways
severity: 0
labels:
  guid: 233a7008-71e9-e745-923e-1a1c7a0b92f3
  area: Security
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // You can use the following Azure Resource Graph query to check if an HTTP rule is using an SSL certificate or is using Azure Key Vault to store the certificates
    resources
    | where type =~ "microsoft.network/applicationGateways"
    | mv-expand frontendPorts = properties.frontendPorts
    | mv-expand httpListeners = properties.httpListeners
    | where isnull(parse_json(httpListeners.properties.sslCertificate))
    | project recommendationId="233a7008-71e9-e745-923e-1a1c7a0b92f3", name, id, tags, param1=strcat("frontendPort: ", frontendPorts.properties.port), param2="tls: false"
