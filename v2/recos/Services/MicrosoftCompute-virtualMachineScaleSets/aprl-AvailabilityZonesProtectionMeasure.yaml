name: aprl-AvailabilityZonesProtectionMeasure
title: Deploy VMSS across availability zones with VMSS Flex
description: |-
  When creating VMSS, implement availability zones as a protection measure for your applications and data against the rare event of datacenter failure.
source:
  type: aprl
  file: azure-resources/Compute/virtualMachineScaleSets/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.Compute/virtualMachineScaleSets
severity: 0
labels:
  guid: 1422c567-782c-7148-ac7c-5fc14cf45adc
  area: High Availability
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // Find VMSS instances with one or no Zones selected
    resources
    | where type == "microsoft.compute/virtualmachinescalesets"
    | where array_length(zones) <= 1 or isnull(zones)
    | project recommendationId = "1422c567-782c-7148-ac7c-5fc14cf45adc", name, id, tags, param1 = "AvailabilityZones: Single Zone"
    | order by id asc
