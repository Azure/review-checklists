name: aprl-HttpServerErrorsAutoHeal
title: Enable auto heal for Functions App
description: |-
  Auto Heal allows you to mitigate your apps when it runs into unexpected situations like HTTP server errors, resource exhaustion, etc. You can configure different triggers based on your need and choose to recycle the app to recover it from a bad state.
source:
  type: aprl
  file: azure-resources/Web/sites/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.Web/sites
severity: 2
labels:
  guid: c6c4b962-5af4-447a-9d74-7b9c53a5dff5
  area: High Availability
links: []
queries:
  arg: |-
    // Azure Resource Graph Query
    // Provides a list of Azure Function App resources that do not have auto heal enabled

    Resources
    | where type =~ 'microsoft.web/sites'
    | where properties.kind contains 'functionapp'
    | join kind=inner
        (appserviceresources
        | where type == "microsoft.web/sites/config"
        | where properties.AutoHealEnabled == 'false'
        | project id, name, tenantId, location, resourceGroup, properties.AutoHealEnabled
        ) on name
    | project recommendationID = "c6c4b962-5af4-447a-9d74-7b9c53a5dff5", name, id, type, kind, param1="AutoHealEnabled =false"
