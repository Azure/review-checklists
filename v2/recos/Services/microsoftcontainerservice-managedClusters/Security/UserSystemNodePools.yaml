name: UserSystemNodePools
title: Separate applications from the control plane with user/system node pools
source:
  type: revcl
  file: ./checklists/aks_checklist.en.json
resourceTypes:
- microsoft.containerservice/managedClusters
waf: Security
severity: 1
labels:
  guid: 6f158e3e-a3a9-42c2-be7e-2165c3a87af4
  area: Governance and Security
  subarea: Compliance
  id: 04.01.02
links:
- https://learn.microsoft.com/azure/aks/use-system-pools
queries:
  arg: where type=='microsoft.containerservice/managedclusters' | project id,resourceGroup,name,pools=properties.agentPoolProfiles
    | project id,name,resourceGroup,poolcount=array_length(pools) | extend compliant
    = (poolcount > 1)
