name: revcl-PublicApiEndpointIpAddresses
title: If using a public API endpoint, restrict the IP addresses that can access it
source:
  type: revcl
  file: ./checklists/waf_checklist.en.json
resourceTypes:
- microsoft.containerservice/managedClusters
waf: Security
severity: 1
labels:
  guid: c4581559-bb91-463e-a908-aed8c44ce3b2
links:
- type: docs
  url: https://learn.microsoft.com/azure/aks/api-server-authorized-ip-ranges
queries:
  arg: where type=='microsoft.containerservice/managedclusters' | extend compliant
    = ((isnull(properties.apiServerAccessProfile.enablePrivateCluster) or properties.apiServerAccessProfile.enablePrivateCluster==false)
    and isnotnull(properties.apiServerAccessProfile.authorizedIPRanges)) | distinct
    id,compliant
