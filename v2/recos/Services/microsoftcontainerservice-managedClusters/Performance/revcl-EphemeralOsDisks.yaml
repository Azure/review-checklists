name: revcl-EphemeralOsDisks
title: Use ephemeral OS disks
source:
  type: revcl
  file: ./checklists/waf_checklist.en.json
resourceTypes:
- microsoft.containerservice/managedClusters
waf: Performance
severity: 0
labels:
  guid: 24367b33-6971-45b1-952b-eee0b9b588de
links:
- type: docs
  url: https://learn.microsoft.com/azure/aks/cluster-configuration
queries:
  arg: where type=='microsoft.containerservice/managedclusters' | project id,resourceGroup,name,pools=properties.agentPoolProfiles
    | mvexpand pools | extend compliant = (pools.osDiskType=='Ephemeral') | project
    id,name=strcat(name,'-',pools.name), resourceGroup, compliant
