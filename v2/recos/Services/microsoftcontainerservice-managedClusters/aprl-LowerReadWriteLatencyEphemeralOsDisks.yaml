name: aprl-LowerReadWriteLatencyEphemeralOsDisks
title: Use Ephemeral OS disks on AKS clusters
description: |-
  Ephemeral OS disks on AKS offer lower read/write latency due to local attachment, eliminating the need for replication seen with managed disks. This enhances performance and speeds up cluster operations such as scaling or upgrading due to quicker re-imaging and boot times.
source:
  type: aprl
  file: azure-resources/ContainerService/managedClusters/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.ContainerService/managedClusters
severity: 1
labels:
  guid: a7bfcc18-b0d8-4d37-81f3-8131ed8bead5
  area: Scalability
links: []
queries:
  arg: |-
    // Azure Resource Graph Query
    // Returns any AKS cluster nodepools that do not have Ephemeral Disks
    resources
    | where type == "microsoft.containerservice/managedclusters"
    | mv-expand agentPoolProfile = properties.agentPoolProfiles
    | extend type = tostring(agentPoolProfile.osDiskType)
    | where type != 'Ephemeral'
    | project recommendationId="a7bfcc18-b0d8-4d37-81f3-8131ed8bead5", name, id, param1=strcat("osDiskType: ", type)
