name: aprl-TrafficManagerProfilesAzureTrafficManager
title: Traffic manager profiles should have more than one endpoint
description: |-
  When configuring the Azure traffic manager, provision at least two endpoints to ensure workloads can fail-over to another instance, enhancing reliability and availability.
source:
  type: aprl
  file: azure-resources/Network/trafficManagerProfiles/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.Network/trafficManagerProfiles
severity: 1
labels:
  guid: 5b422a7f-8caa-3d48-becb-511599e5bba9
  area: High Availability
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // Find traffic manager profiles that have less than 2 endpoints
    resources
    | where type == "microsoft.network/trafficmanagerprofiles"
    | where array_length(properties.endpoints) < 2
    | project recommendationId = "5b422a7f-8caa-3d48-becb-511599e5bba9", name, id, tags, param1 = strcat('EndpointCount: ', array_length(properties.endpoints))
