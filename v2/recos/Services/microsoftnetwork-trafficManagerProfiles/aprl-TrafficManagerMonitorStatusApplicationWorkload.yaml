name: aprl-TrafficManagerMonitorStatusApplicationWorkload
title: Traffic Manager Monitor Status Should be Online
description: |-
  Monitor status should be online to ensure failover for application workload. If Traffic Manager's health shows Degraded, one or more endpoints may also be Degraded.
source:
  type: aprl
  file: azure-resources/Network/trafficManagerProfiles/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.Network/trafficManagerProfiles
severity: 0
labels:
  guid: f05a3e6d-49db-2740-88e2-2b13706c1f67
  area: High Availability
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // Find traffic manager profiles that have an endpoint monitor status of not 'Online'
    resources
    | where type == "microsoft.network/trafficmanagerprofiles"
    | mv-expand properties.endpoints
    | where properties_endpoints.properties.endpointMonitorStatus != "Online"
    | project recommendationId = "f05a3e6d-49db-2740-88e2-2b13706c1f67", name, id, tags, param1 = strcat('Profile name: ',properties_endpoints.name), param2 = strcat('endpointMonitorStatus: ', properties_endpoints.properties.endpointMonitorStatus)
