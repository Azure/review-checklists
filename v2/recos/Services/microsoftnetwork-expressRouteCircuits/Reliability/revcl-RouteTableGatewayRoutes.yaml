name: revcl-RouteTableGatewayRoutes
title: If you are using a route table in the GatewaySubnet, make sure that gateway
  routes are propagated.
source:
  type: revcl
  file: ./checklists/alz_checklist.en.json
resourceTypes:
- microsoft.network/expressRouteCircuits
waf: Reliability
severity: 0
labels:
  guid: 72105cc8-aaea-4ee1-8c7a-ad25977afcaf
  area: Network Topology and Connectivity
  subarea: Hybrid
  id: D06.17
links:
- type: docs
  url: https://learn.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpn-gateway-settings#gwsub
queries:
  arg: resources | where type=='microsoft.network/virtualnetworks' | project id,resourceGroup,name,subnets=properties.subnets
    | mv-expand subnets | project id,resourceGroup,name,subnetName=tostring(subnets.name),routeTableId=tostring(subnets.properties.routeTable.id)
    | where subnetName == 'GatewaySubnet' | join kind=leftouter (Resources | where
    type == 'microsoft.network/routetables' | project routeTableName=name,routeTableId=id,
    disableBgpRoutePropagation=properties.disableBgpRoutePropagation) on routeTableId
    | project id,compliant = (disableBgpRoutePropagation == False or isnull(disableBgpRoutePropagation))
