name: aprl-MultiRegionWriteCapabilityMultipleRegions
title: Evaluate multi-region write capability
description: |-
  Multi-region write capability allows for designing applications that are highly available across multiple regions, though it demands careful attention to consistency requirements and conflict resolution. Improper setup may decrease availability and cause data corruption due to unhandled conflicts.
source:
  type: aprl
  file: azure-resources/DocumentDB/databaseAccounts/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.DocumentDB/databaseAccounts
severity: 0
labels:
  guid: 9ce78192-74a0-104c-b5bb-9a443f941649
  area: High Availability
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // Query to find Azure Cosmos DB accounts that have multiple read locations but do not have multiple write locations enabled
    Resources
    | where type =~ 'Microsoft.DocumentDb/databaseAccounts'
    | where
        array_length(properties.locations) > 1 and
        properties.enableMultipleWriteLocations == false
    | project recommendationId='9ce78192-74a0-104c-b5bb-9a443f941649', name, id, tags
