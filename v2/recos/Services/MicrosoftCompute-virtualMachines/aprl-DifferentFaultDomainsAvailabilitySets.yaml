name: aprl-DifferentFaultDomainsAvailabilitySets
title: Migrate VMs using availability sets to VMSS Flex
description: |-
  While availability sets are not scheduled for immediate deprecation, they are planned to be deprecated in the future. Migrate workloads from VMs to VMSS Flex for deployment across zones or within the same zone across different fault domains (FDs) and update domains (UDs) for better reliability.
source:
  type: aprl
  file: azure-resources/Compute/virtualMachines/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.Compute/virtualMachines
severity: 0
labels:
  guid: a8d25876-7951-b646-b4e8-880c9031596b
  area: High Availability
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // Find all VMs using Availability Sets
    resources
    | where type =~ 'Microsoft.Compute/virtualMachines'
    | where isnotnull(properties.availabilitySet)
    | project recommendationId = "a8d25876-7951-b646-b4e8-880c9031596b", name, id, tags, param1=strcat("availabilitySet: ",properties.availabilitySet.id)
