name: aprl-ProductionVmWorkloadsVmssFlexInstance
title: Run production workloads on two or more VMs using VMSS Flex
description: |-
  Production VM workloads should be deployed on multiple VMs and grouped in a VMSS Flex instance to intelligently distribute across the platform, minimizing the impact of platform faults and updates.
source:
  type: aprl
  file: azure-resources/Compute/virtualMachines/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.Compute/virtualMachines
severity: 0
labels:
  guid: 273f6b30-68e0-4241-85ea-acf15ffb60bf
  area: High Availability
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // Find all VMs that are not associated with a VMSS Flex instance
    resources
    | where type =~ 'Microsoft.Compute/virtualMachines'
    | where isnull(properties.virtualMachineScaleSet.id)
    | project recommendationId="273f6b30-68e0-4241-85ea-acf15ffb60bf", name, id, tags
