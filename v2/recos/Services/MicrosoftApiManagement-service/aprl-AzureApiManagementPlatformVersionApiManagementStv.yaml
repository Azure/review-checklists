name: aprl-AzureApiManagementPlatformVersionApiManagementStv
title: Azure API Management platform version should be stv2
description: |-
  Upgrading to API Management stv2 is required as stv1 retires on 31 Aug 2024, offering enhanced capabilities with the new platform version.
source:
  type: aprl
  file: azure-resources/ApiManagement/service/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.ApiManagement/service
severity: 0
labels:
  guid: e35cf148-8eee-49d1-a1c9-956160f99e0b
  area: High Availability
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // Find all API Management instances that aren't upgraded to platform version stv2
    resources
    | where type =~ 'Microsoft.ApiManagement/service'
    | extend plat_version = properties.platformVersion
    | extend skuName = sku.name
    | where tolower(plat_version) != tolower('stv2')
    | project recommendationId = "e35cf148-8eee-49d1-a1c9-956160f99e0b", name, id, tags, param1=strcat("Platform Version: ", plat_version) , param2=strcat("SKU: ", skuName)
