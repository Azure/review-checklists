name: aprl-StandardPublicLoadBalancerManualPortAllocation
title: Use NAT Gateway instead of Outbound Rules for Production Workloads
description: |-
  Outbound rules for Standard Public Load Balancer involve manual port allocation for backend pools, limiting scalability and risk of SNAT port exhaustion. NAT Gateway is recommended for its dynamic scaling and secure internet connectivity.
source:
  type: aprl
  file: azure-resources/Network/loadBalancers/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.Network/loadBalancers
severity: 1
labels:
  guid: 8d319a05-677b-944f-b9b4-ca0fb42e883c
  area: High Availability
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // Find all LoadBalancers with Outbound rules configured
    resources
    | where type =~ 'Microsoft.Network/loadBalancers'
    | extend outboundRules = array_length(properties.outboundRules)
    | where outboundRules > 0
    | project recommendationId = "8d319a05-677b-944f-b9b4-ca0fb42e883c", name, id, tags, Param1 = "outboundRules: >=1"
