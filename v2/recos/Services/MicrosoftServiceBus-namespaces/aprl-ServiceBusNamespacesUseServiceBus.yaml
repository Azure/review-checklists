name: aprl-ServiceBusNamespacesUseServiceBus
title: Enable Availability Zones for Service Bus namespaces
description: |-
  Use Service Bus with zone redundancy for high availability. The Premium SKU supports availability zones, ensuring isolation within the same region. It manages 3 copies of the messaging store, kept in sync.
source:
  type: aprl
  file: azure-resources/ServiceBus/namespaces/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.ServiceBus/namespaces
severity: 0
labels:
  guid: 20057905-262c-49fe-a9be-49f423afb359
  area: High Availability
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // Returns Service Bus namespaces that do not have any availability zones enabled
    resources
    | where type =~ 'Microsoft.ServiceBus/namespaces'
    | where properties.zoneRedundant == 'false'
    | project recommendationId = "20057905-262c-49fe-a9be-49f423afb359", name, id, tags, param1=strcat("zoneRedundant: ", properties.zoneRedundant), param2=strcat("SKU: ", sku.name), param3=iff(tolower(sku.name) == 'premium', 'Move Service Bus namespace to a region that supports Availability Zones', 'Migrate to Premium SKU in a region that supports Availability Zones')
