name: aprl-AzureAppConfigurationSoftDeletedStores
title: Enable Purge protection for Azure App Configuration
description: |-
  With Purge protection enabled, soft deleted stores can't be purged in the retention period. If disabled, the soft deleted store can be purged before the retention period expires.
source:
  type: aprl
  file: azure-resources/AppConfiguration/configurationStores/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.AppConfiguration/configurationStores
severity: 2
labels:
  guid: bb4c8db4-f821-475b-b1ea-16e95358665e
  area: Governance
links: []
queries:
  arg: |-
    // Azure Resource Graph Query
    // Purge protection should be enabled for App Configuration stores to prevent accidental deletion of configuration data.
    resources
    | where type =~ "Microsoft.AppConfiguration/configurationStores"
    | where sku.name <> "free"
    | where (properties.enablePurgeProtection <> true) or isnull(properties.enablePurgeProtection )
    | project recommendationId = "bb4c8db4-f821-475b-b1ea-16e95358665e", name, id, tags, param1 = "Enable purge protection"
