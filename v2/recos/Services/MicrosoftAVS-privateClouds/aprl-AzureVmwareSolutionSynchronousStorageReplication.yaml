name: aprl-AzureVmwareSolutionSynchronousStorageReplication
title: Enable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore
description: |-
  For Azure VMware Solution, enabling Stretched Clusters offers 99.99% SLA, synchronous storage replication (RPO=0), and spreads vSAN datastore across two AZs. Must be done at initial setup, needing double quota due to extension across AZs.
source:
  type: aprl
  file: azure-resources/AVS/privateClouds/recommendations.yaml
  timestamp: July 24, 2024
resourceTypes:
- Microsoft.AVS/privateClouds
severity: 2
labels:
  guid: 9ec5b4c8-3dd8-473a-86ee-3273290331b9
  area: High Availability
links: []
queries:
  arg: |
    // Azure Resource Graph Query
    // Provides a list of Azure VMware Solution resources that aren't configured as stretched clusters and in supported regions.
    resources
    | where ['type'] == "microsoft.avs/privateclouds"
    | extend avsproperties = todynamic(properties)
    | where avsproperties.availability.strategy != "DualZone"
    | where location in ("uksouth", "westeurope", "germanywestcentral", "australiaeast")
    | project recommendationId = "9ec5b4c8-3dd8-473a-86ee-3273290331b9", name, id, tags, param1 = "stretchClusters: Disabled"
