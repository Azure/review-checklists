{
    "items": [
        {
            "text": "Implement a proper Liveness probe",
            "description": "Many applications running for long periods of time eventually transition to broken states, and cannot recover except by being restarted. Kubernetes provides liveness probes to detect and remedy such situations. The probe is here to tell Kubernetes to restart your pod when it is not responding anymore",
            "guid": "2e9ed573-38b2-4856-a7f9-676d9ab604e1",
            "subcategory": "Application",
            "category": "Application Deployment",
            "severity": "High",
            "link": "https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/"
        },
        {
            "text": "Implement a proper Startup probe",
            "description": "Protect slow starting containers with startup probes. Startup probe allow to delay the initial check by liveness which could cause deadlock or wrong result",
            "guid": "a066989c-9dce-4712-bce3-4eef36f8c0c2",
            "subcategory": "Application",
            "category": "Application Deployment",
            "severity": "Medium",
            "link": "https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/"
        },
        {
            "text": "Implement a proper Readiness probe",
            "description": "Sometimes, applications are temporarily unable to serve traffic. For example, an application might need to load large data or configuration files during startup, or depend on external services after startup. In such cases, you don't want to kill the application, but you don't want to send it requests either. Kubernetes provides readiness probes to detect and mitigate these situations. A pod with containers reporting that they are not ready does not receive traffic through Kubernetes Services.",
            "guid": "de1b6b38-4fa9-4f6e-ab92-d824346dd20c",
            "subcategory": "Application",
            "category": "Application Deployment",
            "severity": "Medium",
            "link": "https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/"
        },
        {
            "text": "Implement a proper prestop hook",
            "description": "This hook is called immediately before a container is terminated due to an API request or management event such as liveness probe failure, preemption, resource contention and others. It can be used when you have critical process you want to finish or save when your pod is destroyed for any reason",
            "guid": "dc4828a3-fc4f-4ac5-8844-122b8482dbb1",
            "subcategory": "Application",
            "category": "Application Deployment",
            "severity": "Low",
            "link": "https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/"
        },
        {
            "text": "Run more than one replica for your Deployment",
            "description": "Ensure that your application always configure proper replicas to ensure resiliency in the event of a pod crashing or being evicted.",
            "guid": "4f1f88f9-98a3-48f5-a37f-4d9c9aecbb11",
            "subcategory": "Application",
            "category": "Application Deployment",
            "severity": "Medium",
            "link": "https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/"
        },
        {
            "text": "Apply tags/labels to all resources",
            "description": "Ensure that your components are tagged, it could be business, security or technical tags and these tags will help to assess or apply relevant policies.",
            "guid": "7b613b26-df38-49a8-94bf-c5301a91d558",
            "subcategory": "Application",
            "category": "Application Deployment",
            "severity": "Medium",
            "link": "https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels/"
        },
        {
            "text": "Use Azure Migrate to quick containerize your applications",
            "description": "The App Containerization tool offers a point-and-containerize approach to repackage applications as containers with minimal to no code changes by using the running state of the application. The tool currently supports containerizing ASP.NET applications and Java web applications running on Apache Tomcat.",
            "guid": "c1c05f94-4b74-4231-9d36-aa7a56fb775e",
            "subcategory": "Application",
            "category": "Application Deployment",
            "severity": "Low",
            "link": "https://aka.ms/AppContainerizationtoAKS"
        },
        {
            "text": "Apply the right deployment type to your application",
            "description": "There are a variety of techniques to deploy new applications to production so choosing the right strategy is an important decision that needs to be made to leverage the impact of change on the consumer.",
            "guid": "3abc7c0e-44c7-40fc-afce-aa4ddbf3dd81",
            "subcategory": "Application",
            "category": "Application Deployment",
            "severity": "Low",
            "link": "https://blog.container-solutions.com/deployment-strategies"
        },
        {
            "text": "Control the usage of imagePullPolicy",
            "description": "If this attributes is not properly define kubernetes downloads the container image for each new instance of the containers.",
            "guid": "d457598a-047b-4fd7-88e5-9c61dea67f6a",
            "subcategory": "Application",
            "category": "Application Deployment",
            "severity": "Low",
            "link": "https://kubernetes.io/docs/concepts/containers/images/#updating-images"
        },
        {
            "category": "Application Deployment",
            "subcategory": "Development",
            "text": "Use canary or blue/green deployments",
            "waf": "Operations",
            "guid": "785c2fa5-5b56-4ad4-a408-fe72734c476b",
            "cost": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/architecture/reference-architectures/containers/aks/secure-baseline-aks"
        },
        {
            "category": "Application Deployment",
            "subcategory": "Development",
            "text": "If required for AKS Windows workloads HostProcess containers can be used",
            "waf": "Reliability",
            "guid": "ab5351f6-383a-45ed-9c5e-b143b16db40a",
            "cost": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/use-windows-hpc"
        },
        {
            "category": "Application Deployment",
            "subcategory": "Development",
            "text": "Use KEDA if running event-driven workloads",
            "waf": "Performance",
            "guid": "a280dcf5-90ce-465d-b8e1-3f9ccbd46926",
            "scale": 1,
            "simple": -1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/azure-functions/functions-kubernetes-keda"
        },
        {
            "category": "Application Deployment",
            "subcategory": "Development",
            "text": "Use Dapr to ease microservice development",
            "waf": "Operations",
            "guid": "26886d20-b66c-457b-a591-19bf8e8f5c58",
            "simple": 1,
            "severity": "Low",
            "link": "https://dapr.io/"
        },
        {
            "category": "Application Deployment",
            "subcategory": "Infrastructure as Code",
            "text": "Use automation through ARM/TF to create your Azure resources",
            "waf": "Operations",
            "guid": "3acbe04b-be20-49d3-afda-47778424d116",
            "simple": -1,
            "ha": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/developer/terraform/create-k8s-cluster-with-tf-and-aks"
        },
        {
            "text": "Don't use naked pods",
            "description": "Naked pods are pods not linked to a Replicaset or a Deployment. Naked Pods will not be rescheduled in the event of a node failure.",
            "guid": "980e9f76-e20a-426a-9c01-cbae1b63c5e8",
            "subcategory": "Resiliency",
            "category": "Application Deployment",
            "severity": "Low",
            "link": ""
        },
        {
            "text": "Use Kubernetes namespaces to properly isolate your Kubernetes resources",
            "description": "Namespaces give you the ability to create logical partitions and enforce separation of your resources as well as limit the scope of user permissions. Don't forget not to use the Default namespace",
            "guid": "0b56d03c-5fc8-42b1-943b-9e4b4d0f3de8",
            "subcategory": "Security",
            "category": "Application Deployment",
            "severity": "Medium",
            "link": "https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/"
        },
        {
            "text": "Specify the security context of your pod/container",
            "description": "A security context defines privilege and access control settings for a Pod or Container. Control the capabilities and the rights your container can have. If you don't specify the security context, the pod get the 'default' one which may have more rights that it should",
            "guid": "20861805-be15-48f5-b40b-5ae203ddbb67",
            "subcategory": "Security",
            "category": "Application Deployment",
            "severity": "Medium",
            "link": "https://kubernetes.io/docs/tasks/configure-pod-container/security-context/"
        },
        {
            "text": "Conduct Dockerfile scanning to ensure Docker Image Security Best Practices",
            "description": "Define a Image build security baseline for your developers to follow. You should also use scanning tools to detect Dockerfile issue",
            "guid": "b5222fdc-72b7-4b5f-baae-ab48a69b1d36",
            "subcategory": "Security",
            "category": "Application Deployment",
            "severity": "High",
            "link": "https://snyk.io/blog/10-docker-image-security-best-practices/"
        },
        {
            "text": "Static Analysis of Docker Images on Build",
            "description": "Introduction of DevSecOps into the environment to promote a proactive security model that starts to shift the responsibility left",
            "guid": "54cbc938-394e-480a-823a-51c2bcd3c66b",
            "subcategory": "Security",
            "category": "Application Deployment",
            "severity": "High",
            "link": "https://docs.microsoft.com/azure/defender-for-cloud/defender-for-containers-introduction"
        },
        {
            "text": "Threshold enforcement of Docker Image Builds that contain vulnerabilities",
            "description": "Restrict builds with identified issues.",
            "guid": "1a67a172-c4ca-4383-8934-a71277cb927e",
            "subcategory": "Security",
            "category": "Application Deployment",
            "severity": "Medium",
            "link": "https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin-compute/vulnerability_management/vuln_management_rules.html"
        },
        {
            "text": "Compliance enforcement of Docker Image Builds",
            "description": "Being able to assess and restrict the Compliance state of an image on build.",
            "guid": "01ede997-e0bf-454a-bd1f-114be06a9874",
            "subcategory": "Security",
            "category": "Application Deployment",
            "severity": "High",
            "link": "https://docs.microsoft.com/azure/aks/policy-samples"
        },
        {
            "category": "BC and DR",
            "subcategory": "Disaster Recovery",
            "text": "Schedule and perform DR tests regularly",
            "waf": "Reliability",
            "guid": "36cb45e5-7960-4332-9bdf-8cc23318da61",
            "ha": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/business-continuity-and-disaster-recovery"
        },
        {
            "category": "BC and DR",
            "subcategory": "High Availability",
            "text": "Use Azure Traffic Manager or Azure Front Door as a global load balancer for region failover",
            "waf": "Reliability",
            "guid": "170265f4-bb46-4a39-9af7-f317284797b1",
            "ha": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-multi-region"
        },
        {
            "category": "BC and DR",
            "subcategory": "High Availability",
            "text": "Use Availability Zones if they are supported in your Azure region",
            "waf": "Reliability",
            "guid": "578a219a-46be-4b54-9350-24922634292b",
            "ha": 1,
            "severity": "Medium",
            "graph": "resources | where type=='microsoft.containerservice/managedclusters' | extend compliant= isnotnull(properties.agentPoolProfiles[0].availabilityZones) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/availability-zones"
        },
        {
            "category": "BC and DR",
            "subcategory": "High Availability",
            "text": "Use the SLA-backed AKS offering",
            "waf": "Reliability",
            "guid": "71d41e36-10cc-457b-9a4b-1410d4395898",
            "cost": -2,
            "ha": 2,
            "severity": "High",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (sku.tier=='Paid') | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/uptime-sla"
        },
        {
            "category": "BC and DR",
            "subcategory": "High Availability",
            "text": "Use Disruption Budgets in your pod and deployment definitions",
            "waf": "Reliability",
            "guid": "c1288b3c-6a57-4cfc-9444-51e1a3d3453a",
            "simple": -1,
            "ha": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-scheduler"
        },
        {
            "category": "BC and DR",
            "subcategory": "High Availability",
            "text": "If using a private registry, configure region replication to store images in multiple regions",
            "waf": "Reliability",
            "guid": "3c763963-7a55-42d5-a15e-401955387e5c",
            "cost": -1,
            "ha": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/container-registry/container-registry-geo-replication"
        },
        {
            "category": "BC and DR",
            "subcategory": "Requirements",
            "text": "Define non-functional requirements such as SLAs, RTO (Recovery Time Objective) and RPO (Recovery Point Objective).",
            "waf": "Reliability",
            "guid": "bc14aea6-e65d-48d9-a3ad-c218e6436b06",
            "ha": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/business-continuity-and-disaster-recovery"
        },
        {
            "text": "Plan for multiregion deployment",
            "description": "When you deploy multiple AKS clusters, choose regions where AKS is available, and use paired regions.",
            "guid": "4e907690-4780-492f-9632-03bcc80b7a80",
            "subcategory": "Resiliency",
            "category": "BC and DR",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment"
        },
        {
            "text": "Create a storage migration plan",
            "description": "Your applications might use Azure Storage for their data. Because your applications are spread across multiple AKS clusters in different regions, you need to keep the storage synchronized",
            "guid": "8c6703c5-42e9-46ef-93f1-7f6232af25fc",
            "subcategory": "Resiliency",
            "category": "BC and DR",
            "severity": "Low",
            "link": "https://docs.microsoft.com/azure/aks/operator-best-practices-multi-region#create-a-storage-migration-plan"
        },
        {
            "text": "Avoid Pods being placed into a single node",
            "description": "Even if you run several copies of your Pods, there are no guarantees that losing a node won't take down your service.",
            "guid": "1eea4888-8c2a-40b2-a40b-cacdc5f55497",
            "subcategory": "Resiliency",
            "category": "BC and DR",
            "severity": "Low",
            "link": "https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#inter-pod-affinity-and-anti-affinity"
        },
        {
            "text": "If using a private registry, configure region replication to store images in multiple regions",
            "description": "Companies that want a local presence, or a hot backup, choose to run services from multiple Azure regions.",
            "guid": "b0803aed-1ca6-4330-816c-92677c6e9935",
            "subcategory": "Resiliency",
            "category": "BC and DR",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/container-registry/container-registry-geo-replication"
        },
        {
            "category": "Cost Governance",
            "subcategory": "Cost",
            "text": "Use an external application such as kubecost to allocate costs to different users",
            "waf": "Cost",
            "guid": "f82cb8eb-8c0a-4a63-a25a-4956eaa8dc4a",
            "cost": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/cloud-adoption-framework/scenarios/aks/eslz-cost-governance-with-kubecost"
        },
        {
            "category": "Cost Governance",
            "subcategory": "Cost",
            "text": "If required scale NodePool snapshots",
            "waf": "Cost",
            "guid": "64d1a846-e28a-4b6b-9a33-22a635c15a21",
            "cost": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/node-pool-snapshot"
        },
        {
            "category": "Cost Governance",
            "subcategory": "Cost",
            "text": "Use scale down mode to delete/delallocate nodes",
            "waf": "Cost",
            "guid": "4d3dfbab-9924-4831-a68d-fdf0d72f462c",
            "cost": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/scale-down-mode"
        },
        {
            "category": "Cost Governance",
            "subcategory": "Cost",
            "text": "When required use multi-instance partioning GPU on AKS Clusters",
            "waf": "Cost",
            "guid": "87e651ea-bc4a-4a87-a6df-c06a4b570ebc",
            "cost": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/gpu-multi-instance"
        },
        {
            "category": "Cost Governance",
            "subcategory": "Cost",
            "text": "If running a Dev/Test cluster use NodePool Start/Stop",
            "waf": "Cost",
            "guid": "2b72a08b-0410-4cd6-9093-e068a5cf27e8",
            "cost": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/start-stop-nodepools"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Compliance",
            "text": "Use Azure Policy for Kubernetes to ensure cluster compliance",
            "waf": "Security",
            "guid": "9ca48e4a-85e2-4223-bce8-bb12307ca5f1",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (isnotnull(properties.addonProfiles.azurepolicy) and properties.addonProfiles.azurepolicy.enabled==true) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/governance/policy/concepts/policy-for-kubernetes"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Compliance",
            "text": "Separate applications from the control plane with user/system nodepools",
            "waf": "Security",
            "guid": "6f158e3e-a3a9-42c2-be7e-2165c3a87af4",
            "security": 1,
            "cost": -1,
            "simple": -1,
            "severity": "Medium",
            "graph": "where type=='microsoft.containerservice/managedclusters' | project id,resourceGroup,name,pools=properties.agentPoolProfiles | project id,name,resourceGroup,poolcount=array_length(pools) | extend compliant = (poolcount > 1)",
            "link": "https://learn.microsoft.com/azure/aks/use-system-pools"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Compliance",
            "text": "Add taint to your system nodepool to make it dedicated",
            "waf": "Security",
            "guid": "a7a1f893-9bda-4477-98f2-4c116775c2ea",
            "simple": -1,
            "ha": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/use-system-pools"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Compliance",
            "text": "Use a private registry for your images, such as ACR",
            "waf": "Security",
            "guid": "55b46a94-8008-4ae7-b7e4-b475b6c8bdbf",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/container-registry/"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Compliance",
            "text": "Scan your images for vulnerabilities",
            "waf": "Security",
            "guid": "59bce65d-e8a0-43f9-9879-468d66a786d6",
            "security": 1,
            "cost": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/security-center/container-security"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Compliance",
            "text": "Use Azure Security Center to detect security posture vulnerabilities",
            "waf": "Security",
            "guid": "cc639637-a652-42ac-89e8-06965388e9de",
            "security": 1,
            "cost": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/security-center/container-security"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Compliance",
            "text": "If required configure FIPS",
            "waf": "Security",
            "guid": "42d4aefe-2383-470e-b019-c30df24996b2",
            "security": 1,
            "cost": -1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/use-multiple-node-pools#add-a-fips-enabled-node-pool"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Compliance",
            "text": "Define app separation requirements (namespace/nodepool/cluster)",
            "waf": "Security",
            "guid": "d167dd18-2b0a-4c24-8b99-9a646f8389a7",
            "security": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-cluster-isolation"
        },
        {
            "text": "Check if you need the Kubernetes dashboard",
            "description": "Starting with Kubernetes version 1.19, AKS will no longer allow the managed Kubernetes dashboard add-on to be installed for security reasons, and the add-on is scheduled to be deprecated. Ensure the Kubernetes dashboard is not installed on the cluster.",
            "guid": "aefbf509-a9e8-46cc-8ae9-80f07acffd7c",
            "subcategory": "Compliance",
            "category": "Governance and Security",
            "severity": "Medium",
            "link": ""
        },
        {
            "text": "Use Mariner COS as host OS",
            "description": "Mariner Container-Optimized OS is a first-party operating system for Azure Kubernetes Service (AKS) that is optimized for running Kubernetes workloads. Mariner is a secure, lightweight, and highly performant operating system that is based on the open source project CoreOS Container Linux. Mariner is designed to be a secure, lightweight, and highly performant operating system that is based on the open source project CoreOS Container Linux. Mariner is designed to be a secure, lightweight, and highly performant operating system that is based on the open source project CoreOS Container Linux.",
            "guid": "d34f49c0-e964-4465-9211-520479338b13",
            "subcategory": "Operations",
            "category": "Governance and Security",
            "severity": "Medium",
            "link": "https://learn.microsoft.com/en-us/azure/aks/use-mariner"
        },
        {
            "text": "Refresh container when base image is updated",
            "description": "As you use base images for application images, use automation to build new images when the base image is updated. As those base images typically include security fixes, update any downstream application container images.",
            "guid": "22882284-a9c2-4e16-b3e3-2d4947cc24b8",
            "subcategory": "Resources",
            "category": "Governance and Security",
            "severity": "Low",
            "link": "https://docs.microsoft.com/azure/aks/operator-best-practices-container-image-management#automatically-build-new-images-on-base-image-update"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Secrets",
            "text": "Store your secrets in Azure Key Vault with the CSI Secrets Store driver",
            "waf": "Security",
            "guid": "5e3df584-eccc-4d97-a3b6-bcda3b50eb2e",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://github.com/Azure/secrets-store-csi-driver-provider-azure"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Secrets",
            "text": "If using Service Principals for the cluster, refresh credentials periodically (like quarterly)",
            "waf": "Security",
            "guid": "b03dda6d-58d7-4c89-8ddb-107d5769ae66",
            "security": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/update-credentials"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Secrets",
            "text": "If required add Key Management Service etcd encryption",
            "waf": "Security",
            "guid": "e7ba73a3-0508-4f80-806f-527db30cee96",
            "security": 1,
            "cost": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/use-kms-etcd-encryption"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Secrets",
            "text": "If required consider using Confidential Compute for AKS",
            "waf": "Security",
            "guid": "ec8e4e42-0344-41b0-b865-9123e8956d31",
            "security": 1,
            "cost": -1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/confidential-computing/confidential-nodes-aks-overview"
        },
        {
            "category": "Governance and Security",
            "subcategory": "Secrets",
            "text": "Consider using Defender for Containers",
            "waf": "Security",
            "guid": "c9e95ffe-6dd1-4a17-8c5f-110389ca9b21",
            "security": 1,
            "cost": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/defender-for-cloud/defender-for-containers-enable"
        },
        {
            "text": "Allow deploying containers only from known registries",
            "description": "One of the most common custom policies that you might want to consider is to restrict the images that can be deployed in your cluster. But it can also be addressed with a proper egress lockdown or using an admission controller",
            "guid": "8dcb9d27-a601-48e6-aeb8-e0469aaf8921",
            "subcategory": "Security",
            "category": "Governance and Security",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/governance/policy/concepts/rego-for-aks#built-in-policies"
        },
        {
            "text": "Runtime Security of Applications",
            "description": "Integrate Runtime Security for your pods.  To complete the defense in depth structure, ensure Runtime protection is in place to protect from process, network, storage and system call attacks.",
            "guid": "a71e024f-ac46-4d0e-86d8-fad9a86c99af",
            "subcategory": "Security",
            "category": "Governance and Security",
            "severity": "High",
            "link": "https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin-compute/runtime_defense.html"
        },
        {
            "text": "Quarantine of Docker Images in Docker Registries that have discovered issues",
            "description": "Use policy to protect images from drift while in the registry, on both push and pull.",
            "guid": "c970cb26-a707-4bf2-9e40-5401fea3d55b",
            "subcategory": "Security",
            "category": "Governance and Security",
            "severity": "High",
            "link": "https://github.com/Azure/acr/tree/master/docs/preview/quarantine"
        },
        {
            "text": "Role-Based Access Contol (RBAC) to Docker Registries",
            "description": "The Azure Container Registry service supports a set of built-in Azure roles that provide different levels of permissions to an Azure container registry. Use Azure role-based access control (RBAC) to assign specific permissions to users, service principals, or other identities that need to interact with a registry.",
            "guid": "3f703579-9f4a-43c4-8c40-5a9e78015379",
            "subcategory": "Security",
            "category": "Governance and Security",
            "severity": "High",
            "link": "https://docs.microsoft.com/azure/container-registry/container-registry-roles"
        },
        {
            "text": "Network Segmentation of Docker Registries",
            "description": "Limit access to a registry by assigning virtual network private IP addresses to the registry endpoints and using Azure Private Link. Network traffic between the clients on the virtual network and the registry's private endpoints traverses the virtual network and a private link on the Microsoft backbone network, eliminating exposure from the public internet. Private Link also enables enables private registry access from on-premises through Azure ExpressRoute private peering or a VPN gateway.",
            "guid": "6ae51d09-8142-4979-95ed-7ec3451de81c",
            "subcategory": "Security",
            "category": "Governance and Security",
            "severity": "High",
            "link": "https://docs.microsoft.com/azure/container-registry/container-registry-private-link"
        },
        {
            "text": "Prefer distroless images",
            "description": "When building a docker image, try to use the distroless version of the base OS image, to reduce the risk of vulnerabilities with preinstalled but unused tools. From example, use base-debian10 instead of debian10",
            "guid": "f57ba3a5-93ae-435f-9468-80ccd6a841b9",
            "subcategory": "Security",
            "category": "Governance and Security",
            "severity": "Medium",
            "link": "https://github.com/GoogleContainerTools/distroless"
        },
        {
            "text": "Policy blocking the deployment of vulnerable image",
            "description": "You can now protect your Kubernetes clusters and container workloads from potential threats by restricting deployment of container images with vulnerabilities in their software components.",
            "guid": "1f95a465-c682-405b-84b4-966c3a619c12",
            "subcategory": "Security",
            "category": "Governance and Security",
            "severity": "Medium",
            "link": "https://github.com/Azure/azure-policy/blob/master/built-in-policies/policyDefinitions/Kubernetes/BlockVulnerableImages.json"
        },
        {
            "text": "Use Azure Key Vault",
            "description": "Use Azure Key Vault to store Secrets and Certificates",
            "guid": "fc1e68dd-ac89-4851-8e53-8fbac3461d26",
            "subcategory": "Security",
            "category": "Governance and Security",
            "severity": "High",
            "link": "https://docs.microsoft.com/azure/key-vault/general/key-vault-integrate-kubernetes"
        },
        {
            "text": "Monitor the security of your cluster with Azure Security Center",
            "description": "Security Center brings security benefits to your AKS clusters using data already gathered by the AKS master node.",
            "guid": "23fda718-b80b-44c8-b2e4-d46580ab6651",
            "subcategory": "Security",
            "category": "Governance and Security",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/security-center/azure-kubernetes-service-integration"
        },
        {
            "text": "Remove vulnerable images from your cluster",
            "description": "With image cleaner, you can detect and automatically remove all unused and vulnerable images cached on AKS nodes keeping the nodes cleaner and safer.",
            "guid": "ca62d835-69cc-476d-bd8e-ea8fa58fab9c",
            "subcategory": "Security",
            "category": "Governance and Security",
            "severity": "High",
            "link": "https://learn.microsoft.com/en-us/azure/aks/image-cleaner"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "Use managed identities instead of Service Principals",
            "waf": "Security",
            "guid": "ed127dd1-42b0-46b2-8c69-99a646f3389a",
            "simple": 1,
            "severity": "High",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (properties.servicePrincipalProfile.clientId=='msi') | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/use-managed-identity"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "Integrate authentication with AAD (using the managed integration)",
            "waf": "Security",
            "guid": "7e42c78e-78c0-46a6-8a21-94956e698dc4",
            "simple": 1,
            "severity": "Medium",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = isnotnull(properties.aadProfile) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/managed-aad"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "Limit access to admin kubeconfig (get-credentials --admin)",
            "waf": "Security",
            "guid": "a2fe27b2-e287-401a-8352-beedf79b488d",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/control-kubeconfig-access"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "Integrate authorization with AAD RBAC",
            "waf": "Security",
            "guid": "eec4962c-c3bd-421b-b77f-26e5e6b3bec3",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/manage-azure-rbac"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "Use namespaces for restricting RBAC privilege in Kubernetes",
            "waf": "Security",
            "guid": "d4f3537c-1346-4dc5-9027-a71ffe1bd05d",
            "security": 1,
            "simple": -1,
            "ha": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-identity"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "For POD Identity Access Management use Azure AD Workload Identity (preview)",
            "waf": "Security",
            "guid": "d2e0d5d7-71d4-41e3-910c-c57b4a4b1410",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/workload-identity-migration-sidecar"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "For AKS non-interactive logins use kubelogin (preview)",
            "waf": "Security",
            "guid": "f4dcf690-1b30-407d-abab-6f8aa780d3a3",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/managed-aad#non-interactive-sign-in-with-kubelogin"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "Disable AKS local accounts",
            "waf": "Security",
            "guid": "b085b1f2-3119-4771-8c9a-bbf4411810ec",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (properties.disableLocalAccounts==true) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/managed-aad#disable-local-accounts"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "Configure if required Just-in-time cluster access",
            "waf": "Security",
            "guid": "36abb0db-c118-4f4c-9880-3f30f9a2deb6",
            "security": 1,
            "simple": -1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/managed-aad#configure-just-in-time-cluster-access-with-azure-ad-and-aks"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "Configure if required AAD conditional access for AKS",
            "waf": "Security",
            "guid": "c4d7f4c6-79bf-45d0-aa05-ce8fc717e150",
            "security": 1,
            "simple": -1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/managed-aad#use-conditional-access-with-azure-ad-and-aks"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "If required for Windows AKS workloads configure gMSA ",
            "waf": "Security",
            "guid": "e1123a7c-a333-4eb4-a120-4ee3f293c9f3",
            "security": 1,
            "simple": -1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/use-group-managed-service-accounts"
        },
        {
            "category": "Identity and Access Management",
            "subcategory": "Identity",
            "text": "For finer control consider using a managed Kubelet Identity",
            "waf": "Security",
            "guid": "1f711a74-3672-470b-b8b8-a2148d640d79",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/use-managed-identity#use-a-pre-created-kubelet-managed-identity"
        },
        {
            "text": "Use AKS and ACR integration without password",
            "description": "AKS can authenticate to ACR without using any password, but by using either Service Principal or Managed Identity.",
            "guid": "100f8f70-3ec6-44bb-ab07-95eef965e80d",
            "subcategory": "Security",
            "category": "Identity and Access Management",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/aks/cluster-container-registry-integration"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Best practices",
            "text": "If using AGIC, do not share an AppGW across clusters",
            "waf": "Reliability",
            "guid": "cbd8ac2a-aebc-4a2a-94da-1dbf3dc99248",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://azure.github.io/application-gateway-kubernetes-ingress/setup/install-existing/"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Best practices",
            "text": "Do not use AKS Application Routing Add-On",
            "waf": "Reliability",
            "guid": "8008ae7d-7e4b-4475-a6c8-bdbf59bce65d",
            "scale": 1,
            "simple": -1,
            "severity": "High",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (isnull(properties.addonProfiles.httpApplicationRouting) or properties.addonProfiles.httpApplicationRouting.enabled==false) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/http-application-routing"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Best practices",
            "text": "For Windows workloads use Accelerated Networking",
            "waf": "Performance",
            "guid": "7bacd7b9-c025-4a9d-a5d2-25d6bc5439d9",
            "scale": 1,
            "simple": -1,
            "severity": "Medium",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (isnull(properties.addonProfiles.httpApplicationRouting) or properties.addonProfiles.httpApplicationRouting.enabled==false) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/virtual-network/accelerated-networking-overview"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Best practices",
            "text": "Use the standard ALB (as opposed to the basic one)",
            "waf": "Reliability",
            "guid": "ba7da7be-9952-4914-a384-5d997cb39132",
            "scale": 1,
            "severity": "High",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (tolower(properties.networkProfile.loadBalancerSku)=='standard') | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/load-balancer-standard"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Best practices",
            "text": "If using Azure CNI, consider using different Subnets for NodePools",
            "waf": "Security",
            "guid": "22fbe8d6-9b40-47ef-9011-25bb1a555a6b",
            "security": 1,
            "simple": -2,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/use-multiple-node-pools#add-a-node-pool-with-a-unique-subnet"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Cost",
            "text": "Use Private Endpoints (preferred) or Virtual Network Service Endpoints to access PaaS services from the cluster",
            "waf": "Security",
            "guid": "c3c39c98-6bb2-4c12-859a-114b5e3df584",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/private-link/private-link-overview"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "HA",
            "text": "If hybrid connectivity is required, use 2xER or ER+VPN for better availability",
            "waf": "Reliability",
            "guid": "e8a03f97-8794-468d-96a7-86d60f96c97b",
            "cost": -1,
            "ha": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/expressroute/designing-for-disaster-recovery-with-expressroute-privatepeering"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "IPAM",
            "text": "Choose the best CNI network plugin for your requirements (Azure CNI recommended)",
            "waf": "Reliability",
            "guid": "a0f61565-9de5-458f-a372-49c831112dbd",
            "simple": 1,
            "severity": "High",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (properties.networkProfile.networkPlugin=='azure') | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-network"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "IPAM",
            "text": "If using Azure CNI, size your subnet accordingly considering the maximum number of pods per node",
            "waf": "Performance",
            "guid": "7faf12e7-0943-4f63-8472-2da29c2b1cd6",
            "scale": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/configure-azure-cni"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "IPAM",
            "text": "If using Azure CNI, check the maximum pods/node (default 30)",
            "waf": "Performance",
            "guid": "22f54b29-bade-43aa-b1e8-c38ec9366673",
            "scale": 1,
            "simple": -1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/configure-azure-cni"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "IPAM",
            "text": "If using private-IP LoadBalancer services, use a dedicated subnet (not the AKS subnet)",
            "description": "For internal apps organizations often open the whole AKS subnet in their firewalls. This opens network access to the nodes too, and potentially to the pods as well (if using Azure CNI). If LoadBalancer IPs are in a different subnet, only this one needs to be available to the app clients. Another reason is that if the IP addresses in the AKS subnet are a scarce resource, consuming its IP addresses for services will reduce the maximum scalability of the cluster .",
            "waf": "Security",
            "guid": "13c00567-4b1e-4945-a459-c373e7ed6162",
            "security": 1,
            "simple": -1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/internal-lb"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "IPAM",
            "text": "Size the service IP address range accordingly (it is going to limit the cluster scalability)",
            "waf": "Reliability",
            "guid": "43f63047-22d9-429c-8b1c-d622f54b29ba",
            "scale": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/configure-azure-cni"
        },
        {
            "text": "Enable traffic management",
            "description": "Azure Traffic Manager can direct customers to their closest AKS cluster and application instance. For the best performance and redundancy, direct all application traffic through Traffic Manager before it goes to your AKS cluster.",
            "guid": "5d0bb60d-b8e0-4031-9c5b-1f0a735f771f",
            "subcategory": "Network",
            "category": "Network Topology and Connectivity",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/aks/operator-best-practices-multi-region#use-azure-traffic-manager-to-route-traffic"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Operations",
            "text": "If required add your own CNI plugin",
            "waf": "Security",
            "guid": "57bf217f-6dc8-481c-81e2-785773e9c00f",
            "security": 1,
            "simple": -2,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/use-byo-cni"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Operations",
            "text": "If required configure Public IP per node in AKS",
            "waf": "Performance",
            "guid": "4b3bb365-9458-44d9-9ed1-5c8f52890364",
            "security": 1,
            "simple": -2,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/use-multiple-node-pools#assign-a-public-ip-per-node-for-your-node-pools"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Scalability",
            "text": "Use an ingress controller to expose web-based apps instead of exposing them with LoadBalancer-type services",
            "waf": "Reliability",
            "guid": "b3808b9f-a1cf-4204-ad01-3a923ce474db",
            "scale": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/concepts-network"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Scalability",
            "text": "Use Azure NAT Gateway as outboundType for scaling egress traffic",
            "waf": "Reliability",
            "guid": "ccb534e7-416e-4a1d-8e93-533b53199085",
            "scale": 1,
            "simple": -1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/nat-gateway"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Scalability",
            "text": "Use Dynamic allocations of IPs in order to avoid Azure CNI IP exhaustion",
            "waf": "Reliability",
            "guid": "8ee9a69a-1b58-4b1e-9c61-476e110a160b",
            "scale": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/configure-azure-cni#dynamic-allocation-of-ips-and-enhanced-subnet-support"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Security",
            "text": "Filter egress traffic with AzFW/NVA if your security requirements mandate it",
            "waf": "Security",
            "guid": "3b365a91-7ecb-4e48-bbe5-4cd7df2e8bba",
            "security": 2,
            "simple": -2,
            "severity": "High",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (properties.networkProfile.outboundType=='userDefinedRouting') | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/limit-egress-traffic"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Security",
            "text": "If using a public API endpoint, restrict the IP addresses that can access it",
            "waf": "Security",
            "guid": "c4581559-bb91-463e-a908-aed8c44ce3b2",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = ((isnull(properties.apiServerAccessProfile.enablePrivateCluster) or properties.apiServerAccessProfile.enablePrivateCluster==false) and isnotnull(properties.apiServerAccessProfile.authorizedIPRanges)) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/api-server-authorized-ip-ranges"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Security",
            "text": "Use private clusters if your requirements mandate it",
            "waf": "Security",
            "guid": "ecccd979-3b6b-4cda-9b50-eb2eb03dda6d",
            "security": 1,
            "simple": -1,
            "severity": "High",
            "graph": "where type=='microsoft.containerservice/managedclusters' | where isnotnull(properties.apiServerAccessProfile.enablePrivateCluster) | extend compliant = (properties.apiServerAccessProfile.enablePrivateCluster==true) | distinct id, compliant",
            "link": "https://learn.microsoft.com/azure/aks/private-clusters"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Security",
            "text": "For Windows 2019 and 2022 AKS nodes Calico Network Policies can be used ",
            "waf": "Security",
            "guid": "ce7f2a7c-297c-47c6-adea-a6ff838db665",
            "security": 1,
            "simple": -1,
            "severity": "Medium",
            "graph": "where type=='microsoft.containerservice/managedclusters' | where isnotnull(properties.apiServerAccessProfile.enablePrivateCluster) | extend compliant = (properties.apiServerAccessProfile.enablePrivateCluster==true) | distinct id, compliant",
            "link": "https://learn.microsoft.com/azure/aks/use-network-policies"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Security",
            "text": "Enable a Kubernetes Network Policy option (Calico/Azure)",
            "waf": "Security",
            "guid": "58d7c892-ddb1-407d-9769-ae669ca48e4a",
            "security": 1,
            "severity": "High",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = isnotnull(properties.networkProfile.networkPolicy) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/use-network-policies"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Security",
            "text": "Use Kubernetes network policies to increase intra-cluster security",
            "waf": "Security",
            "guid": "85e2223e-ce8b-4b12-907c-a5f16f158e3e",
            "security": 1,
            "simple": -1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-network"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Security",
            "text": "Use a WAF for web workloads (UIs or APIs)",
            "waf": "Security",
            "guid": "a3a92c2d-e7e2-4165-a3a8-7af4a7a1f893",
            "security": 2,
            "cost": -1,
            "simple": -1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-network"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Security",
            "text": "Use DDoS Standard in the AKS Virtual Network",
            "waf": "Security",
            "guid": "9bda4776-8f24-4c11-9775-c2ea55b46a94",
            "security": 2,
            "cost": -2,
            "severity": "Medium",
            "graph": "Resources | where type=~'microsoft.containerservice/managedclusters' | project resourceGroup,name,pools=properties.agentPoolProfiles | mv-expand pools | project subnetId=tostring(pools.vnetSubnetID) | where isnotempty(subnetId) | join (Resources | where type=='microsoft.network/virtualnetworks' | project id,resourceGroup,name,enableDdosProtection=tostring(properties.enableDdosProtection),subnets=properties.subnets | mv-expand subnets | project id,resourceGroup,name,enableDdosProtection,subnetId=tostring(subnets.id)) on subnetId | distinct id,resourceGroup,name,enableDdosProtection | extend compliant = (enableDdosProtection == 'true')",
            "link": "https://learn.microsoft.com/azure/virtual-network/ddos-protection-overview"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Security",
            "text": "If required add company HTTP Proxy",
            "waf": "Security",
            "guid": "6c46b91a-1107-4485-ad66-3183e2a8c266",
            "security": 2,
            "cost": -2,
            "severity": "Low",
            "graph": "Resources | where type=~'microsoft.containerservice/managedclusters' | project resourceGroup,name,pools=properties.agentPoolProfiles | mv-expand pools | project subnetId=tostring(pools.vnetSubnetID) | where isnotempty(subnetId) | join (Resources | where type=='microsoft.network/virtualnetworks' | project id,resourceGroup,name,enableDdosProtection=tostring(properties.enableDdosProtection),subnets=properties.subnets | mv-expand subnets | project id,resourceGroup,name,enableDdosProtection,subnetId=tostring(subnets.id)) on subnetId | distinct id,resourceGroup,name,enableDdosProtection | extend compliant = (enableDdosProtection == 'true')",
            "link": "https://learn.microsoft.com/azure/aks/http-proxy"
        },
        {
            "category": "Network Topology and Connectivity",
            "subcategory": "Security",
            "text": "Consider using a service mesh for advanced microservice communication management",
            "waf": "Security",
            "guid": "e9855d04-c3c3-49c9-a6bb-2c12159a114b",
            "security": 1,
            "simple": -2,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/servicemesh-about"
        },
        {
            "text": "Apply control on ingress hostnames",
            "description": "When a user creates an Ingress manifest, they can use any hostname in it. You may want to control which hostnames are allowed to use, like your company's hostnames.",
            "guid": "e5684a8b-f072-43d2-83b2-234ad48f57c7",
            "subcategory": "Security",
            "category": "Network Topology and Connectivity",
            "severity": "Low",
            "link": "https://www.openpolicyagent.org/docs/latest/kubernetes-tutorial/#4-define-a-policy-and-load-it-into-opa-via-kubernetes"
        },
        {
            "text": "Don't expose your load-balancer on Internet if not necessary",
            "description": "There is almost no reason to directly expose the ingress entry point to Internet but by default AKS create a public one. Tell him to create an internal one only.",
            "guid": "c0179fd4-470b-43c8-b7bb-80307051bc96",
            "subcategory": "Security",
            "category": "Network Topology and Connectivity",
            "severity": "High",
            "link": "https://docs.microsoft.com/azure/aks/ingress-internal-ip"
        },
        {
            "text": "Control traffic flow with network policies",
            "description": "Use network policies to allow or deny traffic to pods. By default, all traffic is allowed between pods within a cluster. For improved security, define rules that limit pod communication.",
            "guid": "0751f099-e6f4-4250-b405-d2b26c707432",
            "subcategory": "Security",
            "category": "Network Topology and Connectivity",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/aks/operator-best-practices-network#control-traffic-flow-with-network-policies",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = isnotnull(properties.networkProfile.networkPolicy) | distinct id,compliant",
            "security": 1
        },
        {
            "text": "Configure default network policies in each namespace",
            "description": "Start by creating a deny all policy in each namespace and then add specific policies.",
            "guid": "0bc4e0c6-97fd-411a-9eb4-1a1f85f9cdf0",
            "subcategory": "Security",
            "category": "Network Topology and Connectivity",
            "severity": "Medium",
            "link": "https://github.com/ahmetb/kubernetes-network-policy-recipes"
        },
        {
            "text": "Don't expose your container registry on Internet",
            "description": "When possible, use private link to only allow private network to reach your registry.",
            "guid": "e38f1680-8ddc-4c93-bf09-6b932a4935ca",
            "subcategory": "Security",
            "category": "Network Topology and Connectivity",
            "severity": "Low",
            "link": "https://docs.microsoft.com/azure/container-registry/container-registry-private-link"
        },
        {
            "text": "Bloc Pod access to VMSS IMDS",
            "description": "By default, Pods have access to VMSS IMDS and can request access token from the attached Managed Identity. This access should be restriced by using Network Policy.",
            "guid": "4fb072a7-0303-46d8-9ecf-d8aa4d69ff83",
            "subcategory": "Security",
            "category": "Network Topology and Connectivity",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/how-to-use-vm-token#get-a-token-using-curl"
        },
        {
            "text": "Use private clusters if your requirements mandate it",
            "description": "In a private cluster, the control plane or API server has internal IP addresses and is not exposed to Internet",
            "guid": "29fb411c-20a8-4c39-84df-aaa4227eaeb2",
            "subcategory": "Security",
            "category": "Network Topology and Connectivity",
            "severity": "High",
            "link": "https://docs.microsoft.com/azure/aks/private-clusters"
        },
        {
            "text": "If using a public API endpoint, restrict the IP addresses that can access it",
            "description": "To improve the security of your clusters and minimize the risk of attacks, we recommend limiting the IP address ranges that can access the API server.",
            "guid": "d783a3e8-264f-4dac-870f-569791d1837e",
            "subcategory": "Security",
            "category": "Network Topology and Connectivity",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/aks/api-server-authorized-ip-ranges"
        },
        {
            "text": "Verify non overlapping CIDR ranges for Service-CIDR and Pod-CIDR or Subnet-CIDR",
            "description": "The Service CIDR should not overlap with Pod CIDR or Subnet CIDR or even peered VNET CIDR. If not configured correctly, the cluster might have strange behavior.",
            "guid": "22fbe8d6-9b40-47ef-9011-25bb1a555a6c",
            "subcategory": "Security",
            "category": "Network Topology and Connectivity",
            "severity": "Medium",
            "link": "https://learn.microsoft.com/en-us/azure/aks/configure-azure-cni#plan-ip-addressing-for-your-cluster",
            "simple": -2,
            "security": 1
        },
        {
            "category": "Operations",
            "subcategory": "Alerting",
            "text": "Configure alerts on the most critical metrics (see Container Insights for recommendations)",
            "waf": "Operations",
            "guid": "67f7a9ed-5b31-4f38-a3f3-9812b2463cff",
            "simple": -1,
            "ha": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/azure-monitor/insights/container-insights-metric-alerts"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Check regularly Azure Advisor for recommendations on your cluster",
            "waf": "Operations",
            "guid": "337453a3-cc63-4963-9a65-22ac19e80696",
            "simple": -1,
            "ha": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/advisor/advisor-get-started"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Develop your YAML manifests with intelligent text editors such as vscode+kubeadvisor",
            "waf": "Operations",
            "guid": "5388e9de-d167-4dd1-a2b0-ac241b999a64",
            "simple": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-scheduler"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Enable AKS auto-certificate rotation",
            "waf": "Operations",
            "guid": "3aa70560-e7e7-4968-be3d-628af35b2ced",
            "simple": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/certificate-rotation"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Have a regular process to upgrade your kubernetes version periodically (quarterly, for example), or use the AKS autoupgrade feature",
            "waf": "Operations",
            "guid": "e189c599-df0d-45a7-9dd4-ce32c1881370",
            "security": 1,
            "simple": -1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/supported-kubernetes-versions"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Use kured for Linux node upgrades in case you are not using node-image upgrade",
            "waf": "Operations",
            "guid": "6f7c4c0d-4e51-4464-ad24-57ed67138b82",
            "simple": -1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/node-updates-kured"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Have a regular process to upgrade the cluster node images periodically (weekly, for example)",
            "waf": "Operations",
            "guid": "139c9580-ade3-426a-ba09-cf157d9f6477",
            "security": 1,
            "simple": -1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/node-image-upgrade"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Consider gitops to deploy applications or cluster configuration to multiple clusters",
            "waf": "Operations",
            "guid": "0102ce16-ee30-41e6-b882-e52e4621dd68",
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/architecture/example-scenario/bedrock/bedrock-automated-deployments"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Consider using AKS command invoke on private clusters",
            "waf": "Operations",
            "guid": "d7672c26-7602-4482-85a4-14527fbe855c",
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/command-invoke"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "For planned events consider using Node Auto Drain",
            "waf": "Operations",
            "guid": "31d7aaab-7571-4449-ab80-53d89e89d17b",
            "security": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/node-auto-repair#node-autodrain"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Develop own governance practices to make sure no changes are performed by operators in the node RG (aka 'infra RG')",
            "waf": "Operations",
            "guid": "ed0fda7f-211b-47c7-8b6e-c18873fb473c",
            "security": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/faq"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Use custom Node RG (aka 'Infra RG') name",
            "waf": "Operations",
            "guid": "73b32a5a-67f7-4a9e-b5b3-1f38c3f39812",
            "simple": 1,
            "severity": "Low",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (properties.nodeResourceGroup !startswith 'MC_') | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/cluster-configuration"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Do not use deprecated Kubernetes APIs in your YAML manifests",
            "waf": "Operations",
            "guid": "b2463cff-e189-4c59-adf0-d5a73dd4ce32",
            "simple": -1,
            "ha": 1,
            "severity": "Medium",
            "link": "https://kubernetes.io/docs/setup/release/notes/"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Taint Windows nodes",
            "waf": "Operations",
            "guid": "c1881370-6f7c-44c0-b4e5-14648d2457ed",
            "simple": -1,
            "ha": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure-stack/aks-hci/adapt-apps-mixed-os-clusters"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Keep windows containers patch level in sync with host patch level",
            "waf": "Operations",
            "guid": "67138b82-0102-4ce1-9ee3-01e6e882e52e",
            "severity": "Low",
            "link": "https://learn.microsoft.com/virtualization/windowscontainers/deploy-containers/version-compatibility?tabs=windows-server-20H2%2Cwindows-10-20H2"
        },
        {
            "category": "Operations",
            "subcategory": "Compliance",
            "text": "Send master logs (aka API logs) to Azure Monitor or your preferred log management solution",
            "description": "Via Diagnostic Settings at the cluster level",
            "waf": "Operations",
            "guid": "5b56ad48-408f-4e72-934c-476ba280dcf5",
            "cost": -1,
            "ha": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/monitor-aks"
        },
        {
            "category": "Operations",
            "subcategory": "Cost",
            "text": "Consider spot node pools for non time-sensitive workloads",
            "waf": "Operations",
            "guid": "c5a5b252-1e44-4a59-a9d2-399c4d7b68d0",
            "cost": 1,
            "simple": -1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/spot-node-pool"
        },
        {
            "category": "Operations",
            "subcategory": "Cost",
            "text": "Consider AKS virtual node for quick bursting",
            "waf": "Operations",
            "guid": "c755562f-2b4e-4456-9b4d-874a748b662e",
            "scale": 1,
            "simple": -1,
            "severity": "Low",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (isnotnull(properties.addonProfiles.aciConnectorLinux) and properties.addonProfiles.aciConnectorLinux.enabled==true) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/concepts-scale"
        },
        {
            "category": "Operations",
            "subcategory": "Monitoring",
            "text": "Monitor your cluster metrics with Container Insights (or other tools like Prometheus)",
            "waf": "Operations",
            "guid": "6f8389a7-f82c-4b8e-a8c0-aa63a25a4956",
            "simple": -1,
            "ha": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/azure-monitor/insights/container-insights-overview"
        },
        {
            "category": "Operations",
            "subcategory": "Monitoring",
            "text": "Store and analyze your cluster logs with Container Insights (or other tools like Telegraf/ElasticSearch)",
            "waf": "Operations",
            "guid": "eaa8dc4a-2436-47b3-9697-15b1752beee0",
            "simple": -1,
            "ha": 1,
            "severity": "High",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (isnotnull(properties.addonProfiles.omsagent) and properties.addonProfiles.omsagent.enabled==true) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/azure-monitor/insights/container-insights-overview"
        },
        {
            "category": "Operations",
            "subcategory": "Monitoring",
            "text": "Monitor CPU and memory utilization of the nodes",
            "waf": "Operations",
            "guid": "4621dd68-c5a5-4be2-bdb1-1726769ef669",
            "simple": -1,
            "ha": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/azure-monitor/containers/container-insights-analyze"
        },
        {
            "category": "Operations",
            "subcategory": "Monitoring",
            "text": "If using Azure CNI, monitor % of pod IPs consumed per node",
            "waf": "Operations",
            "guid": "1a4835ac-9422-423e-ae80-b123081a5417",
            "simple": -1,
            "ha": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/configure-azure-cni"
        },
        {
            "category": "Operations",
            "subcategory": "Monitoring",
            "text": "Monitor OS disk queue depth in nodes",
            "description": "I/O in the OS disk is a critical resource. If the OS in the nodes gets throttled on I/O, this could lead to unpredictable behavior, typically ending up in node being declared NotReady",
            "waf": "Operations",
            "guid": "415833ea-3ad3-4c2d-b733-165c3acbe04b",
            "simple": -1,
            "ha": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/virtual-machines/premium-storage-performance"
        },
        {
            "category": "Operations",
            "subcategory": "Monitoring",
            "text": "If not using egress filtering with AzFW/NVA, monitor standard ALB allocated SNAT ports",
            "waf": "Operations",
            "guid": "be209d39-fda4-4777-a424-d116785c2fa5",
            "simple": -1,
            "ha": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/load-balancer-standard"
        },
        {
            "category": "Operations",
            "subcategory": "Monitoring",
            "text": "Subscribe to resource health notifications for your AKS cluster",
            "waf": "Operations",
            "guid": "74c2ee76-569b-4a79-a57e-dedf91b022c9",
            "ha": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/aks-resource-health"
        },
        {
            "text": "Provision a log aggregation tool",
            "description": "Ensure that you are always aware of what happens in your cluster. Monitor the health of the cluster (nodes, server) but also the pods",
            "guid": "90640e42-ce36-4c2a-b20a-bee9c572df6c",
            "subcategory": "Monitoring",
            "category": "Operations",
            "severity": "High",
            "link": "https://docs.microsoft.com/azure/azure-monitor/insights/container-insights-analyze"
        },
        {
            "text": "Configure distributed tracing",
            "description": "Distributed tracing, also called distributed request tracing, is a method used to profile and monitor applications, especially those built using a microservices architecture. Distributed tracing helps pinpoint where failures occur and what causes poor performance.",
            "guid": "8d33b2b2-e043-4c61-aa5d-319a8eb6c382",
            "subcategory": "Monitoring",
            "category": "Operations",
            "severity": "Low",
            "link": "https://github.com/microsoft/Application-Insights-K8s-Codeless-Attach"
        },
        {
            "text": "Enable ContainerLogV2 schema for logging",
            "description": "ContainerLogV2 schema improves the data related to the container logs (such as namespace, pod name, container name, etc.) and allows you to query the logs using these fields",
            "guid": "62f89719-db42-4cd0-824f-82ac7d62d9ac",
            "subcategory": "Monitoring",
            "category": "Operations",
            "severity": "Medium",
            "link": "https://learn.microsoft.com/en-gb/azure/azure-monitor/containers/container-insights-logging-v2"
        },
        {
            "text": "If not using egress filtering with AzFW/NVA, monitor standard ALB allocated SNAT ports",
            "description": "Monitoring these ports are important for security reasons",
            "guid": "95951d87-1a2f-4a45-833c-2fc62d23c44d",
            "subcategory": "Monitoring",
            "category": "Operations",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/aks/load-balancer-standard"
        },
        {
            "text": "Apply different types of labels to all resources",
            "description": "A common set of labels allows tools to work interoperably, describing objects in a common manner that all tools can understand. For instance, resources should have technical, business and security labels. ",
            "guid": "13bb9e32-6f48-4747-9531-0147f20f4b04",
            "subcategory": "Multi-Tenancy",
            "category": "Operations",
            "severity": "Low",
            "link": "https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels/"
        },
        {
            "text": "Use placement proximity group to improve performance",
            "description": "When deploying your application in Azure, spreading Virtual Machine (VM) instances across regions or availability zones creates network latency, which may impact the overall performance of your application. A proximity placement group is a logical grouping used to make sure Azure compute resources are physically located close to each other",
            "guid": "17bd8ae4-8ee7-472d-bca5-c7e3cc9b6d82",
            "subcategory": "Operations",
            "category": "Operations",
            "severity": "Low",
            "link": "https://docs.microsoft.com/azure/aks/reduce-latency-ppg"
        },
        {
            "text": "Customize your clusters with extensions",
            "description": "Cluster extensions provides an Azure Resource Manager driven experience for installation and lifecycle management of services like Azure Machine Learning (ML) on an AKS cluster. ",
            "guid": "4cd9bd7a-fe6f-427b-b5dd-9ab2f50aa663",
            "subcategory": "Operations",
            "category": "Operations",
            "severity": "Low",
            "link": "https://docs.microsoft.com/en-gb/azure/aks/cluster-extensions",
            "ha": 1,
            "cost": -1,
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (isnotnull(properties.austoscalerProfile)) | distinct id,compliant"
        },
        {
            "text": "Regularly check for cluster issues ",
            "description": "Regularly run the latest version of cluster scanning open source tool to detect issues in your cluster. For instance, if you apply resource quotas on an existing AKS cluster, run kubestriker first to find pods that don't have resource requests and limits defined.",
            "guid": "4dd8b544-5b8b-443d-8e76-cea80d9dec30",
            "subcategory": "Operations",
            "category": "Operations",
            "severity": "Medium",
            "link": "https://github.com/Azure/aks-periscope"
        },
        {
            "text": "Set Upgrade Channel",
            "description": "In addition to manually upgrading a cluster, you can set an auto-upgrade channel on your cluster",
            "guid": "01deb8ed-b6f5-40bb-8d0b-d0ee2d933f51",
            "subcategory": "Operations",
            "category": "Operations",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/aks/upgrade-cluster#set-auto-upgrade-channel"
        },
        {
            "text": "Implement CI/CD to deploy workloads in your cluster",
            "description": "Instead of GitOps (or in addition) you can use CI/CD to deploy workloads/tools in your cluster",
            "guid": "cd943950-e336-4906-a719-d2128c8d78e4",
            "subcategory": "Operations",
            "category": "Operations",
            "severity": "High",
            "link": "https://learn.microsoft.com/en-gb/azure/aks/automated-deployments"
        },
        {
            "text": "Improve efficiency with K8S Tools",
            "description": "The Kubernetes ecosystem is strengthened by many tools that make operating it easier.  Here's a few",
            "guid": "fd926057-60e1-4d6c-afc2-0f03b5ab3763",
            "subcategory": "Operations",
            "category": "Operations",
            "severity": "Medium",
            "link": "https://k8slens.dev/"
        },
        {
            "text": "Don't use the default namespace",
            "description": "It's recommended to keep all applications in a namespace other than default",
            "guid": "13bb9e32-6f48-4747-9531-0147f20f4b03",
            "subcategory": "Operations",
            "category": "Operations",
            "severity": "Medium",
            "link": ""
        },
        {
            "text": "Write manifests following good practices using dedicated tools",
            "description": "There are various tools that can make creating k8s manifest files much easier and can help with operational efficiency",
            "guid": "b78f2dec-d75e-44c3-937a-7509fd7a54f1",
            "subcategory": "Operations",
            "category": "Operations",
            "severity": "Low",
            "link": "https://prettier.io/"
        },
        {
            "category": "Operations",
            "subcategory": "Resources",
            "text": "Configure requests and limits in your pod specs",
            "waf": "Operations",
            "guid": "b54eb2eb-03dd-4aa3-9927-18e2edb11726",
            "simple": -1,
            "ha": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-scheduler"
        },
        {
            "category": "Operations",
            "subcategory": "Resources",
            "text": "Enforce resource quotas for namespaces",
            "waf": "Operations",
            "guid": "769ef669-1a48-435a-a942-223ece80b123",
            "simple": -1,
            "ha": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-scheduler"
        },
        {
            "category": "Operations",
            "subcategory": "Resources",
            "text": "Ensure your subscription has enough quota to scale out your nodepools",
            "waf": "Operations",
            "guid": "081a5417-4158-433e-a3ad-3c2de733165c",
            "cost": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits"
        },
        {
            "category": "Operations",
            "subcategory": "Scalability",
            "text": "Use the Cluster Autoscaler",
            "waf": "Performance",
            "guid": "90ce65de-8e13-4f9c-abd4-69266abca264",
            "cost": -1,
            "ha": 1,
            "severity": "Medium",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (isnotnull(properties.autoScalerProfile)) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/concepts-scale"
        },
        {
            "category": "Operations",
            "subcategory": "Scalability",
            "text": "Customize node configuration for AKS node pools",
            "waf": "Performance",
            "guid": "831c2872-c693-4b39-a887-a561bada49bc",
            "cost": -1,
            "ha": 1,
            "severity": "Low",
            "graph": "where type=='microsoft.containerservice/managedclusters' | extend compliant = (isnotnull(properties.austoscalerProfile)) | distinct id,compliant",
            "link": "https://learn.microsoft.com/azure/aks/custom-node-configuration"
        },
        {
            "category": "Operations",
            "subcategory": "Scalability",
            "text": "Use the Horizontal Pod Autoscaler when required",
            "waf": "Performance",
            "guid": "faa19bfe-9d55-4d04-a3c4-919ca1b2d121",
            "scale": 1,
            "simple": -1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/concepts-scale"
        },
        {
            "category": "Operations",
            "subcategory": "Scalability",
            "text": "Consider an appropriate node size, not too large or too small",
            "description": "Larger nodes will bring higher performance and features such as ephemeral disks and accelerated networking, but they will increase the blast radius and decrease the scaling granularity",
            "waf": "Performance",
            "guid": "5ae124ba-34df-4585-bcdc-e9bd3bb0cdb3",
            "cost": 1,
            "severity": "High",
            "link": "https://blog.cloudtrooper.net/2020/10/23/which-vm-size-should-i-choose-as-aks-node/"
        },
        {
            "category": "Operations",
            "subcategory": "Scalability",
            "text": "If required for scalability consider adding more than 5000 nodes",
            "waf": "Performance",
            "guid": "38800e6a-ae01-40a2-9fbc-ae5a06e5462d",
            "cost": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/quotas-skus-regions#service-quotas-and-limits"
        },
        {
            "category": "Operations",
            "subcategory": "Scalability",
            "text": "Consider subscribing to EventGrid Events for AKS automation",
            "waf": "Performance",
            "guid": "9583c0f6-6083-43f6-aa6b-df7102c901bb",
            "cost": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/event-grid/event-schema-aks"
        },
        {
            "category": "Operations",
            "subcategory": "Scalability",
            "text": "For long running operation on an AKS cluster consider event termination",
            "waf": "Performance",
            "guid": "c5016d8c-c6c9-4165-89ae-673ef0fff19d",
            "cost": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/manage-abort-operations"
        },
        {
            "category": "Operations",
            "subcategory": "Scalability",
            "text": "If required consider using Azure Dedicated Hosts for AKS nodes",
            "waf": "Performance",
            "guid": "c4e37133-f186-4ce1-aed9-9f1b32f6e021",
            "cost": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/use-azure-dedicated-hosts"
        },
        {
            "text": "Have a regular process to upgrade the cluster node images periodically (weekly, for example), or use the AKS autoupgrade feature",
            "description": "AKS supports upgrading the images on a node so you're up to date with the newest OS and runtime updates. AKS provides one new image per week with the latest updates, so it's beneficial to upgrade your node's images regularly for the latest features, including Linux or Windows patches",
            "guid": "945889a8-a9e9-4059-b1aa-0a0df2b8a82c",
            "subcategory": "Security",
            "category": "Operations",
            "severity": "High",
            "link": "https://docs.microsoft.com/azure/aks/node-image-upgrade"
        },
        {
            "text": "Securely connect to nodes through a bastion host",
            "description": "Don't expose remote connectivity to your AKS nodes. Create a bastion host, or jump box, in a management virtual network. Use the bastion host to securely route traffic into your AKS cluster to remote management tasks.",
            "guid": "28538587-2c1f-4390-b571-384649732c16",
            "subcategory": "Security",
            "category": "Operations",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/aks/operator-best-practices-network#securely-connect-to-nodes-through-a-bastion-host"
        },
        {
            "category": "Operations",
            "subcategory": "Storage",
            "text": "Use ephemeral OS disks",
            "waf": "Performance",
            "guid": "24367b33-6971-45b1-952b-eee0b9b588de",
            "cost": -1,
            "scale": 1,
            "severity": "High",
            "graph": "where type=='microsoft.containerservice/managedclusters' | project id,resourceGroup,name,pools=properties.agentPoolProfiles | mvexpand pools | extend compliant = (pools.osDiskType=='Ephemeral') | project id,name=strcat(name,'-',pools.name), resourceGroup, compliant",
            "link": "https://learn.microsoft.com/azure/aks/cluster-configuration"
        },
        {
            "category": "Operations",
            "subcategory": "Storage",
            "text": "For non-ephemeral disks, use high IOPS and larger OS disks for the nodes when running many pods/node since it requires high performance for running multiple pods and will generate huge logs with default AKS log rotation thresholds",
            "waf": "Performance",
            "guid": "fc4972cc-3cd2-45bf-a707-6e9eab4bed32",
            "cost": -1,
            "scale": 1,
            "severity": "High",
            "link": "https://learn.microsoft.com/azure/virtual-machines/disks-types"
        },
        {
            "category": "Operations",
            "subcategory": "Storage",
            "text": "For hyper performance storage option use Ultra Disks on AKS",
            "waf": "Performance",
            "guid": "39c486ce-d5af-4062-89d5-18bb5fd795db",
            "cost": -1,
            "scale": 1,
            "severity": "Low",
            "link": "https://learn.microsoft.com/azure/aks/use-ultra-disks"
        },
        {
            "category": "Operations",
            "subcategory": "Storage",
            "text": "Avoid keeping state in the cluster, and store data outside (AzStorage, AzSQL, Cosmos, etc)",
            "waf": "Performance",
            "guid": "9f7547c1-747d-4c56-868a-714435bd19dd",
            "simple": -1,
            "ha": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-multi-region"
        },
        {
            "category": "Operations",
            "subcategory": "Storage",
            "text": "If using AzFiles Standard, consider AzFiles Premium and/or ANF for performance reasons",
            "waf": "Performance",
            "guid": "24429eb7-2281-4376-85cc-57b4a4b18142",
            "cost": -1,
            "scale": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/operator-best-practices-storage"
        },
        {
            "category": "Operations",
            "subcategory": "Storage",
            "text": "If using Azure Disks and AZs, consider having nodepools within a zone for LRS disk with VolumeBindingMode:WaitForFirstConsumer for provisioning storage in right zone or use ZRS disk for nodepools spanning multiple zones",
            "waf": "Performance",
            "guid": "83958a8c-2689-4b32-ab57-cfc64546135a",
            "simple": -1,
            "ha": 1,
            "severity": "Medium",
            "link": "https://learn.microsoft.com/azure/aks/availability-zones#azure-disk-availability-zone-support"
        },
        {
            "text": "Logically isolate cluster",
            "description": "Use logical isolation to separate teams and projects. Try to minimize the number of physical AKS clusters you deploy to isolate teams or applications",
            "guid": "49be78dc-6ff0-4b2c-94ef-e74002e18866",
            "subcategory": "Multi-Tenancy",
            "category": "Resource Organization and Cost Governance",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/aks/operator-best-practices-cluster-isolation#logically-isolate-clusters"
        },
        {
            "text": "Burst serverless with Azure Container Instances and Virtual Nodes",
            "description": "To rapidly scale your AKS cluster, you can integrate with Azure Container Instances (ACI)",
            "guid": "c88681ab-bb2b-46d1-9ea6-72564b75429a",
            "subcategory": "Operations",
            "category": "Resource Organization and Cost Governance",
            "severity": "Low",
            "link": "https://learn.microsoft.com/en-gb/azure/aks/concepts-scale#burst-to-azure-container-instances"
        },
        {
            "text": "Use ARM64 nodes when possible",
            "description": "Benefit from ARM64's better price, compute performance, and lower power utilization in AKS node pools.",
            "guid": "2a5f0cab-92b2-46dc-81a6-d358f7fd062a",
            "subcategory": "Operations",
            "category": "Resource Organization and Cost Governance",
            "severity": "Medium",
            "link": "https://learn.microsoft.com/en-us/azure/aks/use-multiple-node-pools#add-an-arm64-node-pool"
        },
        {
            "text": "Use Azure tags in Azure Kubernetes Service (AKS)",
            "description": "With Azure Kubernetes Service (AKS), you can set Azure tags on an AKS cluster and its related resources by using Azure Resource Manager, through the Azure CLI.",
            "guid": "574bd2fe-f58b-4199-b334-f7eff3ef90c8",
            "subcategory": "Operations",
            "category": "Resource Organization and Cost Governance",
            "severity": "Medium",
            "link": "https://learn.microsoft.com/en-us/Azure/aks/use-tags"
        },
        {
            "text": "Namespaces should have LimitRange",
            "description": " A LimitRange is a policy to constrain resource allocations (to Pods or Containers) in a namespace. It's useful to ensure that pods don't forget to declare request limits",
            "guid": "b74ea93b-598d-48e0-bb26-762b015602e1",
            "subcategory": "Resiliency",
            "category": "Resource Organization and Cost Governance",
            "severity": "Low",
            "link": "https://kubernetes.io/docs/concepts/policy/limit-range/"
        },
        {
            "text": "Set memory limits and requests for all containers",
            "description": "Set CPU and memory limits and requests to all the containers. It prevents memory leaks and CPU over-usage and protects the whole platform",
            "guid": "4868aa30-95a9-49fd-867e-57e70cb0d1d5",
            "subcategory": "Resiliency",
            "category": "Resource Organization and Cost Governance",
            "severity": "Medium",
            "link": "https://learn.microsoft.com/en-gb/azure/aks/developer-best-practices-resource-management#define-pod-resource-requests-and-limits"
        },
        {
            "text": "Sizing of the nodes",
            "description": "what type of worker nodes should I use, and how many of them is a critical question which requires the analysis of the workloads deployed on your cluster to get the best values of it",
            "guid": "7f8b07c5-882b-45ba-9ec9-bcc29b4721ff",
            "subcategory": "Resources",
            "category": "Resource Organization and Cost Governance",
            "severity": "Medium",
            "link": "https://learnk8s.io/kubernetes-node-size"
        },
        {
            "text": "Physically isolate cluster",
            "description": "Minimize the use of physical isolation for each separate team or application deployment",
            "guid": "3b77c0ee-3f84-4a86-bb46-c6dc3070168c",
            "subcategory": "other",
            "category": "Resource Organization and Cost Governance",
            "severity": "High",
            "link": "https://docs.microsoft.com/azure/aks/operator-best-practices-cluster-isolation#physically-isolate-clusters"
        },
        {
            "text": "Choose the right storage type",
            "description": "Understand the needs of your application to pick the right storage. Use high performance, SSD-backed storage for production workloads. Plan for network-based storage when there is a need for multiple concurrent connections.",
            "guid": "4c20c4bd-a7e3-449f-9597-4939a3aeafe7",
            "subcategory": "Storage",
            "category": "Storage",
            "severity": "High",
            "link": "https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/scenarios/app-platform/aks/storage"
        },
        {
            "text": "Size the nodes for storage needs",
            "description": "Each node size supports a maximum number of disks. Different node sizes also provide different amounts of local storage and network bandwidth. Plan for your application demands to deploy the appropriate size of nodes.",
            "guid": "18707174-fa23-4935-b463-8f9982629b35",
            "subcategory": "Storage",
            "category": "Storage",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/aks/operator-best-practices-storage#size-the-nodes-for-storage-needs"
        },
        {
            "text": "Dynamically provision volumes",
            "description": "To reduce management overhead and let you scale, don't statically create and assign persistent volumes. Use dynamic provisioning. In your storage classes, define the appropriate reclaim policy to minimize unneeded storage costs once pods are deleted.",
            "guid": "77bda7ce-1fcf-4735-bd3d-1b3a83a9e484",
            "subcategory": "Storage",
            "category": "Storage",
            "severity": "Low",
            "link": "https://docs.microsoft.com/azure/aks/operator-best-practices-storage#dynamically-provision-volumes"
        },
        {
            "text": "Secure and back up your data",
            "description": "Back up your data using an appropriate tool for your storage type, such as Velero or Azure Site Recovery",
            "guid": "13d493b9-2cdc-4632-b188-6882b81da0ed",
            "subcategory": "Storage",
            "category": "Storage",
            "severity": "Medium",
            "link": "https://docs.microsoft.com/azure/aks/operator-best-practices-storage#secure-and-back-up-your-data"
        },
        {
            "text": "Avoid keeping state in the cluster, and store data outside (AzStorage, AzSQL, Cosmos, etc)",
            "description": "Where possible, don't store service state inside the container. Instead, use an Azure platform as a service (PaaS) that supports multiregion replication.",
            "guid": "b5f3808d-3a6a-42a5-adde-7bb34e047169",
            "subcategory": "Storage",
            "category": "Storage",
            "severity": "Medium",
            "link": "https://learn.microsoft.com/en-us/azure/aks/operator-best-practices-multi-region#remove-service-state-from-inside-containers"
        },
        {
            "text": "Map the base image to node OS",
            "description": "Windows has strict compatibility rules, where the host OS version must match the container base image OS version. Only Windows containers with a container operating system of Windows Server 2019 are supported.",
            "guid": "4d3e8a06-b724-43a3-b9b9-328a08325c61",
            "subcategory": "Windows",
            "category": "Windows",
            "severity": "High",
            "link": "https://docs.microsoft.com/virtualization/windowscontainers/deploy-containers/version-compatibility"
        },
        {
            "text": "Prepare your application for an abrupt kill",
            "description": "TerminationGracePeriod is not implemented on Windows containers",
            "guid": "fce3ccf3-5f62-4ad6-b945-845362777529",
            "subcategory": "Windows",
            "category": "Windows",
            "severity": "Medium",
            "link": "https://cloud.google.com/blog/products/gcp/kubernetes-best-practices-terminating-with-grace"
        },
        {
            "text": "Don't use privileged containers",
            "description": "Windows containers do not support elevation of privilege",
            "guid": "bd773172-40dc-4502-b284-137c70d77bc9",
            "subcategory": "Windows",
            "category": "Windows",
            "severity": "Medium",
            "link": "https://kubernetes.io/docs/setup/production-environment/windows/intro-windows-in-kubernetes/#supported-functionality-and-limitations"
        },
        {
            "text": "Watch for memory usage",
            "description": "There are no OOM eviction actions taken by the kubelet. Windows always treats all user-mode memory allocations as virtual, and pagefiles are mandatory. If memory is over-provisioned and all physical memory is exhausted, then paging can slow down performance.",
            "guid": "dea429d5-2c10-480c-85a1-9d9d0c4afc3d",
            "subcategory": "Windows",
            "category": "Windows",
            "severity": "Medium",
            "link": "https://kubernetes.io/docs/setup/production-environment/windows/intro-windows-in-kubernetes/#supported-functionality-and-limitations"
        },
        {
            "text": "Implement CNI network mode",
            "description": "AKS clusters with Windows node pools must use the Azure CNI (advanced) networking model. Kubenet (basic) networking is not supported. ",
            "guid": "3922e5b0-fa6b-4020-a92e-2e0d76338e95",
            "subcategory": "Windows",
            "category": "Windows",
            "severity": "High",
            "link": "https://docs.microsoft.com/azure/aks/windows-node-limitations#what-network-plug-ins-are-supported"
        },
        {
            "text": "Secure the traffic of your containers",
            "description": "Network policies are currently not supported, ensure that the containerized applications have a layer of protection like authentication ",
            "guid": "74e42965-8bbd-46fb-b027-ccad9c3933a4",
            "subcategory": "Windows",
            "category": "Windows",
            "severity": "High",
            "link": "https://kubernetes.io/docs/setup/production-environment/windows/intro-windows-in-kubernetes/#supported-functionality-and-limitations"
        }
    ],
    "categories": [
        {
            "name": "Identity and Access Management"
        },
        {
            "name": "Network Topology and Connectivity"
        },
        {
            "name": "BC and DR"
        },
        {
            "name": "Governance and Security"
        },
        {
            "name": "Cost Governance"
        },
        {
            "name": "Operations"
        },
        {
            "name": "Application Deployment"
        }
    ],
    "waf": [
        {
            "name": "Reliability"
        },
        {
            "name": "Security"
        },
        {
            "name": "Cost"
        },
        {
            "name": "Operations"
        },
        {
            "name": "Performance"
        }
    ],
    "status": [
        {
            "name": "Not verified",
            "description": "This check has not been looked at yet"
        },
        {
            "name": "Open",
            "description": "There is an action item associated to this check"
        },
        {
            "name": "Fulfilled",
            "description": "This check has been verified, and there are no further action items associated to it"
        },
        {
            "name": "Not required",
            "description": "Recommendation understood, but not needed by current requirements"
        },
        {
            "name": "N/A",
            "description": "Not applicable for current design"
        }
    ],
    "severities": [
        {
            "name": "High"
        },
        {
            "name": "Medium"
        },
        {
            "name": "Low"
        }
    ],
    "metadata": {
        "name": "Azure AKS Review",
        "state": "GA",
        "timestamp": "03/24/2023 14:56:32"
    }
}