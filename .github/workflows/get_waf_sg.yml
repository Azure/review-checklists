name: Get WAF service guide recommendations
on:
    # schedule:
    #     - cron: '0 0 * * 0'  # every Sunday at midnight
    workflow_dispatch:
jobs:
  get-waf-service-guides:
    runs-on: ubuntu-latest
    steps:
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v2
    # Get AKS service guide recos
    - name: Retrieve the AKS WAF service guide
      uses: ./.github/actions/get_service_guides
      with:
        service: 'Azure Kubernetes Service'
        output_folder: './checklists'
        verbose: 'true'
    # Get Azure Firewall service guide recos
    - name: Retrieve the AKS WAF service guide
      uses: ./.github/actions/get_service_guides
      with:
        service: 'Azure Firewall'
        output_folder: './checklists'
        verbose: 'true'
    # Create a PR
    - name: Create pull request
      uses: peter-evans/create-pull-request@v3.10.1
      with:
        title: 'Latest version of the WAF service guides retrieved'
        body: 'This PR contains the latest changes in the WAF service guide recommendations.'
        token: ${{ secrets.WORKFLOW_PAT }}
